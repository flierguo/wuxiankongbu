import * as åœ°å›¾ from './_æ ¸å¿ƒéƒ¨åˆ†/_åœ°å›¾/åœ°å›¾';
import { æ™ºèƒ½è®¡ç®— } from "./_å¤§æ•°å€¼/æ ¸å¿ƒè®¡ç®—æ–¹æ³•";
import * as _P_Base from "./_æ ¸å¿ƒéƒ¨åˆ†/åŸºç¡€å¸¸é‡";
import { ç¥å™¨å¥—è£…é…ç½® } from "./_æ ¸å¿ƒéƒ¨åˆ†/_è£…å¤‡/ç¥å™¨ç»Ÿè®¡";
import { æµ‹è¯•å¥—è£…, å¥—è£…é…ç½®è¡¨ } from "./_æ ¸å¿ƒéƒ¨åˆ†/_è£…å¤‡/éšæœºå¥—è£…";
import { è£…å¤‡å±æ€§ç»Ÿè®¡ } from "./_æ ¸å¿ƒéƒ¨åˆ†/_è£…å¤‡/å±æ€§ç»Ÿè®¡";
import * as åŠŸèƒ½ from "./_æ ¸å¿ƒéƒ¨åˆ†/_åŠŸèƒ½";
import { æ’å…¥, åˆ›å»ºè¡¨, è·å–å½“å‰æ—¶é—´ } from "./_æ ¸å¿ƒéƒ¨åˆ†/_æœåŠ¡/_æ•°æ®åº“";

// GMæ“ä½œæ—¥å¿—è¡¨SQL
const GMæ—¥å¿—è¡¨SQL = `
CREATE TABLE IF NOT EXISTS GMæ“ä½œæ—¥å¿— (
    id INT AUTO_INCREMENT PRIMARY KEY,
    æ“ä½œæ—¶é—´ DATETIME NOT NULL,
    æœåŠ¡å™¨ VARCHAR(100) NOT NULL,
    GMè´¦å· VARCHAR(100) NOT NULL,
    æ“ä½œç±»å‹ VARCHAR(50) NOT NULL,
    ç›®æ ‡ç©å®¶ VARCHAR(100),
    æ“ä½œå†…å®¹ TEXT,
    åˆ›å»ºæ—¶é—´ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_æ“ä½œæ—¶é—´ (æ“ä½œæ—¶é—´),
    INDEX idx_GMè´¦å· (GMè´¦å·)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
`;

let GMæ—¥å¿—è¡¨å·²åˆå§‹åŒ– = false;

export function æ‰§è¡Œæ€§èƒ½æµ‹è¯•(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    try {
        console.log('ğŸ§ª [å®šæ—¶å™¨é›†æˆ] å¼€å§‹æ‰§è¡Œæ€§èƒ½æµ‹è¯•...');
    } catch (error) {
        console.log('âŒ [å®šæ—¶å™¨é›†æˆ] æ€§èƒ½æµ‹è¯•å¤±è´¥:', error);
    }
}
//ç‰ˆæœ¬åå°UIèŒƒä¾‹.ts
export function CreateAdminUI() {
    //-------------------------------------------------------------å¢åŠ ä¸€ä¸ªæ•°æ®åº“æ§åˆ¶é¡µé¢-------------------------------------------------------------
    GameLib.AdminUI.AddPage("æ•°æ®åº“é¡µ", 100, 30, 3)
    GameLib.AdminUI.AddButton('æ•°æ®åº“é¡µ', 'é‡æ–°åŠ è½½è„šæœ¬')
    GameLib.AdminUI.AddButton('æ•°æ®åº“é¡µ', 'æ¸…ç©ºå…¨æœæ€ªç‰©')
    GameLib.AdminUI.AddButton('æ•°æ®åº“é¡µ', 'æµ‹è¯•åŠŸèƒ½è¾“å‡º')

    //-------------------------------------------------------------å¢åŠ ä¸€ä¸ªGMç®¡ç†é¡µé¢----------------------------------------------------------------
    GameLib.AdminUI.AddPage("GMç®¡ç†", 180, 40, 3)
    GameLib.AdminUI.AddEdit('GMç®¡ç†', 'ç»™ç©å®¶åˆ·ç‰©å“', 'ç©å®¶å-ç‰©å“å-æ•°é‡', 'æ ¼å¼ï¼šç©å®¶å-ç‰©å“å-æ•°é‡')
    GameLib.AdminUI.AddEdit('GMç®¡ç†', 'ç»™ç©å®¶åˆ·å±æ€§', 'ç©å®¶å-æ•°é‡-ç±»å‹', 'ç±»å‹ï¼š1å……å€¼ 2å…ƒå® 3å›æ”¶ 4çˆ†ç‡ 5ç­‰çº§')
    GameLib.AdminUI.AddEdit('GMç®¡ç†', 'ç»™ä¸ç¥å™¨å¥—è£…', 'ç©å®¶å-å¥—è£…å', 'ç»™äºˆç©å®¶æ•´å¥—ç¥å™¨ç»„ä»¶')
    GameLib.AdminUI.AddEdit('GMç®¡ç†', 'åˆ·å¥—è£…è£…å¤‡', 'ç©å®¶å-å¥—è£…å-è£…å¤‡å', 'ç»™äºˆå¸¦å¥—è£…å±æ€§çš„è£…å¤‡')
    GameLib.AdminUI.AddEdit('GMç®¡ç†', 'å­¦ä¹ æŠ€èƒ½', 'ç©å®¶å-æŠ€èƒ½å', 'ç»™ç©å®¶å­¦ä¹ æŠ€èƒ½')
    GameLib.AdminUI.AddEdit('GMç®¡ç†', 'ä¼ é€ç©å®¶', 'ç©å®¶å-åœ°å›¾å', 'ä¼ é€ç©å®¶åˆ°æŒ‡å®šåœ°å›¾')
    GameLib.AdminUI.AddEdit('GMç®¡ç†', 'ä¿®æ”¹å……å€¼ç‚¹', 'ç©å®¶å-å……å€¼ç‚¹æ•°', 'æ­£æ•°åŠ ï¼Œè´Ÿæ•°å‡ï¼Œæ ¼å¼ï¼šç©å®¶å-ç‚¹æ•°')
    GameLib.AdminUI.AddButton('GMç®¡ç†', 'æŸ¥çœ‹ç¥å™¨å¥—è£…åˆ—è¡¨', 'ç‚¹å‡»æŸ¥çœ‹æ‰€æœ‰ç¥å™¨å¥—è£…åç§°')
    GameLib.AdminUI.AddButton('GMç®¡ç†', 'æŸ¥çœ‹è£…å¤‡å¥—è£…åˆ—è¡¨', 'ç‚¹å‡»æŸ¥çœ‹æ‰€æœ‰è£…å¤‡å¥—è£…åç§°')

    //-------------------------------------------------------------å¢åŠ ä¸€ä¸ªåœ°å›¾æ§åˆ¶é¡µé¢----------------------------------------------------------------
    //åˆ›å»ºä¸€ä¸ªåå°ç®¡ç†é¡µé¢ åç§°å«åœ°å›¾æ§åˆ¶ æ§ä»¶åƒç´ å®½åº¦ 160 é«˜åº¦ 40 ,æ¯4ä¸ªä¸ºä¸€åˆ—
    GameLib.AdminUI.AddPage("åœ°å›¾æ§åˆ¶", 160, 40, 4)
    //åœ¨åœ°å›¾æ§åˆ¶é¡µé¢åˆ›å»ºä¸€ä¸ª åç§°ä¸º é¼ æ ‡ç§»åŠ¨æœ‰æç¤º çš„æŒ‰é’® é¼ æ ‡ç§»åŠ¨è¿‡å»åœç•™ä¸€ä¸‹ ä¼šæç¤º æç¤º:ç‚¹å‡»æ¸…ç©ºå…¨æœå˜é‡ 
    GameLib.AdminUI.AddButton('åœ°å›¾æ§åˆ¶', 'é¼ æ ‡ç§»åŠ¨æœ‰æç¤º', 'æç¤º:ç‚¹å‡»æ¸…ç©ºå…¨æœå˜é‡')
    //åœ¨åœ°å›¾æ§åˆ¶é¡µé¢åˆ›å»ºä¸€ä¸ª åç§°ä¸º é¼ æ ‡ç§»åŠ¨æç¤ºç¡®è®¤ çš„æŒ‰é’® é¼ æ ‡ç§»åŠ¨è¿‡å»åœç•™ä¸€ä¸‹ ä¼šæç¤º æç¤º:ç‚¹å‡»æ¸…ç©ºå…¨æœå˜é‡  
    //å¹¶ä¸”ç‚¹å‡»ä¼šæœ‰ç¡®è®¤æ‰§è¡Œå¯¹è¯æ¡†
    GameLib.AdminUI.AddButton('åœ°å›¾æ§åˆ¶', 'é¼ æ ‡ç§»åŠ¨æç¤ºç¡®è®¤', 'æç¤º:ç‚¹å‡»æ¸…ç©ºå…¨æœå˜é‡', true)
    GameLib.AdminUI.AddButton('åœ°å›¾æ§åˆ¶', 'æ¸…ç©ºç‰ˆæœ¬æ—¥å¿—å†…å®¹', 'æç¤º:ç‚¹å‡»æ¸…ç©ºå…¨æœå˜é‡')
    GameLib.AdminUI.AddButton('åœ°å›¾æ§åˆ¶', 'å¢åŠ æ—¥å¿—', 'æç¤º:ç‚¹æˆ‘å¢åŠ ä¸€æ¡æ—¥å¿—åˆ°ç‰ˆæœ¬æ—¥å¿—')
    //æ·»åŠ ä¸€ä¸ªå¤é€‰æ¡† 
    GameLib.AdminUI.AddCheckBox('åœ°å›¾æ§åˆ¶', 'æ€ªç‰©æ­»äº¡ä¸æ‰è½è£…å¤‡', true, 'æç¤º:å‹¾é€‰åæ€ªç‰©æ­»äº¡å°†ä¸æ‰è½è£…å¤‡')
    //æ·»åŠ ä¸€ä¸ªç¡®è®¤ç¼–è¾‘æ¡†
    GameLib.AdminUI.AddEdit('åœ°å›¾æ§åˆ¶', 'æ¸…ç©ºæŒ‡å®šç©å®¶å˜é‡', 'è¯·è¾“å…¥ç©å®¶åç§°')
    GameLib.AdminUI.AddEdit('åœ°å›¾æ§åˆ¶', 'å¸¦æç¤ºçš„ç¼–è¾‘ç¡®è®¤æ¡†', 'ç§»åŠ¨åˆ°OKä¸Šæœ‰æç¤ºå“¦', 'æˆ‘æ˜¯æç¤º')
    GameLib.AdminUI.AddEdit('åœ°å›¾æ§åˆ¶', 'å¸¦æç¤ºçš„ç¼–è¾‘ç¡®è®¤æ¡†2', 'ç‚¹å‡»OKæœ‰ç¡®è®¤æ¡†å“¦', 'æˆ‘æ˜¯æç¤º', true)
    GameLib.AdminUI.AddButton('åœ°å›¾æ§åˆ¶', 'ä¿®æ”¹å¤é€‰æ¡†ä¸ºä¸å‹¾é€‰çŠ¶æ€', 'æç¤º:ä¿®æ”¹å¤é€‰æ¡†ä¸ºä¸å‹¾é€‰çŠ¶æ€')
    GameLib.AdminUI.AddButton('åœ°å›¾æ§åˆ¶', 'è®¾ç½®ç¼–è¾‘æ¡†', 'æç¤º:è®¾ç½®ç¼–è¾‘æ¡†å†…å®¹')
    GameLib.AdminUI.AddButton('åœ°å›¾æ§åˆ¶', 'æ•°æ®åº“æµ‹è¯•', 'æç¤º:æµ‹è¯•Mysqlæ•°æ®')
    //-------------------------------------------------------------å¢åŠ ä¸€ä¸ªè§’è‰²æ§åˆ¶é¡µé¢-------------------------------------------------------------------
    //å¢åŠ ä¸€ä¸ªè§’è‰²æ§åˆ¶é¡µé¢
    GameLib.AdminUI.AddPage("è§’è‰²æ§åˆ¶", 120, 35, 4)
    GameLib.AdminUI.AddButton('è§’è‰²æ§åˆ¶', 'æ¸…ç©ºè§’è‰²å˜é‡1', 'æç¤º:ç‚¹å‡»æ¸…ç©ºè§’è‰²å˜é‡')
    GameLib.AdminUI.AddButton('è§’è‰²æ§åˆ¶', 'æ¸…ç©ºè§’è‰²å˜é‡2', 'æç¤º:ç‚¹å‡»æ¸…ç©ºè§’è‰²å˜é‡')
    GameLib.AdminUI.AddButton('è§’è‰²æ§åˆ¶', 'å¢åŠ è§’è‰²æ—¥å¿—', 'æç¤º:ç‚¹æˆ‘å¢åŠ ä¸€æ¡æ—¥å¿—åˆ°ç‰ˆæœ¬æ—¥å¿—')


    //-------------------------------------------------------------å¢åŠ ä¸€ä¸ªæ—¥å¿—æ¡†é¡µé¢é¡µé¢-------------------------------------------------------------------    

    //æ·»åŠ ä¸€ä¸ªæ—¥å¿—æ¡†é¡µé¢ åç§°ä¸º ç‰ˆæœ¬æ—¥å¿—
    GameLib.AdminUI.AddLogPage('ç‰ˆæœ¬æ—¥å¿—')
    //å¾€æ—¥å¿—æ¡†é¡µé¢å†…æ·»åŠ ä¿¡æ¯
    GameLib.AdminUI.AddLog('ç‰ˆæœ¬æ—¥å¿—', 'åˆ›å»ºUIæ—¶é—´ä¸º : ' + new Date().toString())
}



//å½“æŒ‰é’®ç‚¹å‡»å ä¼šè§¦å‘æ­¤å‡½æ•°
GameLib.onAdminUIButtonClick = (controlName: string): void => {
    console.log("ç‰ˆæœ¬åå°æŒ‰é’®è¢«ç‚¹å‡»:", controlName)
    //----------------------------------------------------------------æ•°æ®åº“æ“ä½œ---------------------------------------------------------------------
    if (controlName == 'é‡æ–°åŠ è½½è„šæœ¬') {
        console.log("åå°æ“ä½œï¼šé‡æ–°å¼€å§‹åŠ è½½è„šæœ¬")
        GameLib.ReLoadScriptEngine()
    }

    if (controlName == 'æ¸…ç©ºå…¨æœæ€ªç‰©') {
        åœ°å›¾.å‰¯æœ¬æ¸…ç†()
    }

    if (controlName == 'æµ‹è¯•åŠŸèƒ½è¾“å‡º') {
        // const å¤§æ•°å€¼ = Decimal.mul('500000', '1e100')
        const å¤§æ•°å€¼2 = æ™ºèƒ½è®¡ç®—('300000', '1e100', 3)
        console.log('å¤§æ•°å€¼:', å¤§æ•°å€¼2)
        console.log('å‰¯æœ¬é•¿åº¦:', GameLib.R.åœ°å›¾æ± .length)
        let Player = GameLib.FindPlayer('é¸¿ç¦'); //æŸ¥æ‰¾ç©å®¶
        if (Player != null) {
            Player.R.æš—å½±å€¼ = 100
            // Player.SetCustomEffect(_P_Base.æ°¸ä¹…ç‰¹æ•ˆ.è¡€é­”ä¸´èº«, _P_Base.ç‰¹æ•ˆ.è¡€é­”ä¸´èº«);
            console.log(`Player.R.æ€’æ–©èŒƒå›´:${Player.DropItemRate}`)
        }
    }

    //------------------------------------------------------------ä»¥ä¸‹ç¤ºèŒƒ-------------------------------------------------------------
    if (controlName == 'å¢åŠ æ—¥å¿—') {
        //å¾€æ—¥å¿—æ¡†é¡µé¢å†…æ·»åŠ ä¿¡æ¯
        GameLib.AdminUI.AddLog('ç‰ˆæœ¬æ—¥å¿—', 'ç°åœ¨çš„æ—¶é—´æ˜¯:' + new Date().toString())
    }

    if (controlName == 'å¢åŠ è§’è‰²æ—¥å¿—') {
        //å¾€æ—¥å¿—æ¡†é¡µé¢å†…æ·»åŠ ä¿¡æ¯
        GameLib.AdminUI.AddLog('ç‰ˆæœ¬æ—¥å¿—', 'è§’è‰²æ—¥å¿—æŒ‰é’®å¢åŠ æ•°æ®:' + new Date().toString())
    }

    if (controlName == 'ä¿®æ”¹å¤é€‰æ¡†ä¸ºä¸å‹¾é€‰çŠ¶æ€') {
        GameLib.AdminUI.UpdateCheckBoxState('æ€ªç‰©æ­»äº¡ä¸æ‰è½è£…å¤‡', false)
    }

    if (controlName == 'è®¾ç½®ç¼–è¾‘æ¡†') {
        GameLib.AdminUI.UpdateInputText('æ¸…ç©ºæŒ‡å®šç©å®¶å˜é‡', 'çƒ­è¡€ä¼ å¥‡')
    }

    if (controlName == 'æ¸…ç©ºç‰ˆæœ¬æ—¥å¿—å†…å®¹') {
        GameLib.AdminUI.ClearLogPage('ç‰ˆæœ¬æ—¥å¿—')
    }

    // æŸ¥çœ‹å¥—è£…åˆ—è¡¨
    if (controlName === 'æŸ¥çœ‹ç¥å™¨å¥—è£…åˆ—è¡¨') {
        GM_æ—¥å¿—('========== ç¥å™¨å¥—è£…åˆ—è¡¨ ==========');
        for (const å¥—è£… of ç¥å™¨å¥—è£…é…ç½®) {
            GM_æ—¥å¿—(`ã€${å¥—è£….å¥—è£…åç§°}ã€‘ç»„ä»¶æ•°:${å¥—è£….ç»„ä»¶åˆ—è¡¨.length} æ¥æº:${å¥—è£….æ¥æº}`);
            GM_æ—¥å¿—(`  ç»„ä»¶: ${å¥—è£….ç»„ä»¶åˆ—è¡¨.join('ã€')}`);
        }
        GM_æ—¥å¿—('==================================');
    }

    if (controlName === 'æŸ¥çœ‹è£…å¤‡å¥—è£…åˆ—è¡¨') {
        GM_æ—¥å¿—('========== è£…å¤‡å¥—è£…åˆ—è¡¨ ==========');
        for (const [ç±»å‹, é…ç½®] of å¥—è£…é…ç½®è¡¨) {
            GM_æ—¥å¿—(`ã€${é…ç½®.åç§°}ã€‘ç±»å‹ID:${ç±»å‹} 3ä»¶:${é…ç½®.ä¸‰ä»¶åŠ æˆ} 6ä»¶:${é…ç½®.å…­ä»¶åŠ æˆ} 9ä»¶:${é…ç½®.ä¹ä»¶åŠ æˆ}`);
        }
        GM_æ—¥å¿—('==================================');
    }
}
//å½“å¤é€‰æ¡† å‹¾é€‰çŠ¶æ€æ”¹å˜ä¼šè§¦å‘æ­¤å‡½æ•°
GameLib.onAdminUICheckBoxChange = (controlName: string, checked: boolean): void => {
    if (checked) {
        console.log("ç‰ˆæœ¬åå° å¤é€‰æ¡†  :", controlName, 'è¢«å‹¾é€‰')
    } else {
        console.log("ç‰ˆæœ¬åå° å¤é€‰æ¡†  :", controlName, 'å–æ¶ˆå‹¾é€‰')
    }
}
//å½“è¾“å…¥ç¡®è®¤æ¡†ç‚¹å‡»ç¡®è®¤åä¼šæ‰§è¡Œæ­¤ä»£ç 
GameLib.onAdminUIEditOk = (controlName: string, inputTex: string): void => {
    console.log(`ç‰ˆæœ¬åå° è¾“å…¥æ¡† ${controlName} è¢«ç¡®è®¤, è¾“å…¥å†…å®¹ä¸º:` + inputTex)

    // GMç®¡ç†åŠŸèƒ½å¤„ç†
    if (controlName === 'ç»™ç©å®¶åˆ·ç‰©å“') {
        GM_ç»™ç©å®¶åˆ·ç‰©å“(inputTex);
    }
    if (controlName === 'ç»™ç©å®¶åˆ·å±æ€§') {
        GM_ç»™ç©å®¶åˆ·å±æ€§(inputTex);
    }
    if (controlName === 'ç»™ä¸å¥—è£…') {
        GM_ç»™ä¸å¥—è£…(inputTex);
    }
    if (controlName === 'åˆ·å¥—è£…è£…å¤‡') {
        GM_åˆ·å¥—è£…è£…å¤‡(inputTex);
    }
    if (controlName === 'å­¦ä¹ æŠ€èƒ½') {
        GM_å­¦ä¹ æŠ€èƒ½(inputTex);
    }
    if (controlName === 'ä¼ é€ç©å®¶') {
        GM_ä¼ é€ç©å®¶(inputTex);
    }
    if (controlName === 'ä¿®æ”¹å……å€¼ç‚¹') {
        GM_è®¾ç½®å……å€¼ç‚¹(inputTex);
    }
}

// =================================== GMç®¡ç†åŠŸèƒ½ ===================================

/**
 * ç»™ç©å®¶åˆ·ç‰©å“
 * @param input æ ¼å¼ï¼šç©å®¶å-ç‰©å“å-æ•°é‡
 */
function GM_ç»™ç©å®¶åˆ·ç‰©å“(input: string): void {
    const list = input.split('-');
    if (list.length < 3) {
        GM_æ—¥å¿—('æ ¼å¼é”™è¯¯ï¼Œæ­£ç¡®æ ¼å¼ï¼šç©å®¶å-ç‰©å“å-æ•°é‡');
        return;
    }

    const ç©å®¶å = list[0].trim();
    const ç‰©å“å = list[1].trim();
    const æ•°é‡ = Number(list[2]);

    if (isNaN(æ•°é‡) || æ•°é‡ <= 0) {
        GM_æ—¥å¿—('æ•°é‡å¿…é¡»å¤§äº0');
        return;
    }

    const ç©å®¶ = GameLib.FindPlayer(ç©å®¶å);
    if (!ç©å®¶) {
        GM_æ—¥å¿—(`ç©å®¶ã€${ç©å®¶å}ã€‘ä¸åœ¨çº¿`);
        return;
    }

    ç©å®¶.Give(ç‰©å“å, æ•°é‡);
    ç©å®¶.MessageBox(`GMç»™ä½ å‘æ”¾äº† ${ç‰©å“å} x${æ•°é‡}`);
    GM_æ—¥å¿—(`æˆåŠŸç»™ã€${ç©å®¶å}ã€‘å‘æ”¾ ${ç‰©å“å} x${æ•°é‡}`, 'åˆ·ç‰©å“', ç©å®¶å);
}

/**
 * ç»™ç©å®¶åˆ·å±æ€§
 * @param input æ ¼å¼ï¼šç©å®¶å-æ•°é‡-ç±»å‹(1å……å€¼ 2å…ƒå® 3å›æ”¶ 4çˆ†ç‡ 5ç­‰çº§)
 */
function GM_ç»™ç©å®¶åˆ·å±æ€§(input: string): void {
    const list = input.split('-');
    if (list.length < 3) {
        GM_æ—¥å¿—('æ ¼å¼é”™è¯¯ï¼Œæ­£ç¡®æ ¼å¼ï¼šç©å®¶å-æ•°é‡-ç±»å‹');
        return;
    }

    const ç©å®¶å = list[0].trim();
    const æ•°é‡ = Number(list[1]);
    const ç±»å‹ = list[2].trim();

    if (isNaN(æ•°é‡) || æ•°é‡ < 0) {
        GM_æ—¥å¿—('æ•°é‡å¿…é¡»å¤§äºç­‰äº0');
        return;
    }

    const ç©å®¶ = GameLib.FindPlayer(ç©å®¶å);
    if (!ç©å®¶) {
        GM_æ—¥å¿—(`ç©å®¶ã€${ç©å®¶å}ã€‘ä¸åœ¨çº¿`);
        return;
    }

    let æ“ä½œæè¿° = '';
    switch (ç±»å‹) {
        case '1':
            ç©å®¶.V.çœŸå®å……å€¼ = (ç©å®¶.V.çœŸå®å……å€¼ || 0) + æ•°é‡;
            æ“ä½œæè¿° = `å¢åŠ çœŸå®å……å€¼ ${æ•°é‡}`;
            break;
        case '2':
            åŠŸèƒ½.å¢åŠ .å…ƒå®(ç©å®¶, æ•°é‡, '');
            æ“ä½œæè¿° = `å¢åŠ å…ƒå® ${æ•°é‡}`;
            break;
        case '3':
            ç©å®¶.V.èµåŠ©å›æ”¶ = æ•°é‡;
            æ“ä½œæè¿° = `è®¾ç½®å›æ”¶æ¯”ä¾‹ ${æ•°é‡}`;
            break;
        case '4':
            ç©å®¶.V.èµåŠ©çˆ†ç‡ = æ•°é‡;
            æ“ä½œæè¿° = `è®¾ç½®çˆ†ç‡ ${æ•°é‡}`;
            break;
        case '5':
            ç©å®¶.SetLevel(æ•°é‡);
            æ“ä½œæè¿° = `è®¾ç½®ç­‰çº§ ${æ•°é‡}`;
            break;
        case '6':
            ç©å®¶.V.èµåŠ©é­å°¸ = æ•°é‡;
            æ“ä½œæè¿° = `è®¾ç½®é­å°¸ ${æ•°é‡}`;
            break;
        default:
            GM_æ—¥å¿—('ç±»å‹é”™è¯¯ï¼š1å……å€¼ 2å…ƒå® 3å›æ”¶ 4çˆ†ç‡ 5ç­‰çº§');
            return;
    }
    ç©å®¶.MessageBox(`GMè°ƒæ•´äº†ä½ çš„å±æ€§`);
    è£…å¤‡å±æ€§ç»Ÿè®¡(ç©å®¶);
    GM_æ—¥å¿—(`ç»™ã€${ç©å®¶å}ã€‘${æ“ä½œæè¿°}`, 'åˆ·å±æ€§', ç©å®¶å);
}

/**
 * ç»™ä¸å¥—è£…
 * @param input æ ¼å¼ï¼šç©å®¶å-å¥—è£…å
 */
function GM_ç»™ä¸å¥—è£…(input: string): void {
    const list = input.split('-');
    if (list.length < 2) {
        GM_æ—¥å¿—('æ ¼å¼é”™è¯¯ï¼Œæ­£ç¡®æ ¼å¼ï¼šç©å®¶å-å¥—è£…å');
        return;
    }

    const ç©å®¶å = list[0].trim();
    const å¥—è£…å = list[1].trim();

    const ç©å®¶ = GameLib.FindPlayer(ç©å®¶å);
    if (!ç©å®¶) {
        GM_æ—¥å¿—(`ç©å®¶ã€${ç©å®¶å}ã€‘ä¸åœ¨çº¿`);
        return;
    }

    const å¥—è£… = ç¥å™¨å¥—è£…é…ç½®.find(s => s.å¥—è£…åç§° === å¥—è£…å);
    if (!å¥—è£…) {
        GM_æ—¥å¿—(`æœªæ‰¾åˆ°å¥—è£…ï¼š${å¥—è£…å}`);
        GM_æ—¥å¿—(`å¯ç”¨å¥—è£…ï¼š${ç¥å™¨å¥—è£…é…ç½®.map(s => s.å¥—è£…åç§°).join('ã€')}`);
        return;
    }

    let æˆåŠŸæ•° = 0;
    for (const ç»„ä»¶ of å¥—è£….ç»„ä»¶åˆ—è¡¨) {
        if (ç©å®¶.GiveItem(ç»„ä»¶)) æˆåŠŸæ•°++;
    }

    ç©å®¶.MessageBox(`è·å¾— ${å¥—è£…å} å…¨å¥—(${æˆåŠŸæ•°}/${å¥—è£….ç»„ä»¶åˆ—è¡¨.length})`);
    GM_æ—¥å¿—(`ç»™ã€${ç©å®¶å}ã€‘å‘æ”¾ ${å¥—è£…å} å…¨å¥—(${æˆåŠŸæ•°}/${å¥—è£….ç»„ä»¶åˆ—è¡¨.length})`, 'ç¥å™¨å¥—è£…', ç©å®¶å);
}

/**
 * åˆ·å¥—è£…è£…å¤‡
 * @param input æ ¼å¼ï¼šç©å®¶å-å¥—è£…å-è£…å¤‡å
 */
function GM_åˆ·å¥—è£…è£…å¤‡(input: string): void {
    const ç©å®¶å = input.split('-')[0]?.trim();
    const ç©å®¶ = GameLib.FindPlayer(ç©å®¶å);
    if (!ç©å®¶) {
        GM_æ—¥å¿—(`ç©å®¶ã€${ç©å®¶å}ã€‘ä¸åœ¨çº¿`);
        return;
    }
    æµ‹è¯•å¥—è£…(ç©å®¶, input);
    GM_æ—¥å¿—(`ç»™ã€${ç©å®¶å}ã€‘åˆ·å¥—è£…è£…å¤‡å®Œæˆ`, 'å¥—è£…è£…å¤‡', ç©å®¶å);
}

/**
 * å­¦ä¹ æŠ€èƒ½
 * @param input æ ¼å¼ï¼šç©å®¶å-æŠ€èƒ½å
 */
function GM_å­¦ä¹ æŠ€èƒ½(input: string): void {
    const list = input.split('-');
    if (list.length < 2) {
        GM_æ—¥å¿—('æ ¼å¼é”™è¯¯ï¼Œæ­£ç¡®æ ¼å¼ï¼šç©å®¶å-æŠ€èƒ½å');
        return;
    }

    const ç©å®¶å = list[0].trim();
    const æŠ€èƒ½å = list[1].trim();

    const ç©å®¶ = GameLib.FindPlayer(ç©å®¶å);
    if (!ç©å®¶) {
        GM_æ—¥å¿—(`ç©å®¶ã€${ç©å®¶å}ã€‘ä¸åœ¨çº¿`);
        return;
    }

    if (ç©å®¶.FindSkill(æŠ€èƒ½å)) {
        GM_æ—¥å¿—(`ç©å®¶ã€${ç©å®¶å}ã€‘å·²å­¦ä¹ ã€${æŠ€èƒ½å}ã€‘`);
        return;
    }

    ç©å®¶.AddSkill(æŠ€èƒ½å, 1);
    if (ç©å®¶.FindSkill(æŠ€èƒ½å)) {
        ç©å®¶.MessageBox(`å­¦ä¹ äº†æŠ€èƒ½ã€${æŠ€èƒ½å}ã€‘`);
        GM_æ—¥å¿—(`ç»™ã€${ç©å®¶å}ã€‘å­¦ä¹ æŠ€èƒ½ã€${æŠ€èƒ½å}ã€‘æˆåŠŸ`, 'å­¦ä¹ æŠ€èƒ½', ç©å®¶å);
    } else {
        GM_æ—¥å¿—(`æŠ€èƒ½ã€${æŠ€èƒ½å}ã€‘ä¸å­˜åœ¨`);
    }
}

/**
 * ä¼ é€ç©å®¶
 * @param input æ ¼å¼ï¼šç©å®¶å-åœ°å›¾å
 */
function GM_ä¼ é€ç©å®¶(input: string): void {
    const list = input.split('-');
    if (list.length < 2) {
        GM_æ—¥å¿—('æ ¼å¼é”™è¯¯ï¼Œæ­£ç¡®æ ¼å¼ï¼šç©å®¶å-åœ°å›¾å');
        return;
    }

    const ç©å®¶å = list[0].trim();
    const åœ°å›¾å = list[1].trim();

    const ç©å®¶ = GameLib.FindPlayer(ç©å®¶å);
    if (!ç©å®¶) {
        GM_æ—¥å¿—(`ç©å®¶ã€${ç©å®¶å}ã€‘ä¸åœ¨çº¿`);
        return;
    }

    ç©å®¶.RandomMove(åœ°å›¾å);
    ç©å®¶.MessageBox(`è¢«ä¼ é€åˆ°ã€${åœ°å›¾å}ã€‘`);
    GM_æ—¥å¿—(`ä¼ é€ã€${ç©å®¶å}ã€‘åˆ°ã€${åœ°å›¾å}ã€‘`, 'ä¼ é€ç©å®¶', ç©å®¶å);
}

/**
 * ä¿®æ”¹å……å€¼ç‚¹ï¼ˆæ”¯æŒåŠ å‡ï¼‰
 * @param input æ ¼å¼ï¼šç©å®¶å-å……å€¼ç‚¹æ•°ï¼ˆæ­£æ•°åŠ ï¼Œè´Ÿæ•°å‡ï¼‰
 */
function GM_è®¾ç½®å……å€¼ç‚¹(input: string): void {
    const åˆ†éš”ä½ç½® = input.indexOf('-');
    if (åˆ†éš”ä½ç½® <= 0) {
        GM_æ—¥å¿—('æ ¼å¼é”™è¯¯ï¼Œæ­£ç¡®æ ¼å¼ï¼šç©å®¶å-å……å€¼ç‚¹æ•°ï¼ˆæ­£æ•°åŠ ï¼Œè´Ÿæ•°å‡ï¼‰');
        return;
    }

    const ç©å®¶å = input.substring(0, åˆ†éš”ä½ç½®).trim();
    const æ•°é‡ = Number(input.substring(åˆ†éš”ä½ç½® + 1));

    if (isNaN(æ•°é‡) || æ•°é‡ === 0) {
        GM_æ—¥å¿—('å……å€¼ç‚¹æ•°ä¸èƒ½ä¸º0æˆ–æ— æ•ˆæ•°å€¼');
        return;
    }

    const ç©å®¶ = GameLib.FindPlayer(ç©å®¶å);
    if (!ç©å®¶) {
        GM_æ—¥å¿—(`ç©å®¶ã€${ç©å®¶å}ã€‘ä¸åœ¨çº¿`);
        return;
    }

    ç©å®¶.V.çœŸå®å……å€¼ ??= 0;
    ç©å®¶.V.çœŸå®å……å€¼ += æ•°é‡;
    const æ“ä½œ = æ•°é‡ > 0 ? `å¢åŠ  ${æ•°é‡}` : `å‡å°‘ ${Math.abs(æ•°é‡)}`;
    ç©å®¶.MessageBox(`å……å€¼ç‚¹${æ“ä½œ}ï¼Œå½“å‰å……å€¼ç‚¹ï¼š${ç©å®¶.V.çœŸå®å……å€¼}`);
    GM_æ—¥å¿—(`ã€${ç©å®¶å}ã€‘å……å€¼ç‚¹${æ“ä½œ}ï¼Œå½“å‰ï¼š${ç©å®¶.V.çœŸå®å……å€¼}`, 'å……å€¼ç‚¹', ç©å®¶å);
}

/**
 * GMæ—¥å¿—è¾“å‡ºå¹¶è®°å½•åˆ°æ•°æ®åº“
 */
function GM_æ—¥å¿—(msg: string, æ“ä½œç±»å‹?: string, ç›®æ ‡ç©å®¶?: string): void {
    console.log(`[GMç®¡ç†] ${msg}`);
    GameLib.AdminUI.AddLog('ç‰ˆæœ¬æ—¥å¿—', `[GM] ${msg}`);

    // è®°å½•åˆ°æ•°æ®åº“
    if (æ“ä½œç±»å‹) {
        GM_è®°å½•åˆ°æ•°æ®åº“('åå°GM', æ“ä½œç±»å‹, ç›®æ ‡ç©å®¶ || '', msg);
    }
}

/**
 * è®°å½•GMæ“ä½œåˆ°æ•°æ®åº“
 */
function GM_è®°å½•åˆ°æ•°æ®åº“(GMè´¦å·: string, æ“ä½œç±»å‹: string, ç›®æ ‡ç©å®¶: string, æ“ä½œå†…å®¹: string): void {
    if (!GMæ—¥å¿—è¡¨å·²åˆå§‹åŒ–) {
        åˆ›å»ºè¡¨(GMæ—¥å¿—è¡¨SQL, () => { GMæ—¥å¿—è¡¨å·²åˆå§‹åŒ– = true; });
    }

    æ’å…¥('GMæ“ä½œæ—¥å¿—', {
        æ“ä½œæ—¶é—´: è·å–å½“å‰æ—¶é—´(),
        æœåŠ¡å™¨: GameLib.GetServerName(),
        GMè´¦å·: GMè´¦å·,
        æ“ä½œç±»å‹: æ“ä½œç±»å‹,
        ç›®æ ‡ç©å®¶: ç›®æ ‡ç©å®¶,
        æ“ä½œå†…å®¹: æ“ä½œå†…å®¹
    });
}
