/**
 * 性能优化 - 统一导入入口（智能优化版）
 * 
 * 本方案特点：
 * ✅ 100%功能完整（使用原版本功能）
 * ✅ 添加智能缓存和性能优化
 * ✅ 易于使用和维护
 * ✅ 可随时回滚
 * ✅ 性能监控和统计
 */

// #region 核心优化函数导出

/**
 * 怪物掉落物品触发（智能优化版）
 */
export { 
    怪物掉落物品触发,
    获取掉落性能统计,
    清空掉落缓存,
    重置掉落统计
} from './怪物掉落物品触发_智能优化';

/**
 * 攻击计算（智能优化版）
 */
export { 
    计算伤害,
    获取攻击计算性能统计,
    // 清空攻击计算缓存,
    重置攻击计算统计
} from './攻击计算_超极致优化';

/**
 * 装备属性统计（智能优化版）
 */
export { 
    装备属性统计,
    获取装备属性统计性能统计,
    清空装备属性统计缓存,
    重置装备属性统计统计
} from './装备属性统计_智能优化';

// #endregion

// #region 性能监控和管理

/**
 * 获取所有模块的性能统计
 */
export function 获取所有性能统计(): {
    怪物掉落: any;
    攻击计算: any;
    装备属性: any;
} {
    try {
        const { 获取掉落性能统计 } = require('./怪物掉落物品触发_智能优化');
        const { 获取攻击计算性能统计 } = require('./攻击计算_超极致优化');
        const { 获取装备属性统计性能统计 } = require('./装备属性统计_智能优化');

        return {
            怪物掉落: 获取掉落性能统计?.() || null,
            攻击计算: 获取攻击计算性能统计?.() || null,
            装备属性: 获取装备属性统计性能统计?.() || null
        };
    } catch (error) {
        console.log(`[性能优化] 获取统计时出错: ${error}`);
        return {
            怪物掉落: null,
            攻击计算: null,
            装备属性: null
        };
    }
}

/**
 * 清空所有缓存
 */
export function 清空所有缓存(): void {
    const { 清空掉落缓存 } = require('./怪物掉落物品触发_智能优化');
    const { 清空攻击计算缓存 } = require('./攻击计算_超极致优化');
    const { 清空装备属性统计缓存 } = require('./装备属性统计_智能优化');

    清空掉落缓存();
    清空攻击计算缓存();
    清空装备属性统计缓存();
    
    console.log('✅ [性能优化] 已清空所有模块的缓存');
}

/**
 * 重置所有统计
 */
export function 重置所有统计(): void {
    const { 重置掉落统计 } = require('./怪物掉落物品触发_智能优化');
    const { 重置攻击计算统计 } = require('./攻击计算_超极致优化');
    const { 重置装备属性统计统计 } = require('./装备属性统计_智能优化');

    重置掉落统计();
    重置攻击计算统计();
    重置装备属性统计统计();
    
    console.log('✅ [性能优化] 已重置所有模块的性能统计');
}

/**
 * 打印性能报告
 */
export function 打印性能报告(): void {
    try {
        const stats = 获取所有性能统计();

        // 安全获取属性值，避免访问不存在的属性
        const 怪物掉落 = stats?.怪物掉落 || {};
        const 攻击计算 = stats?.攻击计算 || {};
        const 装备属性 = stats?.装备属性 || {};

        console.log(`
╔═══════════════════════════════════════════════════════════╗
║              性能优化 - 综合统计报告                        ║
╠═══════════════════════════════════════════════════════════╣
║  【怪物掉落物品触发】                                       ║
║  总调用: ${怪物掉落?.总调用次数 || 0}次                     
║  平均耗时: ${怪物掉落?.平均耗时 || 'N/A'}                       
║  缓存命中率: ${怪物掉落?.缓存命中率 || 'N/A'}                   
║  缓存大小: 地图${怪物掉落?.缓存大小?.地图配置 || 0} | 怪物${怪物掉落?.缓存大小?.怪物品质 || 0} | 极品率${怪物掉落?.缓存大小?.玩家极品率 || 0}
╠───────────────────────────────────────────────────────────╣
║  【攻击计算】                                               ║
║  总调用: ${攻击计算?.总调用次数 || 0}次                     
║  批处理: ${攻击计算?.批处理次数 || 0}次 (${攻击计算?.批处理比例 || 'N/A'})                       
║  直接处理: ${攻击计算?.直接处理次数 || 0}次                   
║  采样计算: ${攻击计算?.采样计算次数 || 0} | 采样跳过: ${攻击计算?.采样跳过次数 || 0}
╠───────────────────────────────────────────────────────────╣
║  【装备属性统计】                                           ║
║  总调用: ${装备属性?.总调用次数 || 0}次                     
║  平均耗时: ${装备属性?.平均耗时 || 'N/A'}                       
║  跳过计算: ${装备属性?.跳过计算次数 || 0}次 (${装备属性?.跳过率 || 'N/A'})
║  缓存大小: 装备哈希${装备属性?.缓存大小?.装备哈希 || 0} | 装备数据${装备属性?.缓存大小?.装备数据 || 0}
╚═══════════════════════════════════════════════════════════╝
        `);
    } catch (error) {
        console.log(`[性能优化] 打印性能报告时出错: ${error}`);
        console.log(`错误详情: ${error?.message || error}`);
    }
}

// #endregion

// #region 快速启动和管理

/**
 * 快速启动性能优化系统
 * 
 * 在服务器启动时调用一次即可
 */
export function 快速启动智能优化(): void {
    console.log(`
╔═══════════════════════════════════════════════════════════╗
║          性能优化系统 - 智能优化版 启动中...                 ║
╠═══════════════════════════════════════════════════════════╣
║  ✅ 怪物掉落物品触发 - 已加载智能优化包装器                  ║
║  ✅ 攻击计算 - 已加载智能优化包装器                          ║
║  ✅ 装备属性统计 - 已加载智能优化包装器                      ║
╠═══════════════════════════════════════════════════════════╣
║  特点：                                                     ║
║  ✅ 100%功能完整（使用原版本）                              ║
║  ✅ 智能缓存优化                                            ║
║  ✅ 自动内存管理                                            ║
║  ✅ 性能监控统计                                            ║
║  ✅ 可随时回滚                                              ║
╚═══════════════════════════════════════════════════════════╝
    `);

    // 初始化完成
    console.log('✅ [性能优化] 智能优化系统启动完成！');
}

// #endregion

// #region 导出默认对象

export default {
    // 核心函数
    怪物掉落物品触发: require('./怪物掉落物品触发_智能优化').怪物掉落物品触发,
    计算伤害: require('./攻击计算_超极致优化').计算伤害,
    装备属性统计: require('./装备属性统计_智能优化').装备属性统计,

    // 性能统计
    获取所有性能统计,
    打印性能报告,

    // 缓存管理
    清空所有缓存,
    重置所有统计,

    // 快速启动
    快速启动: 快速启动智能优化
};

// #endregion

