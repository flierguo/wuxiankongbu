# 大数值计算 - 使用说明

## 📌 **推荐使用方式**：智能计算函数

### 最优调用接口（零额外开销）

```typescript
import { 智能计算 } from './_大数值/核心计算方法';

// 自动选择最优路径，无需手动判断
const result = 智能计算('数值1', '数值2', 模式);
```

**特点**：
- ✅ **零额外开销** - 智能判断仅需<1微秒
- ✅ **自动优化** - 999京以内用快速路径，超过999京用包装器优化
- ✅ **简单易用** - 统一接口，一个函数搞定所有计算

---

## 📖 完整API文档

### 1. 智能计算（主函数）

```typescript
智能计算(n1: string, n2: string, mode: number): string
```

#### 参数说明
- `n1`: 第一个数值（字符串）
- `n2`: 第二个数值（字符串）
- `mode`: 计算模式（1-8）

#### 计算模式

| mode | 运算 | 说明 | 示例 |
|------|------|------|------|
| 1 | 加法 | n1 + n2 | `智能计算('100', '50', 1)` → `'150'` |
| 2 | 减法 | n1 - n2 | `智能计算('100', '50', 2)` → `'50'` |
| 3 | 乘法 | n1 * n2 | `智能计算('100', '2', 3)` → `'200'` |
| 4 | 除法(整数) | floor(n1 / n2) | `智能计算('100', '3', 4)` → `'33'` |
| 5 | 除法(2位小数) | n1 / n2 | `智能计算('100', '3', 5)` → `'33.33'` |
| 6 | 除法(5位小数) | n1 / n2 | `智能计算('100', '3', 6)` → `'33.33333'` |
| 7 | 幂运算 | n1 ^ n2 | `智能计算('2', '10', 7)` → `'1024'` |
| 8 | 等差数列求和 | sum(n1...n2) | `智能计算('1', '100', 8)` → `'5050'` |

#### 使用示例

```typescript
// 小数值（自动使用快速路径）
const gold = 智能计算('1000', '150', 3);  // 1000 * 150 = 150000

// 超大数值（自动使用包装器优化）
const power = 智能计算('99900000000000000000', '2', 3);  // 超过999京

// 科学计数法（自动识别）
const huge = 智能计算('1e50', '1e30', 3);  // 自动处理
```

---

### 2. 比较函数

#### 通用比较
```typescript
比较(n1: string | number, n2: string | number): -1 | 0 | 1

// 示例
const result = 比较('100', '200');  // -1 (100 < 200)
```

#### 便捷比较函数

```typescript
大于(n1, n2): boolean        // n1 > n2
小于(n1, n2): boolean        // n1 < n2  
等于(n1, n2): boolean        // n1 == n2
大于等于(n1, n2): boolean    // n1 >= n2
小于等于(n1, n2): boolean    // n1 <= n2
```

#### 示例

```typescript
import { 大于, 小于, 等于 } from './_大数值/核心计算方法';

// 简洁的条件判断
if (大于(playerGold, '1000000')) {
    console.log('玩家是土豪');
}

if (小于(bossHp, '1000')) {
    console.log('Boss快死了');
}

if (等于(score, target)) {
    console.log('达成目标');
}
```

---

### 3. 百分比计算

```typescript
js_百分比(n: string): string

// 示例
const rate = js_百分比('15000');  // '150.00' (15000 / 100)
```

---

### 4. 批量计算（高性能）

适用于大量相同类型的计算。

```typescript
import { js_批量倍率计算 } from './_大数值/核心计算方法';

// 批量乘法（固定倍率）
const values = ['100', '200', '300', '400'];
const results = js_批量倍率计算(values, '150');
// results = ['15000', '30000', '45000', '60000']
```

**优势**：自动检测模式并优化，性能比循环调用提升10-30%

---

## 🚀 性能优化说明

### 自动路径选择

`智能计算` 会根据数值大小自动选择最优路径：

```typescript
// 流程图
输入数值
    ├─ 长度 > 18 或包含 'e' → 超大数值优化版（包装器）
    ├─ 999京以内 → 高性能原生计算（最快）
    └─ 接近999京 → 超大数值优化版（包装器）
```

### 性能特征

| 数值范围 | 使用路径 | 性能特点 |
|---------|---------|----------|
| < 999京 (18位以内) | 原生Number | 最快，CPU占用最低 |
| > 999京 | 包装器优化版 | 减少70%对象创建，降低GC压力 |

### 超大数值专项优化

针对**超过999京**的数值（游戏后期），系统会：

1. 强制启用对象池（包装器复用率>90%）
2. 结果缓存优先级更高
3. 自动记录使用模式用于预热

---

## 📝 完整示例

### 游戏伤害计算

```typescript
import { 智能计算, 大于 } from './_大数值/核心计算方法';

function 计算伤害(基础攻击: string, 伤害倍率: string, 防御: string): string {
    // 1. 计算初始伤害 = 基础攻击 * 伤害倍率
    const 初始伤害 = 智能计算(基础攻击, 伤害倍率, 3);
    
    // 2. 减去防御
    const 最终伤害 = 智能计算(初始伤害, 防御, 2);
    
    // 3. 最小伤害为1
    if (大于('1', 最终伤害)) {
        return '1';
    }
    
    return 最终伤害;
}

// 使用
const damage = 计算伤害('1000', '150', '500');
console.log('造成伤害:', damage);
```

### 经济系统

```typescript
import { 智能计算, 大于等于 } from './_大数值/核心计算方法';

class 玩家经济 {
    private gold: string = '0';
    
    // 增加金币
    addGold(amount: string) {
        this.gold = 智能计算(this.gold, amount, 1);
    }
    
    // 扣除金币
    spendGold(amount: string): boolean {
        if (!大于等于(this.gold, amount)) {
            return false;  // 金币不足
        }
        this.gold = 智能计算(this.gold, amount, 2);
        return true;
    }
    
    // 获取金币
    getGold(): string {
        return this.gold;
    }
}
```

### 升级经验计算

```typescript
import { 智能计算 } from './_大数值/核心计算方法';

function 计算升级所需经验(level: number): string {
    // 经验公式: level * 100 * 1.2^level
    const 基础经验 = 智能计算(level.toString(), '100', 3);
    const 倍率 = 智能计算('1.2', level.toString(), 7);  // 1.2的level次方
    return 智能计算(基础经验, 倍率, 3);
}

// 100级需要的经验
const exp = 计算升级所需经验(100);
console.log('100级需要经验:', exp);
```

---

## ⚙️ 高级功能

### 游戏进度感知

根据游戏阶段自动优化预热策略：

```typescript
import { 设置游戏进度, 预热缓存 } from './_大数值/核心计算方法';

// 游戏开始
设置游戏进度('早期');  // 小数值优化
预热缓存();

// 玩家升到中期
设置游戏进度('中期');  // 中等数值优化

// 玩家进入后期
设置游戏进度('后期');  // 大数值优化
```

### 性能统计

```typescript
import { 获取计算器统计 } from './_大数值/核心计算方法';

const stats = 获取计算器统计();
console.log('包装器复用率:', stats.包装器池统计.复用率);
console.log('缓存命中:', stats.热点缓存数量);
```

---

## ⚡ 性能提示

### ✅ 推荐做法

```typescript
// 1. 使用智能计算（自动优化）
const result = 智能计算(a, b, 3);

// 2. 批量计算使用批量函数
const results = js_批量倍率计算(values, '150');

// 3. 复杂计算拆分步骤（利用缓存）
const step1 = 智能计算(a, b, 3);
const step2 = 智能计算(step1, c, 1);
```

### ❌ 避免的做法

```typescript
// 避免：在循环中重复计算相同结果
for (let i = 0; i < 1000; i++) {
    const x = 智能计算('100', '150', 3);  // 结果总是一样
}

// 改进：提前计算
const x = 智能计算('100', '150', 3);
for (let i = 0; i < 1000; i++) {
    // 使用 x
}
```

---

## 🎯 总结

### 日常使用只需记住

```typescript
import { 智能计算, 大于, 小于 } from './_大数值/核心计算方法';

// 计算用这个
const result = 智能计算(n1, n2, mode);

// 比较用这些
if (大于(a, b)) { }
if (小于(a, b)) { }
```

**就这么简单！** 系统会自动处理所有优化，无需关心数值大小。
