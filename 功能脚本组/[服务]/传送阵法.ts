import * as 地图 from '../[地图]/地图';

const 一大陆最高 = 500;
const 二大陆最高 = 1000;
const 三大陆最高 = 2000;
const 四大陆最高 = 3000;
const 五大陆最高 = 4000;
const 六大陆最高 = 5000;
const 七大陆最高 = 6000;
const 八大陆最高 = 20000;
const 九大陆最高 = 40000;
const 十大陆最高 = 60000;
const 十一大陆最高 = 80000;

export function Main(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    // if (Player.V.任务1 == false) { Player.MessageBox('请先完成新手任务\\点击屏幕上方新手任务即可查看!'); return }
    let S = ``
    switch (Npc.Tag) {
        case 1:
            S = `\\\\\\\\\\\\
            {I=317;F=ASD.DATA;X=47;Y=80} {I=317;F=ASD.DATA;X=47;Y=120} {I=317;F=ASD.DATA;X=47;Y=160} {I=317;F=ASD.DATA;X=47;Y=200} {I=317;F=ASD.DATA;X=47;Y=240}
            <&{S=沙漠绿洲;FS=15;C=103;CH=145;X=130;Y=80}/@副本传送(沙漠绿洲)>
            <&{S=凄凉之地;FS=15;C=103;CH=145;X=130;Y=120}/@副本传送(凄凉之地)>
            <&{S=狂风峭壁;FS=15;C=103;CH=145;X=130;Y=160}/@副本传送(狂风峭壁)>
            <&{S=崎岖索道;FS=15;C=103;CH=145;X=130;Y=200}/@副本传送(崎岖索道)>
            <&{S=风暴峡谷;FS=15;C=103;CH=145;X=130;Y=240}/@副本传送(风暴峡谷)>
        
            {S=当前倍数: ${Player.V.挑战倍数} 倍;X=50;Y=360}            <{S=倍数提高;X=165;Y=360}/@倍数提高(${二大陆最高})}> <{S=倍数设置;X=220;Y=360}/@@InPutString11(输入准备挑战的倍数。当前可挑战倍数上限:${Player.V.最高挑战倍数} 倍,${二大陆最高})><{S=最高;OX=5;Y=360}/@最高(${二大陆最高})}>
        
            {S=地图挑战等级 = 地图固定星级 * 挑战倍数;X=50;Y=390}
        
            <{S=绑定回城石;X=50;Y=330}/@绑定回城石(1)>
            `
            break;
        case 2:
            S = `\\\\\\\\\\\\
            {I=317;F=ASD.DATA;X=47;Y=80} {I=317;F=ASD.DATA;X=47;Y=120} {I=317;F=ASD.DATA;X=47;Y=160} {I=317;F=ASD.DATA;X=47;Y=200} {I=317;F=ASD.DATA;X=47;Y=240}
            <&{S=古船遗迹;FS=15;C=103;CH=145;X=130;Y=80}/@副本传送(古船遗迹)>
            <&{S=森林迷宫;FS=15;C=103;CH=145;X=130;Y=120}/@副本传送(森林迷宫)>
            <&{S=古之城墙;FS=15;C=103;CH=145;X=130;Y=160}/@副本传送(古之城墙)>
            <&{S=暗影迷宫;FS=15;C=103;CH=145;X=130;Y=200}/@副本传送(暗影迷宫)>
            <&{S=失落暗殿;FS=15;C=103;CH=145;X=130;Y=240}/@副本传送(失落暗殿)>
        
            {S=当前倍数: ${Player.V.挑战倍数} 倍;X=50;Y=360}            <{S=倍数提高;X=165;Y=360}/@倍数提高(${三大陆最高})}> <{S=倍数设置;X=220;Y=360}/@@InPutString11(输入准备挑战的倍数。当前可挑战倍数上限:${Player.V.最高挑战倍数} 倍,${三大陆最高})><{S=最高;OX=5;Y=360}/@最高(${三大陆最高})}>
        
            {S=地图挑战等级 = 地图固定星级 * 挑战倍数;X=50;Y=390}
            <{S=绑定回城石;X=50;Y=330}/@绑定回城石(2)>
            `
            break;
        case 3:
            S = `\\\\\\\\\\\\
            {I=317;F=ASD.DATA;X=47;Y=80} {I=317;F=ASD.DATA;X=47;Y=120} {I=317;F=ASD.DATA;X=47;Y=160} {I=317;F=ASD.DATA;X=47;Y=200} {I=317;F=ASD.DATA;X=47;Y=240}
            <&{S=神秘古国;FS=15;C=103;CH=145;X=130;Y=80}/@副本传送(神秘古国)>
            <&{S=海岛遗迹;FS=15;C=103;CH=145;X=130;Y=120}/@副本传送(海岛遗迹)>
            <&{S=魔之莽道;FS=15;C=103;CH=145;X=130;Y=160}/@副本传送(魔之莽道)>
            <&{S=盘蛇古迹;FS=15;C=103;CH=145;X=130;Y=200}/@副本传送(盘蛇古迹)>
            <&{S=泗水祭坛;FS=15;C=103;CH=145;X=130;Y=240}/@副本传送(泗水祭坛)>
        
            {S=当前倍数: ${Player.V.挑战倍数} 倍;X=50;Y=360}            <{S=倍数提高;X=165;Y=360}/@倍数提高(${四大陆最高})}> <{S=倍数设置;X=220;Y=360}/@@InPutString11(输入准备挑战的倍数。当前可挑战倍数上限:${Player.V.最高挑战倍数} 倍,${四大陆最高})><{S=最高;OX=5;Y=360}/@最高(${四大陆最高})}>
        
            {S=地图挑战等级 = 地图固定星级 * 挑战倍数;X=50;Y=390}
            <{S=绑定回城石;X=50;Y=330}/@绑定回城石(3)>
            `
            break;
        case 4:
            S = `\\\\\\\\\\\\
                {I=317;F=ASD.DATA;X=47;Y=80} {I=317;F=ASD.DATA;X=47;Y=120} {I=317;F=ASD.DATA;X=47;Y=160} {I=317;F=ASD.DATA;X=47;Y=200} {I=317;F=ASD.DATA;X=47;Y=240}
                <&{S=铁血魔域;FS=15;C=103;CH=145;X=130;Y=80}/@副本传送(铁血魔域)>
                <&{S=血腥森林;FS=15;C=103;CH=145;X=130;Y=120}/@副本传送(血腥森林)>
                <&{S=蛮荒丛林;FS=15;C=103;CH=145;X=130;Y=160}/@副本传送(蛮荒丛林)>
                <&{S=血狱皇陵;FS=15;C=103;CH=145;X=130;Y=200}/@副本传送(血狱皇陵)>
                <&{S=星空廊道;FS=15;C=103;CH=145;X=130;Y=240}/@副本传送(星空廊道)>
            
                {S=当前倍数: ${Player.V.挑战倍数} 倍;X=50;Y=360}            <{S=倍数提高;X=165;Y=360}/@倍数提高(${五大陆最高})}> <{S=倍数设置;X=220;Y=360}/@@InPutString11(输入准备挑战的倍数。当前可挑战倍数上限:${Player.V.最高挑战倍数} 倍,${五大陆最高})><{S=最高;OX=5;Y=360}/@最高(${五大陆最高})}>
            
                {S=地图挑战等级 = 地图固定星级 * 挑战倍数;X=50;Y=390}
                <{S=绑定回城石;X=50;Y=330}/@绑定回城石(4)>
                `
            break;
        case 5:
            S = `\\\\\\\\\\\\
            {I=317;F=ASD.DATA;X=47;Y=80} {I=317;F=ASD.DATA;X=47;Y=120} {I=317;F=ASD.DATA;X=47;Y=160} {I=317;F=ASD.DATA;X=47;Y=200} {I=317;F=ASD.DATA;X=47;Y=240}
            <&{S=黑暗森林;FS=15;C=103;CH=145;X=130;Y=80}/@副本传送(黑暗森林)>
            <&{S=郊外平原;FS=15;C=103;CH=145;X=130;Y=120}/@副本传送(郊外平原)>
            <&{S=天然洞穴;FS=15;C=103;CH=145;X=130;Y=160}/@副本传送(天然洞穴)>
            <&{S=矿区山谷;FS=15;C=103;CH=145;X=130;Y=200}/@副本传送(矿区山谷)>
            <&{S=祖玛回廊;FS=15;C=103;CH=145;X=130;Y=240}/@副本传送(祖玛回廊)>
            
            {S=当前倍数: ${Player.V.挑战倍数} 倍;X=50;Y=360}            <{S=倍数提高;X=165;Y=360}/@倍数提高(${六大陆最高})}> <{S=倍数设置;X=220;Y=360}/@@InPutString11(输入准备挑战的倍数。当前可挑战倍数上限:${Player.V.最高挑战倍数} 倍,${六大陆最高})><{S=最高;OX=5;Y=360}/@最高(${六大陆最高})}>
            
            {S=地图挑战等级 = 地图固定星级 * 挑战倍数;X=50;Y=390}
            <{S=绑定回城石;X=50;Y=330}/@绑定回城石(5)>
            `
            break;
        case 6:
            S = `\\\\\\\\\\\\
            {I=317;F=ASD.DATA;X=47;Y=80} {I=317;F=ASD.DATA;X=47;Y=120} {I=317;F=ASD.DATA;X=47;Y=160} {I=317;F=ASD.DATA;X=47;Y=200} {I=317;F=ASD.DATA;X=47;Y=240}
            <&{S=万妖森林;FS=15;C=103;CH=145;X=130;Y=80}/@副本传送(万妖森林)>
            <&{S=万妖峡谷;FS=15;C=103;CH=145;X=130;Y=120}/@副本传送(万妖峡谷)>
            <&{S=万妖之巢;FS=15;C=103;CH=145;X=130;Y=160}/@副本传送(万妖之巢)>
            <&{S=万妖迷宫;FS=15;C=103;CH=145;X=130;Y=200}/@副本传送(万妖迷宫)>
            <&{S=万妖祭坛;FS=15;C=103;CH=145;X=130;Y=240}/@副本传送(万妖祭坛)>
            
            {S=当前倍数: ${Player.V.挑战倍数} 倍;X=50;Y=360}            <{S=倍数提高;X=165;Y=360}/@倍数提高(${七大陆最高})}> <{S=倍数设置;X=220;Y=360}/@@InPutString11(输入准备挑战的倍数。当前可挑战倍数上限:${Player.V.最高挑战倍数} 倍,${七大陆最高})><{S=最高;OX=5;Y=360}/@最高(${七大陆最高})}>
            
            {S=地图挑战等级 = 地图固定星级 * 挑战倍数;X=50;Y=390}
            <{S=绑定回城石;X=50;Y=330}/@绑定回城石(6)>
            `
            break;
        case 7:
            S = `\\\\\\\\\\\\
            {I=317;F=ASD.DATA;X=47;Y=80} {I=317;F=ASD.DATA;X=47;Y=120} {I=317;F=ASD.DATA;X=47;Y=160} {I=317;F=ASD.DATA;X=47;Y=200} {I=317;F=ASD.DATA;X=47;Y=240}
            <&{S=邪恶洞穴;FS=15;C=103;CH=145;X=130;Y=80}/@副本传送(邪恶洞穴)>
            <&{S=蛇妖山谷;FS=15;C=103;CH=145;X=130;Y=120}/@副本传送(蛇妖山谷)>
            <&{S=沃玛寺庙;FS=15;C=103;CH=145;X=130;Y=160}/@副本传送(沃玛寺庙)>
            <&{S=暗黑蛇谷;FS=15;C=103;CH=145;X=130;Y=200}/@副本传送(暗黑蛇谷)>
            <&{S=沉息之地;FS=15;C=103;CH=145;X=130;Y=240}/@副本传送(沉息之地)>
            
            {S=当前倍数: ${Player.V.挑战倍数} 倍;X=50;Y=360}            <{S=倍数提高;X=165;Y=360}/@倍数提高(${八大陆最高})}> <{S=倍数设置;X=220;Y=360}/@@InPutString11(输入准备挑战的倍数。当前可挑战倍数上限:${Player.V.最高挑战倍数} 倍,${八大陆最高})><{S=最高;OX=5;Y=360}/@最高(${八大陆最高})}>
            
            {S=地图挑战等级 = 地图固定星级 * 挑战倍数;X=50;Y=390}
            <{S=绑定回城石;X=50;Y=330}/@绑定回城石(7)>
            `
            break;
        case 8:
            S = `\\\\\\\\\\\\
            {I=317;F=ASD.DATA;X=47;Y=80} {I=317;F=ASD.DATA;X=47;Y=120} {I=317;F=ASD.DATA;X=47;Y=160} {I=317;F=ASD.DATA;X=47;Y=200} {I=317;F=ASD.DATA;X=47;Y=240}
            <&{S=神域冰谷;FS=15;C=103;CH=145;X=130;Y=80}/@副本传送(神域冰谷)>
            <&{S=纷争之地;FS=15;C=103;CH=145;X=130;Y=120}/@副本传送(纷争之地)>
            <&{S=上古禁地;FS=15;C=103;CH=145;X=130;Y=160}/@副本传送(上古禁地)>
            <&{S=封印之城;FS=15;C=103;CH=145;X=130;Y=200}/@副本传送(封印之城)>
            <&{S=神庙主殿;FS=15;C=103;CH=145;X=130;Y=240}/@副本传送(神庙主殿)>
            
            {S=当前倍数: ${Player.V.挑战倍数} 倍;X=50;Y=360}            <{S=倍数提高;X=165;Y=360}/@倍数提高(${九大陆最高})}> <{S=倍数设置;X=220;Y=360}/@@InPutString11(输入准备挑战的倍数。当前可挑战倍数上限:${Player.V.最高挑战倍数} 倍,${九大陆最高})><{S=最高;OX=5;Y=360}/@最高(${九大陆最高})}>
            
            {S=地图挑战等级 = 地图固定星级 * 挑战倍数;X=50;Y=390}
            <{S=绑定回城石;X=50;Y=330}/@绑定回城石(8)>
            `
            break;
        case 9:
            S = `\\\\\\\\\\\\
            {I=317;F=ASD.DATA;X=47;Y=80} {I=317;F=ASD.DATA;X=47;Y=120} {I=317;F=ASD.DATA;X=47;Y=160} {I=317;F=ASD.DATA;X=47;Y=200} {I=317;F=ASD.DATA;X=47;Y=240}
            <&{S=神域冰谷;FS=15;C=103;CH=145;X=130;Y=80}/@副本传送(神域冰谷)>
            `
            break;
        default:
            // if (Player.GetLevel() >= 200) { Player.MessageBox('200级以上的玩家无法再进入!'); return }
            S = `\\\\\\\\\\\\
    {I=317;F=ASD.DATA;X=47;Y=80} {I=317;F=ASD.DATA;X=47;Y=120} {I=317;F=ASD.DATA;X=47;Y=160} {I=317;F=ASD.DATA;X=47;Y=200} {I=317;F=ASD.DATA;X=47;Y=240}
    <&{S=荒芜山谷;FS=15;C=103;CH=145;X=130;Y=80}/@副本传送(荒芜山谷)>
    <&{S=试炼之地;FS=15;C=103;CH=145;X=130;Y=120}/@副本传送(试炼之地)>
    <&{S=血之炼狱;FS=15;C=103;CH=145;X=130;Y=160}/@副本传送(血之炼狱)>
    <&{S=竞技洞窟;FS=15;C=103;CH=145;X=130;Y=200}/@副本传送(竞技洞窟)>
    <&{S=血路之颠;FS=15;C=103;CH=145;X=130;Y=240}/@副本传送(血路之颠)>

    {S=当前倍数: ${Player.V.挑战倍数} 倍;X=50;Y=360}           <{S=倍数提高;X=165;Y=360}/@倍数提高(${一大陆最高})}> <{S=倍数设置;X=220;Y=360}/@@InPutString11(输入准备挑战的倍数。当前可挑战倍数上限:${Player.V.最高挑战倍数} 倍,${一大陆最高})><{S=最高;OX=5;Y=360}/@最高(${一大陆最高})}>

    
    {S=地图挑战等级 = 地图固定星级 * 挑战倍数;X=50;Y=390}


    `
            break;
    }
    // Player.V.挑战倍数 = 10

    Npc.SayEx(Player, '传送', S)
}


export function 最高(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    let 最高倍数 = Args.Int[0];
    if (Player.V.最高挑战倍数 >= 最高倍数) {
        Player.V.挑战倍数 = 最高倍数;
    } else {
        Player.V.挑战倍数 = Player.V.最高挑战倍数;
    }
    console.log(`玩家:${Player.GetName()} , 最高倍数:${最高倍数} , 当前倍数:${Player.V.挑战倍数}`);
    Main(Npc, Player, Args);
}

export function InPutString11(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    let 最高倍数 = Args.Int[0];
    let 设置倍数 = Args.Int[1];
    if (设置倍数 > 最高倍数) {
        Player.MessageBox(`请输入小于${最高倍数}的数值`);
        return;
    }
    if (设置倍数 >= 2 && 设置倍数 <= Player.V.最高挑战倍数) {
        Player.V.挑战倍数 = 设置倍数;
    }
    else {
        Player.MessageBox(`请输入小于${Player.V.最高挑战倍数}的数值`);
    }
    Main(Npc, Player, Args);
}

export function 副本传送(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    let 地图名 = Args.Str[0];

    if (!地图名) {
        console.error('错误：地图名参数无效');
        return;
    }
    const 地图配置 = 地图声明.find(m => m.地图名 === 地图名);
    if (!地图配置) return;
    let str = ``;

    let 副本池 = 地图.取地图()
    str += `{S=${地图名} ${地图配置.需求等级} 级;FS=11;C=154;X=80;Y=20}`;

    if (Player.V.地图成就 + 1 < 地图配置.固定星级) {
        Player.MessageBox(`您的地图成就不足，无法进入${地图名}。`);
        return;
    }
    const yPositions = [60, 98, 136, 174, 212, 250, 288, 326, 364, 402];
    const 副本状态 = new Array(10).fill(false); // 记录每个位置是否有副本

    // 先检查所有副本状态
    for (let i = 0; i < 副本池.length; i++) {
        if (!副本池[i] || !副本池[i].地图ID || 副本池[i].地图ID === '') {
            continue; // 跳过无效的副本
        }

        let map = GameLib.FindMap(副本池[i].地图ID)
        const 下标余数 = 副本池[i].下标 % 10;
        const yIndex = 下标余数 === 0 ? 9 : 下标余数 - 1;
        if (副本池[i].地图名 === 地图配置.地图名) {
            副本状态[yIndex] = true;
            // Debug('地图名:' + 副本池[i].显示名 + 'ID:' + 副本池[i].地图ID + '地图等级:' + 副本池[i].地图等级)
        }
    }
    // 生成按钮
    for (let yIndex = 1; yIndex < yPositions.length; yIndex++) {
        const y = yPositions[yIndex];
        if (副本状态[yIndex]) {
            const 下标余数 = yIndex === 9 ? 0 : yIndex + 1;
            const 副本 = 副本池.find(c => c && c.下标 === 地图配置.下标 + yIndex);

            if (副本) {
                const 说明 = `{S=地图名称 : ${副本.显示名} ;C=154}#92{S=地图星级 : ${副本.固定星级} 星;C=154}#92{S=地图需求 : ${副本.需求等级} 级;C=154}`
                // {S=地图人数 : ${map.GetHumCount()} 人;C=154}`

                const 星级 = 下标余数 === 1 ? 地图配置.固定星级 : 地图配置.固定星级 * (副本?.挑战倍数 || GameLib.R.当前挑战倍数);
                str += `<&{S=${副本.显示名};FS=11;C=103;X=80;Y=${y}}/@固定传送(${地图名},${地图配置.下标 + yIndex})>`;
            } else {
                str += `<&{S=创建副本挑战;FS=11;C=154;X=80;Y=${y}}/@创建副本(${地图名})>`;
            }
        } else {
            str += `<&{S=创建副本挑战;FS=11;C=154;X=80;Y=${y}}/@创建副本(${地图名})>`;
        }
    }



    Npc.SayEx(Player, '传送层数', str);

}

export function 固定传送(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    const 地图名 = Args.Str[0];
    const 下标 = Args.Int[1];
    const 地图配置 = 地图声明.find(m => m.地图名 === 地图名);
    if (!地图配置) return;
    if (Player.GetLevel() < 地图配置.需求等级) {
        Player.MessageBox(`您的等级不足，无法进入${地图名}。`);
        return;
    }
    if (Player.V.地图成就 + 1 < 地图配置.固定星级) {
        Player.MessageBox(`您的地图成就不足，无法进入${地图名}。`);
        return;
    }
    Player.RandomMove(地图.取地图ID(下标))

}

export function 创建副本(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    const 地图名 = Args.Str[0];

    地图.创建单个副本(地图名, Player)

    // 创建副本的逻辑
    // Player.MessageBox(`正在创建${地图名}星副本...`);
    // 这里添加实际的创建副本逻辑
}

export function 倍数提高(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    let 当前最高 = Args.Int[0];
    if (Player.V.最高挑战倍数 >= 当前最高) {
        Player.MessageBox(`已提升至当前大陆最高倍数,请前往下一大陆继续提高!!`);
    } else {
        let 所需礼卷 = 0;
        let 所需挑战石 = 0;

        if (Player.V.最高挑战倍数 <= 一大陆最高) {
            所需礼卷 = (Player.V.最高挑战倍数 - 9) * 1;
        } else if (Player.V.最高挑战倍数 <= 二大陆最高) {
            所需挑战石 = 500;
        } else if (Player.V.最高挑战倍数 <= 三大陆最高) {
            所需挑战石 = 750;
        } else if (Player.V.最高挑战倍数 <= 四大陆最高) {
            所需挑战石 = 1000;
        } else {
            所需挑战石 = 1500;
        }
   
        if (Player.V.最高挑战倍数 > 一大陆最高) {
            所需礼卷 = (Math.floor((Player.V.最高挑战倍数 - 500) / 200) * 100) + 100;
        }
    
        if (Player.GetGamePoint() >= 所需礼卷 &&
            (所需挑战石 === 0 || Player.GetItemCount('挑战石') >= 所需挑战石)) {
            Player.SetGamePoint(Player.GetGamePoint() - 所需礼卷);
            if (所需挑战石 > 0) {
                Npc.Take(Player, '挑战石', 所需挑战石);
            }
            Player.GoldChanged();
            Player.V.最高挑战倍数 += 1;
            Player.MessageBox(`成功提升挑战倍数至 {S=${Player.V.最高挑战倍数};C=22} 倍，消耗 {S=${所需礼卷};C=168} 礼卷${所需挑战石 > 0 ? `和 ${所需挑战石} 挑战石` : ''}`);
        } else {
            Player.MessageBox(`资源不足，提升到 {S=${Player.V.最高挑战倍数 + 1};C=22} 倍需要 {S=${所需礼卷};C=168} 礼卷${所需挑战石 > 0 ? `和 ${所需挑战石} 挑战石` : ''}`);
        }
    }
    Main(Npc, Player, Args);
}

export function 绑定回城石(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    // 定义章节与回城石名称的映射关系，避免冗长的switch
    const 列表映射 = [
        '', // 索引0占位，对应case 0（无意义）
        '第二章回城石',   // case 1
        '第三章回城石',   // case 2
        '第四章回城石',   // case 3
        '第五章回城石',   // case 4
        '第六章回城石',   // case 5
        '第七章回城石',   // case 6
        '第八章回城石',   // case 7
        '第九章回城石',   // case 8
        '第十章回城石',   // case 9
        '第十一章回城石', // case 10
        '第十二章回城石', // case 11
        '第十三章回城石', // case 12
        '第十四章回城石', // case 13
        '第十五章回城石', // case 14
        '第十六章回城石'  // case 15
    ];

    const 大陆 = Args.Int[0];
    // 校验大陆编号是否在有效范围（1-15）
    if (大陆 < 1 || 大陆 >= 列表映射.length) {
        Player.MessageBox('无效的大陆编号');
        return;
    }

    // 查找玩家背包中的回城石
    let targetItem: TUserItem | null = null;
    for (let i = Player.GetItemSize() - 1; i >= 0; i--) {
        const item = Player.GetBagItem(i);
        if (item.GetName() === '回城石') {
            targetItem = item;
            break; // 找到第一个回城石后退出循环
        }
    }

    // 处理物品不存在的情况
    if (!targetItem) {
        Player.MessageBox('未找到回城石');
        return;
    }

    // 统一执行物品修改操作（所有case共用的逻辑）
    targetItem.Rename(列表映射[大陆]);
    targetItem.SetBind(true);
    targetItem.SetNeverDrop(true);
    targetItem.State.SetNoDrop(true);
    Player.UpdateItem(targetItem); // 统一在最后更新，避免重复调用

    Player.MessageBox('绑定成功');
}


const 地图声明 = [
    { 地图名: '荒芜山谷', 下标: 1, 固定星级: 1, 需求等级: 1 },
    { 地图名: '试炼之地', 下标: 11, 固定星级: 2, 需求等级: 40 },
    { 地图名: '血之炼狱', 下标: 21, 固定星级: 3, 需求等级: 80 },
    { 地图名: '竞技洞窟', 下标: 31, 固定星级: 4, 需求等级: 120 },
    { 地图名: '血路之颠', 下标: 41, 固定星级: 5, 需求等级: 150 },
    { 地图名: '沙漠绿洲', 下标: 51, 固定星级: 6, 需求等级: 200 },
    { 地图名: '凄凉之地', 下标: 61, 固定星级: 7, 需求等级: 250 },
    { 地图名: '狂风峭壁', 下标: 71, 固定星级: 8, 需求等级: 300 },
    { 地图名: '崎岖索道', 下标: 81, 固定星级: 9, 需求等级: 350 },
    { 地图名: '风暴峡谷', 下标: 91, 固定星级: 10, 需求等级: 500 },
    { 地图名: '古船遗迹', 下标: 101, 固定星级: 11, 需求等级: 1000 },
    { 地图名: '森林迷宫', 下标: 111, 固定星级: 12, 需求等级: 1200 },
    { 地图名: '古之城墙', 下标: 121, 固定星级: 13, 需求等级: 1400 },
    { 地图名: '暗影迷宫', 下标: 131, 固定星级: 14, 需求等级: 1600 },
    { 地图名: '失落暗殿', 下标: 141, 固定星级: 15, 需求等级: 1800 },
    { 地图名: '神秘古国', 下标: 151, 固定星级: 16, 需求等级: 2000 },
    { 地图名: '海岛遗迹', 下标: 161, 固定星级: 17, 需求等级: 2200 },
    { 地图名: '魔之莽道', 下标: 171, 固定星级: 18, 需求等级: 2400 },
    { 地图名: '盘蛇古迹', 下标: 181, 固定星级: 19, 需求等级: 2600 },
    { 地图名: '泗水祭坛', 下标: 191, 固定星级: 20, 需求等级: 2800 },
    { 地图名: '铁血魔域', 下标: 201, 固定星级: 21, 需求等级: 3000 },
    { 地图名: '血腥森林', 下标: 211, 固定星级: 22, 需求等级: 3200 },
    { 地图名: '蛮荒丛林', 下标: 221, 固定星级: 23, 需求等级: 3400 },
    { 地图名: '血狱皇陵', 下标: 231, 固定星级: 24, 需求等级: 3600 },
    { 地图名: '星空廊道', 下标: 241, 固定星级: 25, 需求等级: 3800 },

    { 地图名: '黑暗森林', 下标: 251, 固定星级: 26, 需求等级: 4000 },
    { 地图名: '郊外平原', 下标: 261, 固定星级: 27, 需求等级: 4200 },
    { 地图名: '天然洞穴', 下标: 271, 固定星级: 28, 需求等级: 4400 },
    { 地图名: '矿区山谷', 下标: 281, 固定星级: 29, 需求等级: 4600 },
    { 地图名: '祖玛回廊', 下标: 291, 固定星级: 30, 需求等级: 4800 },

    { 地图名: '万妖森林', 下标: 301, 固定星级: 31, 需求等级: 5000 },
    { 地图名: '万妖峡谷', 下标: 311, 固定星级: 32, 需求等级: 5200 },
    { 地图名: '万妖之巢', 下标: 321, 固定星级: 33, 需求等级: 5400 },
    { 地图名: '万妖迷宫', 下标: 331, 固定星级: 34, 需求等级: 5600 },
    { 地图名: '万妖祭坛', 下标: 341, 固定星级: 35, 需求等级: 5800 },

    { 地图名: '邪恶洞穴', 下标: 351, 固定星级: 36, 需求等级: 6000 },
    { 地图名: '蛇妖山谷', 下标: 361, 固定星级: 37, 需求等级: 6200 },
    { 地图名: '沃玛寺庙', 下标: 371, 固定星级: 38, 需求等级: 6400 },
    { 地图名: '暗黑蛇谷', 下标: 381, 固定星级: 39, 需求等级: 6600 },
    { 地图名: '沉息之地', 下标: 391, 固定星级: 40, 需求等级: 6800 },

    { 地图名: '神域冰谷', 下标: 401, 固定星级: 41, 需求等级: 7000 },
    { 地图名: '纷争之地', 下标: 411, 固定星级: 42, 需求等级: 7200 },
    { 地图名: '上古禁地', 下标: 421, 固定星级: 43, 需求等级: 7400 },
    { 地图名: '封印之城', 下标: 431, 固定星级: 44, 需求等级: 7600 },
    { 地图名: '神庙主殿', 下标: 441, 固定星级: 45, 需求等级: 7800 },

]


