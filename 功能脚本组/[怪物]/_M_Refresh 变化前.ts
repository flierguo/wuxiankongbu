/*怪物刷新单元*/

import { js_number, js_numberRandom, js_Random, js_war } from "../../全局脚本[公共单元]/utils/计算方法"
import { 血量显示 } from "../../大数值版本/字符计算"
import { 大数值整数简写, 随机小数 } from "../[服务]/延时跳转"
import { TAG, _M_BaseData, 原始名字, 怪物星数, 怪物爆率文件, 怪物称号, 怪物颜色 } from "./_M_Base"
import * as 地图 from '../[地图]/地图';

/**
 * 怪物配置接口定义
 */
interface 怪物配置 {
    类别: string;
    颜色: number;
    速度: number;
    攻击L: string;
    攻击M: string;
    血量L: string;
    血量M: string;
    exp: number;
    range?: number;
    triggerMagic?: boolean;
}

/**
 * 地图刷怪配置接口
 */
interface 刷怪配置 {
    地图名字: string;
    怪物名字: string;
    怪物星星大: number;
    经验值: number;
}

/**
 * 变异配置接口
 */
interface 变异配置 {
    后缀: string;
    攻击倍率: string;
    血量倍率: string;
    星星增加: () => number;
    颜色: number;
    几率范围: [number, number];
}

// 定义怪物生物分类
const 生物分类 = {
    1: [
        { 类别: '蝼蚁', 颜色: 怪物颜色.蝼蚁白, 速度: 1400, 攻击L: '5', 攻击M: '15', 血量L: '1000', 血量M: '2000', exp: 10 },
        { 类别: '平凡', 颜色: 怪物颜色.平凡绿, 速度: 1400, 攻击L: '10', 攻击M: '30', 血量L: '2000', 血量M: '4000', exp: 20 }
    ],
    2: [
        { 类别: '野蛮', 颜色: 怪物颜色.野蛮浅绿, 速度: 1200, 攻击L: '20', 攻击M: '60', 血量L: '8000', 血量M: '24000', exp: 30 },
        { 类别: '劲敌', 颜色: 怪物颜色.劲敌蓝,   速度: 1200, 攻击L: '40', 攻击M: '120', 血量L: '16000', 血量M: '42000', exp: 40 }//攻击4倍 血量8倍
    ],
    3: [
        { 类别: '精英', 颜色: 怪物颜色.精英黄, 速度: 1100, 攻击L: '100', 攻击M: '300', 血量L: '60000', 血量M: '180000', exp: 60 },
        { 类别: '骑士', 颜色: 怪物颜色.骑士橙, 速度: 1000, 攻击L: '200', 攻击M: '600', 血量L: '100000', 血量M: '300000', exp: 80 }//攻击5倍  血量8倍
    ],
    4: [
        { 类别: '头领', 颜色: 怪物颜色.头领紫, 速度: 800, 攻击L: '400', 攻击M: '1200', 血量L: '300000', 血量M: '600000', exp: 100, range: 4 },
        { 类别: '深渊', 颜色: 怪物颜色.深渊粉, 速度: 700, 攻击L: '800', 攻击M: '2400', 血量L: '600000', 血量M: '800000', exp: 120, range: 4 }//攻击4倍  血量8倍
    ],
    5: [
        { 类别: '洪荒·BOSS', 颜色: 怪物颜色.洪荒灰,     速度: 600, 攻击L: '1000', 攻击M: '3000', 血量L: '1000000', 血量M: '3000000', exp: 150, range: 8, triggerMagic: true },
        { 类别: '灭世·BOSS', 颜色: 怪物颜色.灭世BOSS红, 速度: 400, 攻击L: '1500', 攻击M: '4000', 血量L: '2000000', 血量M: '5000000', exp: 200, range: 8, triggerMagic: true }
    ],
    6: [
        { 类别: '全民·BOSS', 颜色: 怪物颜色.世界BOSS, 速度: 800, 攻击L: '500', 攻击M: '800', 血量L: '', 血量M: '5500000', exp: 10000 }
    ]
};

// 地图区域配置
const 地图区域配置 = {
    九大陆地图: [],
    十大陆地图: [],
    十一大陆地图: [],
    十二大陆地图: [],
    不进化地图: []
};

// 怪物变异配置
const 怪物变异配置 = {
    噩梦: {
        后缀: '[噩梦☆☆]',
        攻击倍率: '2',
        血量倍率: '2',
        星星增加: () => 5 + random(6),
        颜色: 125,
        几率范围: [100, 180]
    },
    暗黑: {
        后缀: '[暗黑★★★]',
        攻击倍率: '3',
        血量倍率: '5',
        星星增加: () => 40 + random(21),
        颜色: 233,
        几率范围: [10, 40]
    },
    幻化: {
        后缀: '[幻化SSSSS]',
        攻击倍率: '2',
        血量倍率: '10',
        星星增加: () => 20 + random(21),
        颜色: 244,
        几率范围: [0, 10]
    }
};

/**
 * 刷新怪物属性
 * @param Envir 环境对象
 * @param Monster 怪物对象
 * @param Tag 标签编号
 */
export function Refresh(Envir: TEnvirnoment, Monster: TActor, Tag: number): void {
    Monster.SetDenyAutoAddHP(false) // 设置自动回血
    let 标签 = Monster.GetNVar(TAG)
    // 初始化怪物基础属性
    const 取尾数: number = 标签 % 10;
    let 怪物类别 = '';
    let 怪物的颜色 = 0;
    let 怪物后缀 = '';
    let 星星增加 = 1;
    let 怪物变色 = 255;
    let 攻速移速 = 1400;
    let 攻击小 = `0`;
    let 攻击大 = `0`;
    let 血量小 = `0`;
    let 血量大 = `0`;
    let 经验值 = 0;
    let 全民boss星星大 = `1`;
    let 全局血量倍数 = `1`;
    let 怪物标识 = 0;

    const 当前地图ID = Monster.Map.MapID;
    const 当前地图名 = Envir.GetName();
    
    // 获取当前地图配置
    const 副本池 = 地图.取地图;
    const 当前副本配置 = 副本池().find(item => item.地图ID === 当前地图ID);
    
    if (!当前副本配置) return;
    
    // 根据副本配置查找刷怪配置
    const 当前刷怪配置 = 刷怪属性.filter(配置 => 配置.地图名字 === 当前副本配置.地图名);
    const 地图星级 = 当前副本配置.显示名.match(/\((\d+)星\)/)?.[1] || '1';

    // 查找匹配的怪物配置
    const 匹配配置 = 当前刷怪配置.find(
        循环 => (地图.ID取地图名(Monster.GetMapName()) === 循环.地图名字 && Monster.GetName() === 循环.怪物名字) || 
                Monster.Name === `全民boss`
    );
    
    if (!匹配配置) return;
    
    // 根据取尾数选择怪物类型
    const 怪物类型配置 = 生物分类[取尾数];
    if (!怪物类型配置) return;
    
    // 随机选择怪物等级
    const 是高级怪物 = 怪物类型配置.length > 1 && random(100) < 20;
    const 选定配置 = 是高级怪物 ? 怪物类型配置[0] : 怪物类型配置[怪物类型配置.length - 1];
    
    // 应用基础配置
    怪物类别 = 选定配置.类别;
    怪物的颜色 = 选定配置.颜色;
    攻速移速 = 选定配置.速度;
    攻击小 = 选定配置.攻击L;
    攻击大 = 选定配置.攻击M;
    血量小 = 选定配置.血量L;
    血量大 = 选定配置.血量M;
    经验值 = 选定配置.exp === 10000 ? 10000 : 匹配配置.经验值 * 选定配置.exp;
    怪物标识 = Tag;

    
    // 应用特殊属性
    if (选定配置.range) Monster.SetAttackRange(选定配置.range);
    if (选定配置.triggerMagic) Monster.SetTriggerSelectMagicBeforeAttack(true);
    
    // 应用地图和怪物变异效果
    const 变异结果 = 应用怪物变异(Envir, 取尾数, 当前地图名);
    怪物后缀 = 变异结果.怪物后缀;
    攻击小 = js_number(攻击小, 变异结果.攻击倍率, 3);
    攻击大 = js_number(攻击大, 变异结果.攻击倍率, 3);
    血量小 = js_number(血量小, 变异结果.血量倍率, 3);
    血量大 = js_number(血量大, 变异结果.血量倍率, 3);
    星星增加 = 变异结果.星星增加;
    怪物变色 = 变异结果.怪物变色;
    全局血量倍数 = 变异结果.全局血量倍数;
    
    // 计算怪物星级
    let 怪怪星星 = 计算怪物星级(取尾数, 匹配配置, 当前地图名, 星星增加, 地图星级, 全民boss星星大);
    Monster.SetSVar(怪物星数, String(怪怪星星));
    
    // 计算怪物防御
    let 怪物防御 = 计算怪物防御(怪怪星星, 怪物类别, 当前地图名);
    let 星星变量 = '星★';
    
    // 计算最终血量和攻击
    let 血量 = 计算最终血量(取尾数, 怪怪星星, 血量小, 血量大, 全局血量倍数, 当前地图名);
    let 攻击计算小 = 计算最终攻击(怪怪星星, 攻击小, 当前地图名);
    let 攻击计算大 = 计算最终攻击(怪怪星星, 攻击大, 当前地图名);
    let 物理防御小 = js_number(攻击计算小, `0.4`, 3);
    let 物理防御大 = js_number(攻击计算大, `0.8`, 3);
    
    // 特殊处理
    if (js_war(怪物防御, `1`) < 0) {
        怪物防御 = `1`;
    }
    
    // 全民BOSS处理
    if (取尾数 == 6) {
        物理防御小 = 怪怪星星;
        物理防御大 = 怪怪星星;
        广播全民BOSS位置(Envir, Monster);
    }
    
    // 特殊地图处理
    if (八大陆地图.includes(Monster.GetMapName())) {
        攻速移速 = 100;
    }
    
    // 设置怪物属性
    设置怪物属性(Monster, 匹配配置, 怪怪星星, 星星变量, 怪物后缀, 怪物类别, 怪物的颜色, 怪物变色, 
                攻速移速, 经验值, 血量, 攻击计算小, 攻击计算大, 物理防御小, 物理防御大, 地图星级, 怪物标识);
}

/**
 * 应用怪物变异效果
 * @param Envir 环境对象
 * @param 取尾数 怪物标签尾数
 * @param 当前地图名 当前地图名称
 * @returns 变异后的属性对象
 */
function 应用怪物变异(Envir: TEnvirnoment, 取尾数: number, 当前地图名: string): {怪物后缀: string, 攻击倍率: string, 血量倍率: string, 星星增加: number, 怪物变色: number, 全局血量倍数: string} {
    const 结果 = {
        怪物后缀: '',
        攻击倍率: '1',
        血量倍率: '1',
        星星增加: 1,
        怪物变色: 255,
        全局血量倍数: '1'
    };
    
    // 全民BOSS特殊处理
    if (取尾数 == 6) {
        let 全民boss数组 = Object.keys(全民boss刷怪配置);
        for (let i = 0; i <= 全民boss数组.length - 1; i++) {
            if (当前地图名 == 全民boss数组[i]) {
                结果.血量倍率 = '10';
                break;
            }
        }
        return 结果;
    }

    // 获取当前副本配置
    const 副本池 = 地图.取地图;
    const 当前副本配置 = 副本池().find(item => 地图.ID取地图名(Envir.GetName()) === item.地图名);
    if (!当前副本配置) return 结果;

    // 获取地图等级
    const 地图等级 = 当前副本配置.地图等级 || 当前副本配置.固定星级 || 1;

    // 设置地图全局血量倍率（根据地图等级）
    if (地图等级 <= 5) {
        结果.全局血量倍数 = String(1 + 地图等级);
    } else if (地图等级 <= 10) {
        结果.全局血量倍数 = String(10 * 地图等级);
    } else if (地图等级 <= 15) {
        结果.全局血量倍数 = String(100 * 地图等级);
    } else if (地图等级 <= 20) {
        结果.全局血量倍数 = String(1000 * 地图等级);
    } else {
        结果.全局血量倍数 = String(10000 * 地图等级);
    }
    
    // 随机变异几率
    const 几率 = random(1000);
    
    // console.log(`地图111111名字:${当前地图名} 地图等级:${地图等级} 几率:${几率}`);
    // 根据地图等级应用不同的变异规则
    if (地图等级 < 3) {
        // 低等级地图：可变异为噩梦、幻化
        if (几率 < 10) {
            Object.assign(结果, {
                怪物后缀: 怪物变异配置.幻化.后缀,
                攻击倍率: '1.5',  // 低等级地图的幻化加成降低
                血量倍率: '3',
                星星增加: 5 + random(11),
                怪物变色: 怪物变异配置.幻化.颜色
            });
        } else if (几率 >= 10 && 几率 < 1000) {
            Object.assign(结果, {
                怪物后缀: 怪物变异配置.噩梦.后缀,
                攻击倍率: '1.2',  // 低等级地图的噩梦加成降低
                血量倍率: '2',
                星星增加: 2 + random(4),
                怪物变色: 怪物变异配置.噩梦.颜色
            });
        }
    } else if (地图等级 >= 3 && 地图等级 < 5) {
        // 中等级地图：可变异为噩梦、幻化、暗黑
        if (几率 < 10) {
            Object.assign(结果, {
                怪物后缀: 怪物变异配置.幻化.后缀,
                攻击倍率: '2.5',  // 中等级地图的幻化加成增加
                血量倍率: '8',
                星星增加: 15 + random(16),
                怪物变色: 怪物变异配置.幻化.颜色
            });
        } else if (几率 >= 10 && 几率 < 40) {
            Object.assign(结果, {
                怪物后缀: 怪物变异配置.暗黑.后缀,
                攻击倍率: '2',
                血量倍率: '4',
                星星增加: 10 + random(21),
                怪物变色: 怪物变异配置.暗黑.颜色
            });
        } else if (几率 >= 40 && 几率 < 200) {
            Object.assign(结果, {
                怪物后缀: 怪物变异配置.噩梦.后缀,
                攻击倍率: '1.5',
                血量倍率: '3',
                星星增加: 5 + random(6),
                怪物变色: 怪物变异配置.噩梦.颜色
            });
        }
    } else if (地图等级 >= 5 && 地图等级 < 10) {
        // 高等级地图：强化版变异
        if (几率 < 15) {
            Object.assign(结果, {
                怪物后缀: '[幻化SSSSS]',
                攻击倍率: '5',
                血量倍率: '10',
                星星增加: 50 + random(51),
                怪物变色: 244
            });
        } else if (几率 >= 15 && 几率 < 60) {
            Object.assign(结果, {
                怪物后缀: '[暗黑★★★]',
                攻击倍率: '3',
                血量倍率: '6',
                星星增加: 30 + random(31),
                怪物变色: 233
            });
        } else if (几率 >= 60 && 几率 < 200) {
            Object.assign(结果, {
                怪物后缀: '[噩梦☆☆]',
                攻击倍率: '2',
                血量倍率: '4',
                星星增加: 10 + random(16),
                怪物变色: 125
            });
        }
    } else if (地图等级 >= 10 && 地图等级 < 15) {
        // 超高等级地图：极强化版变异
        if (几率 < 20) {
            Object.assign(结果, {
                怪物后缀: '[幻化SSSSS]',
                攻击倍率: '10',
                血量倍率: '15',
                星星增加: 100 + random(101),
                怪物变色: 244
            });
        } else if (几率 >= 20 && 几率 < 80) {
            Object.assign(结果, {
                怪物后缀: '[暗黑★★★]',
                攻击倍率: '5',
                血量倍率: '10',
                星星增加: 50 + random(51),
                怪物变色: 233
            });
        } else if (几率 >= 80 && 几率 < 200) {
            Object.assign(结果, {
                怪物后缀: '[噩梦☆☆]',
                攻击倍率: '3',
                血量倍率: '5',
                星星增加: 20 + random(21),
                怪物变色: 125
            });
        }
    } else if (地图等级 >= 15 && 地图等级 < 20) {
        // 顶级地图：终极变异
        if (几率 < 30) {
            Object.assign(结果, {
                怪物后缀: '[幻化SSSSS]',
                攻击倍率: '15',
                血量倍率: '20',
                星星增加: 200 + random(201),
                怪物变色: 244
            });
        } else if (几率 >= 30 && 几率 < 100) {
            Object.assign(结果, {
                怪物后缀: '[暗黑★★★]',
                攻击倍率: '10',
                血量倍率: '15',
                星星增加: 100 + random(101),
                怪物变色: 233
            });
        } else if (几率 >= 100 && 几率 < 300) {
            Object.assign(结果, {
                怪物后缀: '[噩梦☆☆]',
                攻击倍率: '5',
                血量倍率: '10',
                星星增加: 50 + random(51),
                怪物变色: 125
            });
        }
    } else {
        // 最顶级地图：神级变异
        if (几率 < 50) {
            Object.assign(结果, {
                怪物后缀: '[幻化SSSSS]',
                攻击倍率: '20',
                血量倍率: '30',
                星星增加: 300 + random(301),
                怪物变色: 244
            });
        } else if (几率 >= 50 && 几率 < 150) {
            Object.assign(结果, {
                怪物后缀: '[暗黑★★★]',
                攻击倍率: '15',
                血量倍率: '20',
                星星增加: 200 + random(201),
                怪物变色: 233
            });
        } else if (几率 >= 150 && 几率 < 300) {
            Object.assign(结果, {
                怪物后缀: '[噩梦☆☆]',
                攻击倍率: '10',
                血量倍率: '15',
                星星增加: 100 + random(101),
                怪物变色: 125
            });
        }
    }
    
    // 特殊地图处理
    if (不进化地图.includes(当前地图名)) {
        // 不进化地图重置变异效果
        结果.怪物后缀 = '';
        结果.攻击倍率 = '1';
        结果.血量倍率 = '1';
        结果.星星增加 = 1;
        结果.怪物变色 = 255;
    }
    
    return 结果;
}

/**
 * 计算怪物星级
 * @param 取尾数 怪物标签尾数
 * @param 匹配配置 怪物配置
 * @param 当前地图名 地图名称
 * @param 星星增加 星级增加值
 * @param 地图星级 地图星级
 * @param 全民boss星星大 BOSS星级
 * @returns 计算后的星级字符串
 */
function 计算怪物星级(取尾数: number, 匹配配置: 刷怪配置, 当前地图名: string, 星星增加: number, 地图星级: string, 全民boss星星大: string): string {
    // 全民BOSS特殊处理
    if (取尾数 == 6) {
        return 全民boss星星大;
    }
    const 地图星级增加 = js_number(地图星级, `10`, 3);
    // 计算基础星级
    const 大星星 = js_number(String(匹配配置.怪物星星大), 地图星级增加, 3);
    
    // 应用星级增加和地图倍率，并添加随机浮动
    const 最终星级 = js_number(
        js_number(
            js_number(大星星, String(星星增加), 3),
            大数值刷怪配置[当前地图名].星星,
            3
        ),
        随机小数(0.7, 1).toFixed(2),
        4
    );

        console.log(`地图名字:${当前地图名} 最终星级:${最终星级} 大星星:${大星星} 星星增加:${星星增加} 地图星级:${地图星级} 大数值:${大数值刷怪配置[当前地图名].星星}`);

    return 最终星级;
}

/**
 * 计算怪物防御
 * @param 怪怪星星 怪物星级
 * @param 怪物类别 怪物类型
 * @param 当前地图名 地图名称
 * @returns 计算后的防御值字符串
 */
function 计算怪物防御(怪怪星星: string, 怪物类别: string, 当前地图名: string): string {
    let 基础防御 = `10`;
   
    // 根据怪物类别设置基础防御系数
    if (怪物类别.includes('蝼蚁')) {
        基础防御 = js_number(js_number(怪怪星星, `1`, 3), String(1 + random(10)), 1);
    } else if (怪物类别.includes('平凡')) {
        基础防御 = js_number(js_number(怪怪星星, `5`, 3), String(1 + random(20)), 1);
    } else if (怪物类别.includes('野蛮')) {
        基础防御 = js_number(js_number(怪怪星星, `20`, 3), String(1 + random(30)), 1);
    } else if (怪物类别.includes('劲敌')) {
        基础防御 = js_number(js_number(怪怪星星, `50`, 3), String(1 + random(50)), 1);
    } else if (怪物类别.includes('精英')) {
        基础防御 = js_number(js_number(怪怪星星, `100`, 3), String(1 + random(100)), 1);
    } else if (怪物类别.includes('骑士')) {
        基础防御 = js_number(js_number(怪怪星星, `150`, 3), String(1 + random(150)), 1);
    } else if (怪物类别.includes('头领')) {
        基础防御 = js_number(js_number(怪怪星星, `200`, 3), String(1 + random(200)), 1);
    } else if (怪物类别.includes('深渊')) {
        基础防御 = js_number(js_number(怪怪星星, `250`, 3), String(1 + random(250)), 1);
    } else {
        基础防御 = js_number(怪怪星星, String(1 + random(10)), 1);
    }
    
    // 应用地图倍率
    基础防御 = js_number(大数值刷怪配置[当前地图名].星星, 基础防御, 3);
    
    // 特殊处理极低星级蝼蚁怪
    if (js_war(怪怪星星, `0`) > 0 && js_war(怪怪星星, `6`) < 0 && 怪物类别 == '蝼蚁') {
        基础防御 = `1`;
    }
    
    // 防御值不得小于1
    if (js_war(基础防御, `1`) < 0) {
        基础防御 = `1`;
    }
    
    return 基础防御;
}

/**
 * 计算最终血量
 * @param 取尾数 怪物标签尾数
 * @param 怪怪星星 怪物星级
 * @param 血量小 基础最小血量
 * @param 血量大 基础最大血量
 * @param 全局血量倍数 血量全局倍率
 * @param 当前地图名 地图名称
 * @returns 计算后的血量字符串
 */
function 计算最终血量(取尾数: number, 怪怪星星: string, 血量小: string, 血量大: string, 全局血量倍数: string, 当前地图名: string): string {
    let 基础血量 = `0`;
    
    // 根据怪物类型计算血量
    if (取尾数 == 6) {
        基础血量 = js_number(怪怪星星, 血量大, 3);
    } else {
        基础血量 = js_numberRandom(js_number(怪怪星星, 血量小, 3), js_number(怪怪星星, 血量大, 3));
    }
    
    // 应用地图倍率
    const 最终血量 = js_number(大数值刷怪配置[当前地图名].星星, 基础血量, 3);
    
    return 最终血量;
}

/**
 * 计算最终攻击
 * @param 怪怪星星 怪物星级
 * @param 攻击值 基础攻击值
 * @param 当前地图名 地图名称
 * @returns 计算后的攻击值字符串
 */
function 计算最终攻击(怪怪星星: string, 攻击值: string, 当前地图名: string): string {
    // 计算基础攻击
    let 基础攻击 = js_number(怪怪星星, 攻击值, 3);
    
    // 应用地图倍率
    基础攻击 = js_number(大数值刷怪配置[当前地图名].星星, 基础攻击, 3);
    
    return 基础攻击;
}

/**
 * 广播全民BOSS位置
 */
function 广播全民BOSS位置(Envir: TEnvirnoment, Monster: TActor): void {
    GameLib.BroadcastTopMessage(`{s=全民boss 出现在 ${Envir.DisplayName} 坐标 ${Monster.GetMapX()} ${Monster.GetMapY()};c=249}`);
    GameLib.BroadcastCountDownMessage(`{s=全民boss 出现在 ${Envir.DisplayName} 坐标 ${Monster.GetMapX()} ${Monster.GetMapY()};c=249} 显示时间:<$Time:20$>…`);
}

/**
 * 设置怪物属性
 */
function 设置怪物属性(Monster: TActor, 匹配配置: 刷怪配置, 怪怪星星: string, 星星变量: string, 怪物后缀: string, 怪物类别: string, 怪物的颜色: number, 怪物变色: number, 
                  攻速移速: number, 经验值: number, 血量: string, 攻击计算小: string, 攻击计算大: string, 物理防御小: string, 物理防御大: string, 地图星级: string, 怪物标识: number): void {
    Monster.SetDCMax(99);
    Monster.SetDCMin(99);
    Monster.SetACMax(0);
    Monster.SetACMin(0);
    Monster.SetMaxHP(100000000);
    Monster.SetHP(100000000);
    
    const 地图固定星级 = 地图.取地图固定星级(匹配配置.地图名字);
    
    // 设置基础经验值
    let 最终经验值 = 经验值;
    
    Monster.SetExp(最终经验值);
    
    // 根据地图等级动态设置爆率文件
    if (Monster.Name == '全民boss') {
        Monster.SetDropName('全民boss');
        Monster.SetSVar(怪物爆率文件, '全民boss');
    } else {
        // 根据传入的地图星级生成对应的爆率文件名
        const 动态爆率文件 = `${地图固定星级}级地图`;
        Monster.SetDropName(动态爆率文件);
        Monster.SetSVar(怪物爆率文件, 动态爆率文件);
    }
    if (地图固定星级 > 0 && 地图固定星级 <= 5) {     //1大陆
        物理防御小 = '10'
        物理防御大 = '100'
    } else if (地图固定星级 > 5 && 地图固定星级 <= 10) {     //2大陆
        物理防御小 = js_number(js_number(物理防御小, '1', 3) , '1500000000' , 1)
        物理防御大 = js_number(js_number(物理防御大, '1', 3) , '1500000000' , 1)
    } else if (地图固定星级 > 10 && 地图固定星级 <= 15) {     //3大陆
        物理防御小 = js_number(js_number(物理防御小, '80', 3) , '20000000000000' , 1)
        物理防御大 = js_number(js_number(物理防御大, '80', 3) , '20000000000000' , 1)
    } else if (地图固定星级 > 15 && 地图固定星级 <= 20) {     //4大陆
        物理防御小 = js_number(js_number(物理防御小, '120', 3) , '25000000000000' , 1)
        物理防御大 = js_number(js_number(物理防御大, '120', 3) , '25000000000000' , 1)
    } else if (地图固定星级 > 20 && 地图固定星级 <= 25) {     //5大陆
        物理防御小 = js_number(js_number(物理防御小, '160', 3) , '30000000000000' , 1)
        物理防御大 = js_number(js_number(物理防御大, '160', 3) , '30000000000000' , 1)
    } else if (地图固定星级 > 25 && 地图固定星级 <= 30) {     //6大陆
        物理防御小 = js_number(js_number(物理防御小, '200', 3) , '35000000000000' , 1)
        物理防御大 = js_number(js_number(物理防御大, '200', 3) , '35000000000000' , 1)
    } else if (地图固定星级 > 30 && 地图固定星级 <= 35) {     //7大陆
        物理防御小 = js_number(js_number(物理防御小, '240', 3) , '40000000000000' , 1)
        物理防御大 = js_number(js_number(物理防御大, '240', 3) , '40000000000000' , 1)
    } else if (地图固定星级 > 35 && 地图固定星级 <= 40) {     //8大陆
        物理防御小 = js_number(js_number(物理防御小, '280', 3) , '45000000000000' , 1)
        物理防御大 = js_number(js_number(物理防御大, '280', 3) , '45000000000000' , 1)
    } else if (地图固定星级 > 40 && 地图固定星级 <= 45) {     //9大陆
        物理防御小 = js_number(js_number(物理防御小, '320', 3) , '50000000000000' , 1)
        物理防御大 = js_number(js_number(物理防御大, '320', 3) , '50000000000000' , 1)
    } else if (地图固定星级 > 45 && 地图固定星级 <= 50) {     //10大陆
        物理防御小 = js_number(js_number(物理防御小, '360', 3) , '55000000000000' , 1)
        物理防御大 = js_number(js_number(物理防御大, '360', 3) , '55000000000000' , 1)
    } else if (地图固定星级 > 50 && 地图固定星级 <= 55) {     //11大陆
        物理防御小 = js_number(js_number(物理防御小, '400', 3) , '60000000000000' , 1)
        物理防御大 = js_number(js_number(物理防御大, '400', 3) , '60000000000000' , 1)
    } 

    // 设置外观和速度
    Monster.SetBlendColor(怪物变色);
    Monster.SetAttackSpeed(攻速移速);
    Monster.SetSVar(原始名字, Monster.Name);
    Monster.SetWalkSpeed(攻速移速);
    Monster.SetNameColor(怪物的颜色);
    Monster.SetViewRange(12);
    
    // 设置名字和数据
    const 怪物显示名 = `${怪怪星星}${星星变量}${Monster.GetName()}${怪物后缀}\\${怪物类别}`;
    Monster.AddShowName(怪物显示名);
    Monster.SetSVar(怪物称号, `${怪怪星星}${星星变量}${Monster.GetName()}\\${怪物类别}`);
    Monster.SetSVar(97, 怪物显示名);
    
    // 保存怪物属性
    Monster.SetSVar(92, 血量);
    Monster.SetSVar(91, Monster.GetSVar(92));
    Monster.SetSVar(93, 攻击计算小);
    Monster.SetSVar(94, 攻击计算大);
    Monster.SetSVar(95, 物理防御小);
    Monster.SetSVar(96, 物理防御大);
    Monster.SetNVar(TAG, 怪物标识);
    // 保存怪物信息到变量
    const 新字符 = { 
        怪物名字: Monster.GetSVar(97), 
        怪物等级: String(Monster.Level), 
        血量: 血量, 
        攻击: 攻击计算大, 
        防御: 物理防御大, 
        怪物颜色: 怪物的颜色, 
        怪物标志: 怪物标识, 
        怪物星数: 怪怪星星 
    };
    
    GameLib.R.怪物信息 = GameLib.R.怪物信息 || {};
    GameLib.R.怪物信息[`${Monster.Handle}`] = JSON.stringify(新字符);
    Monster.SetSVar(98, JSON.stringify(新字符));
    
    // 显示血量
    血量显示(Monster);
}

// 保持原有配置数据
const 随机15经验 = [1, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28]
const 随机68经验 = [28, 30, 32, 34, 36, 38, 40, 42, 44, 46]
const 不进化地图 = []
const 八大陆地图 = []
const 九大陆地图 = []
const 十大陆地图 = []
const 十一大陆地图 = []
const 十二大陆地图 = []
const 随机1大陆 = [10, 20, 40]
const 随机2大陆 = [60, 80, 100]
const 随机3大陆 = [120, 140, 160]
const 随机4大陆 = [180, 200, 220]
const 随机5大陆 = [240, 260, 280]
const 随机6大陆 = [300, 320, 340]
const 随机7大陆 = [360, 380, 400]
const 随机8大陆 = [420, 440, 460]
const 随机9大陆 = [500, 550, 600]
const 随机10大陆 = [650, 700, 750]
const 随机11大陆 = [800, 850, 900]
const 随机12大陆 = [1000, 1200, 1400]

const 随机15大陆 = [10, 20, 40, 60, 80, 100, 120, 140, 160, 180, 200, 220, 240, 260, 280]
const 随机68大陆 = [300, 320, 340, 300, 360, 380, 420, 440, 460]
export enum 星星数量检测 {
    第一张小怪 = 10,
    第一张大怪 = 5,
    第二张小怪 = 100,
    第二张大怪 = 50,
    第三张小怪 = 200,
    第三张大怪 = 100,
}

// 保留原有刷怪属性数据
const 刷怪属性 = [
 

    { 地图名字:'荒芜山谷', 怪物名字:'鸡', 怪物星星大:1, 经验值:20},
    { 地图名字:'荒芜山谷', 怪物名字:'鹿', 怪物星星大:1, 经验值:20},
    { 地图名字:'荒芜山谷', 怪物名字:'肥羊', 怪物星星大:1, 经验值:20},
    { 地图名字:'荒芜山谷', 怪物名字:'稻草人', 怪物星星大:1, 经验值:20},
    { 地图名字:'荒芜山谷', 怪物名字:'多钩猫', 怪物星星大:1, 经验值:20},
    { 地图名字:'荒芜山谷', 怪物名字:'钉耙猫', 怪物星星大:1, 经验值:20},
    { 地图名字:'荒芜山谷', 怪物名字:'毒蜘蛛', 怪物星星大:1, 经验值:20},
    { 地图名字:'荒芜山谷', 怪物名字:'猎鹰', 怪物星星大:1, 经验值:20},
    { 地图名字:'荒芜山谷', 怪物名字:'大尾狐狸', 怪物星星大:1, 经验值:20},
    { 地图名字:'试炼之地', 怪物名字:'粪虫', 怪物星星大:1, 经验值:20},
    { 地图名字:'试炼之地', 怪物名字:'洞蛆', 怪物星星大:1, 经验值:20},
    { 地图名字:'试炼之地', 怪物名字:'骷髅', 怪物星星大:2, 经验值:40},
    { 地图名字:'试炼之地', 怪物名字:'掷斧骷髅', 怪物星星大:2, 经验值:40},
    { 地图名字:'试炼之地', 怪物名字:'骷髅战士', 怪物星星大:2, 经验值:40},
    { 地图名字:'试炼之地', 怪物名字:'骷髅战将', 怪物星星大:2, 经验值:40},
    { 地图名字:'试炼之地', 怪物名字:'毒骷髅', 怪物星星大:2, 经验值:40},
    { 地图名字:'试炼之地', 怪物名字:'骷髅精灵', 怪物星星大:2, 经验值:40},
    { 地图名字:'试炼之地', 怪物名字:'骨龙精灵', 怪物星星大:2, 经验值:40},
    { 地图名字:'血之炼狱', 怪物名字:'红僵', 怪物星星大:2, 经验值:40},
    { 地图名字:'血之炼狱', 怪物名字:'黑僵', 怪物星星大:2, 经验值:40},
    { 地图名字:'血之炼狱', 怪物名字:'电僵王', 怪物星星大:2, 经验值:40},
    { 地图名字:'血之炼狱', 怪物名字:'闪电僵尸', 怪物星星大:2, 经验值:40},
    { 地图名字:'血之炼狱', 怪物名字:'僵尸王', 怪物星星大:4, 经验值:60},
    { 地图名字:'血之炼狱', 怪物名字:'血僵尸', 怪物星星大:4, 经验值:60},
    { 地图名字:'血之炼狱', 怪物名字:'尸王', 怪物星星大:4, 经验值:60},
    { 地图名字:'血之炼狱', 怪物名字:'奢比', 怪物星星大:4, 经验值:60},
    { 地图名字:'血之炼狱', 怪物名字:'凶悍屠夫', 怪物星星大:4, 经验值:60},
    { 地图名字:'竞技洞窟', 怪物名字:'蜈蚣', 怪物星星大:4, 经验值:60},
    { 地图名字:'竞技洞窟', 怪物名字:'黑色恶蛆', 怪物星星大:4, 经验值:60},
    { 地图名字:'竞技洞窟', 怪物名字:'蝎子', 怪物星星大:4, 经验值:60},
    { 地图名字:'竞技洞窟', 怪物名字:'巨型蠕虫', 怪物星星大:4, 经验值:60},
    { 地图名字:'竞技洞窟', 怪物名字:'半兽人', 怪物星星大:4, 经验值:60},
    { 地图名字:'竞技洞窟', 怪物名字:'半兽战士', 怪物星星大:4, 经验值:60},
    { 地图名字:'竞技洞窟', 怪物名字:'半兽勇士', 怪物星星大:8, 经验值:80},
    { 地图名字:'竞技洞窟', 怪物名字:'半兽统领', 怪物星星大:8, 经验值:80},
    { 地图名字:'竞技洞窟', 怪物名字:'恶魔教主', 怪物星星大:8, 经验值:80},
    { 地图名字:'血路之颠', 怪物名字:'多角虫', 怪物星星大:8, 经验值:80},
    { 地图名字:'血路之颠', 怪物名字:'巨型多角虫', 怪物星星大:8, 经验值:80},
    { 地图名字:'血路之颠', 怪物名字:'双头金刚', 怪物星星大:8, 经验值:80},
    { 地图名字:'血路之颠', 怪物名字:'双头血魔', 怪物星星大:8, 经验值:80},
    { 地图名字:'血路之颠', 怪物名字:'变异双头血魔', 怪物星星大:8, 经验值:80},
    { 地图名字:'血路之颠', 怪物名字:'变异双头金刚', 怪物星星大:8, 经验值:80},
    { 地图名字:'血路之颠', 怪物名字:'暗之双头血魔', 怪物星星大:8, 经验值:80},
    { 地图名字:'血路之颠', 怪物名字:'暗之双头金刚', 怪物星星大:8, 经验值:80},
    { 地图名字:'血路之颠', 怪物名字:'赤月恶魔', 怪物星星大:16, 经验值:100},
    { 地图名字:'沙漠绿洲', 怪物名字:'猎鹰', 怪物星星大:16, 经验值:100},
    { 地图名字:'沙漠绿洲', 怪物名字:'红蛇', 怪物星星大:16, 经验值:100},
    { 地图名字:'沙漠绿洲', 怪物名字:'虎蛇', 怪物星星大:16, 经验值:100},
    { 地图名字:'沙漠绿洲', 怪物名字:'毒蜘蛛', 怪物星星大:16, 经验值:100},
    { 地图名字:'沙漠绿洲', 怪物名字:'暴牙蜘蛛', 怪物星星大:16, 经验值:100},
    { 地图名字:'沙漠绿洲', 怪物名字:'月魔蜘蛛', 怪物星星大:16, 经验值:100},
    { 地图名字:'沙漠绿洲', 怪物名字:'蛇妖战士', 怪物星星大:16, 经验值:100},
    { 地图名字:'沙漠绿洲', 怪物名字:'变异蛇妖', 怪物星星大:16, 经验值:100},
    { 地图名字:'沙漠绿洲', 怪物名字:'金色眼镜蛇', 怪物星星大:16, 经验值:100},
    { 地图名字:'凄凉之地', 怪物名字:'多钩猫王', 怪物星星大:16, 经验值:100},
    { 地图名字:'凄凉之地', 怪物名字:'钉耙猫王', 怪物星星大:32, 经验值:120},
    { 地图名字:'凄凉之地', 怪物名字:'红蛇王', 怪物星星大:32, 经验值:120},
    { 地图名字:'凄凉之地', 怪物名字:'虎蛇王', 怪物星星大:32, 经验值:120},
    { 地图名字:'凄凉之地', 怪物名字:'红野猪', 怪物星星大:32, 经验值:120},
    { 地图名字:'凄凉之地', 怪物名字:'黑野猪', 怪物星星大:32, 经验值:120},
    { 地图名字:'凄凉之地', 怪物名字:'僵尸王', 怪物星星大:32, 经验值:120},
    { 地图名字:'凄凉之地', 怪物名字:'黑暗巨锤', 怪物星星大:32, 经验值:120},
    { 地图名字:'凄凉之地', 怪物名字:'丛林守护者', 怪物星星大:32, 经验值:120},
    { 地图名字:'狂风峭壁', 怪物名字:'钢牙蜘蛛', 怪物星星大:32, 经验值:120},
    { 地图名字:'狂风峭壁', 怪物名字:'花吻蜘蛛', 怪物星星大:32, 经验值:120},
    { 地图名字:'狂风峭壁', 怪物名字:'暗黑战士', 怪物星星大:32, 经验值:120},
    { 地图名字:'狂风峭壁', 怪物名字:'沃玛战士', 怪物星星大:64, 经验值:140},
    { 地图名字:'狂风峭壁', 怪物名字:'沃玛勇士', 怪物星星大:64, 经验值:140},
    { 地图名字:'狂风峭壁', 怪物名字:'火焰沃玛', 怪物星星大:64, 经验值:140},
    { 地图名字:'狂风峭壁', 怪物名字:'沃玛卫士', 怪物星星大:64, 经验值:140},
    { 地图名字:'狂风峭壁', 怪物名字:'沃玛教主', 怪物星星大:64, 经验值:140},
    { 地图名字:'狂风峭壁', 怪物名字:'沃玛统治者', 怪物星星大:64, 经验值:140},
    { 地图名字:'崎岖索道', 怪物名字:'跳跳蜂王', 怪物星星大:64, 经验值:140},
    { 地图名字:'崎岖索道', 怪物名字:'雪蚕王', 怪物星星大:64, 经验值:140},
    { 地图名字:'崎岖索道', 怪物名字:'蝎子王', 怪物星星大:64, 经验值:140},
    { 地图名字:'崎岖索道', 怪物名字:'钢牙蜘蛛', 怪物星星大:64, 经验值:140},
    { 地图名字:'崎岖索道', 怪物名字:'蝎蛇', 怪物星星大:64, 经验值:140},
    { 地图名字:'崎岖索道', 怪物名字:'钳虫', 怪物星星大:128, 经验值:160},
    { 地图名字:'崎岖索道', 怪物名字:'邪恶钳虫', 怪物星星大:128, 经验值:160},
    { 地图名字:'崎岖索道', 怪物名字:'白野猪', 怪物星星大:128, 经验值:160},
    { 地图名字:'崎岖索道', 怪物名字:'恶魔飞虫', 怪物星星大:128, 经验值:160},
    { 地图名字:'风暴峡谷', 怪物名字:'地狱犬', 怪物星星大:128, 经验值:160},
    { 地图名字:'风暴峡谷', 怪物名字:'沙虫', 怪物星星大:128, 经验值:160},
    { 地图名字:'风暴峡谷', 怪物名字:'蜈蚣王', 怪物星星大:128, 经验值:160},
    { 地图名字:'风暴峡谷', 怪物名字:'盔甲虫', 怪物星星大:128, 经验值:160},
    { 地图名字:'风暴峡谷', 怪物名字:'大老鼠', 怪物星星大:128, 经验值:160},
    { 地图名字:'风暴峡谷', 怪物名字:'神鹰', 怪物星星大:128, 经验值:160},
    { 地图名字:'风暴峡谷', 怪物名字:'幽冥雕像', 怪物星星大:128, 经验值:160},
    { 地图名字:'风暴峡谷', 怪物名字:'幽冥卫士', 怪物星星大:256, 经验值:180},
    { 地图名字:'风暴峡谷', 怪物名字:'无极天尊', 怪物星星大:256, 经验值:180},
    


]

export const 全民boss地图 = [
    '荒芜山谷',
    '试炼之地',
    '血之炼狱',
    '竞技洞窟',
    '血路之颠',
    '沙漠绿洲',
    '凄凉之地',
    '狂风峭壁',
    '崎岖索道',
    '风暴峡谷',
    '古船遗迹',
    '森林迷宫',
    '古之城墙',
    '暗影迷宫',
    '失落暗殿',
    '神秘古国',
    '海岛遗迹',
    '魔之莽道',
    '盘蛇古迹',
    '泗水祭坛',
    '铁血魔域',
    '血腥森林',
    '蛮荒丛林',
    '血狱皇陵',
    '星空廊道',
    '黑暗森林',
    '郊外平原',
    '天然洞穴',
    '矿区山谷',
    '祖玛回廊',
    '万妖森林',
    '万妖峡谷',
    '万妖之巢',
    '万妖迷宫',
    '万妖祭坛',
    '邪恶洞穴',
    '蛇妖山谷',
    '沃玛寺庙',
    '暗黑蛇谷',
    '沉息之地',
    '神域冰谷',
    '纷争之地',
    '上古禁地',
    '封印之城',
    '神庙主殿',
]

const 全民boss刷怪配置 = {
    '荒芜山谷': { 星星: `1`, },
    '试炼之地': { 星星: `1`, },
    '血之炼狱': { 星星: `1`, },
    '竞技洞窟': { 星星: `1`, },
    '血路之颠': { 星星: `1`, },
    '沙漠绿洲': { 星星: `1`, },
    '凄凉之地': { 星星: `1`, },
    '狂风峭壁': { 星星: `1`, },
    '崎岖索道': { 星星: `1`, },
    '风暴峡谷': { 星星: `1`, },
    '古船遗迹': { 星星: `1`, },
    '森林迷宫': { 星星: `1`, },
    '古之城墙': { 星星: `1`, },
    '暗影迷宫': { 星星: `1`, },
    '失落暗殿': { 星星: `1`, },
    '神秘古国': { 星星: `1`, },
    '海岛遗迹': { 星星: `1`, },
    '魔之莽道': { 星星: `1`, },
    '盘蛇古迹': { 星星: `1`, },
    '泗水祭坛': { 星星: `1`, },
    '铁血魔域': { 星星: `1`, },
    '血腥森林': { 星星: `1`, },
    '蛮荒丛林': { 星星: `1`, },
    '血狱皇陵': { 星星: `1`, },
    '星空廊道': { 星星: `1`, },
    '黑暗森林': { 星星: `1`, },
    '郊外平原': { 星星: `1`, },
    '天然洞穴': { 星星: `1`, },
    '矿区山谷': { 星星: `1`, },
    '祖玛回廊': { 星星: `1`, },
    '万妖森林': { 星星: `1`, },
    '万妖峡谷': { 星星: `1`, },
    '万妖之巢': { 星星: `1`, },
    '万妖迷宫': { 星星: `1`, },
    '万妖祭坛': { 星星: `1`, },
    '邪恶洞穴': { 星星: `1`, },
    '蛇妖山谷': { 星星: `1`, },
    '沃玛寺庙': { 星星: `1`, },
    '暗黑蛇谷': { 星星: `1`, },
    '沉息之地': { 星星: `1`, },
    '神域冰谷': { 星星: `1`, },
    '纷争之地': { 星星: `1`, },
    '上古禁地': { 星星: `1`, },
    '封印之城': { 星星: `1`, },
    '神庙主殿': { 星星: `1`, },
}

const 大数值刷怪配置 = {
    '荒芜山谷': { 星星: `1`, },
    '试炼之地': { 星星: `500`, },
    '血之炼狱': { 星星: `1000`, },
    '竞技洞窟': { 星星: `2000`, },
    '血路之颠': { 星星: `3000`, },
    '沙漠绿洲': { 星星: `80000000000000`, },
    '凄凉之地': { 星星: `1200000000000000000`, },
    '狂风峭壁': { 星星: `1400000000000000000000`, },
    '崎岖索道': { 星星: `1800000000000000000000000`, },
    '风暴峡谷': { 星星: `20000000000000000000000000000`, },
    '古船遗迹': { 星星: `250000000000000000000000000000000`, },
    '森林迷宫': { 星星: `3000000000000000000000000000000000000`, },
    '古之城墙': { 星星: `35000000000000000000000000000000000000000`, },
    '暗影迷宫': { 星星: `400000000000000000000000000000000000000000000`, },
    '失落暗殿': { 星星: `4500000000000000000000000000000000000000000000000`, },
    '神秘古国': { 星星: `55000000000000000000000000000000000000000000000000000`, },
    '海岛遗迹': { 星星: `65000000000000000000000000000000000000000000000000000000000`, },
    '魔之莽道': { 星星: `7500000000000000000000000000000000000000000000000000000000000000`, },
    '盘蛇古迹': { 星星: `85000000000000000000000000000000000000000000000000000000000000000000`, },
    '泗水祭坛': { 星星: `950000000000000000000000000000000000000000000000000000000000000000000000`, },
    '铁血魔域': { 星星: `11000000000000000000000000000000000000000000000000000000000000000000000000000`, },
    '血腥森林': { 星星: `1300000000000000000000000000000000000000000000000000000000000000000000000000000000`, },
    '蛮荒丛林': { 星星: `160000000000000000000000000000000000000000000000000000000000000000000000000000000000000`, },
    '血狱皇陵': { 星星: `17000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`, },
    '星空廊道': { 星星: `1900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`, },
}