/*刷怪数据导入工具*/

import { 更新刷怪配置, 更新智能刷怪配置, 初始化并导入数据 } from './_M_Database';

/**
 * 导入刷怪属性数据到数据库
 * 这个函数包含了原来硬编码的刷怪属性数据
 */
export async function 导入刷怪属性数据(): Promise<boolean> {
    console.log('[数据导入] 开始导入刷怪属性数据...');
    
    const 刷怪属性数据 = [
        { 地图名字: '荒芜山谷', 怪物名字: '鸡', 怪物星星小: 1, 怪物星星大: 1, 爆率文件: '10小怪', 经验值: 1 },
        { 地图名字: '荒芜山谷', 怪物名字: '稻草人', 怪物星星小: 1, 怪物星星大: 1, 爆率文件: '10小怪', 经验值: 1 },
        { 地图名字: '荒芜山谷', 怪物名字: '食人花', 怪物星星小: 1, 怪物星星大: 1, 爆率文件: '10小怪', 经验值: 1 },
        { 地图名字: '荒芜山谷', 怪物名字: '多钩猫', 怪物星星小: 1, 怪物星星大: 1, 爆率文件: '10小怪', 经验值: 1 },
        { 地图名字: '荒芜山谷', 怪物名字: '半兽战士', 怪物星星小: 1, 怪物星星大: 1, 爆率文件: '10精英', 经验值: 1 },
        { 地图名字: '荒芜山谷', 怪物名字: '半兽勇士', 怪物星星小: 1, 怪物星星大: 1, 爆率文件: '10精英', 经验值: 1 },
        { 地图名字: '荒芜山谷', 怪物名字: '半兽统领', 怪物星星小: 1, 怪物星星大: 1, 爆率文件: '10BOSS', 经验值: 1 },
        { 地图名字: '荒芜山谷', 怪物名字: '战仙·人形怪', 怪物星星小: 1, 怪物星星大: 2, 爆率文件: '10人形', 经验值: 1 },
        { 地图名字: '荒芜山谷', 怪物名字: '法仙·人形怪', 怪物星星小: 1, 怪物星星大: 2, 爆率文件: '10人形', 经验值: 1 },
        { 地图名字: '荒芜山谷', 怪物名字: '道仙·人形怪', 怪物星星小: 1, 怪物星星大: 2, 爆率文件: '10人形', 经验值: 1 },

        { 地图名字: '试炼之地', 怪物名字: '洞蛆', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '20小怪', 经验值: 2 },
        { 地图名字: '试炼之地', 怪物名字: '骷髅', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '20小怪', 经验值: 2 },
        { 地图名字: '试炼之地', 怪物名字: '掷斧骷髅', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '20小怪', 经验值: 2 },
        { 地图名字: '试炼之地', 怪物名字: '山洞蝙蝠', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '20小怪', 经验值: 2 },
        { 地图名字: '试炼之地', 怪物名字: '骷髅精灵', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '20精英', 经验值: 2 },
        { 地图名字: '试炼之地', 怪物名字: '百战骨灵', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '20精英', 经验值: 2 },
        { 地图名字: '试炼之地', 怪物名字: '骨龙精灵', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '20BOSS', 经验值: 2 },
        { 地图名字: '试炼之地', 怪物名字: '战仙·人形怪', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '20人形', 经验值: 2 },
        { 地图名字: '试炼之地', 怪物名字: '法仙·人形怪', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '20人形', 经验值: 2 },
        { 地图名字: '试炼之地', 怪物名字: '道仙·人形怪', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '20人形', 经验值: 2 },

        { 地图名字: '血之炼狱', 怪物名字: '沃玛战士', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40小怪', 经验值: 3 },
        { 地图名字: '血之炼狱', 怪物名字: '沃玛勇士', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40小怪', 经验值: 3 },
        { 地图名字: '血之炼狱', 怪物名字: '沃玛战将', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40小怪', 经验值: 3 },
        { 地图名字: '血之炼狱', 怪物名字: '火焰沃玛', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40小怪', 经验值: 3 },
        { 地图名字: '血之炼狱', 怪物名字: '沃玛卫士', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40小怪', 经验值: 3 },
        { 地图名字: '血之炼狱', 怪物名字: '尸王', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40精英', 经验值: 3 },
        { 地图名字: '血之炼狱', 怪物名字: '奢比', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40精英', 经验值: 3 },
        { 地图名字: '血之炼狱', 怪物名字: '凶悍屠夫', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40BOSS', 经验值: 3 },
        { 地图名字: '血之炼狱', 怪物名字: '战仙·人形怪', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40人形', 经验值: 3 },
        { 地图名字: '血之炼狱', 怪物名字: '法仙·人形怪', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40人形', 经验值: 3 },
        { 地图名字: '血之炼狱', 怪物名字: '道仙·人形怪', 怪物星星小: 1, 怪物星星大: 10, 爆率文件: '40人形', 经验值: 3 }
        // 这里可以继续添加更多的数据...
    ];

    let 成功数量 = 0;
    let 失败数量 = 0;

    for (const 配置 of 刷怪属性数据) {
        try {
            const 结果 = await 更新刷怪配置({
                map_name: 配置.地图名字,
                monster_name: 配置.怪物名字,
                star_min: 配置.怪物星星小,
                star_max: 配置.怪物星星大,
                drop_file: 配置.爆率文件,
                experience_value: 配置.经验值
            });

            if (结果) {
                成功数量++;
            } else {
                失败数量++;
            }
        } catch (error) {
            console.error(`[数据导入] 导入刷怪配置失败: ${配置.地图名字} - ${配置.怪物名字}`, error);
            失败数量++;
        }
    }

    console.log(`[数据导入] 刷怪属性数据导入完成: 成功 ${成功数量} 条，失败 ${失败数量} 条`);
    return 失败数量 === 0;
}

/**
 * 导入智能刷怪数据到数据库
 */
export async function 导入智能刷怪数据(): Promise<boolean> {
    console.log('[数据导入] 开始导入智能刷怪数据...');
    
    // 刷新时间常量
    const 小怪刷新 = 5;
    const BOSS刷新 = 5;
    const 人形刷新 = 5;
    
    const 智能刷怪数据 = [
        { 地图名字: '荒芜山谷', 地图名字变量: '空', 怪物名字: '鸡', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '荒芜山谷', 地图名字变量: '空', 怪物名字: '稻草人', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '荒芜山谷', 地图名字变量: '空', 怪物名字: '食人花', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '荒芜山谷', 地图名字变量: '空', 怪物名字: '多钩猫', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '荒芜山谷', 地图名字变量: '空', 怪物名字: '半兽战士', 数量: 50, 刷新时间: BOSS刷新, TAG: 12 },
        { 地图名字: '荒芜山谷', 地图名字变量: '空', 怪物名字: '半兽勇士', 数量: 50, 刷新时间: BOSS刷新, TAG: 13 },
        { 地图名字: '荒芜山谷', 地图名字变量: '荒芜山谷', 怪物名字: '半兽统领', 数量: 50, 刷新时间: BOSS刷新, TAG: 14 },

        { 地图名字: '试炼之地', 地图名字变量: '空', 怪物名字: '洞蛆', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '试炼之地', 地图名字变量: '空', 怪物名字: '骷髅', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '试炼之地', 地图名字变量: '空', 怪物名字: '掷斧骷髅', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '试炼之地', 地图名字变量: '空', 怪物名字: '山洞蝙蝠', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '试炼之地', 地图名字变量: '空', 怪物名字: '骷髅精灵', 数量: 50, 刷新时间: BOSS刷新, TAG: 12 },
        { 地图名字: '试炼之地', 地图名字变量: '空', 怪物名字: '百战骨灵', 数量: 50, 刷新时间: BOSS刷新, TAG: 13 },
        { 地图名字: '试炼之地', 地图名字变量: '试炼之地', 怪物名字: '骨龙精灵', 数量: 50, 刷新时间: BOSS刷新, TAG: 14 },

        { 地图名字: '血之炼狱', 地图名字变量: '空', 怪物名字: '沃玛战士', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '血之炼狱', 地图名字变量: '空', 怪物名字: '沃玛勇士', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '血之炼狱', 地图名字变量: '空', 怪物名字: '沃玛战将', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '血之炼狱', 地图名字变量: '空', 怪物名字: '火焰沃玛', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '血之炼狱', 地图名字变量: '空', 怪物名字: '沃玛卫士', 数量: 80, 刷新时间: 小怪刷新, TAG: 11 },
        { 地图名字: '血之炼狱', 地图名字变量: '空', 怪物名字: '尸王', 数量: 30, 刷新时间: BOSS刷新, TAG: 12 },
        { 地图名字: '血之炼狱', 地图名字变量: '空', 怪物名字: '奢比', 数量: 30, 刷新时间: BOSS刷新, TAG: 13 },
        { 地图名字: '血之炼狱', 地图名字变量: '血之炼狱', 怪物名字: '凶悍屠夫', 数量: 30, 刷新时间: BOSS刷新, TAG: 14 }
        // 这里可以继续添加更多的数据...
    ];

    let 成功数量 = 0;
    let 失败数量 = 0;

    for (const 配置 of 智能刷怪数据) {
        try {
            const 结果 = await 更新智能刷怪配置({
                map_name: 配置.地图名字,
                map_variable: 配置.地图名字变量,
                monster_name: 配置.怪物名字,
                quantity: 配置.数量,
                refresh_time: 配置.刷新时间,
                tag: 配置.TAG
            });

            if (结果) {
                成功数量++;
            } else {
                失败数量++;
            }
        } catch (error) {
            console.error(`[数据导入] 导入智能刷怪配置失败: ${配置.地图名字} - ${配置.怪物名字}`, error);
            失败数量++;
        }
    }

    console.log(`[数据导入] 智能刷怪数据导入完成: 成功 ${成功数量} 条，失败 ${失败数量} 条`);
    return 失败数量 === 0;
}

/**
 * 完整的数据导入流程
 */
export async function 执行完整数据导入(): Promise<boolean> {
    console.log('[数据导入] ===== 开始完整数据导入流程 =====');
    
    try {
        // 1. 初始化数据库
        console.log('[数据导入] 第1步: 初始化数据库...');
        const 初始化成功 = await 初始化并导入数据();
        if (!初始化成功) {
            console.error('[数据导入] 数据库初始化失败');
            return false;
        }

        // 2. 导入刷怪属性数据
        console.log('[数据导入] 第2步: 导入刷怪属性数据...');
        const 刷怪数据导入成功 = await 导入刷怪属性数据();
        if (!刷怪数据导入成功) {
            console.error('[数据导入] 刷怪属性数据导入失败');
            return false;
        }

        // 3. 导入智能刷怪数据
        console.log('[数据导入] 第3步: 导入智能刷怪数据...');
        const 智能刷怪数据导入成功 = await 导入智能刷怪数据();
        if (!智能刷怪数据导入成功) {
            console.error('[数据导入] 智能刷怪数据导入失败');
            return false;
        }

        console.log('[数据导入] ===== 完整数据导入流程完成 =====');
        return true;

    } catch (error) {
        console.error('[数据导入] 数据导入过程中发生异常:', error);
        return false;
    }
}

/**
 * 测试数据库连接和功能
 */
export async function 测试数据库功能(): Promise<void> {
    console.log('[测试] ===== 开始测试数据库功能 =====');
    
    try {
        // 导入并测试数据库
        const 导入成功 = await 执行完整数据导入();
        if (导入成功) {
            console.log('[测试] ✅ 数据库导入测试通过');
        } else {
            console.log('[测试] ❌ 数据库导入测试失败');
        }

        // 这里可以添加更多的测试用例...
        
    } catch (error) {
        console.error('[测试] 测试过程中发生异常:', error);
    }
    
    console.log('[测试] ===== 数据库功能测试完成 =====');
}