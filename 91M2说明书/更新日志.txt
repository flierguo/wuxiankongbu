更新日志 - 2024年
PS: 请将VMProtectedSDK32.dll 放到 C:/Windows/System 下 因为没有再使用VMP加壳 程序依赖这个dll (客户端程序加壳 所以发布登录器并不会依赖这个dll)
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------

暂停更新……
-----------------------------------------------------------------------------------------------

1.[增加] TUserMagic.CustomIcon 字段 可以动态修改客户端的技能图标

例:
export function SetSkillIcon(Npc: TNormNpc, Player: TPlayObject, Args: TArgs) {
    let magic = Player.FindSkill('基本剑术')
    if (magic) {
        magic.CustomIcon = 56;
        Player.UpdateMagic(magic)
        Player.SendMessage('设置技能图标成功')
    } else {
        Player.SendMessage('没有找到技能')
    }
}

// CustomIcon的读取规则为 10000个序号为一个文件
// 依次读取 MagIcon.data MagIcon1.data MagIcon2.data 依次类推
2.[增加] TUserMagic.Level 和 TUserMagic.Strengthen 从255扩充到65535

　 　 　　　

1.[修正] TUserItemList.Delete 最后一个元素会失效的问题

2.[增加] 武器和衣服特效AniCount = 150 从 HumEffect6 开始每个文件50个ID 支持到 HumEffect20

3.[增加] 91Resource\Data\Hair\下自定义发型读取 从10000 开始 共可使用31个ID

4.[修正] 开启自动逐日剑法和自动烈火 会导致怪物盖住主角的问题。

5.[优化] 防止网关被CC攻击

6.[修正] 使用OutWay4 会导致M2崩溃的问题

7.[优化] 使用新的版本保存格式 加快版本读取和保存的时间。(注意可能存在风险,请备份版本文件,使用版本管理器打开修改任意内容重新保存后就是新的格式，版本文件会比之前的版本更小，加载保存也会更快)

-----------------------------------------------------------------------------------------------
2024-05-11

1.[增加] M2-选项-参数设置-游戏设置(3) 客户端装备对比设置 , 注意需要更新引擎包内的客户端补丁 91Resource/Prguse.data 图片530-535是道具有提升的提示图片。

2.[增加] TUserItem.CompareScore 字段 当设置客户端装备对比为脚本分数时，客户端将根据物品对象手动设置的CompareScore 进行比较。此字段不在客户端有任何显示。

3.[增加] M2-选项-性能参数-增加自动绑定CPU核心设置

4.[增加] TActor.SetHudHPStr(HpStr:string) 用于设置客户端怪物头顶的血量自定义显示,需要注意的是 一旦设置后除非再次在脚本设置,否则不管怎么收到伤害都不会改变。

例子:
Actor.SetHudHPStr(“1.5亿/3亿”) //设置显示血量为 1.5亿/3亿
Actor.SetHudHPStr(“”) //清空使用引擎的内置血量显示

5.[增加] M2-选项-功能参数-技能魔法-刺杀可以触发暴击选项

6.[修正] GameLib.AddClonePlayer 会导致内存泄漏的问题

更新日志 - 2023年
PS: 请将VMProtectedSDK32.dll 放到 C:/Windows/System 下 因为没有再使用VMP加壳 程序依赖这个dll (客户端程序加壳 所以发布登录器并不会依赖这个dll)
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------

持续更新中……

-----------------------------------------------------------------------------------------------
2023-12-03

1.[增加] TActor.IsAttackTarget(Target) 用于判定目标是否可攻击目标 此接口行为等同于 技能编辑器的目标可攻击配置。

2.[增加] TActor.FlyEffectNoTarget(目标X,目标Y,特效ID,速度,飞行结束特效ID) 用于无目标播放飞行动画 // do not well done

3.[增加] 技能编辑器技能 支持鼠标拖动到其他目录。

4.[增加] TActor.AddedAbility.PunchHitWRate 暴击额外加成万分比。用于在脚本中动态调整生物的暴击伤害加成。注意修改后需要调用 TActor.RecalcAbilitys() 重算属性,否则要在下一次触发重算才会生效。

5.[修正] TActor.SetBuffIcon 在客户端已经存在buff图标的情况下 再次设置 不会更新的客户端图标信息的问题

6.[增加] 版本管理器-自定义特效 增加显示层级设置。 用于当特效为角色特效播放时。可以调整显示层级 。0 为默认 表示在最顶层。 新增 设置为 100 。表示在角色脚下 用于显示光环类特效。其他值暂时无用 作为保留方便后续扩展。

7.[增加] 增加 GameLib.GetActorByHandle(Handle:number):TActor; 可以根据 TActor.Handle 获取TActor 对象的功能， 如果 TActor 对象不存在了，将返回 null。Handle 是一个 整数，通过存储 Handle 方便脚本中查询 TActor 对象。

8.[修正] 自定义技能编辑器配置的技能 在技能面板上可能不会有技能提示的问题。

9.[修正] 自定义技能编辑器配置的技能 在技能面板上达到最高等级依旧显示升级经验的问题。

10.[增加] 开发者客户端UI节点支持 导入导出 xml的功能。

11.[修正] TBuff.BuffStatusType 始终为0的问题

12.[增加] TActor.ShowBleedNumber 和 TPlayObject.SendBleedNumber 飘雪函数增加一个可选延迟函数 DelayMS 。单位毫秒 不填则不延迟

13.[增加] GameLib.ShowEffect2 播放地图特效函数 与 GameLib.ShowEffect 的区别在于 GameLib.ShowEffect的播放为持续时间 而 GameLib.ShowEffect2 播放的持续时间为循环次数。

14.[修正] 创建账号可以使用不可视字符导致离线挂机上线后存在重复角色在线的问题。

15.[扩展] 人物(TPlayObject)定时器 移动到 角色 (TActor) 以便支持怪物以及NPC设置定时器

16.[增加] TActor.DelayGotoMS 毫秒级别的定时器

17.[优化] NPC对话M标签当没有指定点击跳转时 不会遮挡底层带点击事件的按钮。

-----------------------------------------------------------------------------------------------

2023-10-25

1.[修正] 客户端解析NPC对话会报错的问题。

2.[修正] 客户端退出会报RunTimeError的问题。

-----------------------------------------------------------------------------------------------
2023-10-24

1.[增加] TActor.CreateAttackEvent2 以及 GameLib.CreateAttackEvent2 其功能与 TActor.CreateAttackEvent 和 GameLib.CreateAttackEvent 一致。区别在于带2的特效ID是 UI设计中的特效ID

2.[扩展] TActor.Damage 和 DamageDelay 。增加 ShowBleedNumber 可选参数 。true 表示 飘血 false 表示不飘血。默认为 true

3.[增加] TActor.PlayDir8Effect(( SkillEffectID: number,Dir: number = -1)) 用以播放技能编辑器中的特效。 Dir = -1 表示按照角色当前朝向播放。

4.[修正] 石化Buff时间到后,无法移动的问题。

5.[增加] 内挂挂机设置增加 在一定时间内无攻击目标 使用物品配置。 (注意 如果使用了自定义UI会提示UI版本升级,需要用开发者客户端保存出一份新的UI即可。)

6.[扩展] TActor.CustomEffect(）数量 从1-10扩展为 1-20

7.[修正] 一处客户端内存泄漏可能导致客户端卡死的问题

8.[增加] GameLib.CreateBlockEvent(地图代码,X,Y,持续毫秒时间,UI特效ID) 可以动态创建地图阻挡点 并且显示特效。

-----------------------------------------------------------------------------------------------
2023-10-09

1.[修正] 自定义技能伤害当属性 上限比上限更高的时候伤害会溢出的问题

2.[修正] 怪物数据库导出到Excel 再导入会丢失 怪物标志的问题。

3.[修正] 自定义技能被动技能 在客户端挂机状态下会被使用的问题。

4.[增加] 获取客户端快捷栏物品数量的接口 TPlayObject.QueryClientQuickBarItemCount(ident:string)。查询结果将触发
GameLib.onQueryClientQuickBarItemCountResult(Player:TPlayObject,Ident:string,Count:number)

5.[增加] 登录器列表默认展开配置

6.[增加] 登录器列表项目颜色配置

7.[增加] 怪物Race 182 与 181的区别在于 怪物移动到可以攻击范围内后 不会再移动。

-----------------------------------------------------------------------------------------------

2023-09-22

1.[扩展] GameLib.CreateAttackEvent 和 TPlayObject.CreateAttackEvent 增加可选参数 SkillEffectID 。用于在创建地图攻击事件的时候可以在客户端显示一个特效。此特效ID 是技能编辑器中设置的特效。

2.[修正] TActor.MissionToXY 后怪物到到达指定坐标会发呆的问题。

3.[增加] TActor.FlyEffect(Target:TActor,SkillEffectID,Speed:number,flyOverEffect:number) 用于脚本中动释放一个飞行动画。

Target为 飞行到的目标生物
SkillEffectID 为技能编辑 器中的特效ID
Speed 为飞行速度 通常为1.3 可以自行修改。此参数表示 客户端每毫秒行进的像素数量。
FlyOverEffect 为可选参数 表示飞行到目标后 播放的动画ID 。此特效ID 是技能编辑器中设置的特效。
-----------------------------------------------------------------------------------------------

2023-09-21

1.[修改] TActor.MissionToXY 增加 范围参数 用于设置怪物往指定坐标点行走 。 当到达指定坐标点时 将触发 GameLib.onActorReachedMissionXY(Actor:TActor,MissionX,MissionY,Range)
-----------------------------------------------------------------------------------------------

2023-09-19

1.[修正] GameLib.CreateAttackEvent 地图事件无效的问题

2.[修正] 重新加载技能数据库后 自定义技能执行脚本会执行两次的问题

3.[修正] 经验超过21亿 客户端显示不正确 以及脚本输出不正确和M2在线信息显示不正确的问题。

4.[修正] 副本地图事件无效的问题。

5.[增加] TActor.MissionToXY(X,Y) 用于设置怪物往指定坐标点行走 。 当到达指定坐标点时 将触发 GameLib.onActorReachedMissionXY(Actor:TActor)

6.[增加] 版本加载配置 (Mir200\Project.ini) 增加脚本加载路径配置 方便同一台机器上多区都从磁盘上加载同一个份脚本,仅在从磁盘加载脚本有效，版本内置脚本无效。
如
ScriptPath=D:\版本脚本\
则入口脚本路径为 D:\版本脚本\Main.js
需要注意的是这个路径只能为为绝对路径值 或者为空(则加载Mir200\Script\目录) 不能为 以 .\ 类开头的相对路径。

-----------------------------------------------------------------------------------------------

2023-09-07

1.[增加] M2-功能选项-技能魔法 增加飞行技能可穿墙配置

2.[修正] TActor.SetTargetEx 玩家宝宝使用无效的问题

3.[优化] 客户端大地图每次打开不再重置位置

4.[修正] 佩戴隐身戒指魔法盾不显示的问题

5.[增加] 商铺物品增加单次购买数量限制,以防止数量*单价造成总价数据溢出

-----------------------------------------------------------------------------------------------

2023-08-22

1.[修正] 挂机中 开启了智能追踪会玩家来回寻路导致一直来回走动的问题。

2.[修正] [严重] M2在读取版本时有一处非法内存写入。可能导致M2无法启动 以及 其他异常情况

3.[扩展] 物品对象 TUserItem.AddAC AddLAC等基础属性 扩展支持给负数。

4.[扩展] GameLib.onSkillActionExecute 自定义技能执行触发 增加两个参数 鼠标指向的地图坐标X 鼠标指向的地图坐标Y。

-----------------------------------------------------------------------------------------------
2023-08-17

1.[增加] 鼠标右键点击大地图触发 GameLib.onRightClickMapPos(Player:TPlayObject,MapX:number,MapY:Number)

2.[增加] 获取玩家当前物品爆率加成属性 TPlayObject.TotalDropItemRate

3.[增加] 获取玩家当前金币爆率加成属性 TPlayObject.TotalGoldRate

4.[增加] 自定义技能增加锁定目标选项，勾选后客户端使用快捷键可锁定目标

-----------------------------------------------------------------------------------------------
2023-08-09

1.[增加]动态调节技能冷却时间接口 TActor.SetMagicCDTime(技能ID,冷却时间毫秒)

2.[增加]调节视野范围 属性 TActor.ViewRange用于获取以及修改可视范围。取值范围 0-99,不建议超过20. 否则将会导致严重的性能问题。

3.[增加]新增两个扩展物品特效 TUserItem.SetCustomEffect2 和 TUserItem.SetCustomEffect3。注意 这两个新的特效不不支持外观特效。需要支持外观特效 必须使用，TUserItem.SetCustomEffect。

4.[增加]自定义技能 增加 最高等级设置，可设置如果没有直接取最高等级。

5.[增加]增加获取上一次使用的技能ID和等级的接口 TActor.LastUseMagicID 和 TActor.LastUseMagicLevel

6.[修正]网关提示黄色信息 逻辑错误2的问题

7.[修正]重新加载版本 客户端使用的技能可能会效果不对

8.[修正]自定义技能等级描述不符 总是显示第一级的提示。

9.[修正]自定义技能 起手施法特效设置了后无法取消的问题

10.[修正]物品出售给商店再购买回来会报错的问题。

-----------------------------------------------------------------------------------------------
2023-07-30

1.[修正] 因为自定义UI, Hint(鼠标移动提示) 可能导致客户端卡死的问题

2.[修正] UserItem.MakeString 导致客户端内存泄漏的问题

3.[增加] 产出途径(OutWay)字符串 增加 新的格式化支持 $CUSTOMCAPTION0$ $CUSTOMCAPTION1$ $CUSTOMCAPTION2$ $CUSTOMTEXT0$ $CUSTOMTEXT1$ $CUSTOMTEXT2$
　例:
　在版本管理器-物品产出来源对照表中添加一行配置
　888=测试文本支持 $CUSTOMCAPTION0$ $CUSTOMCAPTION1$ $CUSTOMCAPTION2$ $CUSTOMTEXT0$ $CUSTOMTEXT1$ $CUSTOMTEXT2$

// 在服务端脚本中使用如下脚本测试
export function weaponCaption(Npc: TNormNpc, Player: TPlayObject, Args: TArgs) {
    if (Player.Weapon) {
        Player.Weapon.SetCustomCaption(0, "标题零")
        Player.Weapon.SetCustomCaption(1, "标题壹")
        Player.Weapon.SetCustomCaption(2, "标题贰")

        Player.Weapon.SetCustomText(0, "内容零")
        Player.Weapon.SetCustomText(1, "内容壹")
        Player.Weapon.SetCustomText(2, "内容贰")

        Player.Weapon.SetOutWay1(0, 888)

        Player.UpdateItem(Player.Weapon)
    } else {
        Player.MessageBox("你当前没有穿戴武器")
    }
}
// 即可给物品增加一个产出途径提示 内容为
// 测试文本支持 标题零 标题壹 标题贰 内容零 内容壹 内容贰
-----------------------------------------------------------------------------------------------
2023-07-21

1.[增加] 排除名称方式获取地图怪物数量函数 ， TEnvirnoment.GetMonCountExclude()
　例如 Player.Map.GetMonCountExclude(“白野猪,黑野猪”) 。可获得玩家所在地图除 白野猪以及黑野猪以外的怪物总数

2.[增加] M2-选项-游戏参数-伤害计算 增加暴击加成方式设置 以及默认暴击倍率设置。

3.[修正] 因客户端内存泄漏，导致的白屏以及卡顿的问题。

4.[修正] 玩家死亡掉落的装备无法拾取并且会导致M2报错的问题

5.[修正] GameLib.onAfterTakeOnItem 触发回调中 修改 TakeOffItem 属性不生效的问题。

-----------------------------------------------------------------------------------------------
2023-07-06

1.[修改] M2与GateWay的通讯监听地址默认为127.0.0.1 防止因为监听0.0.0.0 导致外网可以访问的问题

2.[修正] M2报错 TGameService.ReadFromRunGate : Invalid socket handle 的问题。

3.[扩展] 人物经验为 Int64

4.[修正] GameLib.onPlayerDropItem 触发中 修改物品对象属性不会生效的问题。

5.[修正] 创建角色名称异常字符过滤可能无效的问题。

-----------------------------------------------------------------------------------------------
2023-06-26

1.[增加] GameLib.onGetExpEx 相对于 GameLib.onGetExp 增加一个参数ExpActor 用于获取经验来源是哪个怪物。 如果非杀怪途径获得ExpActor 将为 null

2.[优化] 优化从磁盘恢复玩家存档数据 ，在恢复成功后不再删除磁盘文件，而是移动到
Mir200/DBDump/RestoreSuccess/目录下。

3.[修正] 怪物使用自定义技能 在需要转向攻击的时候 方向和特效方向会不一致的问题。

4.[修正] 购买摆摊物品可能出现购买数量为0的问题

-----------------------------------------------------------------------------------------------
2023-06-13

1.[修正] TBuffStatusType.stDenyMove 对怪物无效的问题

2.[修正] 在同一处脚本中使用多次 TActor.MagicAttack 并且传递技能ID 会导致在
GameLib.onMonitorDamageEx 触发中，将技能ID都认成最后一次 MagicAttack 技能ID 的问题。

3.[扩展] TActor.SetState(11,0,0) 可以立即取消玩家的魔法盾。

4.[增加] 版本管理器-扩展数据-属性数字单位配置,用于对角色属性进行单位简化。

-----------------------------------------------------------------------------------------------

2023-06-09

1.[修正] 小退上线时可能会出现金币变更的音效。

2.[修正] 怪物死亡掉落金币 3x3 范围内没有位置可以掉落的时候，会导致内存泄漏的问题。

3.[增加] TActor.DenyAutoAddMP 用于动态禁止引擎自带的回蓝机制

4.[增加] 引擎控制台手动清理数据 可清理角色数据表

5.[修正] 引擎控制台手动清理日志数据会报错的问题。

-----------------------------------------------------------------------------------------------
2023-06-04

1.[修正] 使用物品可能导致M2报错的问题。

2.[修正] 使用GM指令制造物品在脚本中拦截 使用 Player.UpdateItem 可能导致报错的问题

-----------------------------------------------------------------------------------------------

2023-06-02

1.[修正] 玩家负重已满,拾取宠物(race 33 34),会继续拾取地图上的物品。但是不到玩家背包的问题。

2.[修正] 拾取宠物(race 33 34) 会导致物品内存泄漏的问题

3.[修正] M2会提示 魔法盾失败： code 3 d 的问题

4.[修正] 自定义怪物 使用自定义技能。 当技能动作设置为攻击的时候 不会播放动作的问题

-----------------------------------------------------------------------------------------------

2023-05-24

1.[修正] 背包淬炼物品 脚本不处理的情况下会收走所有物品，并且报错的问题。

2.[修正] 使用TActor.Damage 以及 DamageDelay 在GameLib.onClientBleedNumber 触发中技能ID和等级错误的问题。

3.[修正] 移动端TPlayObject.ShowSighIcon无效的问题

4.[增加] TNormNpc.SayExMobile: ( PlayObject: TPlayObject,UIName: string,Text: string,Scale: number,boCenter?: boolean) => void;
用以在移动端缩放兼容显示原PC端的物品 Scale 表示窗口整体放大倍数 1.0 未原始 1.5则是放大1.5倍 boCenter 表示窗口是否居中显示
-----------------------------------------------------------------------------------------------

2023-05-23

1.[增加] M2-选项-功能设置-宝宝系统 可以穿过自己宝宝,开启此功能后玩家可以跟自己宝宝站在同一个坐标上。

2.[修正] stdmode = 32类物品 已经记录地图坐标的物品 存入仓库后取出 会导致地图名称不显示的问题。

3.[修正] 出售物品给摆摊摊位 会导致M2报错的问题。

-----------------------------------------------------------------------------------------------
2023-05-17

1.[修正] 玩家物品掉落可能导致M2报错的问题,导致相关玩家无法存档的问题。【重要】

2.[扩展] M2-选项-物品装备-附加属性以及强化属性相关掉落几率可以设置为 -1 表示不可掉落

3.[增加] TPlayObject.CloseAllWindow 用于关闭所有NPC对话窗口

-----------------------------------------------------------------------------------------------
2023-05-09

1.[修正] stdmode=32 记路标石 客户端不显示记录的地图名称的问题,对于已经存在的物品可以使用 GameLib.FixRecordMapPointItemShowName(物品对象) 进行数据修复

2.[扩展] 物品对象显示名称上限 从40 个字节 扩充到100个字节。

3.[增加] 设置客户端技能冷却时间功能 TPlayObject.SetClientMagicUseTime(技能对象,冷却时间) 执行后客户端将以当前时间 开始进入冷却。单位毫秒

4.[增加] 设置客户端技能冷却时间偏移功能 TPlayObject.SetClientMagicOffsetUseTime(技能对象,冷却时间) 执行后客户端将根据 冷却时间 进行 增减。

例如 当前技能冷却时间剩余 5000 毫秒 如果此时提供的参数为 2000 那么 冷却时间将增加至7000毫秒，如果提供的参数为 -2000 那么当前技能的冷却时间将减少至 3000毫秒

5.[修正] 执行 TCastle.UnHireGuard() 和 TCastle.UnHireArcher 后,通过TCastle.GetGuard() 和 TCastle.GetArcher()依旧可以获得对象的问问题

6.[增加] 判断玩家是否在移动端客户端下 函数 TMobilePlatForm.IsMobileClient(PlayObject)

7.[增加] 移动客户端 添加功能页面按钮 MobilePlatform.AddFunctionButton(PlayObject,FunctionTag,IconFile,ScriptFlag,ShowDock)
参数解释:

  PlayObject 要操作的玩家对象，如果这个玩家不是在移动端客户端下 操作将无效
  FunctionTag 功能标志  小于 0 为系统内置标志, 大于等于0 为自定义功能标志。当设置为内置标志时(内置ID,见下文) 会打开引擎内置功能窗口 ，为用户自定义标志时候 可以通过自定义标志删除自定义按钮。
  IconFile 图标文件名称 当文件名称为 "./" 开头时候 则表示从从资源目录开始加载 , 如果直接文件名 比如1.png 则表示从 Image/FunctionIcon/目录下加载 。 此处1.png 和 ./Image/FunctionIcon/1.png 是一样的效果
  ScriptFlag 执行脚本标志  点击按钮会触发 GameLib.onScriptButtonClick,并且将此字符串作为参数。
  ShowDock 是否显示按钮底座。

  示例: MobilePlatform.AddFunctionButton(Player, 1, "1.png", "功能按钮1", false)
8.[增加] 移动客户端 删除功能页面按钮 MobilePlatform.DelFunctionButton(PlayObject,FunctionTag) ,可以根据FunctionTag删除图标，内置图标也可以删除。

9.[增加] 移动客户端 设置功能页面按钮 ,与添加不同的是此接口可以实现 批量设置，全部删除，以及图标排序的功能。

MobilePlatform.SetFunctionLayout(Player, [{ Tag: -1, IconFile: "11.png", ScriptFlag: "", ShowDock: true }, { Tag: 1, IconFile: "1.png", ScriptFlag: "测试按钮1", ShowDock: false }]）

目前内置的FunctionTag 有:
Setting = -1, //设置
MergeItem = -2, //合成
Guild = -3, //行会
Magic = -4, //技能
Social = -5,//社交
Shop = -6, //商铺
UpStar = -7, //升星
Merton = -8, //强化
-----------------------------------------------------------------------------------------------
2023-04-29

1.[优化] PC客户端普攻目标与自身中间有玩家会导致自身会呆在原地的问题。

2.[优化] 修正牛魔法师 远程攻击没有 雷电术特效的问题

3.[增加] M2-选项-功能设置-技能魔法-基本参数 增加 “统一使用物理伤害计算魔法伤害” 开启后 玩家属性 MC SC TC PC WC 将等于 DC。这样便可以使得全部技能魔法都按照DC计算伤害。

-----------------------------------------------------------------------------------------------
2023-04-27

1.[修正] 刺杀剑术不会增加熟练度的问题

2.[增加] GameLib.IsvaildUserItem() 用以测试物品对象是否失效,用以脚本中排错

3.[扩展] TUserItem.CustomValue 从0-10 扩展到 0-20

4.[增加] GameLib.onBeforePlayerReAlive(Player : TPlayObject,Event : TReAliveEvent) =>boolean 在玩家复活前触发。返回 true允许复活 返回false 不允许复活

5.[新增] 技能编辑器动作 “施法动作” 会映射到部分有两种攻击动作怪物第二种攻击动作上。 当怪物没有第二种攻击动作 会映射为普通攻击动作

6.[修正] 牛魔法师 攻击没有特效的问题

7.[修正] 彩票中奖后地面也会掉落金币的问题

8.[修正] 部分操作金币变化没有金币音效的问题

9.[增加] TPlayObject.IsH5Client 用于判断客户端是否使用H5客户端登录 以便对UI以及排版布局针对性适配

10.[修正] GetTickCount() 返回undefined 的问题

-----------------------------------------------------------------------------------------------
2023-04-10

1.[修正] 小退后基本剑术熟练度不会增加的问题。

2.[优化] 脚本对已经删除的物品进行操作，将提示错误。

3.[优化] 异常守护者过滤无效异常信息

4.[增加] TPlayObject.DeleteBagItem 删除背包物品，与 TPlayObject.DeleteItem 的 差别是 前者只会删除背包物品 后者会删除背包以及穿戴的物品。

-----------------------------------------------------------------------------------------------

2023-04-04

1.[修正] GameLib.ShowEffect 更换地图后依旧会显示特效的问题

2.[修正] TUserItem.Look 修改后 在NPC对话界面 使用 TUserItem.MakeString() , 物品图标还是显示原来的问题。

3.[增加] TActor.SetTargetActorEx(目标,持续时间) ,设置怪物在持续时间内 锁定攻击目标。如果攻击目标超出范围 (20坐标) ，或死亡或离开地图 则会立即被清除。

4.[增加] 技能使用时间 TUserMagic.UseTime 可写 此时间为 计算机启动到现在的毫秒时间。GameLib.GetTickCount() 可获取计算机启动到当前的启动毫秒时间。

5.[增加] 称号数据库 Desc 显示在 人物称号面板

6.[增加] 武器挥砍声音自定义以及物品点击声音自定义。

　需要在客户端目录下新建 Sound.ini 文件(91Client.dat 同级)
　使用文本编辑器编辑 示例为:
　[weapon1]
　hit=70
　struck=71
　struckArmor=72

　其中[weapon1] 表示 武器外观1 (物品数据库中的shape) 的声音 。
　hit=70 表示武器挥砍播放ID为70 声音
　struck =71 表示武器砍在目标上 播放ID为71的声音
　struckArmor=72 表示武器砍在目标穿戴盔甲类衣服的声音

　如需配置多个 写多个配置项即可
　如

　[weapon1]
　hit=70
　struck=71
　struckArmor=72
　;这是备注
　[weapon33]
　hit=75
　struck=76
　struckArmor=77

　物品点击声音自定义：

　[item6]
　click=115

　表示数据库IDX 6的物品点击时候播放声音ID为115的声音。

　声音ID对应参考对照客户端目录 wav\sound.lst 文件
　若要添加自己的声音，可以修改sound.lst空位置或往最后添加
　1: wav\1.wav
　2: wav\2.wav
　3: wav\3.wav
　4: wav\4.wav
　5: wav\5.wav
　6: wav\6.wav
　7: wav\7.wav
　8: wav\8.wav
　9: wav\9.wav
　10: wav\10.wav
　11: wav\11.wav
　冒号 左侧 为声音ID 右侧为文件路径
　sound.lst集声音文件可集成登录器更新

-----------------------------------------------------------------------------------------------

2023-03-27

1.[修正] 一处可能导致异常报错，使玩家掉线的bug

2.[修正] 版本管理器导入导出地图可能导致版本管理器报错的问题

-----------------------------------------------------------------------------------------------

2023-03-26

1.[修正] TEnvirnoment.ThrowMonItems 在触发 GameLib.onDropItemByMonName 中拦截其中一个物品掉落会导致后续物品都不掉落的问题

2.[增加] 角色存档时间日志记录 ，用于记录玩家最后存档时间 以及存档耗时

3.[修正] 角色存档会修改 角色创建时间(dCreateDate 字段) 为当前时间的问题,

4.[修正] TActor.TriggerAINpcExecute 和 TActor.TriggerSelectMagicBeforeAttack 只能设置为true 无法设置为 false 的问题

5.[修正] 自定义技能 地图伤害事件可能导致M2报错的问题。

6.[增加] TActor.AttackRange 用于调整怪物的射程 仅对 数据库race = 181 怪物有效,其他无法修改。（有效范围1-99）

7.[增加] 当远程DB数据库断开连接且无法重连的时候,会将玩家数据保存到Mir200/DBDump/ ，在下次M2启动会还原到数据库并且删除文件，如果数据库时间比磁盘文件更新将会跳过还原并删除文件。

-----------------------------------------------------------------------------------------------

2023-03-20

1.[修正] 在 GameLib.onScriptEngineFinal 修改 GameLib.V GameLib.R 变量数据无效的问题。

2.[增加] 登录器的推广标识在玩家注册后会记录到账号表的Memo字段 方便统计引流效果

3.[修正] race 108的怪物攻击目标方向会错乱的问题

4.[修正] TActor.SetBuffIcon 的最后一个参数 ShowTimeStr(显示Buff剩余时间) 无效的问题。

5.[优化] 登录器补丁密码 支持以 / 符号 作为路径分割符。支持$DATA 配置路径

-----------------------------------------------------------------------------------------------

2023-03-18

1.[修正] 可能因物品异常导致玩家掉线的问题

2.[修改] 网络封包加密格式 防止WPE攻击

3.[增加] 独立设置游戏日志数据库连接 可选择不和游戏日志放在一起，以解决因为日志数据过大导致备份数据库文件过大以及时间过久的问题

4.[修正] 客户端快捷键Ctrl +D 导致客户端无法使用技能的问题

5.[修正] 武僧天雷阵会导致玩家掉线的问题

-----------------------------------------------------------------------------------------------

2023-03-01

1.[增加] TActor.ConfuseBitTimeBeAttacked 用于控制怪物收到攻击后是否会延长下一次攻击间隔时间 默认是true(原始设定) 。当如果是玩家的宝宝 改为false 可以使得宝宝在被多个怪物攻击时 不会延长攻击时间。

2.[修正] 怪物受击没有武器音效的问题

3.[增加] 登陆器支持读取 xml格式的服务器列表,xml格式的服务器列表可以从版本管理器的登陆器列表设计中导出。使得在修改服务器列表时候可以直接编辑文本。

4.[修正] TPlayObject.DeleteBigStorageItem2 无效并且会报错的问题。

5.[修正] 玩家随机传送可能导致玩家掉线的问题。

-----------------------------------------------------------------------------------------------

2023-02-02

1.[优化] 聊天框不自动滚动模式下 自身发送聊天信息会滚动到最底部

2.[修正] 魂练经验值不显示的问题

3.[优化] 添加物品到仓库,不再强制物品必须存在玩家背包， 可以从其他地方存入。例如

export function addKt(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
  let item = GameLib.CreateUserItemByName('开天')
  if (item) {
    Player.AddItemToBigStorage(item)
    GameLib.DestoryUserItem(item, false)
   }
}
4.[修正] 小地图较小时候坐标会显示负数的问题

-----------------------------------------------------------------------------------------------
2023-01-08

1.[修正] 佩戴马牌会立即骑马的问题

2.[修正] MD5客户端白名单无效的问题

3.[修正] 邮件无法提取附件的问题

-----------------------------------------------------------------------------------------------


更新日志 - 2022年
PS: 请将VMProtectedSDK32.dll 放到 C:/Windows/System 下 因为没有再使用VMP加壳 程序依赖这个dll (客户端程序加壳 所以发布登录器并不会依赖这个dll)

-----------------------------------------------------------------------------------------------

2022-12-25

1.[新增] 怪物 race 138 使用闪现攻击 类似大刀守卫 , 不会移动 可被召唤为宝宝 召唤为宝宝时候 距离超过主人20个坐标 会使用瞬息移动跟进到主人身边
2.[新增] 怪物 race 137 同138 区别是会自主移动 召唤为宝宝 会跟随主人移动
3.[新增] 装备提示预览 -“不显示未激活魂练” 配置
4.[修正] 邮件提取附件会提示 附件已被提取的问题。
5.[修正] 使用 Player.VarDateTime().asDateTime 给与的值为负数的时候 会导致玩家存档失败导致回档的问题。
6.[修正] TActor.DamageDelay 传递的技能ID和等级无法在 GameLib.onClientBleedNumber 获取到的问题。
7.[修正] 拾取宠物 (怪物 race 33 ,34 ) 可能导致M2报错的问题。
8.[新增] 支持使用 TPlayObject 使用 RankLevelName 角色名称前面不同颜色称号的功能。
例如
Player.RankLevelName = ‘{S=法神;C=#ff7d63}’ + ‘%s’
Player.ShowRankLevelName = true
Player.UpdateName()


-----------------------------------------------------------------------------------------------

2022-12-11

1.[修正] 人形怪攻击速度不能修改的问题。 以及 人形怪不会触发 GameLib.onMonSelectMagicBeforeAttack 的问题。

2.[修正] TActor.AddGameLog1 和 TActor.AddGameLog2 失效的问题

3.[增加] TActor.AddGameLogEx(Event: number,Int1: number,Int2: number,Log1: string,Log2: string): void; 用于记录更加详细的日志到数据服

4.[优化] 优化客户端性能

5.[优化] 优化部分协议减少网络带宽

-----------------------------------------------------------------------------------------------

2022-11-26

1.[修正] 道士物理攻击的时候同时使用攻击性魔法 会导致目标血量会忽高忽低的问题。

2.[修正] SetClientUIProperty 空格会被过滤的问题。

-----------------------------------------------------------------------------------------------

2022-11-25

1.[增加] GameLib.CloseDuplicateMapEx(Map: TEnvirnoment) 用于关闭销毁指定副本地图

2.[修正] 全景大地图 地图标识显示不全的bug

3.[修正] 客户端组件 NPC对话框 不支持 显示物品的问题。

4.[修正] NPC对话 倒计时组件 {SC} 会显示剩余时间为 42亿的问题。

5.[增加] 版本管理器 命令行生成登录器的功能 ,用于批量生成登录器。 方便修改推广标识
使用办法:
　　1.打开版本管理器 常规生成一个登录器 。此时在版本管理器目录下会生成一个 BuildLogin.json 就是 本次生成登录器的配置文件
　　2.修改 配置文件中 skinFileName 的皮肤路径 为具体路径 (因为版本管理器 会先把编辑器皮肤文件写入到临时文件目录 这里需要修改)。以及 buildFileName 为生成后的登录器存储路径。
　　3.在命令行或者新建一个bat文件，命令内容格式为 start 版本管理器路径 buildlogin 配置路径文件 。 如: start D:\MirServer\Mir200\M2ProjectBuilder.exe buildlogin D:\MirServer\Mir200\BuildLogin.json。回车执行 或者双击执行的bat即可。

注意：本次更新需要全套更新 包括重新生成登录器 微端资源无需重新构建。

-----------------------------------------------------------------------------------------------

2022-11-18

1.[增加] TActor.Damage 和 TActor.DamageDelay 增加两个可选参数 MagicId 和MagicLevel 用于传递到 伤害触发 GameLib.onMonitorDamageEx 中

2.[修正] 客户端丢弃物品引擎报错的问题

3.[修正] race 33 34 宠物拾取物品会漏掉物品的问题

-----------------------------------------------------------------------------------------------

2022-11-01

1.[增加] 资源管理器文件列表 方便快速打开切换文件。

2.[修正] 物品对象121内存泄露。

-----------------------------------------------------------------------------------------------

2022-10-29

1.[优化] 自定义技能编辑器拾取物品作用 增加 [拾取过滤] 选项。 勾选后将不会拾取客户端内挂设置为不拾取的物品。

2.[优化] race = 34 的宝宝 拾取物品 会根据客户端物品拾取过滤来决定是否拾取。如果需要忽略掉的话可以在 GameLib.onSlavePickUpItem 返回 TPickUpResult.purPickUp 强制拾取

3.[增加] 物品拾取过滤设置函数 设置后同样会影响 race 34宝宝拾取过滤 和 自定义技能编辑器拾取作用过滤。

设置/获取 物品是否自动拾取
TPlayObject.SetItemFliterAutoPickUp(Idx: number,Value: boolean)
TPlayObject.GetItemFliterAutoPickUp (Idx: number): boolean
设置/获取 物品是否显示名称
TPlayObject.SetItemFliterShowName(Idx: number,Value: boolean)
TPlayObject.GetItemFliterShowName(Idx: number): boolean
设置/获取 物品是否特殊显示
TPlayObject.SetItemFliterSpecialShow(Idx: number,Value: boolean)
TPlayObject.GetItemFliterSpecialShow(Idx: number): boolean
更新拾取过滤配置到客户端
TPlayObject.UpdateItemFliter()

参数解释: idx 为物品数据库ID,0为金币

如:
    //设置金币为可拾取
    Player.SetItemFliterAutoPickUp(0,true)

    //同步设置到客户端
    Player.UpdateItemFliter()

或者
    //设置开天为不可拾取
    let itemIdx = GameLib.FindItemIndex("开天")
    Player.SetItemFliterAutoPickUp(itemIdx,false)

    //同步设置到客户端
    Player.UpdateItemFliter()
需要注意的是TPlayObject.UpdateItemFliter() 为更新所有拾取过滤,会花费比较大的网络带宽 如果在脚本中一次性修改多个物品的拾取过滤 不要 每次修改一个物品是否拾取 就执行一次TPlayObject.UpdateItemFliter()
在批量修改玩成后再执行 TPlayObject.UpdateItemFliter()

更新注意:本次更新 所有玩家数据的拾取过滤配置将会被重置,请谨慎更新。

-----------------------------------------------------------------------------------------------

2022-10-26

1.[增加] 版本管理器 登录器列表编辑器 增加 服务器列表文本格式编辑，更新列表文本格式编辑 素材补丁密码列表格式编辑

2.[修正] 自定义技能编辑器设置为烈火模式 没有蓝依旧提示成功的问题

3.[修正] 传统模式无限仓库取物品会导致物品消失的问题。

4.[修正] 被麻痹时会自动开盾,导致卡盾的问题。

5.[优化] console.log 输出数字会带双引号 而字符串不带双引号的问题。(修改后参照node.js样式)

6.[修正] TActor.KillSlave() 怪物名无效 会清理掉所有宝宝的问题。

7.[修正] 技能编辑里面添加地图伤害事件的特效会有延迟 以及 GameLib.ShowEffect 特效会有延迟的问题

8.[修正] 野蛮冲撞撞墙会导致玩家角色名称变色的问题

9.[修正] 地图扩展属性自动减少生命值和自动增加生命值数值会翻倍的问题 以及杀人增加等级 会变成 2147483647 级的问题

10.[优化] 飘血层级在最高层不会被地图建筑 和特效挡住。

11.[修正] 版本管理器 地图预览导出小地图无效的问题

12.[修正] 称号显示会重影的问题

13.[增加] 流星火雨增加伤害次数设置

14.[增加] TEnvirnoment.ThrowMonItems(MapX: number,MapY: number,Range: number,MonName: string,ItemOwner: TPlayObject,ForbidPickUpTime: number,AppendDropRatePercent: number): number;
用于在地图上丢弃怪物的爆率物品配置 , 当怪物爆率设置为触发脚本时 将会触发 GameLib.onDropItemByMonName

如 Player.Map.ThrowMonItems(Player.MapX,Player.MapY,5,”黑野猪8”,null,10000,Player.AddedAbility.ItemRate)

参数解释:
MapX ,MapY ,Range 坐标 XY 和范围。
MonName : 怪物名称
ItemOwner ：物品归属玩家 可为null
ForbidPickUpTime 禁止拾取时间， 如设置为10000表示掉落后10秒可以拾取。
AppendDropRatePercent:额外附加爆率百分比

15.[增加] 怪物种族 race 33 和 34 作为宠物 无法被攻击。 其中 34 会自动拾取物品到玩家背包 。同时增加两个对race 34才会触发的拾取相关回调

//当宝宝发现一个可以拾取物品的时候触发 返回 True 表示允许宝宝拾取 返回False 表示不允许宝宝拾取
GameLib.onSlaveCanPickUpItem : (Slave : TActor,Item : TMapItem,Accept : boolean) =>boolean;

//当宝宝拾取物品时触发
返回:TPickUpResult.purPickUp 表示继续拾取,
返回:TPickUpResult.purPickStop 表示不拾取 物品还会停留在地图上
返回:TPickUpResult.purPickStopDelete 将不拾取物品，同时删除地图上的物品。
GameLib.onSlavePickUpItem : (Slave : TActor,Item : TMapItem , PickUpResult : TPickUpResult) =>TPickUpResult;

需要注意的是 TMapItem.UserItem 有可能为null。 需要先判断 TMapItem.MoneyType 是否等于 TMoneyType.mtNone。
只有当TMapItem.MoneyType === TMoneyType.mtNone 才表示是一个物品 。 否则表示掉落的是货币 。

注意事项:此版本为了增加 TEnvirnoment.ThrowMonItems 功能 重构了怪物掉落 涉及影响 TPlayObject.GetMonItems 以及 GameLib.ThrowItem 等函数,可能存在bug，请使用到相关接口的脚本重新测试一下。

-----------------------------------------------------------------------------------------------
2022-10-10

1.[修正] TPlayObject.ShowEffect 特效偏移和版本管理器中设计对不上的问题

2.[修正] 打开自定义UI后 关闭 导致背包刷新按钮不可用 的问题。

3.[修正] 日志分析工具单独搜索物品ID 无法搜索的问题，以及时间无法选择24小时的问题。 增加根据角色ID查询角色名称信息的功能。

注意事项:本次更新 只需更新 91Client.dat 即可

-----------------------------------------------------------------------------------------------

2022-10-09

1.[修正] 瞬息移动 会有一个火球特效的问题

2.[修正] 地狱火和疾光电影 攻击目标不飘血的问题

3.[修正] TActor.CancelToMonster() 无效的问题

4.[修正] 技能编辑器伤害计算错误的问题

5.[增加]用于动态修改目标是否触发脚本函数
　　TActor.TriggerRevivalEvent 　 //复活触发
　　TActor.TriggerDieEvent 　 　 //死亡触发
　　TActor.TriggerKillerEvent 　 　 //杀怪触发
　　TActor.TriggerDamageEvent 　 //受到伤害触发

6.[优化] 挂机拾取物品会漏掉物品的问题

7.[修正] 绑定物品图标位置会因物品大小以及格子大小导致显示位置有差异的问题。

8.[修正] 确定对话框会导致玩家移动的问题。

注意事项:本次更新 需要同步更新对应版本内的JONE.d.ts 以及 91Client.dat 和 M2Server.exe 登陆器无需重新生成。

-----------------------------------------------------------------------------------------------

2022-10-06

1.[修正] TGuild.VarString 不保存的问题

2.[修正] 使用Nginx 和 Apache 等 作为通用负载均衡防火墙 时，客户端IP总是为转发服务器的IP的问题 需要转发程序 http头配置 “X-Real-IP”或者“X-Forwarded-For”

3.[增加] TUserMagic.Opened 可写用于脚本修改开关状态 以及 TPlayObject.UpdateMagicOpenState 用于更新状态到客户端

4.[修改] GameLib.onChangeAttatckMode 修改为正确的拼写 GameLib.onChangeAttackMode 以及对应参数修改为枚举类型

5.[修改] 穿戴装备回调部分 ItemWhere:number 修改为 ItemWhere:TItemWhere

注意事项:本次更新 需要同步更新对应版本内的JONE.d.ts 以及 91Client.dat 和 M2Server.exe 登陆器无需重新生成。

-----------------------------------------------------------------------------------------------

2022-10-05

1.[修正] 技能编辑器设置减少MP实际会增加MP的问题

2.[增加] 技能编辑器可设置每次释放增加技能熟练度。 -1 表示不增加熟练度 0 表示随机 1-4点 > 0 表示增加对应设置的值

3.[增加] 技能编辑器 修改本技能熟练度作用 , 计算公式为: 基础熟练点 + 随机(随机熟练点)

4.[增加] M2-选项-游戏选项(2) 允许爆物品到有角色的坐标上，以及设定每个坐标允许掉落物品的最大数量

5.[修正] 商城可能导致复制物品的BUG

6.[修正] 套装属性增加HP 会给MP也增加的问题。

注意事项:本次更新 需要同步更新 91Client.dat 和 M2Server.exe 登陆器无需重新生成。

-----------------------------------------------------------------------------------------------

2022-10-04

1.[修正] 摆摊叠加物品购买后存无限仓库数量不对 导致可以复制叠加物品的问题。

2.[修正] 火龙守护兽导致引擎报错的问题

3.[修正] 大刀卫士会攻击 race 51 52 不主动攻击怪物的问题。

4.[修正] TActor.AddedAbility.MaxWeight 等若干属性 无效的问题

5.[修正] GameLib.onAfterTakeOnItem 中修改 TakeOnUserItem 属性不生效的问题。

6.[修正] 自定义特效坐标偏移 版本管理器预览和客户端位置不一致的问题。

7.[增加] NPC对话格式控制 I 图片类型控制参数 对Mask(遮罩) 矩形范围的控制 如 {I=72;F=Prguse.data;Mask=#33333380} Mask字段扩展支持参数格式为 #RGBA,偏移X,偏移Y,Mask宽度,Mask高度。

8.[增加] 开发者客户端增加UI节点上移下移动的功能。

9.[修正] TActor.ShowEffectEx Y坐标调节会变成X坐标的问题。

10.[修正] 叠加物品绑定 显示数量位置不对的问题。

11.[修正] GameLib.onChangeAttatckMode 回调 return TAttackMode.amCamp 不会生效的问题

12.[修正] 内挂魔法盾开盾可能会失败 导致一直顶盾的问题。

13.[修正] 允许MegreData合区工具多次重复合区

注意事项:本次更新 需要同步更新 91Client.dat 和 M2Server.exe 登陆器无需重新生成。

-----------------------------------------------------------------------------------------------

2022-09-20

1.[修正] Gamelib.onCastleStopWar 不会触发的问题。

2.[修正] DateUtils.IncHour 计算时间错误的问题

3.[新增] TActor.ShowEffectEx 新增一个参数LoopCount 表示重复播放次数

4.[新增] TActor.ShowEffectEx2 与 TActor.ShowEffectEx 的差异为 TActor.ShowEffectEx限制播放特效数量为 1 播放过程中再次执行 会清理掉之前的特效。 TActor.ShowEffectEx2 限制特效数量为20个。

5.[新增] 自定义技能编辑器作用 地图伤害事件增加配置 “单坐标最大允许事件数量” 用于限制单个坐标允许的最大伤害事件数量

6.[优化] 客户端被外挂或者其他方式修改并且发送错误协议时，强制T玩家下线

7.[优化] 鼠标左键在周围无法移动时根据鼠标位置 切换人物朝向，并优化转向卡顿时间

8.[修正] 城堡所属行会重启后丢失的问题

注意事项:本次更新 需要同步更新 91Client.dat 和 M2Server.exe 登陆器无需重新生成。

-----------------------------------------------------------------------------------------------

2022-09-19

1.[优化] NPC对话格式控制 E 字段物品类型 增加Count 用于强制显示物品图标右下角数量。当Count=-1时 强制不显示物品右下角数量。以及 C 用于控制右下角数量文字的颜色 如 {E=乌木剑;Count=5;C=253}

2.[新增] NPC对话格式控制 I 图片类型控制参数。
增加 Gray=1 表示灰化图像。如 {I=72;F=Prguse.data;Gray=1}
增加 Mask=#16进制RGBA颜色, 表示在图片之上再绘制一个同等大小的矩形框。如 {I=72;F=Prguse.data;Mask=#33333380} 注意颜色格式顺序为 #RGBA。
Gray 和 Mask 可以同时使用 例如 {I=72;F=Prguse.data;Gray=1;Mask=#33333380}

3.[优化] TActor.FlashMove 和 TActor.FlashPush 的滞留时间。

4.[修正] 客户端Buff图标设置持续时间为0 不能永久显示的问题。

5.[新增]
GameLib.onCastleStartWar : (Castle : TUserCastle) =>void; //城堡开始攻城触发
GameLib.onCastleStopWar : (Castle : TUserCastle) =>void; //城堡结束攻城触发
GameLib.onCastleSeized : (Castle : TUserCastle,Guild : TGuild) =>void; //城堡被占领触发 Guild 为占领行会
TUserCastle.StartWarTick //攻城开始毫秒时钟
TUserCastle.StopWarTick //攻城结束毫秒时钟

6.[新增] TActor.ShowEffectEx(EffectID:number,X:number = 0,Y:number = 0,OthersCanSee:Boolean = false) 用于支持对任何生物角色进行一次性特效播放 X Y可对特效进行坐标调整 OthersCanSee = true 表示其他周围玩家可以看见 。

7.[新增] 客户端背景音乐配置文件bgm.ini 用于自定义修改兼容归来和热血传奇客户端音效。(客户端目录下如无此文件,会自动创建)
参考设定
归来（默认无需修改）：
[BGM]
Login=wav\log-in-long2.wav
Select=
Death=

热血：
[BGM]
Login=wav\log-in-long2.wav
Select=wav\sellect-loop2.wav
Death=wav\game over2.wav

8.[新增] M2-选项-参数设置-游戏速度 怪物受击后仰控制 可设定怪物是否有后仰动作 以及停留时间 (默认 有后仰 停留时间为0)

9.[新增] 状态类Buff , TBuffStatusType.stStruckAction 强制对象受击后仰 Args1 为停留时间(仅对非玩家对象有效) 。

10.[新增] 状态类Buff , TBuffStatusType.stNoStruckAction 强制对象受击无后仰。对所有角色类型生效

11.[修正] 角色复活存在一个抖动动作的问题。

12.[修正] Race 181 远程攻击怪 在做为宝宝时不会跟随主人的问题

13.[修正] 关闭NPC对话框后,对话框内的自定义物品容器对象不会清空的问题。

14.[修正] 自定义技能地图伤害事件特效不显示的问题

15.[修正] 挂机道士挂机需要毒符的技能如果没有毒符还会一直释放的问题。

16.[优化] 技能描述文本从限制50个字符长度 扩充到限制 1024个字符长度。

-----------------------------------------------------------------------------------------------

2022-09-10

1.[修正] stdmode 为 71,73的物品 掉落数量与爆率设置数量不符的问题。(71，73等同于31和33的物品，但是可以叠加)

2.[修正] Player.SetClientUIProperty 设置多个UI属性无效的问题。

-----------------------------------------------------------------------------------------------

2022-09-09

1.[优化] 修正合区工具在遇到一场情况下的报错信息更加友好

2.[修正] 职业默认属性参数公式默认不正确的问题。

3.[增加] GameLib.onThrowItem : (Map : TEnvirnoment,X : number,Y : number,CallBackIdent : number,Item : TUserItem,Owner : TActor) =>void;
用于在 GameLib.ThrowItem 和 GameLib.ThrowItemEx 可对物品地面属性进行修改可以立即生效 如 名称 地面图标 以及 掉落光柱 和 颜色。
同时对 GameLib.ThrowItem 和 GameLib.ThrowItemEx 增加一个可选参数 CallBackIdent 当 CallBackIdent > 0 时候将会触发 GameLib.onThrowItem 同时将CallBackIdent 带入到 GameLib.onThrowItem 触发参数中。

4.[增加] 地图对象 TEnvirnoment.MapID 此字段等同于 TEnvirnoment.MapName 更方便进行区分。

5.[增加] TActor.FlashMove 闪现移动到坐标 和 TActor.FlashPush 向某方向闪现最大距离，如果最大距离目标坐标不可行走或者有怪物，将依次减少冲刺距离尝试。
具体参数解释：
//IgnorActor 为true表示目标坐标上如果有生物对象 也会强制移动过去 如果为false 将不能移动过去。
FlashMove(X: number,Y: number,IgnorActor: boolean): boolean;

//Direction 方向 0-7 最大冲刺距离 IgnorActor 为忽略目标坐标上的生物
FlashPush(Direction: number,MaxStep: number,IgnorActor: boolean): boolean;

6.[修正] 在GameLib.onUseMedcine 触发中对叠加类药品使用 Player.DeleteItem 叠加数量不会更新的问题。

7.[增加] M2-选项-参数设置-客户端控制-小地图左键点击打开大地图功能。 勾选后客户端鼠标左键点击小地图 即可打开大地图。

8.[增加] 全景大地图 和 滚动大地图切换功能。 在客户端UI中分为 两个组件，如果不需要切换只需要根据自身需要 屏蔽掉对应的地图组件即可。

9.[优化] 道士内挂 自动隐身在没有护身符的情况下会一直自动使用隐身术并且无法成功的问题。

10.[修正] 宝宝追击玩家会使用瞬移的问题。

11.[增加] 状态Buff TBuffStatusType.stObserverForMon 和 TBuffStatusType.stObserver 添加参数 Args1 = 1 时，角色有半透明效果

12.[增加] 三种状态Buff类型，stUnParalysis-防麻痹, stUnLockRun-防蛛网, stUnTrap-防定身陷阱.

13.[修正] 护身符和毒药用尽没有释放内存存在内存泄漏的问题。

14.[优化] 部分物品掉落日志同为一个日志类型，现优化分类

-----------------------------------------------------------------------------------------------

2022-09-02

1.[增加] GameLib.onUseMedicine 当 stdMode = 0, 1, 3 药品时 使用会触发此回调。 返回值 true 表示继续使用引擎逻辑。返回 false 引擎将不进行任何处理。

2.[修正] 鼠标右键人物跑动可能停止跑动的问题

3.[修正] ShowBleedNumber 血量在某些数值会有异常的问题。

4.[修正] 某些情况下登陆器微端和客户端无法通讯的问题。

5.[修正] 在某些情况下内挂物品过滤不保存的问题。

6.[优化] 登陆器在部分机器上启动会卡顿比较久的问题。

7.[修正] 调用 TNormNpc.Give 给与玩家物品如果玩家背包满了 会导致物品对象内存泄漏的问题。同时增加脚本调用文件以及行号在日志中，方便查询物品来源。

8.[修正] 几处内存泄漏的问题。

9.[增加] 内挂 人物简装 怪物简装复选框 以及音效调节功能（注意需要更新引擎包内的 Prguse.data）

10.[修正] 日志查看功期 物品溯源 日志 物品名称不对的问题。

11.[增加] M2-选项-参数设置-客户端-客户端内核MD5白名单功能，开启后不在列表内的客户端MD5将禁止登录。

12.[优化] 挂机在极端情况下会自动取消内挂拾取的功能。

-----------------------------------------------------------------------------------------------

2022-08-19

1.[修正] GameLib.RenamePlayer 无效的问题

2.[修正] 摆摊物品最后一格物品 重启会丢失的问题

3.[优化] 及时雨内挂 呼出卡顿问题。

4.[增加] 斗笠外观支持扩展。 从Har2.wzl 文件读取素材,从3600编号开始计算 数据库shape设置1就是3600编号开始到4799结束 以此类推，支持自定义扩展最多60个[暂时只支持战法道三职业] 刺客斗笠素材从Har3.wzl读取,暂不支持扩展

-----------------------------------------------------------------------------------------------

2022-08-14

1.[优化] 微端登录器在部分开启防火墙的系统上可能无法下载微端资源的问题

2.[修改] 版本管理器导出导入Excel 在包含双引号字符串的情况下会无法导入的问题，并且修改导出字符串不再包含双引号，修正导出格式不对的问题。

3.[增加] GameLib.HasDelayGoto 和 TPlayObject.HasDelayGoto 用于判定是否有延迟执行的时钟。

4.[修正] 在掉落触发中修改物品名称地面依旧显示旧物品名称的问题。

5.[修正] 账号数据库和角色数据库 不在同一个库的情况下, 控制台清理数据可能报错的问题。

注意 ：本次更新 91Client.dat 以及登录器 必须同步更新 否则会导致 微端不下载

-----------------------------------------------------------------------------------------------

2022-08-10

1.[修改] GameLib.onAINpcExecute 和 GameLib.onMonSelectMagicBeforeAttack 的执行不再是全局执行
而是根据每个怪物独立的标志设定是否触发回调。同时在版本管理器内的刷怪配置状态触发 增加刷怪选项 是否执行这两个触发回调。
例如
Actor.TriggerAINpcExecute = true
Actor.TriggerSelectMagicBeforeAttack = true
表示此角色将会触发执行 GameLib.onAINpcExecute 和 GameLib.onMonSelectMagicBeforeAttack

2.[新增] 怪物Race 181 ，数据库WC字段为怪物的最大攻击范围，建议1-10 以内。

3.[新增] TActor.Mutiny() 主动让宝宝叛变

4.[新增] TPlayObject.hasRobotRun(Name:string) 用于判定自身是否有设定的定时器在执行

5.[新增] TPlayObject.ClientScreenWidth TPlayObject.ClientScreenHeight 用于获取客户端分辨率

6.[新增] 连体时装设置 当 stdmode =17 18 时 物品数据库配置 source = 1 表示连体时装 此时武器外观模型 将不显示 ，用于在部分时装 是武器和角色模型一体的情况。

7.[新增] 老自定义技能编辑器动作类型 移动到鼠标位置(强制,无后摇)

8.[删除] 购买商铺物品成功引擎内的提示信息，如需购买成功提示 可自行在 GameLib.onBuyShopItemEnd 中进行提示。

9.[新增] 宝宝叛变回调事件 GameLib.onSlaveRoyalOver : (Slave : TActor,Reason : number,Accept : boolean) =>boolean
参数内容:Slave 宝宝对象 ， Reason 叛变原因和处理方式
1:祈祷套装生效 宝宝叛变
2:祈祷套装生效 宝宝死亡
3:忠诚时间到达 宝宝叛变
4:忠诚时间到达 宝宝死亡
5:主人死亡 宝宝叛变
6:主人死亡 宝宝死亡
返回 true 表示允许引擎继续处理 返回 false 表示引擎不做任何事情。脚本中可以使用 Slave.Mutiny() 使其叛变。 或者Slave.Die() 将其杀死，或者使用 Slave.MakeGhost() 使其消失。
但是需要注意如果忠诚时间到达一直不允许引擎对宝宝进行任何处理 那么引擎将会每10秒进行一次触发。建议在脚本设置不允许引擎操作的同时 修改忠诚过期时间。

10.[修改] TActor.SetMasterRoyaltyTick 执行后叛变时间为 从当前开始多久后叛变， 旧逻辑为 从召唤成功后的多久叛变
注意 ：本次更新 91Client.dat 以及开发者客户端 和 M2Server.exe 必须配套更新否则会有异常情况

-----------------------------------------------------------------------------------------------

2022-08-08

1.[修正] 微端登录器可能报错的问题

2.[修正] 客户端物品悬浮提示框闪动 以及 更换物品 显示不及时的问题。

-----------------------------------------------------------------------------------------------

2022-08-07

1.[修正] 叠加物品丢地面不显示物品名称的问题

2.[修正] 摆摊收购物品上架后无法删除的问题

3.[修正] 攻击模式聊天框提示信息 不受服务端绿字信息提示的控制的问题

-----------------------------------------------------------------------------------------------

2022-08-06

1.[修正] 登录器分辨率在非默认模式下不保存的问题

2.[修正] 微端登录器默认目录无效的问题

3.[优化] 微端登录器默认目录根据磁盘剩余空间大小进行选择

4.[修正] 技能系统可能造成内存错误的问题。

5.[修正] 斗笠内观显示不对的问题

6.[优化] @InPutString 输入框在第一次调用不会获取焦点的问题

7.[修正] 名称带数字的装备物品在地面不显示数字的问题

8.[修正] 因DB线程异常导致玩家数据不存档的问题。

-----------------------------------------------------------------------------------------------

2022-08-02

1.[增加] 客户端UI组件 “NPC对话文本框” 组件。 支持使用与NPC对话相同的文本格式进行内容排列。 服务端脚本通过 Player.SetClientUIProperty 可更新组件的内容。
示例:
let text = ‘{S=91M2;C=253}{I=54;F=Prguse.data}’
text = GameLib.MakeMaskString(text) //注意 text 需要使用 MakeMaskString 函数进行转义
Player.SetClientUIProperty(‘DNpcChat’, ‘SayText=${text}’)；

2.[优化] 客户端UI属性编辑器对一些 boolean 值类型编辑 从下拉列表 修改为勾选框 ，更直观的进行修改。

-----------------------------------------------------------------------------------------------

2022-07-31

1.[修正] M2勾选毒符背包即可使用，背包中存在红绿毒药物时，并且使用自动红绿毒切换 绿毒和红毒 都会扣减红毒药物持久的问题。

2.[修正] 修正因技能数据保存异常导致的玩家角色异常问题。

-----------------------------------------------------------------------------------------------

2022-07-26

1.[修正] 素材编辑器 使用覆盖 和插入方法 导入BMP会上下镜像的问题。

2.[优化] 自动练功技能间隔调整为 1秒

3.[修正] 尝试修正因技能数据保存异常导致的玩家角色异常，此问题原因暂未明确 需要长期观察。

-----------------------------------------------------------------------------------------------

2022-07-25

1.[增加] 内挂单独对红绿毒切换进行控制,优化在M2设置为不需要毒符穿戴的情况下 红绿毒切换的逻辑。 （自定义UI会提示更新 内挂-技能页可能会有布局变化请已经使用自定义UI的手动调整）

2.[修正] 游戏网关多开会有的网关无法进入游戏的问题

3.[增加] 版本数据库保活机制，提高脚本内的数据库访问速度。

-----------------------------------------------------------------------------------------------

2022-07-22

1.[修正] GameLib.onAttackActorDamageIsZero 会导致伤害恒为 1 的问题

2.[修正] @@InPutString 弹出的输入框无法ctrl + v 粘贴的问题。

3.[增加] wil素材格式支持部分地图编辑器扩展的颜色模式

-----------------------------------------------------------------------------------------------

2022-07-21

1.[修正] 商城购买的道具 会清理掉对应的State信息。

2.[修改] 系统默认UI 技能ICON 点击为禁止获取鼠标焦点，为优化设置技能快捷键后 必须点击地图才能释放技能的问题。已经自定义UI的可以手动修改6个技能组件图标的 “允许获取焦点” 为 false

3.[修正] 开启怪物简装 部分NPC可能会绘制不正确的问题。

4.[修改] 自定义UI窗口会阻挡焦点的问题。 已经自定义UI的可以手动修改 DButtonSideBar 展开收缩按钮 组件图标的 “允许获取焦点” 为 false

5.[修正] 背包物品装备位置 重新上下线位置会有变更

-----------------------------------------------------------------------------------------------

2022-07-09

1.[修正] 修正GameLib.ShowEffeect 播放自定义特效 特效ID超过255就不播放的问题。

2.[修正] 修正护身戒指会导致人物无敌的问题。 并且增加 飘血类型 TBleedType.btMagicProtected = 17 表示护身戒指生效减蓝。

3.[增加] 增加开发者客户端配置保存的功能

4.[增加] 增加开发者客户端快速登录的功能。只需要预定义好账号密码和角色名称 启动会快速进入到游戏场景。

5.[修正] 修正复活类僵尸头顶可能会有特效的问题。

6.[增加] 当玩家对目标伤害为0时触发 GameLib.onAttackActorDamageIsZero 用于拦截当攻击者的攻击力 小于 被攻击者的防御, 这时候攻击会全是0 的问题。

示例 以下修改 会造成最低伤害 为 1 （Reason伤害为0原因 目前只有0 表示目标的物理防御大于攻击者的最大攻击）
GameLib.onAttackActorDamageIsZero = (Attacker: TActor, Target: TActor, Reason: number, Damage: number): number => {
return 1
}

7.[修正]UI设定组件场景不为登录场景也会再登陆界面显示出来的问题。

-----------------------------------------------------------------------------------------------

2022-07-04

1.[修正] 部分素材优化会导致客户端花屏的问题

2.[修正] 部分版本存在机器人默认模块 不为RobotManagerNpc 的问题。

3.[增加] 登录器列表编辑器-微端控制-关闭微端日志

4.[增加] 服务器列表增加入口标识，用于区分是从登录器的哪个选项进入的游戏。脚本内通过TPlayObject.ServerEntryFlag进行获取。

5.[修正] 微端地图下载可能因为 map文件夹不存在导致的报错问题。

-----------------------------------------------------------------------------------------------

2022-06-27

1.[增加] 部分地图格式支持

2.[修正] 资源编辑器导出大量图片会卡死的问题。

3.[修正] 上一版登录器会提示一直在等待必要资源更新的问题

-----------------------------------------------------------------------------------------------

2022-2022-06-24

1.[修正] 修正登录器生成无法勾选微端客户端的问题。

2.[修正] 91Resource内的文件大小写名称和实际微端文件大小写不一致导致在大小写敏感的http系统上无法加载的问题。

3.[修正] 登录器必要补丁 没有更新完毕 依旧可以开始游戏的问题

4.[修正] 登录器更新提示信息 包含英文字母是会有白边的问题

5.[修正] 登陆器更新补丁 设置更新地址 https 会自动增加 http前缀的问题

6.[修正] 无极真气人物属性超过21亿使用 会降低属性的问题。

7.[修正] 神兽从大狗变成小狗后，走路外观动画依旧是大狗的问题。

8.[增加] ts脚本 Promise 支持，以便实现异步转同步代码。

9.[增加] Player.SendBleedNumber Player.SendBleedNumberForDebug 与 TActor.ShowBleedNumber 和 TActor.ShowBleedNumberForDebug 的区别在于 ShowBleedNumber 和 ShowBleedNumberForDebug 是广播给所有人 。而Player.SendBleedNumber Player.SendBleedNumberForDebug 是对单个玩家发送。

10.[增加] UI设计元素 输入框 增加唯一标志设置 ，使得其内容可以脚本修改。 例如Player.UpdateUIEditText(1003,’文本已经修改’) 1003 为设置的输入框元素的唯一标志。

11.[增加] M2-功能设置-技能魔法-施毒术 玩家离线保存绿毒伤害数值。若勾选 玩家下线再上线其绿毒伤害不会重置为1

12.[增加] 资源文件编辑器设置功能 可设置缩略图宽度高度 以及每行图片数量。

-----------------------------------------------------------------------------------------------

2022-06-17

1.[修正] 远程技能命中目标 无伤害 也不飘MISS的问题。

2.[增加] TActor.AddedAbility 用于给怪物动态修改属性 （若要立即生效请修改完毕后 执行 RecalcAbilitys()）

3.[修正] 间隔作用各类BUFF HP伤害错误的问题。

4.[增加] GameLib.AsyncHttpPostJson 以及 GameLib.AsyncHttpGet 对Https的支持

5.[修正] 使用治愈术给宝宝加血 主人看不到飘血的问题

6.[修正] 版本管理器生成的登录器 如果不使用微端客户端 在客户端内无法打开的问题。

-----------------------------------------------------------------------------------------------

2022-06-14

增加鼠标点击背包物品事件触发，GameLib.onUIActivedBagItemEvent 前提需要一个自定义UI显示才能激活。对应设置在 版本管理器-UI设计-自定义窗口-可视时激活背包鼠标点击事件 勾选（注意需要更新Jone.d.ts）

2.增加 控制台新增数据清理页签，将数据清理单独放置一个页面，并且可选清理对应的数据。

3.修正 控制台端口重新生成会修改掉 GateWay端口的问题。

4.增加 PlugInManager.MonDropItem 怪物掉落物品触发 将第一个参数 由 Player:TPlayObject 修改为 Actor:TActor 以便捕捉到 怪物击杀怪物掉落物品的事件触发。

5.修正 Player.TargetActor 可能存在无效目标的问题。

6.优化 客户端坐标可能和服务端坐标不对导致普通攻击无法砍出来的问题。

7.增加 生成登录器可选微端客户端。

8.增加 版本管理器 预览特效增加人物模型对照，方便调整特效偏移

9.增加 控制台增加清理若干天游戏日志的功能 ，防止因为游戏日志过大。导致数据库文件过大。

10.增加 部分客户端组件增加 “提示信息支持变量” 功能 勾选后提示信息 内包含 形如 <$LEVEL> 的变量标签将自动格式化为对应信息。

11.增加 独立的素材文件编辑器 DataView 。

12.增加 微端客户端MD5对比功能。当微端文件和客户端文件不一致时，将会自动更新。

13.优化 微端文件大小写名称在CDN下大小写敏感导致部分文件无法下载的问题。

14.增加 自定义飘血功能 其触发函数为 GameLib.onClientBleedNumber 其中包含 攻击者 受伤者 血量 伤害事件等参数 返回 true 表示 引擎继续飘血。返回 false 表示拦截此次飘血。
使用 Player.ShowBleedNumber(2,100000); 和 Player.ShowBleedNumberForDebug 配合替换掉引擎飘血效果。（详见15,16,17）

15.增加 版本管理器增加飘血模板设置。用于预定义一些飘血效果。(其配置和16是一样的)
参数释意

16.增加 Player.ShowBleedNumberForDebug 用于显示一个飘血效果 （注意 此函数推荐仅用于调试特效,调试好之后的参数建议在版本管理器增加飘血模板,使用 Player.ShowBleedNumber 在生产环境中 以便节省流量)
ImgFile ： 文件图库名称 如，$Data\Prguse.data
NumImageIndex : 对应图库的 数字图片 0 起始位置 此从序号开始 应当是连续的0-9数字
Prefix 飘血前缀 在飘血数字左边显示的图片 格式为 图片序号,X,Y|图片序号,X,Y 最多5组
BleedNumber ：飘血的数字 不区分正负值 -100 和 100 都将显示为100
Suffix 飘血后缀 在飘血数字右边显示的图片 格式为 图片序号,X,Y|图片序号,X,Y 最多5组
duraTime 持续时间 单位毫秒
StartX,StartY,StopX,StopY 分别表示相对于角色位置 起始X 起始Y 结束X 结束Y。

17.增加 Player.ShowBleedNumber(飘血模板ID,飘血数量) 。

18.增加 自定义技能快捷键功能。 通过 Player.FindSkill 可以获取到 TUserMagic TUserMagic.Key 就是快捷键的键值(快捷键的键值可参考ASIIC码表) TUserMagic.KeyCtrl 为是否包括Ctrl键
同时客户端文件增加 MagKey.data （快捷键不包含ctrl 的 快捷键显示图标） MagKeyCtrl.data （快捷键包含ctrl 的 快捷键显示图标） 这两个文件只包括 F1-F8的图标 键值对应112-119。

19.增加 自定义技能图片ICON脚标的功能。TUserMagic 新增 LeftTopIcon （左上角角标） RightTopIcon(右上角角标) LeftBottomIcon (左下角角标) RightBottom (ICON 右下角角标) 其图片放置在

MagTag.data 内 同时图片的XY偏移可以对角标位置进行调整。

20.增加素材优化功能 优化真彩地图卡顿的效果，需要使用素材编辑器对既有的data文件进行优化 推荐使用中等优化。即可大幅度改善游戏客户端在低端机器上的卡顿效果（优化前请备份资源文件）

21.增加 Player.UpdateItemContainerVisable(‘302,301’,true) 用于动态调节隐藏或者显示可控道具元素组件。其中”302,301”(可设置多个) 为 版本管理器-UI设计-自定义窗口-可控道具元素组件 内的 唯一标志。

升级注意：

微端需要重新生成，登录器需要重新生成 , 客户端内核需要替换 。(需要全套更新 ) 并且 需要将客户端补丁内的 MagKey.data 和 MagKeyCtrl.data 以及 MagTag.data 复制到客户端目录 否则技能快捷键会显示不正常。

-----------------------------------------------------------------------------------------------

2022-05-25

1.[修正] M2存储行会数据报错导致行会数据不更新的问题。

2.[修正] 自定义技能拾取地面物品报错的问题。

3.[修正] 拾取他人丢弃的物品可能会报错的问题。

4.[修正] GateWay存在内存泄漏，导致内存只增不减的问题。

5.[修正] 修正商铺分类按钮按下效果会自动弹起来的问题。

6.[修正] 自动挂机的一些问题。

7.[修正] 技能数据库导出到excel后再导入数据库扩展技能会数据错乱的问题。

8.[优化] 高清地图卡顿的问题，以及优化玩家跑步过程中可能会卡顿的问题。

9.[增加] M2-选项-角色数据库设置-选角超时时间

10.[增加] 自定义UI九宫格窗口增加 允许浮动 以及不允许前置的选项。

11.[增加] 自定义UI 输入编辑框增加最大长度限制。

12.[增加] 技能数据库扩展技能增加导入导出到剪切板。

-----------------------------------------------------------------------------------------------

2022-05-14

1.[修正] 客户端关闭可能报错的问题

2.[优化] 刷新背包会改变快捷栏位置的问题。

3.[优化] 挂机的一些调整

4.[修正] 盛大地图模式下 小地图有时候会点不出来的问题

5.[增加] TActor.BlockInArea 用于将怪物或者玩家在一定时间内锁定在指定坐标矩形范围内，不可移动出去。参数为 左上坐标 和右下坐标 以及持续时间(毫秒)

6.[增加] TActor.BreakBlockArea 用于解除怪物或者玩家的范围锁定

7.[修正] 自定义技能的一些问题。

-----------------------------------------------------------------------------------------------

2022-05-08

1.[修正] 登录器更新自身以及更新补丁时界面会假死的问题。

2.[修正] 使用了 GameLib.onGetLineMessage 函数 会导致会导致玩家掉线的问题。

3.[修正] 物品到期时间 退出游戏后重新上线会消失的问题。

4.[修正] 技能扩展飞行效果只显示第一张图片 不会轮流播放的问题。

5.[修正] 微端下载文件 如果文件不存在不会提示的问题。

6.[修正] NPC购买物品售出不会自动删除物品的问题。

7.[修正] 当文字颜色不为0时，文字颜色和背景颜色都无效

8.[修正] 微端第一次进入游戏 挂机寻路可能出现问题 以及相关一些挂机问题。

9.[增加] 九宫格增加填充间距 属性 用以设置填充背景颜色与组件四周距离的像素距离。

10.[增加] 技能扩展 “移动到鼠标位置(强制)”

-----------------------------------------------------------------------------------------------

2022-04-27

1.[修正] TGuild.AddMember 和 AddMemberWithRank无效的问题。

2.[增加] GameLib.DeleteGuildForce 可强制解散行会。

3.[修正] 挂机情况下负重满 人物会一直站在原地尝试拾取物品的问题。

4.[修正] 无法恢复角色的问题

-----------------------------------------------------------------------------------------------

2022-04-20

1.[修正] GameLib.GetAVar GetGVar 和设置的索引对不上的问题。

2.[修正] UserItemList 报错的问题。

3.[修正] 购买商铺物品可能会导致内存泄漏的问题

4.[优化] 取消M2封包分析报告。

5.[修正] 说明书无法搜索的问题。

-----------------------------------------------------------------------------------------------

2022-04-17

1.[修正] GameLib.GetLastThrowItemList 无效的问题。

2.[修正] GameLib.V R在 GameLib.onScriptEngineInit 中无法使用的问题。

3.[优化] 客户端内存占用，以取消客户端内存报告文件到保存到硬盘(内存泄漏问题已经解决)。

-----------------------------------------------------------------------------------------------

2022-04-14

1.[修正] 删除角色后可能会自动恢复的问题

2.[修正] 副本怪物假死的问题

3.[增加] M2设置 免助跑步数

4.[优化] 客户端加速从-5 ~ 5 调整为 -100 ~ 100

-----------------------------------------------------------------------------------------------

2022-04-13

1.[优化] 客户端寻路性能

2.[优化] 客户端存在的内存泄漏，以及内存占用。

3.[修改] 全局物品容器 接口 增加保存到数据库功能，因使用不正确容易导致内存错误以及泄漏。需要极其小心 参考示例。

4.[修正] TPlayObject.GetSkills 无法获取技能信息的问题。

5.[修正] 物品悬浮提示框修改极品附加颜色不生效的问题。

6.[修正] GameLib.ClearMapMon ANoDrop参数为false时,也不会爆出物品的问题、

7.[修正] ‘randomRange’ is not defined 的问题。

8.[修正] 聊天文字修改颜色不会及时变色 的问题。

9.[修正] 大仓库无法取出物品的问题

10.[修正] JONE.d.ts 一处单词拼写错误问题

11.[修正] 登录器以及客户端 有概率存在无法链接服务器的问题。

12.[增加] 内挂挂机控制 同时增加挂机开始回调 GameLib.onStartAutoFight 和 GameLib.onStopAutoFight 同时增加 TPlayObject.UpdateAssistantIni 用于设置内挂行为选项。

另 客户端目录/91Resource/Assistant.ini 文件将在客户端启动时候加载，将其设置为默认的挂机行为配置。

[普通药品]

HP=强效护手霜,超级金创药,普通药品HP

MP=超级魔法药,强效魔法药,普通药品MP

[特殊药品]

HP=强效护手霜,超级金创药,特殊药品HP

MP=超级魔法药,强效魔法药,特殊药品MP

[随机保护]

HP=强效护手霜,超级金创药,回城卷

[挂机行为]

红药完=红药完,回城卷

蓝药完=蓝药完,回城卷

毒符完=毒符满,回城卷

背包满=回城卷,自动回收/@Item #背包满将触发执行 GameLib.onScriptButtonClick 事件

受玩家攻击=受玩家攻击,回城卷

-----------------------------------------------------------------------------------------------

2022-03-17

1.[修正] 物品内存泄漏的问题 (严重)，感谢寒枫(QQ164382362)发现并配合查错

2.[修正] 物品MakeIndex有可能冲突的问题。

3.[增加] 通过脚本给与和删除的物品在日志中会记录对应的js代码行号，方便确定物品来源。

-----------------------------------------------------------------------------------------------

2022-03-14

1.[修正] 宝箱钥匙无法打开宝箱的问题

2.[修正] TPlayObject.Question 第三个参数为空会导致客户端无法显示的问题。

3.[增加] GameLib.onClickLockedBagGrid : (Player : TPlayObject,GridIndex : number) =>void;点击背包未解锁格子触发。

可参考示例(以下代码放在ManagerNpc.ts 为例,可放在任意ts文件内,客户端UI将物品格子调整超过最大背包空间数量即可显示小锁):

export function OpenBagGird(npc: TNormNpc, Player: TPlayObject, Args: TArgs) {
    Player.SendCenterMessage(`已开启第${Args.Int[0]}个背包格子`, 0, 2000)
    Player.MaxBagSize += 1
}

GameLib.onClickLockedBagGrid = function (Player: TPlayObject, GirdIndex: number): void {
    Player.Question(`确定打开第${GirdIndex}个背包格子吗?`, `ManagerNpc.OpenBagGird(${GirdIndex})`, '')
}
4.[增加] TActor.MagicAttack等魔法攻击函数新增一个可选参数 ClientPlayerHaveSpellAction 表示客户端玩家是否可以看到自己的施法动作。默认为false。

5.[增加] M2信息面板增加 可用内存 M2内存 和脚本内存占用参数。

-----------------------------------------------------------------------------------------------

2022-03-11

1.[修正] Jone.d.ts 可能再某些 vscode版本下提示的语法错误(需要更新Jone.d.ts 到对应的脚本目录)

2.[修正] @@功能调试.IntPutString22 这类单单元名称的 不会弹出输入框的问题

3.[修正] 脚本内传递 null 或者 undefined 给 Actor对象 ，会导致脚本报错的问题。

4.[修正] 修正背包淬炼按钮无法自定义的问题。

5.[修正] 新建版本后再打开 提示单元名称错误的问题。

6.[修正] 登录器注册账号成功后无提示的问题（需要重新生成登录器）

7.[增加] M2-选项-角色数据库设置 用于对创角进行一些设置。

-----------------------------------------------------------------------------------------------

2022-03-07

1.修正 Jone.d.ts 可能再某些 vscode版本下提示的语法错误(需要更新Jone.d.ts 到对应的脚本目录)

2.修正 在没有DBServer目录下生成配置文件报错的问题。

3.增加 GameLib.CreateDuplicateMap 创建副本第二个参数 为 0 表示副本存活时间为永久。

-----------------------------------------------------------------------------------------------

2022-03-04

1.[修正] 删除角色后,角色未通知玩家下线的问题。

2.[修正] 叠加物品无法拆分的问题。

3.[修正] NPC头顶特效设置一个不存在的特效ID会导致客户端ID假死的问题。

4.[修正] 魂炼系统修改UpdateItem不生效的问题。

5.[修正] 创建新角色时使用Ctrl+v 粘帖可以突破字符串字数限制的上限的问题

6.[修正] 套装属性魔法倍数显示是蓝量倍数的问题。

7.[修正] GameLib.onExternalNpcExecCommand 执行无效的问题。

7.[新增] DateUtils 增加 SecondOf MinuteOf HourOf等函数用于获取日期中对应的时分秒年等。

8.[新增] TActor.Weapon == TActor.weapon , TUserItem.AddHole == TUserItem.AddHold 用于修正并兼容拼写错误的问题。

9.[删除] 重新优化引擎架构 删掉 DBServer , 数据兼容 之前的TS引擎版本。

注意 : 对应版本脚本需要更新 JONE.d.ts 用于更新引擎接口提示。

-----------------------------------------------------------------------------------------------

2022-01-04
1.修正 Player.VarDateTime 时间类型服务器重启后失效的问题。

更新日志 - 2021年
2021-12-30

1.修正 内置脚本M2报错 无法找到脚本文件的问题。

202-12-27

1.修正数据库配置为 纯数字 名称 启动游戏报错的问题。
2.修正勾选新区自动清理数据 会导致启动游戏M2报错的问题。
3.修正购买NPC商品 提示商品已经售出，无法购买的问题。

2021-12-25

1.修改M2主界面的日志滚动条为 当滚动条在最底部 新增消息滚动条会自动滚动到最底部。如果不在最底部滚动条则不滚动。
2.增加M2界面版本后台功能,通过此功能可给M2内增加 自定义按钮 和 输入框 复选框，和日志窗口。可以方便在M2对版本的自定义功能进行一个简略的控制，也方便版本开发过程中对脚本功能测试。（注意更新 引擎包内的 JONE.d.ts 到版本内）

2021-12-23

1.增加行会 对象 TGuild.V TGuild.R 和 GameLib.V GameLib.R ,方便数据自定义。 （注意需要更新替换掉自己版本内的 JONE.d.ts）
2.修正M2网关端口被占用 没有提示报错的问题。
3.修正一处M2日志内存泄漏的问题。
4.修正客户端选中角色光环会不显示的问题。

2021-12-20

1.修改打包内置脚本目录为根据版本所在目录 打包对应版本文件下的Script目录
2.修正GateWay 网关端口占用不会报错的问题。
3.修正普通仓库无法取出物品
4.增加 GameLib.DBEngine.AddConection 在代码内增加数据库链接配置。
5.增加 Player.V 和 Player.R 其类型为 {} , 可以更加方便的自定义变量。（注意需要更新替换掉自己版本内的 JONE.d.ts）
例如 赋值代码为:
Player.V[“血脉等级”] = 5
或者
Player.V.魂玉系统 = {}
Player.V.魂玉系统.等级 = 10
Player.V.魂玉品质.品质 = “史诗级”
取值代码为
Player.SendMessage(Player.V[“血脉等级”])
Player.SendMessage(Player.V.魂玉系统.等级)
其中 V 和 R的类型为 V会保存到数据库 玩家上下线值会以json格式保存在player表中的customSaveStr字段中。
Player.R 玩家下线就会清空。
后面会陆续加上 TGuild.V TGuild.R 以及 GameLib.V 和 GameLib.R

2021-12-16

1.修正关闭服务器玩家会自动退回到选角界面的问题。
2.修正网关可能报错 逻辑错误2 的问题

摆摊增加摊位名称可修改。(自定义UI 会自动升级 记得保存)
2021-12-13

1.修正摆摊的异常问题。
2.修正新建行会保存到数据库ID为0的问题。
3.修正任务系统数据没有保存到数据库的问题。

2021年04月26日更新
修正 物品数据库修改职业为0无效的问题。
修正 无限刀配置保存失败的问题。

2021年04月25日更新
修正 上一版本配置数据不会下发导致客户端物品显示错误的问题
增加 M2-选项-游戏参数-客户端控制-禁止使用自动挂机设置
增加 登陆器编辑器窗口化组件
优化 版本管理器 单元测试 QFunction QManagerNpc 时间过长的问题

2021年04月23日更新
修正 火墙持续伤害 无法 通过 QManager.MonitorDamageEx 触发 技能ID总是0的问题。
修正 及时雨内挂下物品过滤修改后 保存按钮无法点击 导致无法保存过滤配置的问题
增加 选项-游戏参数-游戏速度-无限不卡刀 设置 开启后 客户端的攻击将更流畅,适用于 无限刀版本
增加 GameLib.LoadLibrary ，GameLib.GetProcAddress ` GameLib.FreeLibrary 用于版本内可延迟加载DLL

2021年04月19日更新
优化 如果微端描述文件MiniVer.91Ver 无法下载会导致一直提示 后台构建微端资源中的问题。
增加 生成登陆器增加 客户端推广标识， 在服务端可使用 Player.PromotionFlag 获取对应的推广标识。通过此功能可以实现统计哪些渠道来了多少玩家。(需要重新生成登陆器以及更新内核91Client.dat 以及服务端)

2021年04月15日更新
优化 微端下载的data文件无法在版本管理器中打开
修正 物品自定义来源中 使用 $CUSTOM0$ 至 $CUSTOM10$ 总是显示0的问题

2021年04月14日更新
优化 微端加载速度 速度提升50%以上(登陆器需要重新生成)
修正 因91源码泄露导致Data资源格式加密能被第三方工具解密的问题(已经加密过的文件使用重新修改密码即可重新加密)

2021年03月31日更新
修正 复活戒指无法复活的问题
增加 登录器设计 分辨率下拉框
修正 微端不会更新部分非 \data\开头的图片资源
修正 DBServer 可能出现 数据库锁表。导致无法存档的问题

2021年03月14日更新
修正 UserItem.DisplayName 为 空字符串的问题
增加 自定义技能编辑器 目标选中条件 是否死亡
增加 自定义编辑器 目标作用 破除目标对自身隐身
增加 游戏参数-日志记录-关闭M2日志写入磁盘

2021年03月02日更新
修正 微端下载URL中包含中文或者空格会导致无法下载的问题
优化 自定义物品名称 ItemNameList.txt 文件大小 防止文件越来越大
修正 物品自定义来源中 使用图片或者动图 无法使用 W=0 来控制实际宽度的问题
增加 物品自定义来源中 使用 $CUSTOM0$ 至 $CUSTOM10$ 用来格式化输出 UserItem.CustomValue[0..10]对应的内容实现更多自定义化
注意本次更新必须同同时更新服务端和客户端内核 单独更新服务端或者客户端内核 都会导致各种异常问题

2021年01月31日更新
修正GameLib.LoadUseItemFromString 和 GameLib.SaveItemToString 有可能会导致物品的自定义属性重复的问题。
修正 TUserItem.OutWay2 修改后 OutWay3 如果不进行修改值会变成0的问题。
增加 TPlayObject.ForceMapMove(Envir: TEnvirnoment; const MapX, MapY: Integer) 此函数可以使得离线挂机人物可以被执行地图传送。
修正 部分技能无法打出超过21亿的伤害。
修正 SetBuffIcon Args1 Args2 客户端显示错误的问题。
增加 Tbuff.Actor 用于脚本自定义存放 玩家或者怪物对象。(仅用于存放引擎不会对这个值进行任何操作)
优化 客户端自动打怪会停止的问题
注意本次更新必须同同时更新服务端和客户端内核 单独更新服务端或者客户端内核 都会导致各种异常问题
2021年01月19日更新
优化 网关性能,修正可能黑屏的问题
增加 Actor.DenyAutoAddHP 属性 用于禁止引擎对怪物以及人物的自动回血 true 为不使用引擎的自动回血。

2021年01月18日更新
修正 网关卡顿导致游戏卡顿的问题
增加 Player.RemoveItemFromUIContainer(UniTag:Integer) 用于从UI物品框中移除物品
修正 若干小问题

2021年01月06日更新
修正 在某些服务器上可能登录网关会一直关闭客户端连接的问题
修正 Buff图标在移除Buff后不会删除的问题
修正 {S=xxxx;Hint=aaaa} hint 不会显示的问题
修正 客户端新增自定义组件在全局窗口列表下可能丢失的问题
增加 弓箭手衣服Shape 20-25

更新日志 - 2020年
2020年12月22日更新
修正 调用自定义对话框，图片按钮 不执行脚本的问题
增加 登录器列表加密
修正 复活BUFF 设置次数不会自动删除的问题

2020年12月20日更新
新增 属性 TActor.AlwaysShowHP 使得玩家或者怪物 总是处于心灵启示状态 (掉血始终广播给周围玩家)
修改 Buff系统 复活Buff Args1 为复活生效次数,达到指定次数将自动删除buff, 0 表示无限次数
修正 TPlayer.Question 点击不执行脚本的问题

2020年12月16日更新
增加 物品 TUserItem 扩展 OutWay2 字段类型为 Integer 数组。 增加OutWay3 字段 以便支持 在自定义物品信息中 实现上下限同时显示的功能 例如物品来源配置表中 1=攻击力增加$OUTWAY2$-$OUTWAY3$ 。对应设置OutWay2 和 OutWay3 的值会被格式化为具体值 原来的Value 格式同样支持。但是不建议继续使用.详情查看 TUserItem文档
修改 物品来源限制(TUserItem.CustomCaption)条件从仅支持装备 为无限制。
新增 GameLib.SaveUserItemToString(UserItem:TUserItem):String 用于将物品转为字符串保存。 以及 GameLib.LoadUserItemFromString(Str:String):TUserItem; 从字符串转化为物品对象。注意:物品序列化为字符串后,再序列化回来会导致一样的物品唯一ID 转化后如果用于保存再转化回来。必须确保转化之前的物品对象已经从人物或者仓库销毁。否则会造成复制装备的风险 慎用!
修改 当物品名或者顶部拓展栏 描述为空 依旧会显示空边框的问题。

2020年12月14日更新
修正 Buff 系统的一些问题。
修正 练功师伤害不对的问题
修正 M2逻辑越界导致玩家掉线的问题

2020年12月11日更新
修正 DBServer 报异常的问题。
增加 QFunction 玩家聊天触发 OnChatMessage(PlayObject:TPlayObject;const Message:String;var Accept:Boolean) 可进行消息过滤和特殊指令实现
新增 添加Buff系统 Buff系统文档
2020年11月04日更新
修正 TSnowWudu.Run 报错的问题。
修正 经验倍率总是显示100%
优化 客户端流畅度。

2020年10月27日更新
优化 客户端字体绘制性能 降低卡顿。
修正 Player.CustomItem 不按照顺序放入导致无法识别物品的问题。
修正 多个宝宝打怪可能只有一个宝宝有伤害的问题。
优化 套装经验加成显示到人物主界面。
优化 怪物重用不在同一地方复活。
修改 TActor.Level 修改 如果不是玩家 将不受到 M2设置的最高等级限制。
优化 保存摆摊数据导致M2卡顿。
修正 win10 1703 1709 长按鼠标右键人物无法一直跑的问题。

2020年10月20日更新
修正 会心一击抵抗、 致命一击抵抗 、 以及固定伤害抵抗 无效 的问题。
修正 Player.CustomItem 可以放入重复 makeIndex 物品导致被刷的问题。
修正 网关可能异常死亡的问题。
修正 重载脚本引擎后游戏日志不会记录的问题。
修正 摆摊提取金币 StallExtractGold 不执行的问题。
增加 版本管理器物品类型对照表 中如果第一个字符为#则表示不显示此类型说明 例如 35=#马牌 则表示 马牌这个类型在物品悬浮提示栏中不会显示类型说明。
修正 马牌持久为0的时候会显示魔力的问题。
修正 AddItemToBigStorage 调用存入nil 物品会导致引擎报错的问题。
修正 M2内存泄漏的问题。

2020年5月3日更新
修正人物血量上限不能突破21亿的问题。
修正副本地图无法刷出人形怪NPC的问题。
修正客户端自定义技能起手特效会保持最后一帧动画的问题。
修正 OnBeforeStartStall Accept := false 无法控制不允许摆摊的问题。
优化当加载量过多 微端 部分加载会被丢弃的问题。导致需要二次重开客户端。
增加 Player.MoveItemToUIContainer(UniTag,物品对象，数量) UniTag 在自定义UI可控道具元素内编辑 唯一值 不可冲突 用于脚本内放置物品到自定义物品框中。

2020年04月27日更新
修正 MonitorDamageEx 函数修改Damage后,数值正确,飘血不对.依然是原伤害飘血数值。
修正物品极品属性上限为0的问题。
老自定技能客户端渲染自定义起手动作 帧间隔时间 增加 0 表示跟随玩家动作帧率 否则为设置的帧率。
增加 GameLib.AddMonNpcEx 和 GameLib.RemoveMonNpcEx 意义同 GameLib.AddMonNpc 和 GameLib.RemoveMonNpc 变更处为 地图名称字符串 参数 地图对象 TEnvirnoment 方便在操做同名地图不会冲突(比如副本中)。
TEnvirmonet地图对象增加 MapWidth 和 MapHeight 字段 用于获取地图对象的坐标数量宽高。

2020年04月22日更新
修正上个版本因为因为优化物品流量导致物品相关属性不正常的问题。

修正 TSnowyWuDu.Run 报异常的问题。
增加 物品MakeString 在对话框显示特效。

2020年04月20日更新
修正登录器关闭 还会残留进程的问题。
自定义装备内观特效增加是否顶层绘制 用于解决设定特效在人物后面还是前面。(仅对武器和衣服有效)。
修正穿戴装备客户端等级面板显示的数据异常的问题。
修正物品数据库修改职业为0重新打开版本会被还原为99的问题。
修正武僧没有穿戴武器还会显示手中有武器的问题。
修正登录器换了文件夹启动登录器 桌面快捷方式指向的路径不会更新的问题。
优化物品流量 相比上一个版本 物品流量从 1.74K 降低为 0.3K左右。
修正怪物性能排行数据不准确的问题。
修正使用mysql 数据库 自动创建的表结构会导致引擎报错的问题。
修正AsyncHttpPost取不到返回值的问题
修正离线后基本剑术 精神力战法等被动技能技能熟练度不会增加的问题。

2020年02月20日更新
增加控制台停止服务器后 清理数据将被被重置为不勾选 防止删除数据。
修正盾牌和宝石无法脚本修改 防御和魔法防御的问题。
修正Buff图标单位配置错误的问题。
修正受到恶意攻击可能导致网关向M2发送垃圾数据导致M2假死的问题
移除控制台性能分析模式,将其移动到M2 性能分析选项中。
新增M2性能分析功能 其中包含：
1.卡顿分析：开启卡顿分析后，当M2遇到卡顿会自动生成报告文件在M2路径下。利用新增的性能报告查看工具可分析具体问题。(精确到脚本)
2.性能采样：此模式报告不会自动生成,只有当手动停止性能分析后,会生成报告文件在M2路径下.

控制台增加M2高性能模式以及普通模式 高性能模式 性能采样 和 卡顿分析将无法被使用，具有更高的性能。
修正若干小BUG优化。

2020年1月9日更新
增加远程版本服务器程序，便于集中管理 防止版本泄露。
1.启动远程版本服务器 在目录下会生成 Project 目录 将要远程发送的版本放置在这个目录下， 编辑 允许访问IP列表.txt 编辑 允许访问IP列表.txt 文件 增加IP 一行一个
2.编辑Mir200目录 Project.ini 中的FileName 字段 例如@139.126.124.222:1310/版本.m2project 期中IP替换为服务器的外网IP 以及端口。 端口可在 远程版本服务程序的配置文件RemoteM2ProjectSrv.json中修改
3.启动M2 即可。远程版本服务器分为免费版本 和 赞助版。 免费版本每次启动可以允许10次远程加载 超过则需要重启，赞助版本无限制。赞助联系QQ416246292 (影子) 本功能为影子赞助开发。
修正背包Alt点击物品触发 QFunction.AltAndLButtonClickBagItem 当物品为可叠加物品时无效的问题。
修正勋章会异常显示魔力+10的问题。
修正MessageBox 多个一起调用会导致出现多次的问题
修正部分无法行动的怪物TActor对象N S运行期变量无效的问题。 例如 触龙神 和千年树妖。
修正Player.IPLocal IP地址描述无效的问题。增加GameLib.GetIPLocal(const IP:String):String; 用于查询IP地址信息。
修正人形怪宝宝召唤的宝宝 打死怪物爆出东西 玩家无法拾取。
添加 GameLib.AsyncHttpGet(Ident:String;URL:String;TimeOut:Cardinal = 5000) 函数,用于支持httpget功能
参数说明:1.ident:请求标志,自定义数据,当httpost 完成或者错误的时候 此数据会原封不动传递到下文的OnAsyncHttpGetResult中 2.URL:远程服务器URL 3.TimeOut: 超时时间 单位秒
同时在 ManangerNpc 添加 结果触发函数 procedure OnAsyncHttpGetResult(Npc: TNormNpc; const Ident:String ; const URL:String; const Response:string ; const ErrorStr:String); 当成功或者失败会调用此函数。(异步模式 同步会导致引擎主线程逻辑卡) 参数说明: 1.Ident : 请求标志 自定义数据 2.URL:远程服务器URL 3.Response : 服务器返回的数据(失败为空字符串,如果服务器返回的就是空串就根据ErrorStr来判定成功与否) 4.ErrorStr : 成功为空字符串 失败为失败的错误描述信息。可以根据是否为空串判定是否成功
优化CustomEffect 设置新值 不会重置其他动画重新播放。
若干小BUG优化修正。

2020年1月1日跨年更新
修复CustomValue 无效。
修正 引擎启动第一次判断 Player.Wepon 会为nil 的bug。
修正上一版本爆率过高的问题。
增加TActor.CustomEffect[1..10] :Integer 自定义特效。可用于实现自定义动态称号 功能。ID 为UI设计中自定义特效ID
物品MakeIndex 从 Integer 修改为 int64 (为跨服做准备)。
物品增加CustomValue[0..10] 为自定义值 方便对物品做额外标记操作。
修正物品打孔一个孔 会显示3个孔的问题。
修正上一版本版本管理器修改套装属性报错的问题。
修正盾牌外观没有佩戴武器会不显示的问题。
修正查看他人首饰盒以及生肖装备UI修改无法保存的问题。(注意自定义UI会升级 注意备份防止出现异常问题导致UI被破坏)。
修正角色动画框 偏移X 和Y 无法修改的问题。 （创建角色界面的有一部分设置 在其父节点 “选择角色界面” 中设置)。

更新日志 - 2019年
2019年12月29日更新
优化客户端流畅度。
物品附加属性 从word 修改为 int64 。 突破65535限制。
物品宝石镶嵌孔 从3个扩充为5个。
物品的元素属性值 从word 修改为int64 突破65535限制。
物品MakeIndex 从 Integer 修改为 int64 (为跨服做准备)。
物品增加CustomValue[0..10] 为自定义值 方便对物品做额外标记操作。
TPlayObject.N 变量 数量由50个扩展为300个 TPlayObject.P 变量 数量由50个扩展为300个 TPlayObject.S 变量 数量由50个扩展为300个
套装属性值从 Word 扩充修改为 int64
增加函数 GameLib.RandomRange(const Min,Max:Int64):Int64; 用于获取一个指定范围内的随机数 和random()不一样是 random 返回的是 integer类型 这个返回的是int64。
例: A := GameLib.RandomRange(1000000000000,200000000000); 意思就是从 随机 从 1000000000000 - 200000000000中间取一个数 包含 1000000000000,200000000000

2019年12月13日更新
[修正]登录时给玩家添加任务 客户端会显示两条的问题。
[新增]QFunction 添加穿戴装备且属性变化后触发 OnAfterTakeOnItem ,与之前的OnTakeOnItem不同是 OnTakeOnItem 触发执行的时候装备附加的属性没有加到人身上。OnAfterTakeOnItem是属性已经附加到人物身上了。
函数原型
procedure OnAfterTakeOnItem(Player : TPlayObject; TakeOnItem: TUserItem; TakeOffItem : TUserItem; AItemWhere: TItemWhere);
注意当穿戴位置 原先没有装备的时候 TakeOffItem 是为nil 的 请先判断 再做操作。
[新增]QFunction 添加脱下装备且属性属性变化后触发 OnAfterTakeOnItem . 区别同上
procedure OnAfterTakeOnItem (Player : TPlayObject; TakeOffItem : TUserItem; AItemWhere: TItemWhere);
[新增]增加TActor.IsFrindlyTarget(Actor:TActor) :Boolean; 用于判断对方是否友方单位, 该结果会受到切换攻击模式的影响。
[修正]物品提示信息栏 宝石镶嵌 增加UI设置修改 是否显示宝石图标 以及 样式
[修正]完善物品提示信息栏 属性自定义
[修正]优化客户端流畅度

2019年12月8日更新
[新增]技能魔法施毒术增加配置 毒死怪物必掉物品
[新增]UI物品提示框增加 属性自定义以及 属性颜色自定义
[新增]M2-选项-参数设置 增加怪物简装 和人物简装设置。客户端内挂须为仿及时雨 盛大模式暂未支持
[新增]开发者客户端增加 实时修改预览物品提示框 和 实时预览修改 物品来源描述。达到实时修改无需重启M2 和版本管理器的功能 提升开发效率
[修正]若干小bug修正。

2019年12月3日更新
[新增]物品悬浮提示框 物品产出来源信息 支持图片和文字混排，形如
1={I=12;F=prguse.data}神来之笔{I=13;F=prguse.data}{S=攻击力+;C=123}{S=255;C=#00FFFF}{S=AABBCE;C=#FFFF00}{H=24}{M=163-165;T=200;F=Prguse.data}
这类混排指令已被支持。
[修正]自定义BUFF 时间和BUFF图标时间显示不对的问题
[新增]增加网络数据包性能分析报告 将在MIR200下生成91NetMessage*.csv 用于分析流量负载情况

[修正]逐日剑法伤害失效的问题
[新增]自定义技能施法动作增加无动作类型
修正 致命额外伤害 <$PUNCHITAPPENDDAMAGE> 客户端标签显示数值异常
注意 此版本修改了协议封包 必须客户端和服务端同时更新 否则会导致行走卡住

2019年11月25日更新
[新增]GameLib 增加
QueryPerformanceFrequency 获取CPU每秒震荡次数
QueryPerformanceCounter 获取获取当前震荡总数 (两次震荡总数 相减 就是两次间隔的CPU震荡次数)
用于获取超高精度的时间计算。可用于精确到纳秒的计时器 可以用于脚本中做性能测试分析。具体使用可以百度 QueryPerformanceCounter 以及 QueryPerformanceFrequency
[修正]M2重启游戏网关不会重新连接上来的问题
[新增]版本管理器刷怪配置增加 重复使用怪物模式,此模式下 怪物死亡后会立即 重新刷新。保证在一些升级地图 玩家始终有怪可打。
[优化]M2性能 略微提升版本管理器编译效率

2019年11月22日更新
[新增]控制台增加性能测试模式 开启后可对M2程序以及脚本中的代码进行性能分析,将会在程序关闭的时候生成报告。(无需关闭控制台只需停止M2) Mir200目录下生成 91Prof.csv(程序性能分析) 91PorfScript.csv(脚本性能分析) RunGate 下也会生成性能报告 。(生成的csv 可用excel 直接打开 )
性能分析 将会轻微降低M2性能 约5%性能下降 脚本性能将下降15%左右
[新增]压力测试工具公布 (使用需要M2开启 GM权限 并且控制台开启压力测试 并且网络密码必须为空 )
以及压力测试工具需要使用以下GM命令 如果命令名称不对请自行修改
@Superman 无敌
@Level 调整等级
@MoveMap 随机地图移动
@trainingSkill 学习技能
[新增]版本管理器批量导出资源增加跳过空图片选项。
[新增]物品特殊属性脚本化。

2019年11月15日更新
[修正]网关增加用户Socket用户断线原因日志
[修正]副本释放可能导致玩家掉线的问题
[修正]创建角色使用内存类工具修改创建角色名长度可以导致挂机以及在线两个同名角色的问题[严重]

2019年10月21日更新
[修正]角色顶号会导致数据库报错的问题
[修正]人形怪无 S 以及 N 运行期变量无效的问题。
[新增]M2 选项-参数设置-城堡参数 增加是否允许飞行魔法攻击城墙的设置
[修正]上一版本人物大退实际没有离线的问题。
[修正]摆摊礼券收益 无法从摊位取回的问题。

2019年10月19日更新
[修正]禁止穿人的模式下 穿过死亡怪物或者玩家会被弹回的问题。
[修正]摆摊上架礼券有时候会无法编辑的问题。
[新增]GameLib.GetGuildCount() 获取服务器上总共的行会数量。
[新增]GameLib.GetGuildByIndex() 获取具体的行会对象。配合和 GameLib.GetGuildCount() 共同使用 例如
//遍历获取服务器上的所有行会
for i = 0 to GameLib.GetGuildCount() - 1 do
begin
Guild = GameLib.GetGuildByIndex(i)
end
[新增]顶戴静态称号增加 xy偏移调整Player.TitleName={I=1;X=5;Y=10}
[修正]游戏网关玩家下线还能在在线列表看到的问题

2019年10月14日更新
[修正]接取任务(AddMissionLink)会导致任务人物数据不保存的问题
[修正]开启生肖以及首饰盒功能 设置不会被保存的问题。
[修正]聚灵珠在商城看到是满的 实际买到是空的的问题。
[修正]自动挂机 战士攻击特效异常的问题。
[优化]客户端字体绘制性能, 修正因为字体内存泄漏导致客户端会白屏的问题。
[修正]网关防攻击功能无法关闭导致误封无法解除的问题。
2019年9月26日更新
[修正]上一版本合区后修改分区数据名字无效的问题
[新增]添加 GameLib.AsyncHttpPostJson(Ident:String;URL:String;Json:String;TimeOut:Cardinal = 5000) 函数,用于支持http提交json功能。

参数说明:
ident:请求标志 自定义数据 这个当httpost 完成或者错误的时候 此数据会原封不动传递到下文的OnAsyncHttpPostResult 中
URL:远程服务器URL
Json : 要提交的json字符串内容。
TimeOut: 超时时间 单位秒。

同时在 ManangerNpc 添加 结果触发函数
procedure OnAsyncHttpPostResult(Npc: TNormNpc; const Ident:String ;const URL:String; const Response:string ;const ErrorStr:String);
当成功或者失败会调用此函数。(异步模式 同步会导致引擎主线程逻辑卡)

参数说明
Ident : 请求标志 自定义数据
URL:远程服务器URL
Response : 服务器返回的数据(失败 为 空字符串,但是服务器如果返回的就是空串那要根据 ErrorStr来判定成功与否)
ErrorStr : 成功为空字符串 失败为失败的错误描述信息。可以根据是否为空串判定是否成功
[修正]物品事件触发为拾取时修改物品属性无效的问题。
[新增]摆摊增加礼券货币。对应的摆摊回调触发函数新添加有GamePoint 函数。 请根据M2报错信息 修改 触发函数声明。(注意更新91自带素材补丁)
[新增]控制台增加 是否开启异常守护者(不开启的话可以嵌入程序到控制台,开启并且同时嵌入控制台会导致无响应)
[修正]上一版网关不稳定的问题。
[修正]武僧天雷阵MP不足不会失效的问题

2019年9月2日更新
[新增] TActor.TitleEffect 使怪物也可以头顶上有动态称号。
[修正]十二生肖物品指定了穿戴位置 会导致穿戴不上去的问题。
[修正]交易物品UI 修改 支持自己名字和金币位置自定义。
[修正]数据库设置了物品幸运 脚本中获取依旧为0的问题。
[修正]盾牌自定义特效在装备内观中不显示的问题
[修正]合区工具没有重复角色名依旧会被识别为重复并且加上1的问题。
[修正]备份功能不会备份非UTF8编码TXT文件的问题。
[修正]GameLib.ReNamePlayer修改玩家名称函数在DBServer 开启了非法字符过滤 会总是更名失败的问题。
[新增]登录器列表编辑器增加复制插入功能。
[优化]游戏网关性能优化。
[新增]地图预览增加导出小地图图片功能。
[修正]数据库导入json不管选什么都会导入到物品数据库的问题。
注意此版本将 摆摊 全局仓库(GameLib.SaveItemToStore) 以及任务数据从二进制修改为了sqlite数据库 这些数据将被丢弃。 有玩家数据的请不要更新到此版本. 新区可以。

2019年8月16日更新
[新增]日志查看增加目标NPC字段过滤配置。
[修正]开发者客户端保存过UI到其他目录 会导致 地图以及声音无法读取的问题。
[优化]M2内存占用 降低怪物内存占用,(优化前 5W怪物占用内存1G,优化后20W怪物占用内存1G)
[修正]自定义技能使用功能网关会报错的问题。
[修正]部分地图寻路路径会有问题的bug
[修正]导入EXCEL数据物品会被清空的问题。
[新增]物品DropEff属性，属性值为Word，取DropEff.data文件中每10个图片为一组,显示为地面掉落特效 从1开始 0为无特效。
[修正]若干内存访问BUG

2019年8月3日更新
[修正]一个一个技能会导致报错的问题。
[优化]优化合区工具合并自定义物品名称耗时很久的问题(效率提升1000倍以上,原来合并一个小时 优化后只需要 2秒)
[修正]脚本图片{F}增加可以支持目录结构如{I=55;F= Interface.Data}可修改为:{I=55;F=$Data/Interface.Data} 因为 反斜杠被\识别为换行 所以F支持正斜杠/表示路径分割
[修正]微端当图片切割部分有空图片会导致该部分所有图片不进行下载的问题，
以及修正微端当91Resource目录下有和盛大目录下相同文件名 导致微端冲突不下载该文件的问题。(需要重新生成登录器 以及更新客户端91Client.dat 微端资源文件 不需要,不需要,不需要 重新构建 )
[新增]开放自定义游戏启动 LOGO 使用方法 放一张图片名为 91Logo.png放在客户端目录下即可。（建议 搭配登录器强制释放资源 使用）
[修正]TActor.SearchViewRange 异常的问题。
[优化]日志服务器SQL插入优化 改为批量INSERT INTO 降低数据库IO 提高性能。

2019年8月1日更新
[修正]上一版本玩家大退不会大退的问题(修正两次小退触发导致的问题)
[新增]游戏网关增加连接攻击设置 在设定时间内 同IP 建立连接超过指定次数将被识别为攻击。

2019年7月31日更新
[修正]上一个版本DBServer 报错的问题
[新增]版本管理器 资源编辑器 删除图片增加 [空图片微端标记] 模式 . 旨在提供细化到单张图片的微端资源控制 ，以便减少微端客户端的体积。
使用场景,举例说明
在使用微端功能的时候,挑选一部分资源文件打包成一个最小微端客户端,提供给玩家。其中有些图片是可以进行优化到 运行中下载的比如：
Prguse.data 图片中有 300张图片,只有序号0-100是希望集成在最小微端客户端中的。
序号101-299 希望在运行中下载的。 这个时候我们使用这个功能将序号101-299的图片用 [空图片微端标记]删除模式 将其删除,即可。
通过这个功能,可大幅度的优化最小微端客户端体积。 我把一个微端客户端从 100M 优化为了20M 。进行更细化的控制优化到10M以内是没有问题的。
注意:这个删除模式不能用于普通图片编辑.就是说你不能用他来编辑资源文件 后又 用微端资源生成器生成。这个功能是删除图片并且标记 这张图片数据在运行期通过微端获取。
[新增]版本管理器 数据库增加导入导出到Excel 方便使用Excel 对数据库进行编辑后 再导入到数据库。
[修正]离线挂机会触发两次 QManager.PlayerReconnection 会执行两次的问题。
[新增]微端资源构建器增加支持iis mime . web.config 增加对应的mime类型描述信息。
[修正]远程版本管理不能使用的问题
[修正]一个导入版本会报错失败的问题。

PS.发现严重的脚本BUG,且修复工程量大,暂时不会修正 请按 下文规避。

当脚本中产生异常的时候全局变量 String 类型会被重置为空值
例:
var
GlobalS : String = ‘元宝’
发生异常时候 GlobalS 会被修改为 空值
建议String 不需要改变的 使用
const
GlobalS : String = ‘元宝’
这样不会被改变。
2.TObject类型如果被赋值有初值则会被初值
例:
var
GlobalList : TStringList = nil;
然后再其他地方
GlobalList := TStringList.Create;
发生异常 GlobalList 会被 重新赋值为nil
建议修改为:
var
GlobalList : TStringList;
然后再其他地方
GlobalList := TStringList.Create;
对于全局String 数组 请用 TStringList进行替代。
2019年7月27日更新
[修正]OutWay会被识别为未知途径的问题。
[新增]增加GameLib.ReloadScriptEngine 可以在脚本中重载脚本引擎
[修正]一些M2稳定性更新。

2019年7月25日更新
[修正]勋章不显示 刺书 箭术 武术的问题。
[修正]OutWay 超过255会被阶段为255以下的问题(需要同步更新客户端)
[修正]脚本刷怪 伤害触发不生效的问题
[修正]TPlayObject.AddItemToStroage 会报错的问题。
[修改]物品产出来源修改为默认不显示划分横线 如果要显示那么可以在标题文本中设置为类似的划分: {line}\产出来源

2019年7月22日更新
[修正]仓库存取日志不正常的问题,修改为:普通仓库日志 为 存仓 取仓 无限仓库为 无限仓库存仓 无限仓库取仓。
[新增]装备TIPS 增加 是否显示产出途径 标题配置。
[修正]套装属性攻击倍数增加属性错误以及魔法倍数 和道术倍数无效的问题。
[修正]套装客户端TIP显示部分属性排版不一致的问题。
[修正] Npc.GiveItem 会报错的问题。

2019年7月20日更新
[修正]摆摊元宝溢出导致杯被刷的问题。
[新增]登录日志增加玩家IP
[新增]控制台增加封机器码功能。
[新增]脚本中添加元宝以及给与物品增加记录相应的函数和行号 方便追溯物品的给与。
[修正]版本管理器修改地图标志 会报错的问题。
[修正]邮件功能异常的问题。(需要更新客户端)
[修正]M2修改在线人物货币无效的问题。

2019年7月15日更新
[修正]M2 监视怪物NPC刷新会报异常的问题。
[修正]修改版本管理器版本加密方式,防止用泄漏的91代码可以绕过加密破解版本的问题。

2019年7月14日更新
[重要]因自定义UI中的脚本按钮有安全隐患可以让玩家不经过任何限制执行服务器的脚本函数导致M2崩溃，故将原来脚本按钮中的调用QM脚本函数。
修改为调用固定函数，当脚本按钮被点击 将不在允许调用任意函数，新的方式会执行QManagerNPC 中的 OnScriptButton 函数中。 Flag参数 为 脚本按钮中 设置的 的标志字段。
函数原型：

procedure OnScriptButton(Npc:TNormNpc;Player : TPlayObject ;const Flag:String);

举例说明:

procedure OnScriptButton(Npc:TNormNpc;Player : TPlayObject ;const Flag:String);
begin
Player.SendMessage(‘你点击了脚本按钮, 按钮标志:’ + Flag);
end;
[新增]增加脚本安全性 防止因为异常导致M2崩溃。

2019年7月3日更新
[修正]日志服务器记录日志错误的问题。(日志重复并且丢失)
[修正]脚本中使用 Exit 退出函数会导致异常的问题。
[新增]开放自动打怪 ctrl + z
[修正]OutWay Value 没有被 替换格式化为OutWay2 对应的值的问题。 (UserItem.OutWay[i] 中对应的字符串包含 Value 时候 将被替换为 UserItem.OutWay2[i] 中的值,此功能可以做一些物品自定义描述,例如附加属性说明等)
[新增]UserItem.OutWay 描述增加支持 {Line} 控制符 例如在物品来源描述表中 配置 1= {Line}\分割横线测试。 当UserItem.OutWay = 1 时候 客户端将会显示一条分割的横线 和 一行 分割横线测试。
[修正]地图配置中设置自动扣减元宝 不管设置多少值 始终只扣减1元宝的问题

2019年6月27日更新
[新增]ManagerNpc 增加 脚本引擎 启动以及销毁 触发 可用于引擎在启动 或者重载时候 进行一次性或者需要数据持久化的操作。（应当避免在脚本中 使用 finalization initialization 引擎对这类用法的支持有bug）

//当脚本引擎启动时 isReload 表示是否重载脚本
procedure OnScriptEngineInit(isReload:Boolean);
//当脚本引擎销毁时 isReload 表示是否重载脚本
procedure OnScriptEngineFinal(isReload:Boolean);
例如：
procedure OnScriptEngineInit(isReload:Boolean);
begin
if isReload then
begin
Debug(‘OnScriptEngineInit 重载’);
end else begin
Debug(‘OnScriptEngineInit 启动’);
end;

//从硬盘加载数据
end;

procedure OnScriptEngineFinal(isReload:Boolean);
begin
if isReload then
begin
Debug(‘OnScriptEngineFinal 重载’);
end else begin
Debug(‘OnScriptEngineInit 关闭’);
end;

2019年6月26日更新
[新增]增加 function GameLib.MobPlaceEX (const AEnvir : TEnvirnoment; AMissionX, AMissionY: Integer; const AMonName: String; AX, AY: Integer; ACount: Integer=1; ARange: Integer= 0; ACamp: Byte= 0; ANation: Byte = 0; ATag: Integer = 0; ARevivalEvent: Boolean = 0; ADieEvent: Boolean = 0; AKillerEvent: Boolean = 0; ADamageEvent: Boolean = 0):TActorList;
在指定的地图上刷怪，AEnvir 所在地图对象：TEnvirnoment；并且向AMissionX、AMissionY坐标集中，AMissionX 刷新后自动前往集中坐标X；AMissionY 刷新后自动前往集中坐标Y；AX, AY 刷新坐标X,Y；其他参数与Mongen一样
[新增]增加 functionGameLib. MonGenEX (const AEnvir :TEnvirnoment;const AMonName: String; AMonCount, AMapX, AMapY, ARange: Integer; ACamp: Byte=0; ANation: Byte=0; ATag: Integer = 0; ARevivalEvent: Boolean = 0; ADieEvent: Boolean = 0; AKillerEvent: Boolean = 0; ADamageEvent: Boolean = 0):TActorList
在指定的地图上刷怪。AEnvir 所在地图对象：TEnvirnoment；AMonName 怪物名称；AMonCount, 刷怪数量；AMapX, AMapY, ARange 刷怪的坐标X ,坐标Y, 刷怪范围；ACamp 阵营ID；ANation 国家ID ；ATag 怪物标记；ARevivalEvent 是否 刷新触发；ADieEvent 是否 死亡触发；AKillerEvent 是否 杀人触发；ADamageEvent 是否 受到伤害触发；
[新增]GameLib.MobPlace 和 GameLib.MonGen 增加 ADamageEvent 是否 受到伤害触发
[修正]一个会导致游戏网关卡死未响应的问题。

2019年6月24日更新
[新增]UseItem.outway修改为 array [0..15] of word，取物品自定义备注对照表中的对应数值文字
增加 outway2 = array [0..15]of integer； outway2[0..15]的值必须在物品自定义备注对照表中添加关键字Value才会显示。
举例说明item.outway[0]:=100; 对照表中此处文字为.100= {S=神力附体 HP+：Value;c=251}; 则客户端会自动解析outway2[0]的值替换Value这一关键字给客户端显示 。
如果版本管理器提示OutWay 编译错误 请将UserItem.OutWay 修改为UserItem.OutWay[0]
[修正]绑定绑定物品可以被摊位收购 出售的问题。
[修正]合区GuildList.txt 行会列表行会名称会被添加两次的问题。以及行会变量没有被复制到主区的问题。
[修正]网关会断开客户端连接的问题(需要同步更新客户端内核)

2019年6月22日更新
[修正]游戏流量过大封包无法发送到客户端的问题.(表现为一些版本的可视化仓库无法打开)
[修正]客户端发送封包可能异常的问题。
[优化]将游戏网关启动后增加到M2异常守护者列表 用于监视游戏网关是否异常(依赖RunGate.map)

2019年6月21日更新
[修正]重写网关后游戏速度调整失效的问题。
[修正]MonitorDamageEx 不能识别自定义技能ID的问题
[修正]使用瞬回药物血量和蓝量不会立即更新的问题。

2019年6月20日更新
[修正]登录器释放附加资源有时候会无效的问题。
[修正]M2一处会导致卡死的问题。
[修正]上一版本扣减元宝实际扣减的是金币的问题。
[修正]游戏网关性能优化。

2019年6月19日更新
[修正]合区工具 账号本身达到10位 账号冲突会把老区账号多加一位变成11位 导致不能登录的问题
[修正]利用删除人物 再恢复 恢复的时候是从数据库调取人物数据 这样可以导致刷货币 的bug
[修正]M2稳定性增强
[修正]因为改封包导致登录器无法注册的问题。
[修正]RunGate 的一些小BUG
[重构]重构货币系统以及日志,加上日志消耗的所有可能的渠道,不再建议直接操作TPlayObject.Gold 和 GameGold 以及 GamePoint 等货币类型对象直接修改货币值 未来 这些字段将被移除《点击查看示例 》。
货币类型：
GAME_MONEY_TYPE_GOLD = 1; //金币
GAME_MONEY_TYPE_GAMEGOLD = 2; //元宝
GAME_MONEY_TYPE_GAMEPOINT = 3; //游戏点
GAME_MONEY_TYPE_GAME_GIRD = 4; //灵符
GAME_MONEY_TYPE_DIAMOND = 5; //金刚石
TPlayObject 增加 货币扣减以及检查函数
1.function TPlayObject.GetGameMoney(Type:Byte):Cardinal; //获取对应货币的数量
2.procedure TPlayObject.SetGameMoney(Type:Byte;Value:Cardinal;const Log:String); //设置货币的数量。 Log 为日志描述
3.function TPlayObject.CanTakeGameMoney(Type:Byte;Value:Cardinal):Boolean; //是否可以扣减玩家对应数量的货币 Value 为需要增加货币的数量
4.function TPlayObject.CanAddGameMoney(Type:Byte;Value:Cardinal):Boolean; //是否可以给玩家增加货币 Value 为需要增加的货币数量
5.function TPlayObject.AddGameMoney(Type:Byte;Value:Cardinal; const Log:String):Boolean; //给玩家增加 对应数量的货币 Log 为日志描述 成功则为返回True 失败返回False;
6.function TPlayObject.TakeGameMoney(Type:Byte;Value:Cardinal;const Log:String):Boolean; //扣除玩家对应数量的货币 成功返回True 失败返回False;
示例:

procedure CanTake(Npc: TNormNpc; Player: TPlayObject; Args: TArgs);
begin
if Player.CanTakeGameMoney(1,100000000) then
Player.SendMessage(‘可以拿走’)
else
Player.SendMessage(‘不可以拿走’);
end;

procedure CanAdd(Npc: TNormNpc; Player: TPlayObject; Args: TArgs);
begin
if Player.CanAddGameMoney(1,100000000) then
Player.SendMessage(‘可以给’)
else
Player.SendMessage(‘不可给’);
end;
procedure Take(Npc: TNormNpc; Player: TPlayObject; Args: TArgs);
begin
if Player.TakeGameMoney(1,100000000,’流浪汉拿走’) then
Player.SendMessage(‘扣除成功’)
else
Player.SendMessage(‘扣除失败’);
end;
procedure Add(Npc: TNormNpc; Player: TPlayObject; Args: TArgs);
begin
if Player.AddGameMoney(1,100000000,’流浪汉给与’) then
Player.SendMessage(‘给与成功’)
else
Player.SendMessage(‘给与失败’);
end;

2019年6月14日更新
[修正]TActor.Exp 增加可写 方便动态修改怪物经验 (仅支持非玩家对象 TPlayObject.Exp 修改了也不会有效果的)
[修正]ManagerNpc.MonitorDamageEx 冰咆哮 爆裂火焰 火龙气焰 技能ID 识别错误的问题
[修正]M2关闭 游戏网关不会断开客户端链接的问题。
[新增]QFunctionNPC新增OnSendHotKey函数，用来做自定义热键触发。

procedure OnSendHotKey(Npc: TNormNpc; Player: TPlayObject; Akey:Byte; KeyCtrl,KeyAlt: Boolean; ATargetActor:TActor; X,Y:Integer);
Akey的值代表按下的按键字符值
KeyCtrl，KeyAlt 代表 Ctrl，Alt按键的状态 False为没有按下 True为按下。
ATargetActor代表客户端鼠标指向的TActor，X,Y代表TActor所在位置坐标，如果TActor为nil，则X,Y代表客户端鼠标指向的坐标。
[新增]QFunctionNpc新增PlayerAction函数，可以用来脚本封挂。Accept值为True 则执行动作，反之则不执行。默认为True。

procedure PlayerAction(Npc: TNormNpc; Player: TPlayObject; Action :Byte; var Accept: Boolean);
Action值代表不同的动作：
1 攻击
2 魔法
3 骑马跑动
4 跑动
5 走路
6 转向
7 挖肉
8 点击脚本

2019年6月13日更新
[新增]支持最新盛趣传奇归来客户端
[变更]重新编写跨平台游戏网关, 修改通讯封包。
[修正]M2稳定性增强 , 修正若干可能造成引擎异常的BUG
[修正]DBServer会异常卡死的问题。
[修正]刺客武器没有带武器外观特效不能单独生效的问题。
[新增]增加压力测试模式，使用压力测试工具可测试引擎的承载量和稳定性(压力测试工具 未完善暂不发布,压力测试模式将 跳过所有的反攻击措施)
[修正]M2内存增强支持使用到4G的内存。
[修正]同一个账号可以同时登录的bug

2019年5月27日更新
[修正]几个会导致玩家游戏中掉线的bug
[修正]客户端毒符持久显示不正确的bug

2019年5月26日更新
[修正]客户端 毒符 不显示持久的问题
[修正]技能编辑器无法打开的问题
[修正]一个会导致玩家挂机掉线的异常
[变更]网上有人恶意用泄漏的91代码增加了一个提权后门 版本号为 20180222 重新修改登录器加密方式 不再支持老版本的91Client.dat

2019年5月25日更新
[修正]M2发送数据到网关会访问非法内存的问题。
[修正]客户端不会显示持久和重量的问题。
[修正]改进引擎一些底层函数 性能提升 10%以上。

2019年5月24日更新
[修正]重新调整怪物 处理方式 , 尝试修正因刷怪导致的死M2.
2019年5月23日更新
[修正]因为VMP加壳导致的客户端在部分机器上非常卡的问题。
[修正]控制台正常关闭程序再开启不会注入调试M2的问题。

2019年5月21日更新
[修正]勾选清理尸体 会导致死亡的名字在屏幕上固定位置的问题。
[修正]检测扣除金币 实际检测的是元宝数量的问题。(此问题导致检测错误 实际消耗了金币 但是没有扣除的可能 当元宝数量等于需要扣除的金币数量的时候)
[新增]控制台增加M2异常守护者功能。可以监测M2 所有的线程状态以及异常堆栈 依赖 M2Server.map文件。
[修正]所有的服务端程序不再加壳,方便查错 (客户端程序 依旧加壳)

更新日志 - 2017年
如何下载更新

关于自定义Buff不可以移动的问题,自定义Buff可以在设计器显示位置,暂不支持自定义位置
M标签有改变，XY用来调节显示位置，OX和OY用来按钮图片显示位置，使用了资源偏移

09月06号
1.修正摆摊和自由市场可以金币和元宝溢出导致可以刷金币元宝的问题。
2.封掉市面上可以修改网络封包的工具。例如wpe.
3.9宫格组件增加“可拉伸位置”属性 例如聊天框九宫格 勾选顶部 为true 后可 动态拉动顶部调节聊天框大小。
4.修正自定义技能编辑器CD无效的问题。
5.十二生肖物品 增加source 1-12表示对应装备的生肖物品格子 0 表示无限制。
6.物品增加标志，可放入首饰盒。
7.修正摆摊物品包含回购物品 导致部分物品元宝显示不正确的问题。

ManagerNpc增加监视怪物受攻击触发函数 procedure MonitorDamageEx（Npc: TNormNpc; Actor, ADamageSource: TActor; const Tag,MagicID,Level:Integer; var Damage: Integer);
此触发函数 为 procedure MonitorDamage 的增强版本 会优先于 MonitorDamage执行。
增加了技能ID 和技能等级 以及 伤害可以在脚本内修改的功能。
参数说明:
NPC :指向QManagerNPC 的对象。
Actor : 受攻击者.
ADamageSource: 攻击者，
Tag：标志值
MagicID:魔法ID,
Level:魔法等级
Damage:伤害值(修改此值即可改变本次伤害的数值 ， 小<= 0 表示此次攻击无效，>= 0 则表示正常伤害。)
增加客户端 角色 血条 以及名字偏移坐标。方便更换模型的游戏调整血条位置。
10.ManagerNPC 增加 MonitorDamage 、MonitorDamageEx 、MonitorDie 等函数支持普通玩家。意味着原来监视怪物行为的触发 同样可以监视到玩家以及玩家的宝宝 并且玩家是一定会触发的。
11.修正道士技能召唤类设置怪物名字 以及召唤等级保存可能不生效的问题。
12.开发者客户端增加客户端设置 加入 血条 以及 名字XY 偏移调整 此设置将会集成到UI设置内。
13.修正刀刀刺杀 和 隔位刺杀的一些问题。
14.增加TActor.DamageDelay 作为扩展 TActor.Damage 增加延迟功能。
15.因TJSONArray.Add() 函数提供的重载String Integer Double等数据类型的自动判定不稳定。所以 TJSONArray 增加 AddDouble AddInteger AddString 等函数对不同数据类型的。建议不要在使用TJSONArray.add函数 都使用指定类型的函数。
06月29号
1.修正客户端使用技能书取消后，第二次使用技能书 显示技能名称为空的问题。
2.套装属性增加 “HP上限万分比”,和 “MP上限万分比”。属性的配置，例如 配置 1则表示增加 0.01%的HP 100则表示增加 1%。
3.修正 Actor.TitleEffect 设置的头顶特效会上下跳动的问题。
4.修正技能编辑器 “添加地图伤害事件” 绑定了特效激活 会造成伤害两次的问题。
5.修正MagicAttack NPC 以及怪物使用 新技能 可能出现特效不显示的问题。
6.M2版本管理器 对版本增加导入导出功能。可单独将所有配置 导出到JSON格式的配置 进行文本编辑后 重新导入到版本内(方便策划使用excel 进行拉表生成对应配置)。
使用方式:在对应节点（例如 套装 ） 点击右键 选择导出 即可。 修改完毕 同样 右键点击导入即可。
因为JSON需要由对应的格式才可解析 推荐到 http://www.bejson.com/

使用在线功能对json 的合法性检测。 以及 构建JSON 树形视图，进行友好性阅读。

06月18号
1.地图商人NPC 入口函数配置 支持函数参数如： Main(112,118,222) 。
2.修正 TPlayObject.ClearSkill 函数重复使用会有异常的问题。
3.修正小地图 不同大小下会出现偏移的问题。
4.增加技能攻击函数：
TActor.MagicAttack(ATarget:TActor;X,Y,MagicID,Level,Group:Integer);
ATarget： 要攻击的目标
X，Y 目标坐标。
MagicID 技能ID
Level：技能等级
Group:技能的作用分组
支持10000以上的技能ID
同事对于原来的MagicAttack 和 SelectMagic 都支持新的技能编辑器编辑的技能。
5.封CE 等一类内存搜索加速攻击外挂。
6.新技能编辑器 增加 添加地图伤害事件 以及拾取物品 等作用。 用于实现基于坐标点的技能(火墙。流星火雨)
7.修正备份文件 还原报错的问题。
8.修正自定义怪物NPC 无效的问题 (需要用新的版本管理器重新打开 版本 再保存)
9.新支持部分其他引擎工具生成的地图文件。
10.若干小问题修复。

05月22号
1.修正登录器在关闭时候会报RunTime Error的问题
2.修正物品穿戴条件转升等级在穿戴后 还是显示红色字体的问题。
3.客户端变量标签增加 <$RELEVEL> 表示人物当前的转生等级
4.新技能编辑若干问题修复 (thk:ゞoο陈年佳酿(???猫总) 测试反馈以及帮助)
5.修正上一版本 绑定外网端口没有绑定广播IP地址 和端口的问题

04月18号

1.修正登录器在关闭时候会报RunTime Error的问题
2.修正物品穿戴条件转升等级在穿戴后 还是显示红色字体的问题。
3.客户端变量标签增加 <$RELEVEL> 表示人物当前的转生等级
4.新技能编辑若干问题修复
5.修正上一版本 绑定外网端口没有绑定广播IP地址 和端口的问题

04月17号
1.修正老传奇默认界面 女道士 法师 未选中状态 绘制位置不正确。
2.修正TUserItem.MakeString 的物品在一个NPC对话 只能显示30个物品的问题。
3.修正自定义物品摆摊后购买会恢复到原来的名字的问题。以及QFunction.StallBuyItem在购买摊位物品 不触发的问题。
4.修正登录器关闭后还有有残余进城 导致新登录器无法打开的问题。
5.修正锁定客户端后客户端还能使用物品 以及受到伤害的问题。
6.修正瞬回药品不受喝药时间控制的问题。
7.TPlayObject.Exp ,MaxExp.字段修改为Int64类型 ,增加TPlayObject.MaxExp 为可写 (仅本次在线)

QFunctionNPC 增加 procedure OnGetLevelExp(Level:Integer;var Exp:Int64); 用于获取每个等级的经验配置数据。此函数由引擎在人物需要改变人物升级经验时引擎触发。
如 以下示例 将所有等级的升级经验 设置为引擎配置的120%
procedure OnGetLevelExp(Level:Integer; var Exp:Int64);
begin
Exp := Trunc(Exp 1.2);
end;
再如:以下1000级以前的经验 以引擎配置配置 1000级以上的经验 采用 等级 10000的公式进行计算
procedure OnGetLevelExp(Level:Integer; var Exp:Int64);
begin
if Level >= 1000 then
begin
Exp := Level * 10000；
end;
end;
9.修正半月弯刀 以及 刺杀 会在上限时候主动打开的问题。
04月16号
1.修正打怪爆落物品 下线再上线无法拾取的问题。
2.修正TPlayObject.Kick() 踢下线 实际还能缓慢操作的问题。
3.修正广播物品鼠标直接移上去就会显示物品 而不是点击再显示的bug.
4.微端修正会重复下载的问题。修正微端内存泄露的问题。使用内存共享 改进微端加载速度。修正会市面上各类云盾冲突的问题。
5.修正刺杀 和 半月 没有MP后还会打出假象的问题。
6.修正聊天框位置 点选不对的问题。 修正UI鼠标穿透 对底部状态栏 会产生一些BUG的问题。
7.修正登录器Data加密资源密码无效的问题。
注意:如果资源路径为 D:\热血传奇\91Resource\Data\Prguse.data 密码为123456 那么在登录器密码配置内的文件路径必须为91Resource\Data\Prguse.data 否则无效。资源将不能读取。
同样 如果 ：D:\热血传奇\Data\ChrSel.data 下 则应该配置路径为: Data\ChrSel.data
8.修正登录器附加资源文件 强制替换无效的问题。以及释放附加文件报错的问题。
9.修正功能设置-技能魔法 是否启用毒符 道士技能毒符免穿戴 4个选项重启还原,人形怪控免毒符制无效.
10.修正人形怪物道士有时候只会放施毒术的问题。
11.修正 M2管理-行会管理-数据重启后还原的问题。
12.修正大地图界面坐标可能不正确的问题。
13.修正肉 和 矿石 品质越高 价格越低的问题。
14.修正微端资源构建器 在文件占用会被卡死的问题。以及在阿里云CDN因为名字大小写导致的无法读取问题
15.修正M2在某些异常情况下可能卡死的问题。
16.完美自定义技能编辑器功能

03月28号
1.修正客户端会崩溃的问题
2.修正选择角色界面解冻光圈乱显示的问题。
3.修正物品来源标题错误的问题。
4.修正微端关闭了还会请求微端版本的问题。
5.修正从0222升级会丢失玩家数据的问题。

03月26号
特别注意：本版本物品进行了升级。 对于有 角色数据的服务器。先备份角色数据 再升级到后测试一下 仓库 摆摊 等功能以及玩家数据是否有错乱 再 决定是否更新。如果出现数据错误 请联系管理 反馈。将以最快速度发布补丁。
91微端生产的*.91ver文件 需要支持MIME类型 后戳:91ver 类型:application/octet-stream

1.修正顶戴花翎在人物移动会消失的问题。
2.修正人物内观在他人查看特效有黑边的问题。
3.修正直接关闭游戏不会执行下线触发的问题。
4.优化客户端内存占用。
5.物品数据库增加物品配置 是否可以放入客户端快捷栏内(stdmode 0-3的是一定可以放入快捷栏的 目前无法改变,考虑到数据兼容的问题，后面几个版本将会可以设置0-4物品是否可以进入物品快捷栏) 同时 在脚本内
可以通过 TUserItem.CanInQuickBar ：= True 以及 False 来动态修改物品是否可以放入快捷栏。
6.对于慢回药品 数据库 AC2 和 MAC2 表示 药物一次增加HP/MP 的值 如果此值为 0 那默认由引擎计算 （等级 /10 + 5）.回复间隔 暂时不可调整 由引擎计算 公式为 :600 - 等级 * 10 （ 毫秒） 最小值为200毫秒。 7.声音未见支持 MP3OGG格式的智能判定
优先读取顺序为: OGG>MP3>WAV. 例如 wav文件加下有 long.wav 和 long.ogg。 那么引擎播放的时候优先使用long.ogg。在音频文件采样率一致的情况下文件大小WAV>MP3>OGG
8.修正M2设置 麻痹可行走 麻痹可攻击 等麻痹状态控制无效的问题。
9.修正烈火剑法召唤时不耗蓝 砍出烈火时候耗蓝的问题。
10.修正商铺购买物品设置了绑定 但是不生效的问题。
11.修正选择角色界面UI角色动画框 文件改变不保存的问题。
12.改进带透明通道的wzl颜色读取。(hum8.wzl 衣服读取花屏问题)

TUserItem 增加物品来源 字段设置功能。通过TUserItem.CustomCaption[0] TUserItem.CustomText[0] 总共支持3组设置 0-2
例如 ：
TUserItem.CustomCaption[0] := '掉落怪物' TUserItem.CustomText[0] := '白野猪';
TUserItem.CustomCaption[1] := '击杀者' TUserItem.CustomText[1] := '王八蛋';
TUserItem.CustomCaption[2] := '掉落地图' TUserItem.CustomText[2] := '猪洞7层';
TUserItem.FromDateTime := Now(); //产生时间。
需要在客户端物品提示界面打开物品来源显示。
14.全新微端,抛弃旧微端,全新微端支持CDN、切片、独立资源读取,具体使用请查看录像教程。
02月22号
1.修正穿戴勋章会导致人物衣服自带的翅膀消失的问题
2.修正上一版本自定义外观特效不显示的问题
3.修正QFunctionNPC 给予的玩家物品 日志不会记录会出现错乱的问题。
4.修正查看他人装备特效 为背包特效 的问题 以及 自身特效位置不对的问题。
5.修正客户端被其他引擎恶意劫持后打开客户端黑屏的问题。
6.地图相关 Objects tiles SmTiles 序号优化支持到最高255。
7.TUserItem.AniCount 修改增加 可写。
8.修正人物名称使用着色语法无效的问题。
9.修正人物特效不透明的问题。
10.修正版本管理器自定义内观 和背包特效 帧数为0时会一直报错 无法关闭的问题。
11.增加Stdmode = 71可叠加功能物品 和 其他配置和 31类物品一样。
12.排行榜UI分类表重写开放自定义。
13.内挂 自动隐身 自动开盾 修改为根据技能不再根据职业。
14.修正StdMode = 32的物品无法在快捷栏内使用的问题。
15.修正盾牌属性加成不准确的问题。
16.UI组件增加鼠标穿透配置。鼠标穿透:当UI组件内是透明的 那么如果鼠标穿透被设置为True 那么透明区域将不认为是 UI 的范围。典型应用可以应用于透明聊天框 透明部分点击仍然可以行走。
17.修正Hum5资源无法读取的问题。
18.SetClientUIProperty支持 #系列转义字符 的使用.
19.改进登录器目录搜索速度。修正搜索光驱导致登录器报错的问题。
20.修正版本管理器修改UI设计 修改组合特效内观 会将外观清空的问题。

01月17号
1.修正队员招募队长人数不会更新的问题。
2.增加 TPlayObject.RefFeature; 刷新角色外观。可用于动态更改武器 和衣服外观特效时候 刷新。不必在脱下来
3.取消Home键盘呼出内挂.
4.修正M键大地图使用ESC关闭 地图后 换地图后会自动显示大地图的问题。
5.修正道士内挂换毒符持久剩下10以内的就不使用了的问题
6.修改商品列表 和仓库列表组件 允许获取焦点为false 以便解决 在购买商品 和存放物品时候 UI焦点 转变为列表 导致 无法使用回车发送消息的问题
7.修正内挂开启自动保护会导致 手动使用物品导致物品卡消失的问题。
8.修正 大地图 和盛大 小地图 以及91小地图 在地图图片小于窗口时候不会进行自动缩放的问题。
9.修正 首饰 内观特效 再内观显示为包裹特效的问题。
10.物品包裹特效 和内观特效 增加 绘制模式(0-11) 的配置
0-2：普通, 3.影子 4:添加 5.分量相乘 6.翻转分量 7.透明通道混合 8。原色添加 9.黑白. 10.普通 11.加亮
11.怪物数据库 增加怪物附加标志配置包含有：
1.阵营攻击优先(怪物将会 优先攻击不同阵营的 怪物或者人物)
2.只攻击阵营不同(怪物将 只攻击阵营不同的怪物或者人物 即使同阵营玩家攻击 也不会反击)
3.智能寻路(此怪物将会智能绕过障碍物攻击目标,不会被障碍卡住来回走动无法攻击玩家)
12.修正人物死亡后还会升级的问题。
13.修正上一版本商城物品BindState 有问题的bug
14.修正GameLib.ThrowItem 的禁止时间无效的问题
15.增加 内挂保护自动修正，HP MP上限
16.修正人物走动不会取消交易的问题
17.UI编辑增加 ctrl+s 快捷保存UI 增加客户端UI自动备份文件夹 “91UIBak”。每次保存UI将会自动根据时间日期生成文件名保存到此文件夹下。
18.新年大礼，登录器生成列表支持主副副三列表

更新日志 - 2016年
12月29号
1.内挂 增加智能追踪功能 勾选 后遇到障碍物会自动绕开 可在 M2功能设置内配置 是否允许客户端使用
2.修正道士 使用治愈术 宝宝会攻击对方的问题。
3.修正按住Shift可能会打不出刺杀的问题。
4.修正人物死亡后 对方捡走东西 死亡的人看的东西还在原地的问题。

12月28号
1.修正人物攻击镖车 宝宝会攻击人物的问题
2.M2选项->功能设置 增加镖车是否根据人物下属指令进行休息 的配置
3.M2选项->功能设置 增加镖车是否影响召唤类技能的召唤数量的配置
4.修正内挂去掉物品显名还会显示的问题。
5.修正宝石不能被强化和修复的问题
6.修正 礼券 元宝 灵符 名称无法修改的BUG
7.修正穿人穿怪 在安全区 登录 会导致 反弹的问题。
8.修正自动拾取物品等待时间太久的问题
9.修正内挂没有设置 自动更换毒符 依旧会自动更换毒符的问题 。同时修正自动切换毒符 可能导致 装备无法穿戴和取下的问题。
10.修正1.76人物界面内观有偏移的问题
11.M2选项->功能设置->技能魔法 增加 道士 护身符 和 毒药 没有穿戴在身上(放在背包) 是否可以直接使用的配置
12.修正 怪物爆出的物品，当站在物品上（由于其它因素导致该物品不会自动拾取到背包，包括：物品不属于当前站在该物品上的对象或者背包满时），然后走开，该物品的消失时间会比同时爆出的慢消失 的问题
13.修正擒龙手会导致玩家无敌的问题
14.修正打开第二个登录器会报错的问题。 [要重新生成登录器]

12月23号
1.修正宝宝 会追杀安全区人物的问题。
2.M2-选项-参数设置-增加 外挂加速检测增强模式。默认关闭 在云服务器可能会导致误报的问题 所以不建议在云服务器上打开。(云服务器是虚拟出来的,时间方面会有问题)
3.属性点调整窗口显示所有调整按钮。
4.本地公共仓库 存放物品函数 GameLib.SaveItemToStore 增加 Param : 可选参数自定义(限制长度128超过长度的会被舍弃)用于开放给大家增加保存自定义参数 function SaveItemToStore(Item: TUserItem; const ChrName: String;EventType:Integer;Param:String=’’);
同时TStoreItemList 增加 TStoreItemList.Params[Index] 用于获取 存入时候的自定义参数。
5.修正野蛮冲撞人物可以快速跑走的问题
6.修正道士宝宝 安全模式 会攻击队友的问题
7.修正内挂智能半月不智能的问题。
8.修正卡药特厉害的问题

12月19号
1.QFunction 增加 procedure OnQueryAllowLevelUp(Player:TPlayObject;var Allow:Boolean); 用于是否允许引擎对人物进行升级。通过操作Allow 进行 True 表示允许升级 False 表示不允许升级
例:
procedure OnQueryAllowLevelUp(Player:TPlayObject;var Allow:Boolean);
begin
if (Player.Level > 100) and (Player.Guild = nil) then
begin
Player.SendMessage(‘您还未加入行会 , 无法提升等级’);
Allow := False;
end;
end;
2.修改一次升多级只会执行一次升级触发的问题。
3.修正上一版本刺杀 忽略对方防御无效的问题。
4.M2选项 人物属性编辑 增加 三职业默认参数。
5.版本管理器商人配置 内 头顶特效配置 支持多个配置如: 101;102;103;此时NPC头上就有3个特效。

12月15号
1.修正 TUserItem.CustomEff 改变后外观特效不会变化的问题。
2.修正 {E=聚灵珠} 显示出来的物品提示 为已经聚积满的问题。
3.修正头顶称号特效会跟随人物跑动导致卡顿的问题。
4.修正批量导入图片中有坐标 以及BMP和png导入 会导致 版本管理器卡死的问题
5.增加注册界面帮助提示文字位置可自定义。
6.因为无法合区的原因 对 GameLib.SaveItemToStore 函数进行修改。 点击查看功能例子
增加EventType 表示物品存储进去的途径 其意义由GM自行定义。返回的保存编号修改为字符串。
function SaveItemToStore(Item: TUserItem; const ChrName: String;EventType:Integer): String;
并且添加以下增强函数用于对公共物品库进行操作
function GetStoreItems(const ChrName: String): TStoreItemList; //根据角色名获取其存储的所有物品
function GetStoreItemsWithType(const ChrName: String;EventType:Integer): TStoreItemList; //根据角色名和 存储的途径类型 获取角色对应途径的所有物品
function GetStoreItemsOnlyType(EventType:Integer): TStoreItemList;//根据存储途径类型 获取所有人存储的物品
function CopyUserItem(Item: TUserItem): TUserItem; //拷贝物品。当从公共物品库取出物品 要添加到背包 或者需要放置到其他位置 需要拷贝一份。否则会内存错乱
function GetItemEventType(const Index: String): Integer;//根据保存编号 得到其存储数据类型
function DeleteStoreItems(IndexList: TStringList): Integer; //批量删除存储的物品 。返回删除的数量

TStoreItemList 类型说明
property TStoreItemList.Count 数量
property TStoreItemList.Names[Index:Integer] 物品所属的玩家名称
property TStoreItemList.SaveIndex[Index:Integer] 保存编号
property TStoreItemList.EventTypes[Index:Integer] 存储途径类型
property TStoreItemList.UserItems[Index:Integer] 物品数据 (临时数据 要添加到其他地方 必须CopyUserItem)
严重事项：
1：通过GetStoreItemsWithType 等函数返回的 TStoreItemList 由引擎维护 脚本内不要对其进行 Free。
2：要将读取出来的物品 添加到背包 一定要 执行CopyUserItem 获取一个新的拷贝 。因为 里面的数据只是临时的。如果不拷贝添加到背包 会导致背包数据异常。其他地方也是一样
7.刺杀剑法 增加 隔位刺杀是否 忽略对方防御。
8.修正调整等级命令可以调整为 0级的问题
9.修正攻击安全区内的弓箭护卫 离线挂机后 还会被攻击的问题。
10.添加TStdItem.TypeID 用于获取数据库中设置的物品类型。
11.NPC配置 增加头顶特效 根据 根据UI配置内自定义特效的序号ID进行配置。

12月06号
1.修正组件宽高自动调整 对 按钮 无效的问题。
2.修正机器人会在一些机器上会执行两次的问题。
3.Player.SetClientUIProperty 增加 可进行域操作
如：Player.SetClientUIProperty(‘DMyCustomName’,’Caption.Text= 这才是我的标题呢。’) ;
4.修正弹出对话框会显示编辑框的问题。
5.修正一些技能会卡几秒的问题
6.修正刺客技能 潜行隐身 对人物无效的问题

12月05号
1.修改上一版本因为失焦导致快捷键无法使用的问题。
2.修正怪物自定义 外观无效的问题。
3.弹出对话框增加 编辑框可自定义。
怪物自定义和Npc方法是一样的

12月02号
1.修改跑动过程中允许回车发送聊天信息
2.修正内挂自动喝药 药没了的提示有问题的BUG
3.修正 聊天框发送物品无效的问题
4.摆摊UI增加佣金位置可自定义
5.修正可能不触发登录脚本的问题。
6.增加怪物自定义和NPC自定义 (公开测试) 具体使用方法查看对应教程。
公布2个怪物Race
57 见人就跑，无攻击
58 见人就跑，见东西就拣，无攻击

11月29号
1.修正上一版本 大退无法退出游戏的问题。
2.人形怪物配置增加 “勋章” 字段 如 ： 勋章=火把,荣誉勋章45号,荣誉勋章44号,荣誉勋章43号
3.修正背包双击穿戴武器 会播放两次声音特效的问题。
4.优化物品物品背包双击 和 快捷栏双击 有时候会卡住的问题。
5.编辑框属性增加失焦颜色透明度
6.修正物品改名改名后为{S=名称;C=253} 样式的 名字 在 摆摊上架 会显示出 控制符号的问题。
7.游戏设置 死亡掉落规则 增加 低于多少级别不掉物品 和 死亡掉落物品数量限制。
8.游戏设置 升级经验 增加 一次最多升多少级控制。

11月28号
1.动画按钮裁剪方式 增加动态裁剪 方式。设置为动态裁剪 时候 根据 属性的动态裁剪可设置其裁剪值(有效值 0-1.0);
在NPC脚本中 可通过
Player.SetClientUIProperty(‘DAMyHP’,’ClipType=ctDynamicValue;DynamicClipValue=0.5’) ; 将人物HP的雪球裁剪设置为50%.
2.增加退出按钮提示框可自定义。
3.修正学习技能会出现两次提示的问题
4.怪物数据库增加 MaxDropHP字段 表示受到攻击 一次最多掉血量的配置。0 表示 不限制。同时增加 TActor.MaxDropHp 属性字段可以动态调节一次最多掉血量同样适用于怪物 和 玩家。下线不保存
5.聊天对话框增加聊天框背景风格属性 用于自定义 聊天框信息 是否透明。
6.九宫格图片组件增加填充颜色透明度 用于支持聊天框 半透明显示。
7.修正查看他人装备 使用10000以上的Shape 武器特效会显示为 衣服特效的问题
8.修正快捷栏不能放置部分快捷物品的问题
9.增加<$LUCKY> 幸运 以及 <$HITSPEED> 攻击速度 变量标签变量
10.技能栏 改为打开窗口 就刷新 方便使用自定义UI 将技能整合到 装备页导致无法自动刷新的问题
11.修正行会不显示联盟行会的问题。
12.修正人形怪会打自己宝宝的问题
13.修正脚本指定 宝宝 和主人的 TargetActor 但是宝宝有攻击动画不会掉血的问题。
14.修正 APlayer.Damage(Bplayer,100); 用这个函数指定A攻击B后，A会灰名，但A的宝宝还是会站着不动，不去攻击B 的问题。
15.增加城堡TUserCastle.ChangeDateTime属性用于获取城堡被占领时间 使用 DateUtils.DaysBetween(Now() - TUserCastle.ChangeDateTime ) 获取占领天数。(PS:需要先uses DateUtils)
16.修正NPC对话消息 每次打开NPC对话框 会被重置的问题。
17.排行榜界面为自定义修改。

11月23号
1.M2选项-》游戏参数->游戏选项1增加离线挂机 毒是否掉血的配置 默认为 无效。
2.修正M2版本管理器 添加部分BMP图片不支持的问题。
3.修正登录器拖动禁止按钮会让背景 和窗体分离的问题
4.增加动态加载UI文件,如：Player.LoadUI(‘UI2.91UI’);
5.增加动态修改客户端UI属性的功能。
如:第一个参数为UI名称 可在 开发客户端内 选择看组件名称获得。
第二个参数为属性列表。属性名在开发客户端内 属性编辑器内使用英文字段 即可.
Player.SetClientUIProperty(‘DShop’,’Left=5;Top=100’) ; //修改商铺坐标为5,100
Player.SetClientUIProperty(‘DItemBag’,’ImageIndex=200’) ; //设置背包窗口图片序号为200
6.NPC对话编辑增加 MO 用于 支持资源文件偏移。除此之外和M 是一样的
比如 {M=3000-3005;F=Mon15;T= 200}//黄泉教主走路动画没使用文件资源偏移会抖动。
{MO=3000-3005;F=Mon15;T=200} //使用资源偏移绘制 不会抖动。
7.商城价格、元宝、和商品名称等可自定义位置

11月22号
1.增加 Player.LockClient 和 Player.UnLockClient 用于锁定客户端不允许做任何操作 同时角色会处于无敌状态。
示例：
procedure LockClient(Npc: TNormNpc; Player: TPlayObject; Args: TArgs);
begin
Player.LockClient(‘请输入密码’,’Q57.OnGetPassWord’); //客户端锁定 并且弹出对话框 要求输入密码。输入密码后将跳转到 Q57.OnGetPassWord 进行处理。
end;
procedure OnGetPassWord(Player: TPlayObject;const Password:String; Args: TArgs);
begin
Player.SendMessage(‘你输入的密码是’ + Password); //显示客户端输入的密码 ,这里可以对密码进行比较匹配。
Player.UnLockClient; //解锁客户端
end;
2.修正 人形怪因为魔法使用间隔过短导致 魔法特效不显示的问题。
3.增加Player.ChatColor 用于动态调整人物聊天颜色。
4.修正装备 和 打捆类药品会出现再快捷栏的问题 同时 增加 Alt+R快捷键用于刷新背包 。
5.修正在地图内飞随机也会触发MapEventNpc.Enter 事件的问题。
6.增加 TActor.ThroughHuman 用于在脚本中动态控制是否可以穿过玩家。如果此值没被设置 True 或者 False 那么根据引擎规则 决定是否可以穿过。
如果此值呗赋值过 那么根据赋值的值来决定是否可以穿过。 使用TActor.ResetThroughHuman(); 来清除脚本赋值 还原由引擎控制。
同样 增加的还有:
TActor.ThroughMonster 是否可以穿过怪物
TActor.ThroughNPC 是否可以穿过NPC
TActor.ThroughGuard 是否可以穿过卫士
TActor.ResetThroughMonster(); // 重置穿过怪物
TActor.ResetThroughNPC(); // 重置怪物NPC
TActor.ResetThroughGuard(); // 重置穿过卫士
7.添加创建账号窗口 和 修改密码窗口 编辑框组件UI可自定义。
8.修正版本管理器 数据库 ->选中增加选择状态 会报错的问题
9.重写物品状态系统.之前 UserItem.NoRepair UserItem.NoStore 等 字段被去除。
增加 TUserItem.State 和 TStdItem.State 用于获取物品的状态。
数据库内设置的物品状态 全部可以在 TUserItem.State 中动态修改(修改只影响对应的单个物品).
比如数据库内物品设置了 禁止修理。
那么所有生产出此物品都会被默认是指为禁止修理。 但是可以通过 TUserItem.State.NoRepair := False; 设置为允许修理。并且只影响单个物品。
对应更新的State 属性字段有：
DisableMake 禁止GM命令制造
WriteLog 记录日志
DropHint 掉落提示
ButchHint 挖取提示
NoPickUp 禁止拾取
BoxHint 宝箱提示
ShowNameClient 显示名称 客户端.
SpecialShow 特殊显示 客户端
AutoPickUp 客户端自动拾取。
NerverDrop 永不掉落
Bind 绑定
NoRepair 禁止修理
NoStore 禁止存仓
OfflineFree 下线消失
NoDrop 禁止丢弃
DeathFree 死亡消失
DeathDrop 死亡必爆
NoTakeOff 穿戴后不允许取下
AutoBindAfterTakeOn 穿戴后自动绑定。
CallMethodOnMonDrop 怪物掉落后触发脚本
CallMethodOnPlayerDrop 玩家掉落后触发
CallMethodOnButch 挖取时 触发函数。
CallMethodOnPickUp 拾取时触发函数。
更新之后如果有编译报错 UserItem.Bind 等 不存在的 字段提示 请手动改为 UserItem.State.Bind

11月16号
1.修正版本管理器物品特效重名会导致版本管理器 和M2会假死的问题。
2.修正上一版本 加载老的UI配置会假死的问题
3.修正附加属性点点+号按钮会导致 底部状态兰位置归为的问题。
4.修正十二生肖按钮不显示的问题
5.修正人物称号图片不显示的问题
6.修正属性点确定按钮不显示的问题

11月15号
1.修正物理攻击 弓箭手 弓箭手不会召唤同伴攻击玩家的问题 以及 死亡后复活 和 小退后 上线 弓箭手还会攻击玩家的问题。
2.修正不同阵营的怪物 不会主动攻击的问题
3.修正客户端变量标签<$HP> <$MP> <$EXP> 不会及时刷新的问题
4.QFunction 增加 procedure OnClickGameShop(Npc: TNormNpc; Player: TPlayObject; var OpenDefalut:Boolean); 点击商铺触发 通过控制OpenDefalut 来实现是否打开默认商铺. 默认为True.
5.DBServer 数据库选项增加角色名字控制 增加禁止创建包含阿拉伯 数字 和英文等控制
6.修正Gamelib.Broadcast({S=91M2;C=253});广播消息 客户端移动到文字上面 会默认红色字体的问题。
7.修改NPC对话框编辑 {M} 图层为最底层,解决会遮住文字的问题。
8.客户端游戏画面明亮度调整。
9.修正上一版本套装HP上限属性无效的BUG.
10.修正技能栏更新不及时的BUG.
11.修正背包存在 同时补充HP 和 MP的药品 不会优先解包药包的问题。
12.修正String.Ini会被自动添加默认值的问题
13.版本管理器增加重载M2脚本。点击按钮后 会自动编译脚本并且同步到M2 M2无需做任何操作。
14.重写选择角色场景 增加UI参数方便自定义。
15.版本管理器增加针对单个NPC脚本重载功能(不稳定，仅供测试使用)。
16.引擎支持无需编译脚本单元直接让引擎加载功能(不稳定，内部在测试使用)。

10月28号
1.修正脚本内对 Actor属性进行操作 会二次加成的问题。
2.修正 不管人物走多远 弓箭手会一直攻击 打他的人物 的BUG。
3.修正人物头盔 会挡住斗笠的问题。
4.增加斗笠 面巾 数据库字段配置,Reserver: 0 面巾 1 斗笠.(区别在于人物内观 面巾会同头盔一并显示。而头盔和斗笠同时存在的话 只会显示斗笠.) Source: 0 戴上变成神秘人 1：戴上不变成神秘人
5.修正怪物可能会闪的BUG。
6.修正摆摊界面部分UI不能自定义的问题.
7.修正摆摊摊主 开着摆摊界面 有玩家出售收购物品 后 摆摊摊主 界面不更新的问题。
8.优化药品卡药的问题。
9.修正NPC对话框动画 {M}播放会少一帧的问题。
10.String.ini文件 支持留空 不发送消息。 如：
ManLongOutDearOnlineMsg=
将不会发送红色空格消息。
11.修改顶部扩展栏位UI可以更改位置。以及
Player.AddExtendButton
Player.AddTopExtendButton 函数坐标不生笑的问题。
如果需要使用坐标 那么所有添加的都要使用自定义坐标。 否则在添加非自定义坐标的按钮时候会认为是 自动坐标 将之前添加的全部自动排序

10月20号
1.修正小地图组件不能前置的问题。
2 增加.脚本按钮 设置组件可视按钮，标题可以显示。
3.增加小地图鼠标XY组件。以及 地图属性区域编辑。
4.修正 集体隐身术 治愈术 神圣战甲术 等buff对队友使用 宝宝会攻击队友的bug
5.修正自动增加泡点值无效的问题。
6.NPC对话编辑M类型增加DB字段取值0-11表示绘制模式对于非透明的BMP图片可以调节绘制模式达到混合透明的效果。例如{M=1480-1498;F=Prguse.wil;TB=100;OX=122;OY=-85;DB=4}
7.修正神圣战甲术 幽灵盾 等 会对宝宝的HP造成影响的bug.
8.增加GameLib.GetLastThrowItemList :TList; 用于获取 GameLib.ThrowItem 和 GameLib.ThrowItemEx 丢出在地上的物品对象。
例如：
var
ItemList :TList;
I : Integer;
Item : TUserItem;
begin
Gamelib.ThrowItem(‘3’, ‘乌木剑’, 300, 300, 3, 1, Player); //在地图300x300的3格坐标范围内爆出一把乌木剑,当前的Player可拾取
ItemList := GameLib.GetLastThrowItemList;
for i := 0 to ItemList.Count - 1 do
begin
Item := TUserItem(ItemList[i]);
//对Item 进行操作。
end
end;

10月19号
1.修正高分辨率设计的UI到低分辨率下不会自适应的问题。
2.修正 NPC编辑动画框 的大小不会自动适应。导致可能点击不到的问题。
3.M2版本管理器增加设置为默认版本按钮 用于快速设置版本为M2引擎使用版本。
4.修正多个宝宝在攻击同一怪物的情况下 会走来走去的问题。
5.修正顶部按钮不显示的问题。
6.修正底部状态栏 自动喊话等五个按钮资源图片会被自动替换的问题。
7.修正物品名字会把玩家挡住的问题。
8.修正套装信息 没有根据玩家性别显示对应衣服 而是把两件都显示出来的问题。
9.套装信息 对应宝石 改为[石]
10.修正施毒术没有目标对象依旧有魔法特效的问题。
11.修正部分png导入后 再游戏内不显示的问题。
12.修正脚本编辑器 “拷贝为HTML格式”功能无效的问题。
13.增加刺客技能效果 自动识别 归来客户端 和 热血传奇客户端。
14.版本管理器 数据库 增加跨版本 可粘贴复制 记录功能。
15.增加立即取消变身函数：TActor.CancelToMonster.
16.修正宝宝会将人物挤出安全区的问题。
17.购买和拆分按钮标题可修改。
18.增加在线改名功能。
使用方法：
GameLib.GameLib.ReNamePlayer(Player,新名称);
同时ManagerNpc 对应增加两个触发函数 表示 改名结果。需要注意的是这个时候传递进来的PlayObject 可能为nil 。
procedure OnPlayerRenameSucess (State: Integer;PlayObject: TPlayObject; const OldName, Newname: String); //改名成功
procedure OnPlayerRenameFail (State: Integer;PlayObject: TPlayObject; const OldName, Newname: String);//改名失败
参数意义说明:
State : 状态码 。0:改名成功, -1:新的名字已经存在无法改名。-2，-3 DBServer异常(可能是数据库链接断开或者被关闭)。 -4:新的角色名字非法。
PlayObject ：要改名的玩家对象 到此处可能有可能为nil
OldName : 原名字
Newname :新名字
注意: 改名成功后脚本内使用的自定义文本 涉及到了人物名称的 请自行在OnPlayerRenameSucess 对其进行对应处理
名字的额外说明：
脚本内使用玩家名字按原先的设置 Player.Name 写即可
系统会自动判定 Newname 为空则显示OldName 不为空则直接显示新名
OldName 为建人物的时候定死的 仅能修改 Newname 且该名字在服务器内不存在同名
OldName和Newname 这两个仅在写脚本界面给玩家看到的时候调用即可

10月13号
1.增加组件锚点功能。
2.修正组件按钮标题 文字不显示的问题。
3.修正UI列表拖放会导致UI列表异常的问题。
4.修正商铺界面可能会透明的问题。
5.封包结构重新编写。最大封包扩展为32K.
6.修正在安全区上线 可能导致人物撞到NPC反弹的bug
7.NPC编辑 增加 {M 类型 } 增加 TA表示 每帧时间 并且 动画不循环 播放停止。TB表示每帧时间并且动画不循环 播放消失。
8.修正坐骑跑动可能会卡的问题
9.修正30+组件无法更换 按下图片序号的问题
10.登陆器增加自动修改桌面颜色位数为 32 以解决不透明的问题。
10月10号
1.修正合区工具导致合区可能会丢失角色的问题。
2.修改行会名称组件可自定义
3.增加出售文字可自定义。
4.恢复角色列表组件更换 自定义能力更强。
5.修正主称号不可见的BUG。
6.修正商铺类型移动无效的问题
7.查看他人时装点击无效的问题。 如果是老版本的自定义UI 存在此问题。 请先用最新版本客户端,再不加载UI的情况下 将查看他人 页面窗口导出。 再打开UI配置导入即可
8.设置技能快捷键面板增加文字标签 可自定义。
9.修正魔法盾自身绘制是 人物在魔法盾上面的问题
10.修正小退选择其他角色会黑屏，以及 在上线蓝 血为0 的问题。
11.引擎优化

10月2号
1.增加TActor.GetSlaveList 用于获取宝宝的列表。
2.增加TActor.SlaveRelax 判断以及设置 宝宝的状态， true 为休息 false 为攻击
3.修正查看女刺客装备发型不对的bug
4.修正查看他人不显示内观特效 以及 会显示子自己的内观特效到他人的BUG
5.修正查看他人装备弓箭手显示错乱的问题
6.修正查看他人时装不显示的问题
7.NPC编辑器增加倒计时标签
{SC=10;SF=@CountDownOver}
表示 倒计时10秒 倒计时结束后 执行CountDownOver函数 (必须再对话框没有关闭的情况下) ,如果SF不填写表示 仅仅倒计时而已
8.修正GameLib.MonGen 函数中心点再不可移动点 导致怪物刷不出来的问题
9.UI修改 商品列表 和仓库物品列表 可自定义
10.修正登陆器会创建Log文件夹的问题
11.修正登陆器不会创建快捷方式的问题(登录器列表配置有个允许生成快捷方式要打勾)。
12.修正ShowProgressEx 会循环调用 成功或者失败函数的问题。
13.修复打开WZL文件PNG花屏的问题.

9月27号
1.NPC对话编辑增加动画框例如<{M=56-59,65,69;F=Prguse.data;T=500;OX=50;OY=50;HINT=点击打开传送对话框} /@ClickImage>
表示 将Pruguse.data 56-59作为动画进行播放 鼠标经过图片为 65按下图片为69每帧间隔为500毫秒坐标偏移为50,50鼠标移动过去的信息为点击打开传送对话框 同时增加移动图片和按下图片具体参照NPC编辑
2.NPC对话框编辑增加自动变色例如{S=91M引擎;AC=251,249,222,210;AT=1000}
AC 表示自动变色颜色表
T 表示变色间隔时间(毫秒) 如果不填默认为1000
3.NPC对话框编辑增加{GX=50;GY=60} 用于动态NPC对话框面板 全局字体渲染位置。
4.修正版本管理器 NPC对话 预览 不能预览图片位置的问题。
5.NPC对话预览 增加更换底图功能。
6.修正M2-物品装备-附加属性-附加属性点数几率。保存错乱无效的问题。
7.进度条事件优化 增加 Player.ShowProgressEx函数。
8.增加泡点点数值 同时地图增加 自动增加 和减少泡点值
脚本通过 Player.PaoDianPoint 来进行赋值和修改
9.行会面板异常修改 限制行会封号长度
10.Gamelib.BroadCenterMessage 提供一个停留时间的参数
11.增强NPC对话编辑 E:控制符
12.修正人形怪物追击人物 以及 玩家追击人物 会出现闪现的问题。
13.修正读取UI导致客户端卡死的问题
14.排行榜所有开放根据UI配置调整
15.修正弹出菜单会多次保存的问题
9月22号
1.修正 游戏商铺的关闭按钮 自定义图片无效
2.修正 天气图片不不支持自定义所在位置
3.修正 打开任务窗口的按钮 鼠标经过 显示的图片无效
4.修正 动画按钮 经过图片无效的bug.
5.修正底部状态栏 小地图按钮等 无鼠标移动提示的bug 。加入可自定义鼠标经过提示。
6.修正 打开任务窗口的按钮 鼠标经过 显示的图片无效
7修正 热点按钮 鼠标经过 显示的图片无效
8.修正聊天滚动条 顶部 底部 以及滚动球 鼠标经过显示图片无效
9.修正 商铺按钮 鼠标经过 显示的图片无效
10.修正 帮助按钮 鼠标经过 显示的图片无效

修正 查看女的会显示男人头 而且武器的层级比衣服低 衣服内观把武器内观遮挡了
修正 大退和小退无法编辑
9月21号
1.修正资源管理器报错的问题
2.修正上一版本客户端自定义文件不显示的问题
3.刷新背包按钮UI 修改 可自定义
4.小地图UI修改 可自定义。
5.修正排行榜无效的问题
6.优化Png 读取效率 优化客户端png绘制效果
7.脚本修改衣服LOOK依然有BUG！ 之前的BUG是背包、地面正确，穿戴内观错误。现在是背包、穿戴内观正确，地面显示错误！ 修正
8.GameLib.ClearMapMon 和 TEnvirnoment.ClearMon 清除怪物不掉物品的问题 修正。
9.客户端装备物品提示 风格修改 增加 属性分割横线 对应资源文件为 91Resource\Prguse.data 521 522 523 可自行修改 [暂定]
10.修正宝石不显示套装信息的bug.
11.出售 和购买 框 根据NPC对话框 自适应。

9月19号
1.Data资源文件 PNG格式改进 支持透明通道(之前导入的Png不生效 需要重新导入)
2.修正 人物在安全区 被怪物打死 小退后 无限死亡的bug.
3.增加 Player.TotalExpRate 只读属性 用于获取人物当前的经验加成
4.修正GameLib.RemoveNpc 会失效的bug.
5.重写登录公告窗口 解决登录窗口UI不能自定义的问题。
6.所有组件 增加 禁止鼠标消息 属性 用于对组件 设置 是否接受鼠标消息。
7.AddExtendButton 和 AddTopExtendButton 增加 参数 XY用于调整位置
8.大地图窗口重写 修正无法自定义UI的问题
9.修正聊天对话框 行数高度改为7以下 接受到聊天信息不会到最新行的bug
10.修正版本管理器打开部分wzl资源文件可能导致 异常的问题

9月17号
1.变量标签增加 <$GAMEGOLD_V> 和 <$GOLD_V> 表示金币 和元宝 带千分符号的数量 点击查看更多
2.修正上一版本新增加的三个变量标签无效的问题。
3.修正版本管理器在部分未安装DX9机器上报 缺少dxd9_33.dll的错误。
4.修正屏蔽显示行会聊天 按钮 和私聊按钮会自动锁定位置的问题
5.开发客户端界面样式修改。
6.修改部分UI保存后重新加载再保存 可能丢失的问题。
7.修正登录器会报毒的原因,请重新生成登录器

9月13号
1.修正脚本修改装备look值，背包和地面显示正常，衣服穿戴内观未变化 的Bug.
2.修正使用 特殊药水(攻击力药水 疾风药水) 下线后上线 提示异常的Bug.
3.变量标签增加 <$MAPNAME> 地图名字 <$MAPX> 地图X <$MAPY> 地图Y 点击查看更多
4.重写UI保存读取部分 上一版本的UI配置文件将无法读取。对于之前版本已经调整好的UI。 请单独将组件保存出来。用新的开发者客户端导入。给大家带来的不便 非常抱歉。
5.增加 可删除添加的UI组件 功能。
6.增加可修改内置UI组件归属的功能
7.编辑框增加 关联变量 属性 用于 和 脚本按钮进行关联。 (例:编辑框关联变量设置为 <#礼包ID> ，脚本按钮 调用QM函数名称 设置为:GetLiBao(<#礼包ID>) 即可将其参数传递到对应qm脚本函数内 )
8.修正上一版本部分技能失效的问题

9月12号
1.修正变量标签组件不保存的问题
2.修正脚本按钮点击无效的问题
3.键盘 上下左右功能 调整为 按下调整一个像素 长按为移动。
4.修正按钮底部状态栏 地图交易等图标 保存失效的问题
5.9宫格图片组件 增加填充颜色属性。
6.编辑框增加透明度 和 颜色 属性。
7.修正自定义编辑框无法选中的问题
8.修正按钮提示文字 无效的问题。
9.修正部分UI不能保存的问题。
10.变量标签增加 <$USERNAME> 表示自身玩家名字

9月9号
1.修正固定伤害 法术攻击会有翻倍伤害的BUG。
2.修正版本管理器 删除爆率无效物品会把金币 也一同删掉的BUG
3.M2->选项 ->物品装备->极品属性 武器极品属性 增加 对 准确 、速度、持久属性机率的控制因子
4.改进反加速系统 封掉市面上已知加速挂 包含但不限于(游戏守望者,爱萧加速器,飘逸加速器)
5.修正上一版本不会自动放药的BUG
6.附加极品属性 增加 ： HP上限百分比、MP上限百分比 、致命一击额外伤害、会心一击额外伤害
7.QManage 增加检测到玩家速度异常触发 PlayerSpeedException(Player:TPlayObject;var Kick:Boolean); Kick 为是否将其踢下线 默认为 True.
8.修正 String.IsNumberic 无效的bug。
9.修正登录器更新列表 未选中依旧会更新的bug
10.自定义UI开放测试 将UI配置文件放在91Resource\UI.91UI 客户端会自动读取UI配置

8月21号
1.TActor 增加S变量 和N变量 通过 TActor.S[序号] TActor.N[序号] 进行访问读写操作 序号 范围为 0-99.
2.TActor 增加 SendMessage 函数 实现怪物说话 NPC说话接口
3.TPlayObject.SendClientUIVisible 设置客户端UI是否可视
4.加入 喝药间隔 和使用物品间隔的功能 同时 客户端内挂 根据M2配置间隔自动限制最低使用间隔
5.登录器客户端搜索改进 提升 4倍；
6.客户端加载资源速度优化提升 5倍；
7.修正版本管理器 数据库编辑 在使用筛选后 ‘选中选择增加状态’ 无效的Bug。
8.修正购买商城物品 负重会计算 最大叠加数 x 重量 的bug

8月9号
1.修改刷怪函数返回怪物列表 用于对刷出的怪物进行控制。兼容之前的代码 无需改动 。注意TList 需要在uses 内加入 Classes;
使用 TActor(List[i]) 强转为Actor即可
procedure MonGen(const AMap, AMonName: String; AMonCount, AMapX, AMapY: Integer; ACamp: Byte; ANation: Byte);
procedure MobPlace(const AMissionMap: String; AMissionX, AMissionY: Integer; const AMonName: String;
AX, AY: Integer; ACount: Integer=; ARange: Integer; ACamp: Byte; ANation: Byte);
function MonGen(const AMap, AMonName: String; AMonCount, AMapX, AMapY: Integer; ACamp: Byte; ANation: Byte): TList;
function MobPlace(const AMissionMap: String; AMissionX, AMissionY: Integer; const AMonName: String;
AX, AY: Integer; ACount: Integer=; ARange: Integer; ACamp: Byte; ANation: Byte): TList;
2.修正人物转向 其他客户端方向不一致的问题。
3.增加 TUserItem.CustomEffect：Word; 改变自定义特效。使用版本管理器内的特效配置ID 进行修改。
4.爆率概率BUG修正。
5.修正 Data 资源文件不支持PNG的Bug
6.修正通过脚本改变叠加物品上限客户端不显示叠加数量的BUG
7.修正SetState 无法解除玩家麻痹状态的bug
8.优化Client、M2

8月2号
1.修正版本管理器资源文件名 不能正确拉取 91Resource 文件下的资源的问题
2.修正商城购买物品不计算负重的问题
3.修正拾取叠加物品 只计算一个物品的重量的问题
4.游戏参数-> 游戏选项2->增加物品使用间隔
5.修正冷酷不加技能点的BUG
6.自定义UI开放测试[目前只能针对热血传奇界面有效编辑]
7.优化Client、M2

由于引擎过于强大,此版本说明文档大部分保留77相关字眼方便用户查找信息
77Client.dat 更改为 91Client.dat
77Resource 更改为 91Resource

关于致残毒药的问题几率由数据库调整
每攻击触发概率 = (技能等级 * 数据库DefPower) + 数据库Power /10000
例如: DefPower 300 数据库Power 500 则有14%几率

7月30号
1.血魄一击修改
　　EffectType = 12 技能往鼠标方向冲
　　EffectType = 0 人物往人物方向冲
2.致残毒药增加 是否对怪物设置为 禁止移动
3.修正副本地图 专属杀怪触发失效的问题
4.修正 人物 TargetActor 为 无效的问题
5.增加获取怪物、武器、衣服染色值
6.增加使目标受伤害、格子范围内受伤害、可播放动画,支持[击退,麻痹,吸血,吸蓝,打飞,混乱] <<<点击查看使用例子
7.优化Client、M2
7月28号
1.刺客衣服以及衣服特效编号修改
====================衣服===================
hum_ck.wil 0-99
hum_ck02.wil 100-199 //比较特殊 只有这个文件是有0的
hum_ck3.wil 200 - 299
以此类推 支持到hum_ck20.wil
====================衣服特效===================
hum_ckef.wil 0-99
hum_ck02_effect.wil 100-199 //只有这个文件是有0的
hum_ck3_effect.wil 200 - 299 //
humeffect7_ck.wil 600 - 699 //
除了以上4个文件格式不固定其他 都以Hum_Ck编号(无0)_ef.wil
以此类推 支持到hum_ck20_ef.wil
2.内嵌内挂 喝药 开放可调整
3.增加 TActor.BlendColor (身体绘制染色颜色) TActor.WeaponBlendColor (武器染色颜色) 。实现装备染色功能
4.修复副本杀怪无效的Bug
5.修复使用新地图会出现空气墙的Bug
6.修复1.76弓箭手穿衣服后与背景图不同的问题[更新到必要补丁]
7.调整首饰盒和十二生肖按钮在1.76界面坐标
7月26号
十二生肖StdMode：68
首饰盒StdMode：22，23
首饰盒和十二生肖按钮在Prguse.data 65-70
//开启人物首饰盒
Player.FunctionState[ffJewelryBox] := True;
//开启人物十二生肖
Player.FunctionState[ffZodiac] := True;
//关闭人物首饰盒
Player.FunctionState[ffJewelryBox] := False;
//关闭人物十二生肖
Player.FunctionState[ffZodiac] := False;

1.修正刺客外观和特效 编号一致 特效不一致的问题
2.麻痹效果改良
3.刺客技能数值修正
4.修正 分组爆率设置 仅爆一件的问题
5.增加刺客血魄一击冲击距离可通过数据库配置
6.物品加入产出途径功能 通过 TUserItem.OutWay 可以修改物品的产出途径 对应的文字提示在 版本管理器 扩展数据库 物品产出类型对照表 即可对其进行编辑
在UI设计 物品提示 可设置 是否显示物品产出途径
7.人物中致残毒药 由原来的右键不允许跑 改为 右键可以行走。
8.修正组队一起杀怪时 A杀的怪，B有经验 而A自己没经验 的Bug
9.修正野蛮冲撞可能导致冲撞怪物为0血不死的情况
10.修正商城所有物品 当鼠标放到物品上时 显示错误，统一显示为技能书外观的BUG
11.增加地图属性 TEnvirnoment.DisplayName:String 用于动态修改地图显示名称
12.盛大内挂保护时间改为 可以修改。
13.修正控制台配置默认登录网关 和 默认角色网关 会导致 网关二选项 灰掉不可用的Bug
14.优化程序

7月21号
1.修复若干已知BUG
2.修正版本管理器地图拖动 到附属地图 导致版本管理器报错无法使用的BUG
3.修正上版本爆率问题。 TActor.DropItemRate 用于动态调整 怪物掉落物品几率 的倍率。(-100 表示 降低一倍爆率 100 表示 增加一倍爆率 ) 默认为 0 表示 根据 爆率配置进行爆率计算。 1/10 强效金疮药 若调整 DropItemRate = 200； 则 概率变为 1/3 若调整为 -50 则概率变为 1/15
4.刺客技能优化 BUG修正
5.修正登录器每次打开需要搜索的BUG
6.修正转职后角色界面没有更新的BUG
7.修复带麻痹戒指引起技能不正常的Bug
8.致残毒药修改同步盛大
9.修正盾牌和武器不能同时穿戴的问题
10.盾牌穿戴负重 改为 腕力
11.增加TUserItem.Look 和 TUserItem.Shape 可以修改。修改后使用TPlayObject.UpdataItem可更新到客户端 (穿着的物品不能立即改变 )
12.怪物爆率增加参数

   #G 表示一个分组爆率的开始，其后跟概率，"("和")"必须各占一行，此分组爆率表示，有1/10的概率选择此分组，当选中此分组后，随机在分组中选择一个物品，然后再根据该物品的爆出概率来判断是否爆出物
   现在增加一个参数表在一个组内随机获取物品的数量
   #G  1/3 2
   (
   1/2 乌木剑
   1/2 铁剑
   1/2 短剑
   )
   比如这样设置
   后面的2代表了 从分组中抽取2个不一样的物品 然后根据物品爆率决定是否爆出
   1/3几率出2个东西 2个东西各自在此计算爆率

   #G  1/1 2
   (
   1/1 乌木剑
   1/1 铁剑
   1/1 短剑
   )
   如果是这样就代表必爆里面的2个物品
13.QFunction 增加拾取物品增强触发 此函数将最先于其他触发函数执行.
//PickSender 拾取者, Item 拾取的物品. Gold . 金币数量(如果物品是金币 那么 此变量 不等于 0 否则 此变量等于0.可根据此变量是否为 0 判断拾取的是物品还是金币) WhoPicker .最终拾取者(通过改变此值 可实现 A拾取 到B背包的功能)
//ItemState 0: 可以继续拾取 1.不允许继续拾取物品还在地图上 2.不允许继续拾取 直接从地图删除物品
procedure OnPickUpItemChangePicker(PickSender:TPlayObject;Item:TUserItem; var Gold : Integer ; var WhoPicker:TPlayObject; var ItemState:Byte);

地图->杀怪触发 。Main 函数声明由
procedure Main(Npc: TNormNpc; Player: TPlayObject; Args: TArgs);
改为：加入杀死的怪物对象 去除无用的Args
procedure Main(Npc: TNormNpc; Player: TPlayObject; Monster: TActor);
15.刺客支持左右手武器 以及特效 文件序号
一组 武器Shape 以及 特效 Anicount 从 0-99
wep_ck_l.wzl
wep_ck_r.wzl
WeaponEffect_CK_L.wzl
WeaponEffect_CK_R.wzl
二组 武器Shape 以及 特效 Anicount 从 100-199
weapon_ck02_l.wzl
weapon_ck02_r.wzl
weapon_ck02_l_effect.wzl
weapon_ck02_r_effect.wzl
三组 武器Shape 以及 特效 Anicount 从 200-299
wep_ck3_l.wzl
wep_ck3_r.wzl
weapon_ck03_l_ef.wzl
weapon_ck03_r_ef.wzl
四组 武器Shape 以及 特效 Anicount 从 300-399
wep_ck_l04.wzl
wep_ck_l_effect04.wzl
wep_ck_r04.wzl
wep_ck_r_effect04.wzl
16.武器外观支持扩展 以及 衣服外观支持扩展
=====================武器=================
当前的设置:
0-37 Weapon.wil
38-58 weapon2.wil
59-85 weapon3.wil
86-112 weapon4.wil
113-121 weapon5.wil
修改为:
0-37 Weapon.wil
38-58 weapon2.wil
59-85 weapon3.wil
86-112 weapon4.wil
113-149 weapon5.wil //开始做修改
从 Weapon6.wil 150 开始 每50编号为一组 支持到 Weapon20.wil
====================衣服===================
之前设置:
0-11 Hum.wil
12-23 Hum2.wil
24-47 hum3.wil
52 Hum4.wil
修改为:
0-11 Hum.wil
12-23 Hum2.wil
24-47 hum3.wil
48-90 hum4.wil
91-149 hum5.wil
从Hum6.wil 150 开始 每50编号为一个文件 支持到Hum20.wil
7月9号
关于摆摊价格Bug的问题 是素材导致不对 替换下素材即可
关于半月和刺杀的问题
数据库可以设置技能使用优先级 (数字越小 优先级越高 可以将 刺杀设置为 1 半月设置为0 则 会优先使用半月)
91引擎刺客同步盛大 唯一真刺客 真刺客技能 热血传奇客户端
刺客相关配置与设置看配套版本
1 .修正截屏导致客户端卡死的bug
2.人形怪配置 增加 职业：武僧
3.人性怪增加配置项 发型: -1为随机 >0 为指定发型
4.修改穿人穿怪配置 立即发送到客户端 不需要小退
5.QFunction 增加 procedure OnUseExpStoneItem(PlayObject:TPlayObject ; Item:TUserItem;var CanUse:Boolean); //在脚本中更改CanUse 的值 决定是否可以使用聚灵珠
6.改进登录器搜索速度
7.修正怪物NPC或者其他会突然消失的问题
8.Player.GroupMapMoveEx 函数 增加一个新的参数 ForceMove:Boolean 表示 是否强制传送 (即使在不允许组队传送的情况下 也传送)
procedure GroupMapMoveEx(Envir: TEnvirnoment; const MapX: Integer=0; const MapY: Integer=0 ;ForceMove:Boolean = false);
9.修改聊天框消息在收到消息的情况下 切换到新的消息行

176界面bug修复。
阵营怪物不能选中攻击的bug修正
12 .修正 Player.AddSidebarButton(); 导致左侧界面 点击无法行走的问题
13.修正自己组队关闭 邀请他人组队 他人拒绝后 客户端显示允许组队勾选 他人再次邀请却显示 对方不允许编组的问题
14.增加组队队员招募功能
15.版本管理器 ，装备提示效果定义 增加 【强化次数显示】 用于调节 在装备名称 后的显示强化次数样式
16.TEnvirnoment 类型增加 procedure SetInTroubleModeActive(boDenySay,boDenyAutoColor,boDenyViewUserInfo:Boolean;WeaponShape,DressShape:Integer;SameName:String);//用于脚本中动态开启 浑水摸鱼模式
//对应参数意义为 ： 是否禁止说话,是否禁止名字变色，是否禁止查看他人装备,统一衣服外观(0不改变),统一武器外观(0不改变) 统一显示名字(‘’ 则不统一显示名字)。
增加：procedure SetInTroubleModeClose(); //关闭浑水摸鱼模式
17.控制台增加服务器ID配置 同时GameLib.ServerID 服务器ID
18.TActor.DropItemRate 用于动态调整 怪物掉落物品几率 的倍率。(-100 表示 降低一倍爆率 100 表示 增加一倍爆率 ) 默认为 0 表示 根据 爆率配置进行爆率计算。 1/10 强效金疮药 若调整 DropItemRate = 200； 则 概率变为 1/33 若调整为 -50 则概率变为 1/15
19.M2 选项-》物品装备 -》附加属性 增加 固定伤害属性 。
20.战力类型修改为 Int64 避免数据溢出
21.怪物爆率检索功能改进
22.刺客技能重写同步盛大[效果,特效]
23.聊天编辑框过滤 <> 字符的解析。
24.聊天编辑框 粘贴 光标修正。
25.增加 游戏开始按钮 冷却时间 防止 游戏黑屏
26.调整NPC E字段显示物品是叠加物品的修正为1个
27.修正登录界面,选择服务器界面点击不到素材错乱的Bug
28.修正上一版本已知BUG
6月16号
此次更新包括1.76无四格、有四格客户端
1.修正一个会导致M2异常崩溃的问题
2.修正弓箭手射箭 其他人看到射箭速度不一样的问题。
3.修正 Player.Map.MonCount 数量为玩家地图的怪物数量 ，[之前为全服怪物数量]
4.修正变身后使用技能没有音效的问题
5.修正变身后变身回来一瞬间可能出现乱帧的问题
6.修正变身后变回玩家 穿戴装备外观不变的问题
7.修正变身时间参数为0不是永久变身的问题
8.支持ND类地图。
9.修正版本管理器打开时的布局问题
10.版本管理工具 物品数据库->道具状态 增加 “选中增加选择状态” 和 “选中移除选择状态”
11.弓箭手武器显示 与 雕像显示bug修正
12.复制的地图对象 地图号和地图名称 都会自动加上”_复制” 用于区别和源地图,防止因为地图号重复 出现莫名其妙的问题。
13.修正DBServer 可能假死的问题
14.修正RunGate 内存泄漏的问题。
15.禁止创建System 和 Self 的玩家名称
16.修正自由市场物品过期后还出现能进行交易的bug
17.骑马可以放魔法盾的BUG修正
18.魔血石显示BUG修正 以及增加 恢复上限百分比功能 数据库设置 ： AC = 启动恢复百分比 , AC2 恢复间隔(毫秒) , MAC = 单次恢复的量 , MAC2 = 恢复上限 详情请查看 魔血石设置帮助文档
19.登录器添加找回密码功能 默认登录器皮肤文件需要更新。
20.地图增加浑水摸鱼模式组 包含:
是否开启模式
禁止说话
禁止名字变色
禁止看对方装备
统一名字
统一武器外观
统一衣服外观
21.地图增加禁止变身配置
22.修正无法恢复角色的问题。
23.修正调整货币类命令 导致溢出为负数的问题
24.增加删除指定人物技能名称命令@DelSkill 人物 技能名称
25.修正Player.Take命令 拿走矿石 不会手动刷新到客户端的问题。
26.Player.PlayDice 增加一个参数 表示延迟关闭时间 单位是毫秒
Player.PlayDice(100{骰子标志}, 4{骰子点数1}, 1{骰子点数2}, 6{骰子点数3},3000{演示完毕显示骰子数目后3秒后自动关闭显示界面});
27.修正输入框有时候会出现乱码 以及复制位置不对的问题。
28.修正命令制造物品 传递OnBagItemEvent中Item参数有误的问题。
29.解析怪物文件爆率 增加 “全不选,反选” 以及 完善 过滤不存在的怪物设置。
30.修正人形怪可能会出现摆摊的问题
31.封已知的加速器以及外挂软件。
32.修正烈火剑法CD时间到 多按几次 会导致无法打出烈火剑法的bug。
33.修正M2一个内存泄漏的问题 降低内存约 160M。
34.流量优化 性能提升 相比之前 稳定性提升50% 以上 服务器运行效率 提升40%以上 经过负载测试 服务器承载率 可达到 同时 3000人 以上同时在线 其中600人攻城(极限1200人) 其他2400人 稳定游戏 不卡 CPU( interl I7-4790).

5月18号
1.添加TActor.M
ove(地图号,X,Y) 函数用于对Actor的移动位置移动 (X,Y可以不填 不填就是随机在地图号移动,否则就是定点传送)
2.添加变身系统 添加GM命令 @ChangeToMonster(怪物名称,时间(秒) 0 则为永久) 可进行变身。
3.脚本添加TActor.ChangeToMonster(怪物名称,时间(秒)) 变身函数。
QFunction脚本增加
变身开始触发函数
procedure OnChangeToMonsterStart(Actor:TActor; sMonName:string; nSec:integer); //变身的Actor,变成目标的怪物名称 ,变身的时长(单位秒)
变身结束触发函数
procedure OnChangeToMonsterEnd procedure(Actor:TActor; sMonName:string); //变身的Actor,变成目标的怪物名称
4.禁止创建空白的角色名称。
5.修正药品和回城卷 不会自动解包的问题
6.修正背包和属性窗口位置会自动归位的问题
7.增加盾牌和宝石可以开孔和镶嵌 其中 可以镶嵌的宝石类型为stdmode=7 并且 shape = 4
8.增加解包物品声音配置(stdmode = 31 anicount = 1) 为解包物品 AC为 解包后的物品ID source 为点击声音 0:药水 1:卷轴
9.修正杀怪掉落的物品 小退后再上线无法拾取的问题
10.修正雷霆战甲 类翅膀 在一些方向 特效 不清晰的问题
11.修复字体渲染导致游戏无响应的Bug
12.修正灵符 和 荣誉 客户端不同步显示的问题
13.TEnvirnoment对象添加函数 function CanMove(X,Y:integer;boIgnoreActor:Boolean = true):Boolean; 用于判断地图某个XY坐标是否可以移动。
其中boIgnoreActor 表示 是否忽略坐标点上的角色。如果为true 则该坐标只要不是障碍点 则有没有人和怪物都可以移动。为 false 则 如果坐标点不是障碍物，但是上面有人和怪物 则不可移动。
14.修正在背包快速连续双击使用可叠加物品可能导致物品消失的问题
15.修正Player.RequestURL无效的问题
16.修正登录器在特殊情况下启动不了第二个游戏的Bug

5月10号
1.修复男女角色头发 内外观对不上的问题
2.修复UI中的装备特效放在npc对话框中会出现特效与装备错位
3.修复客户端会崩溃的问题
4.修复有鼠标悬停颜色的NPC对话连接 移开鼠标颜色不变回的问BUG！
5.修复使用BUFF物品增加BUFF上线后 实际有加属性 却无提示的问题！
6.修复 叠加物品数量过多 显示数目字体过长的BUG。
7.修复 默认的自带的市场在上架物品时显示错位的Bug;
8.修复怪物配置产生装备魂炼值不保存的Bug
9.修复DateUtils.compareTime、CompareDate、CompareDateTime无返回值的Bug
10.修复国家聊天和阵营聊天的Bug
11.修复弓箭手、刺客武器错位的Bug
12.修正使用GameLib.SaveItemToStore 保存物品后 再取出来，自定义物品名称 恢复到了默认物品名称的问题
13.修正组队情况下2个玩家在不同的游戏地图 依旧有组队经验加成的的bug.
14.修正新建人物发型 发型错乱的问题
15.修正自定义特效其他玩家看不到的问题
16.修正按F12 无法关闭内挂的bug
17.修正 关于叠加物品使用MakeString显示的时候不显示数量的BUG
18.修正Tab按键会切换焦点到输入框的Bug
19.修正开天斩、龙影剑法攻击后没有落地特效的问题
20.修正OnBagItemEvent(),EventType，EventID: 为 {0,11} {1,6} {1,7} {1,9} 不执行的问题
21.修正盾牌 Player.Shied 拼写错误 修正为: Player.Shield
22.修正使用复活命令复活后，会出现“A杀死B，B跑回到A身边砍A，A有几率看不到B 的问题。
23.修正选择角色A进入游戏 小退后 可能出现选中角色为B的BUG
24.调整创建角色名最多7个字符
25.调整魔血石 类型 物品描述修改
26.调整选中地上物品的弹出提示框风格
27.增加选项-参数设置-客户端控制: 增加显示魔法血球起始等级。
28.增加桌面颜色不为32位的时候会自动切换回32位
29.增加宝石和盾牌允许开凹槽
30.增加首饰盒和十二生肖功能.
31.增加首饰盒十二生肖开启功能控制脚本。
32.修正女刺客特效会错乱的问题。
33.特殊属性物品设置->附加属性->装备位置 增加宝石 和盾牌

2月28日

人形怪支持”宝石”、”面巾”及”盾牌”3个装备位置的装备穿戴
调整MySQL数据库创建表时默认创建为InnoDB utf8编码 (注意：77使用Mysql数据库时请使用utf8编码，否则将报错 )
修复日志数据库设置密码后无法连接数据库(无法写入日志)的bug
修复某些情况下，文字渲染比较破的bug（如果人物界面）
修复使用药品可能出现卡药的bug
修复从旧版本导出技能然后导入到新版本时自定义技能客户端渲染设置丢失的bug
修复寒冰怪执行报错的bug
修复打开地摊时函数调用可能报错的bug
控制台支持从配置加载路由的选项
修复控制台关闭服务时人物不触发下线的bug
2月17日(77Client.dat必须配套更新)

1.(重要)修复游戏网关在切换人物时可能导致黑屏的bug
2.修复部分技能效果不跟随目标的bug(如治愈术)
3.修复一些小bug

2月15日

1.修复一些小bug

2月14日

1.自定义技能支持强化效果设置
2.可叠加物品叠加时增加颜色和持久上限判断，只有颜色和持久上限都相同时才可叠加
3.恢复穿戴在身上的装备不做常规穿戴要求检查（如攻魔道需求）
4.修复多个和网关相关的bug
5.修复多处细节性bug
6.排行系统财富榜排行增加元宝排行选择，选择元宝排行后财富榜统计的是元宝数据
7.优化下属攻击模式

2月4日
1.允许部分附加属性最大值超过100（如HP、MP）
2.当物品属性极品概率最大附加值设置为0时将不对该属性做极品处理
3.修复施毒术不消耗毒品持久的bug
4.数据库连接增加每小时一次的连接状态检查维护，防止类似Mysql长时间闲置后连接断开（MySQL本身可设置超时断开）
5.修复游戏网关停止服务后再启动将无法正常提供服务的bug
6.技能数据表增加“魔法锁定”字段，不勾选该功能则不管客户端内挂是否开启锁定都不会对目标进行锁定
示范版本中默认不锁定的技能ID为：2, 14, 15, 19, 9, 10, 22, 23, 29, 31, 33, 46, 49, 40, 52, 56, 57, 58, 164, 165
注：删除魔法锁定对象快捷键为Delete 键
7.优化DBServer存储数据处理能力；当存储失败时将在Backup目录下生成角色信息，可通过编辑人物数据时将该数据重新导入并存储
8.NPC增加变色功能（首先M2功能设置里对NPC变色颜色进行设置，然后在版本中对NPC自动变色变色进行勾选）
9.版本工具支持跨版本复制粘贴（快捷键Ctrl+C及Ctrl+V，加密脚本无效）
10.修复登录器初次加载时报加速错误的bug
11.自定义UI里支持自定义素材名填写

1月25日
1.修复收摊时如果摊位已经清空导致M2崩溃的bug
2.增加摊位取回收购的物品及下架物品负重检测
3.修复摊位上架时出现和市场上架冲突的bug
4.修复首次打开摊位不显示提成(如果已设置提成)千分比的bug
1月24日（77Client.dat、Prguse.data及M2必须配套更新）
1.修复控制台定时启动报错的bug
2.*开放地摊系统
QFunctionNpc增加3个触发函数(请参考示范版本)
procedure OnBeforeOpenStall(Npc: TNormNpc; Player: TPlayObject; var Accpet: Boolean); //玩家打开摊位前触发,如果Accpet设置为false则不允许打开摊位界面
procedure OnBeforeStartStall(Npc: TNormNpc; Player: TPlayObject; var Accpet: Boolean); //玩家在摊位界面点击开始摆摊时触发,如果Accpet设置为false则不允许摆摊
procedure OnAfterStopStall(Npc: TNormNpc; Player: TPlayObject); //玩家在摊位界面点击停止摆摊后触发
注意：地摊、自由市场里出售或收购单价均表示一个单位物品的价格，可叠加物品实际总价为单价x数量

3.修复技能数据表名称长度可以超过M2允许的范围导致游戏时错乱的bug
4.修复部分图形渲染色彩问题
5.修复M2在某种极限情况下可能导致网关断开的bug
6.修复任务系统标志判断错误导致后续任务无法继续进行的bug
7.任务系统增加ContainMissionIDInDB函数，用以判断玩家曾经是否接受过指定ID的任务
8.暂时取消lua的支持（没时间详细测试lua相关游戏细节，并且导致部分服务器下提示C++运行库的缺失）
1月10日（77Client.dat和M2必须配套更新）
1.修改骰子为支持最多3个点数投掷（请参考帮助或者示范版本修改QF里的函数定义）
2.修改骰子为切换地图时关闭窗口
3.修复内挂自动半月时不自动追踪的bug
4.修复任务系统不加载任务进度的bug（玩家上线可能无法提交已经完成的任务,也不会更新该任务的进度）
5.修复Gamelib.RecallMap无效的bug
6.修复雷炎蛛王喷出的蜘蛛网秒人的bug
7.修复部分属性发送到客户端时以byte类型传送导致数据显示不正确的bug
1月3日（77Client.dat和M2必须配套更新）
1.修正StdMode=3且Shape=13的物品（经验、金币、元宝等物品）使用后不可修复
2.角色、行会及Gamelib均增加清除变量表函数ClearVarTable及删除具体变量函数RemoveVar（执行清空操作后的变量将被移除内存，减少内存占用）
3.修复某些情况下角色上线处于一个黑色地图状态的bug
4.修复刺杀开启时按住shift键不跟踪目标的bug
5.优化游戏网关(优化内存读写；强制IOCP，单网关千人在线不卡)
6.修复任务系统不更新数据的bug
7.修复怪物有主人的情况下死亡触发无法取得其主人的bug
8.修复物品的_Need和_NeedLevel属性无效的bug(这两个属性取值范围请参考版本根据中物品数据库设置时的值)
9.物品增加表示死亡消失的DeathFreeLatent属性和死亡必爆的DeathDropLatent属性，这两个属性均为脚本设置，设置后在客户端物品查看时不显示这两个属性描述
10.修复武僧职业物品需求描述部分缺失的bug
11.地图增加“允许同行会玩家拾取物品”及“允许同行会玩家分配经验值”功能，该功能类似组队，只要玩家同属一个行会即可拾取别人的物品或分配经验
12.增加骰子功能

更新日志 - 2015年
12月20日（优化部分传输，M2和77Client.dat必须配套）

1.修复M2物品参数设置无法保存武器攻击点数的bug
2.Gamelib增加函数SlaveMutiny，用来实现下属叛变
3.调整属下叛变相关控制（M2菜单->功能设置->宝宝系统）
3.游戏日志增加聊天信息记录(任何从聊天框发出的信息均记录，如GM命令、普通功能命令)
4.修复玩家离线挂机情况下仍可以被传送的bug（脚本MapMove传送请检查角色属性NotOnlineAddExp是否为True，是则为离线挂机）
5.修复客户端部分输入框字体不正确的bug
6.*修复多核多线程处理时可能存在网关假死的bug
7.任务系统增加ContainMissionID和TryGetByMissionID函数
8.修复11.23版被动技能无法保存或者技能点数不正常的bug

11月23日（优化部分传输，M2和77Client.dat必须配套）

1.自定义技能持续类增加攻击单次耗MP和再次释放结束持续技能的选项
2.自定义技能取消技能召唤属性，增加召唤技能动作列表
3.修复玩家中蜘蛛网死亡后彻底无法跑动的bug
4.修复客户端显示职业等级时为0的bug
5.M2增加是否实时显示HP选项(M2菜单->选项->参数设置->客户端控制: 显示实时HP情况)
6.M2增加是否实时装备对比选项(M2菜单->选项->参数设置->客户端控制: 显示装备对比效果）
7.Gamelib.ThrowItem和Gamelib.ThrowItemEx 增加限时拾取

11月12日

1.修复骑马状态下被攻击时显示错误的bug
2.修复单独拿盾时不显示外观的bug
3.修复11.11版引起的渲染bug

11月11日（优化部分传输，请使用全套最新程序）

修复脚本刷怪不触发相关事件的bug(MobPlace、MonGen)
所有怪物均指出MoveTo 进行指定坐标移动
支持SQL版日志服务器*
修复属性过多时显示被截断的bug
增加SkillCount、Skills 属性获取角色所有技能
修复M2Server不保存版本key到Project.ini文件的bug
修复网关攻击处理，增强稳定性
修复版本开启注册机制后，在开启此机制的机器上无法取消注册机制的bug
支持CreateAttackEvent 创建一个攻击事件对象
10.修复类似野蛮冲撞时移动速度与M2速度设置不匹配的bug
11.修复地图没设置地图名的时候启动M2不作出提示的bug
12.修复多种报毒的情况
13.自定义技能支持魔法盾类、天雷阵类和火墙类(参考示范版本相关技能设定)
14.允许穿戴后不可去下的物品持久为0时取回到背包
15.修复女性角色骑马后有一个默认翅膀的bug
16.[*]QFunctionNpc中的 BuyShopItem和BuyShopItemEnd 函数定义请更新为（具体可参考示范版本，如果不更新将导致商铺购买时M2崩溃）：
procedure BuyShopItem(Npc: TNormNpc; Player: TPlayObject; UserItem: TUserItem; const Kind, ShopType, Count, Price: Integer);
procedure BuyShopItemEnd(Npc: TNormNpc; Player: TPlayObject; const ItemName: String; const Kind, ShopType, Count, ActualCount, Price: Integer);
10月7日（请使用全套最新程序，包括登陆器和77Client.dat）

1.优化游戏网关，支持掉线重连
2.修复设置师傅后，师傅状态不变导致师徒攻击无效的bug
3.修复登录器部分bug
4.修复M2部分bug
5.修复及优化77Client.dat

8月8日

1.修复全新安装时M2及M2ProjectBuilder报错的bug(缺失Gamelog目录)
2.修复登陆器分区组件是下拉框时，分区密码无效的bug
3.修复某些情况下网关认为正常状态的客户端连接超过上限而导致无法登陆的bug

7月28日 ( 必须更新M2Server及77Client.dat)

1.修复NPC点击可能无效的bug
2.修复客户端连接登陆网关极易出现出现连接断开的bug
注：登陆网关、角色网关及游戏网关的超时设置建议在3000-60000毫秒之间(3-60秒)

7月22日（请使用全套最新程序，包括登陆器和77Client.dat）

1.优化M2刷怪，提升刷怪速度
2.修复开宝箱后继续转动时如果金币或元宝不满足需求时宝箱界面不关闭的bug
3.开放防CC攻击处理(配置方便、零负担)

登陆网关

角色网关

游戏网关

免费版

支持

支持

不支持

商业版

支持

支持

支持

4.修复神圣战甲术和幽灵盾增益数据不显示的bug
5.修复Appr为990-992时客户端不显示怪物外怪的bug
6.修复7.7版m2可能无法关闭导致无法保存角色数据的bug
7.角色增加Push函数用来将当前角色向指定的方向推出指定的距离
7月7日
1.修复从商店购买物品时不检查背包负重的bug
2.修复内挂自动吃药可能卡药的bug
3.修复内挂在无药可吃之后获得可拆包药品时不会自动拆包的bug
4.QFunctionNpc增加设置称号时触发事件OnActiveTitleChanged(脚本指定称号时不触发) ，请参考示范版本增加该事件
5.修复无法使用重载ShowSighIcon函数的bug
6.修复”!”地图内喊话为全服喊话的bug
7.修复怪物Exp属性无法取经验值的bug(玩家EXP属性为当前经验值，怪物则为数据库经验值)
7.优化M2 CPU占用*

6月23日

1.套装增加武术属性
2.修复6.22版自定义UI导致开门崩溃的bug
3.修复地图怪物和人物计数在复活之后不正确的bug

6月22日

1.修复VarBoolean定义的变量赋值始终为True的bug
2.任务系统开放IndexOf及IndexOfLink用来获取指定ID的任务对象所在的序号
3.角色增加LockMoveItem、UnLockMoveItem及LockMoveItemEx用来锁定客户端物品移动
4.M2增加物价计算控制(游戏参数->价格费用: 物价计算)
5.修复自定义物品框允许道具范围设置为”“时无法放置任何物品的bug(设置为”“时可放置任意物品类型)
6.修复版本工具删除某些节点时报错的bug
7.修复客户端使用CTRL+A让下属休息后下属仍然做出攻击动作的bug
8.修复客户端加载比较大的自定义UI时比较耗时的bug

6月7日

1.修复爆率文件名无匹配名称怪物数据时，通过修改怪物DropName重定向爆率文件无效的bug
2.[重要]StdMode=7类物品（气血石、魔血石及可穿戴宝石）规则从M2设置改为物品数据库设置，请参考示范版本进行数据处理
3.(*)客户端性能优化（大幅降低CPU占用率）
4.修复DBServer设置禁止恢删除人物时执行客户端点击恢复按钮，然后无法选择人物进入游戏的bug
5.修复弓箭手精准箭术及蓄势待发无法增加技能修炼的bug
6.修复扩展按钮、Buffer图标点击后焦点错误导致一些快捷键无效的bug
7.修复市场上架通过点击”X”按钮取消时物品不会立即返回背包的bug
8.修复玩家可见范围与大于系统消息广播范围时可能出现虚假形象的bug()
9.修复原地复活后当前地图人物或怪物数量不增加的bug
10.修复被秒杀时有可能不触发死亡事件的bug
11.UI设计增加复制、剪切、粘贴功能
12.登陆器特性修改：当打开客户端数量超过最大数量时，自动隐藏登陆器，并在打开客户端数量小于最大数量时取消隐藏

5月31日

1.修改角色幸运属性BodyLuckLevel为Luck
2.修改任务系统AddMissionLinkEx函数，支持等级限制显示
3.修复StdMode=34时（如聚灵珠）爆出数量无限制的bug
4.修复设置物品爆出为任意拾取时不触发QF中MonDropItem事件的bug
5.优化客户端渲染及其他处理
6.版本工具脚本编辑器强化编辑功能，增加书签设置跳转、批量选择脚本编辑及脚本转换到HTML格式
7.修改M2设置淬炼为空格时客户端不启用淬炼按钮功能（如果为空则重启M2后会恢复为淬炼）

5月25日

31类物品支持持久处理（非叠加物品）
支持任务系统
优化客户端，提升客户端流畅度
支持类及时雨内挂(登陆器列表里选择内挂样式)
5.优化一些内核算法
5月10日 [请使用全套最新程序，包括登陆器和91Client.dat]

1.修复StdMode=22时(戒指)额外增加的防御和魔御无效的bug
2.[重要]免费开放全套程序使用，取消免费版程序上线人数限制
免费版登陆器依旧使用版本工具执行生成(无法修改logo，登陆器列表只支持单一列表，无备用列表)
商业用户如果需要修改logo或需要备用列表，请继续使用在线系统生成并下载登陆器和M2Server
3.修复聊天时”,”及”=”两个符号被编码的bug
4.修复角色CallMethod无法处理怪物NPC的bug

5月3日

1.修复等级上限设置超过65535时自动截断的bug
2.修复客户端处于非焦点状态静默模式时重复播放的背景音乐会在下一轮自动播放的bug
3.修复M2关闭战力系统后客户端仍然显示战力排行的bug
4.修改当客户端淬炼按钮没有名称时为关闭该按钮功能(M2菜单 选项->参数设置->客户端控制->淬炼按钮名称)
5.修改可叠加物品(StdMode:0,1,3,42)绘制时如果数据库DuraMax小于等于1则不显示数量信息（如“x1”）
6.修复RandomUpgrade时物品下限不会置零的bug
7.套装增加客户端是否显示套装属性选项
8.套装增加时装、坐骑、盾牌选项
9.角色增加状态检查函数CheckState，用来检查角色是否处于某种状态，如中毒、魔法盾、麻痹等
10.修复某些情况下M2保存人物数据出现“保存人物数据超时”的bug

示范版本：
1.修复千里传音脚本持久为0还可以继续使用的bug(客户端命令集Qianlichuanying函数)

4月19日

1.修复Gamelib.AddClonePlayer复制的角色不处理数据的bug
2.人物增加IPLocal属性用来获取IP来源地址
3.修复关闭客户端声音时报错的bug
4.修复地图以”$”开始为标记时无法显示地图标识的bug
5.修正聊天框中物品提示为点击后弹出物品提示框
6.修复M2中一处可能导致崩溃的bug

4月13日

1.修复4.12版地图事件触发无范围限制的bug
2.修复DBServer自动升级角色表结构时可能导致数据丢失的bug（如果启动DBServer时出现升级数据失败的提示，请先关闭占用角色表的相关应用程序）
3.修复等级排行榜性别错误的bug
4.修复排行榜右键菜单位置不正确的bug

4月12日

1.[重要]QFunctionNpc中获取经验事件GetExp更名为OnGetExp，同时经验参数Exp支持修改
2.背包淬炼按钮点击时触发QFunctionNpc中OnRefineButtonClick事件(拦截此事件可做背包随身NPC功能)
事件定义：
procedure OnRefineButtonClick(Npc: TNormNpc; Player: TPlayObject; var Handled: Boolean);
3.NPC对话框中Hint属性支持换行及颜色处理
4.修复QFunctionNPC中PlayerReAlive不触发的bug
5.修复QFunctionNPC中SlaveKillPlayer不触发的bug
6.NPC和角色增加Question函数，用来显示对话框进行提问，并根据玩家选择是或否来处理相应的事件函数
7.优化寻路算法，修复自动寻路可能绕路的bug
8.开放CTRL + Z键自动挂机功能(挂机时技能使用请配合数据库技能功能类型设置)
9.修复战力计算错误的bug
10.修复地图事件触发必须要地图ID和地图文件相同及副本不触发地图事件的bug
11.开放排行榜系统 ，支持脚本控制排行榜 同时支持脚本重新计算排行榜
12.版本工具爆率调整增加批量追加爆率功能

3月22日

1.修复客户端不显示武僧属性点加点按钮及属性计算错误的bug
2.QFunctionNpc增加采集前触发，非示范版本请自行添加事件函数声明。
事件定义：
procedure OnBeforeCollect(Npc: TNormNpc; Player: TPlayObject; Monster: TActor; var Accept: Boolean);
如果Accept为False则不会执行采集动作,默认为True

3.增加FlashWindow函数，用来向非激活状态的客户端发送一个标题栏闪动(可做最小化状态时事件提醒)
4.开放右键直接查看角色装备的功能(M2Server菜单->选项->参数设置->客户端控制)
5.修复自定义UI里面的玻璃音效无效
6.取消登陆器浏览器组件边框显示
7.修复怪物掉落聚灵珠时聚灵珠附带经验的bug
8.修复无限仓库合区时部分仓库信息丢失及行会合区时信息可能丢失的bug
9.修复普通仓库和无限仓库存取无效的bug

3月12日

1.版本工具支持按下Ctrl键的时候将选择地图直接移动到目标地图的附属地图节点里面
2.版本工具支持将传统版本一键导入到77里面（导入后部分脚本或配置需要手工处理）
3.地图增加“杀怪触发”分组（对应传统版本中MapQuest.txt中的杀怪任务配置）
4.优化传统脚本编译（4mb的全传统脚本版本文件编译速度从25秒提升为1.5秒）
优化混编时pascal和lua脚本的编译速度
5.优化地图对象编辑器，支持坐标网格显示，支持拖拽和滚轮放大镜
6.支持选角色时分页
7.修复人物小退时进度条不隐藏的bug
8.修复金客户端不刷新荣誉点的bug
9.修复普通仓库存储时存到无限仓库的bug(@bigstorage为存往无限仓库 @biggetback为从无限仓库取回)
10.修复类似脚本搜索时，如果同一脚本单元存在多个搜索结果的时候可能定位不正确的bug

2月10日

1.行会对象增加修改帮主函数ChangeChief、获取称号列表函数GetRankNames、获取某个称号下所有人函数GetRankMembers 、
称号添加 AddRankName、删除称号DropRankName、修改称号UpdateRankName及指定称号下成员添加AddRankMember
2.版本文件增加版本标识属性，增加版本配置文件节点。发布版本时请使用此配置
3.调整M2中部分配置读取方式以适应版本内置配置模式
4.怪物数据库开放ACMin及MACMin字段，用来表示怪物物防和魔防的下限值。
怪物的防御下限默认为0，在玩家伤害输出大于0时，怪物属性不管多高都有可能对怪物造成伤害；但是设置了下限值，如果伤害输出低于怪物的防御下限，则不可能对怪物造成伤害（会心一击除外）
5.支持盾牌(副手)物品，角色属性Shied取得盾牌对象
6.武器类型5调整为单手武器，可装备盾牌(副手)；武器类型6调整为双手武器，不可装备盾牌(副手)
7.角色增加DeleteUseItem函数，用来删除穿戴的某个位置的装备（彻底删除，不放回背包、不检查是否可以脱掉、不触发穿戴事件）
8.修复吸血属性无效的bug
9.增加加入队伍函数JoinGroup及离队函数LeaveGroup
10.取消商人是否允许贩卖、是否可以使用仓库、是否可以发送消息等选项，替换为当消息传递时需要对应的功能时就开启
11.增加地图对象编辑功能，支持NPC、刷怪、地图事件及入口点等对象可视化设置
12.开放部分4级技能（请自行添加数据库技能内容）
13.修复客户端自定义技能对有效攻击距离判断不正确的bug
14.修复麻痹效果绘制不正确的bug
15.修复面巾(斗笠)无法取下的bug
16.修复合区时如果不选择合并账号数据库则无法合并人物的bug
17.客户端音频文件支持wav、mp3、ogg等常见音频类型

1月25日

1.提供MakeMaskString函数及ConvertMaskString函数，用来对字符串进行掩码处理
注：针对客户端向服务端发送的字符串，经过服务器以聊天信息的方式转发给客户端，此时内容需要经过MakeMaskString处理，
将一些特殊字符进行转化，防止出现命令漏洞；同时经过掩码转换处理的字符串如果需要还原，则使用ConvertMaskString函数
进行处理
2.单元加密规则调整(请使用最新版本工具和M2)
3.修复离线挂机人物上线不会自动打开部分默认为打开的技能（如刺杀剑术、半月弯刀）
4.优化下属护主的能力（某对象准备攻击主人时，下属即开始行动）
6.修复聚灵珠在商城显示不正确的bug
7.怪物增加SlaveLevel属性，作为下属时用来表示当前的等级（宝宝等级）
8.QFunctionNpc增加SlaveLevelUp事件函数，在下属升级时触发。定义为：
procedure SlaveLevelUp(Npc: TNormNpc; Master, Slave: TActor; NewLevel: Integer; var Accept: Boolean);
9.修复 登陆器设计 无法为图形按钮添加bmp格式以外的图片格式的bug
10.修复ClearList导致文件独占的bug
11.增加玩家面纱装备属性Mask，用来访问面纱道具

角色额外属性增加致命一击、会心一击、伤害吸收及伤害反弹等属性
13.修复通过类似吃药、技能增加等方式取得的固定属性提高可以被百分比增加时再次计算的bug
14.修复脚本地图传送及查找地图时地图名区分大小写的bug
15.Mogen及MobPlace函数增加刷怪触发事件的参数
16.支持沙巴克新城墙，904: 沙巴克左城墙 905: 沙巴克右城墙 906 : 沙巴克中城墙
17.修复NameColor赋值修改名称颜色无效的bug
18.修复怪物防御下限及魔御下限偏高导致低攻全输出MISS的bug
19.怪物及怪物NPC状态监视增加“受到伤害”监视处理，当受到伤害减少血量时，将触发QM事件函数MonitorDamage（请参考示范版本）
1月11[请使用全套最新程序]

1.取消客户端“已装备”素材绘制时默认透明处理，修改此素材时使用PNG透明图片即可
2.修复1.3版组队按钮不显示的bug
3.开放聊天框命令点击功能，如：可以通过Player.SendMessage(‘欢迎使用在线充值/@Q55.pay系统’)让聊天框出现可点击触发函数的链接
4.修复登陆器如果列表地址过长可能导致无法读取列表的bug
5.修复客户端聊天框粘贴时允许多行内容的bug
6.修复版本工具文本搜索时报错的bug
7.修复离线事件执行两次的bug
8.修复部分地图无法读取及自动寻路不准确的bug
9.[重要]物品数据 幸运、攻速计算公式 调整及物品存储 数据升级
调整武器数据库幸运及攻速计算：
攻速：原MAC2大于10表示加小于10表示减速，更改为MAC大于0为加速小于0为减速度
幸运：原AC表示幸运MAC表示诅咒，更改为MAC2大于0为幸运小于0为诅咒
调整项链数据库幸运及攻速计算(SdtMode= 19)：
幸运：原MAC表示幸运MAC2表示诅咒，更改为MAC2大于0为幸运小于0为诅咒
调整项链数据库幸运及攻速计算(SdtMode= 21, 23)：< /FONT>
攻速：原AC表示速度增加MAC表示速度减少，更改为MAC大于0为加速小于0为减速度
即：调整之后StdMode为5,6,19的MAC2大于0为幸运小于0为诅咒
调整之后StdMode为5,6,21,23的MAC大于0为加速小于0为减速度
本次数据升级非自动升级，运行服务端之前请使用版本工具升级相关数据(打开版本文件->工具栏->数据库->数据升级)
10.套装增加武术倍率
11.调整Prguse.data素材418-429为会心一击效果(示范版采用和致命一击相同素材,请按自行修改此素材)
12.人物增加函数 ChangeKillMonExpRate（普通脚本示例）用来调整杀怪经验倍数
13.修复部分绑定状态不判断的bug
14.登陆器支持限制最大可打开的客户端数量

1月3日

1.修复微端在某些网络安全环境下被认为Syn Flood攻击导致连接被拒绝的bug
2.修复公共单元与其他脚本单元名称重复的情况下保存版本，下次重新打开报错导致无法打开的bug
3.修复版本工具中拖放一个地图到另外一个地图的附属地图时可能出现版本工具崩溃的bug
4.修复自定义技能魔法躲避增加到敏捷属性上的bug
5.修复自定义UI输入框传值后函数内获取时参数序可能不对的bug
6.修复登陆器图层绘制错位的bug
7.优化商城功能及修复和商城相关的bug

更新日志 - 2014年
12月28日

1.修复合区时非常耗时的Bug(新的合区方式不再读取原来合区的备份文件,如果恢复以前的备份请使用以前的合区工具)
2.修复某些情况下释放技能错误导致无法攻击的bug（如武僧无法强制攻击）
3.修复角色在线时长属性LogonTick取值错误的bug
4.修复版本工具导入爆率、入口点、刷怪等配置时，如果地图名和地图文件名不一致时导致解析失败的bug
5.修复人物背包金币接近上限的时候杀怪仍然可以金币直接入包从而导致金币数量超过上限的bug
6.M2增加发送系统公告的功能菜单(工具->发布公告)
7.修复勋章极品属性不读取的bug
8.修复登陆器边框可拖拽的bug
9.修复示范版本半月弯刀无法施展的bug(修改技能数据库最大攻击距离为1)
10.修复正确配置的宝箱无法打开的bug
11.修复示范版本召唤白虎无效的bug(技能数据库名称为”召唤圣兽”,改为”召唤白虎即可,同时需要怪物数据库配置相应的召唤兽)
12.版本管理器中在线技术交流平台上线，希望大家bug提交和经验文章都转移到该平台

以下为非bug，但是需要注意的事项：
1.千里传音的使用：示范版本在脚本里模拟了千里传音的使用，所以”@传”命令执行时调用了脚本处理，如果需要调用默认处理请删掉脚本对应的部分(千里传音物品: StdMode=7 Shape=0)
2.如果需要在WIN7及更高版本操作系统中使用DX9，请发布时附带d3dx9_33.dll文件

12月15日

1.修复NPC可修复非装备类物品，导致物品数据错误的bug
2.增强版本管理工具版本管理界面、脚本编写界面及其他文本编辑界面文本搜索及替换功能
3.增加单脚本文件保护(其他人可以打开版本文件编辑，但是被保护的文件需要校验密码后才可以打开编辑)
4.支持对话框中命令下划线开关。如果&你好/@Say表示不显示下划线，而你好/@Say则显示下划线
5.开放面对面交易按钮(M2Server->游戏参数->客户端控制),该按钮默认为开启状态
6.修复同行会的管理员面对面可以将自己的行会进行结盟的Bug
7.修复获取地图怪物数量时数量重复的bug
8.增加DeleteDelayCallMethod函数，用来删除DelayCallMethod指定的延迟调用
9.修复传统脚本SET赋值无效的bug
10.修复坐骑素材读取路径错误的bug
11.修复武器负重计算到人物穿戴负重的bug

11月24日

1.角色增加DelayCallMethod函数，用来更简单的做延时函数调用(注意和DelayGoto的区别)
2.修复客户端截取用户名导致名字偏长的角色无法进入游戏的bug
3.支持普通脚本混编模式(可加快一般脚本编写速度)
4.修复人物使用药品的时候可能出现药品消失的bug
5.修复批量导入PNG时不透明的bug

11月15日

1.修复StdMode=2时物品类型不显示的bug
2.修复自定义UI中输入框值作为参数传输时可能不准确的Bug
3.修复自定义技能能力值来源为射术和刺术时无法按照相关能力值进行输出的bug
4.修复自定义技能被动属性中吸收伤害、伤害反弹、伤害加成、致命一击及会心一击无效的bug
5.修复自定义技能物理攻击时触发(如攻杀剑术)类型无伤害输出及不计延迟时间的bug
6.M2中增加默认的强化属性（修复全新安装下如果不设置强化属性会出现强化不显示属性的bug）,请自行修改强化等级对应的属性及值
7.更新登陆器最多可同时打开5个
8.修复天下第一雕像外观显示错误的bug(请参考示范版本的天下第一设置进行修改)
9.修复诱惑之光类型的召唤技能在召唤下属的时候，新召唤的下属可能会持续被原有的下属攻击的bug
10.提高自定义技能中诱惑怪物的成功机率
11.修复刺客残毒药无效的bug(以自定义技能方式处理，请参考示范版本相关设置)
12.修复自定义技能禁止移动后仍然可以移动的bug
13.修复0级灵魂陷阱无法锁住目标的bug(参考示范技能设置，锁定时间为:(Power+Random(MaxPower - Power)) 技能等级 1000毫秒
14.修复人物死亡身上物品掉落后不刷新人物属性及外观的bug
15.修复技能设置最大攻击距离为0时导致近身攻击无效的bug(修复半月弯刀)
16.修复切换人物后感叹号按钮依旧存在上一次数据的bug
17.修复自定义技能判断目标释放环绕于自身无效的bug
18.版本工具地图导入支持“[地图ID|地图文件名 地图名]”格式的导入
19.修改客户端ALT+Q为大退游戏
20.修复武器攻速显示错误的bug(Mac2 0-9为减速度, 11-20为加速度(Mac2-10))
21.修复使用声望卷时客户端不更新的Bug
22.修复副本可能刷不出怪的bug
23.修复自定义技能召唤类无效的bug

11月12日

1.修改全新安装时M2人物速度控制跑和走为600毫秒（影响客户端角色速度， 建议速度为500-600，客户端视觉更流畅）
2.修复自定义技能半月类型释放后关闭无效的bug

11月11日

1.修复聚灵珠物品属性显示错误的bug
2.修复使用脚本发送物品到聊天信息时会将属性字符串显示出来的bug
3.增加”91Resource\Data\Images.data”文件的读取(建议一些自定义自己的素材放到里面，减少对Prguse.data文件素材的增加操作)

11月10日

1.调整地图读取方式，在版本管理器中如果地图文件名前加”$”则表示强制从”91Resource\Map\”目录下读取地图，同时微端也只从对应的位置读取，如果不加”$”则优先从”91Resource\Map\”目录下读取，如果没有相应的地图文件则从根目录的Map文件夹读取，但是微端则只从根目录Map文件夹下读取。如”0.map”和”$0.map”读取位置是不一样的
2.微端修复及读取规则调整
3.修复多个下属存在时，当一个下属攻击其他对象而另外的下属处于围观状态的Bug
4.修复自定义技能类烈火召唤类技能冷却时间及超时时间无效的bug
修复自定义技能类烈火召唤类技能攻击可能无效的bug
5.修复防外挂处理机制可能造成错误的加速判断的bug

10月27日

1.人物增加函数SetActiveTitle，用来设置或者取消当前称号
2.修复称号翻页后设置无效的Bug
2.修复10月26日更新导致的UI面板无属性的bug，修改人物初始魔法躲避为10%，修复称号系统魔法躲避显示错误的Bug

10月26日【必须使用全套最新程序】

1.修复版本管理器中自定义Buffer文字颜色及背景颜色修改无效的Bug
2.物品对象TStdItem开放相关绑定属性读取，如是否存仓、是否可修理及是否绑定等（需要注意与TUserItem存在的区别）
3.宝石属性增加武术属性
4.Gamelib增加AddMonNpc函数及及RemoveMonNpc函数用来增加删除怪物Npc
5.自定义技能增加“允许选择死亡对象”选项(可用来处理类似复活术技能)
6.修复M2重新加载版本相关的数据时，可能造成数据丢失的Bug
7.修复魂炼系统默认升级处理没有武术的Bug
8.完成称号系统(请注意更新Prguse.data，称号素材来自于Title.data，每3个图片表示一个称号，分别表示正常、按下及鼠标经过的状态)
人物增加函数AddTitle、RemoveTitle及属性ActiveTitle、TitleCount、TitleItems
9.取消M2全新安装时人物死亡处理默认为回城复活的方式
10.[重要]全面启用UNICODE(UTF-8 修复特殊字符乱码或其他语言系统乱码的bug)
11.自定义窗口物品框增加物品放入及取下时触发事件（函数定义同main函数，可用来更新界面描述信息）
NPC及人物增加函数UpdateSay ，用来更新自定义界面的文字描述
12.自定义UI增加编辑框类型
13.调整物品数据库StdMode=19的项链的魔法躲避属性AC2读取方式（如白色虎齿项链，调整前AC2的值为2，表示魔法躲避20%，调整后为2%）
修复套装属性设置魔法躲避值为50，而实际效果为500的bug
14.修复I标签指定F属性从任意data文件中取素材均从Prguse.data文件中读取的bug

10月12日
1.修复物品数据库绑定状态无效的Bug(物品生成的获取数据库指定的绑定状态，之后该绑定状态属物品本身，与数据库设置无关)
2.集成怪物说话信息到版本文件中
3.修复逐日剑法不会自动调整到一条直线上再攻击从而导致攻击无效的Bug
4.修复版本管理器中游戏数据库SQL使用”%”执行LIKE操作无效的Bug
5.角色增加当前等级经验值上限属性MaxExp
背包负重Weight, 最大背包负重MaxWeight
穿戴负重WearWeight,最大穿戴负重MaxWearWeight
手持负重HandWeight,最大手持负重MaxHandWeight
6.修复客户端技能冷却时间在移动及被攻击状态下计算不正确的Bug
7.增强技能数据容错处理(如示范版中将万箭齐发的Power设置为50，而将MaxPower设置为0，从而导致数据溢出出现非正常攻击力)
8.修复武僧可选择女性的Bug
9.修复在连续使用有冷却时间的技能时可能会卡住的Bug(技能释放失败)
10.加强角色转职及调整性别时的逻辑处理(限制职业及性别)
11.[重要]调整自定义技能脚本触发的函数入口声明，增加鼠标所在的X、Y坐标参数，详见示范版本。
函数声明格式：
function 函数名(ASource, ATarget: TActor; ATargetX, ATargetY, AMouseX, AMouseY: Integer; AList: TActorList; AMagic: TUserMagic): Boolean;

10月1日

1.修复自定义技能烈火类召唤技在释放的时候会绘制技能效果且会卡住的bug
2.修复自定义技能命中后的目标效果播放时机不正确的bug
3.修复自定义技能MP不足时仍会播放释放效果的bug
4.自定义技能客户端渲定义->辅助增加是否锁定目标选项，选中后客户端会执行魔法锁定
5.自定义技能客户端渲定义增加效果帧播放间隔时间（毫秒）
6.M2游戏参数->游戏选项(2)增加”启用怪物攻击技能选择”，MagicNpc增加函数MonSelectMagicBeforeAttack，两者配合用来执行除人物及人形怪以外的怪物在攻击时是否选择技能的处理(当前只支持远程魔法类技能)
7.角色对象增加Damage函数，用来表示当前对象针对目标直接执行伤害点数（此伤害点数无视防御，如果需要计算防御请自行在脚本中处理，同时该伤害可被目标反弹）
8.怪物数据库增加WC字段(武术),当怪物执行武僧技能时采用此字段的值做技能伤害输出

9月27日
1.修复武器幸运显示为双倍的Bug
2.修复脚本引擎变量解析及函数返回存在的Bug
9月25日
1.修复狮子吼绘制错误的bug
2.修复自定义技能范围对象选择方式为“作用于魔法起点为中心的范围上”时存在方向计算错误的Bug
3.更改示范版本技能“降龙伏虎”、“达摩棍法”的攻击范围，自定义技能如果攻击多条线请参考这两个技能的设置
4.修复部分Buffer不提示的Bug
5.修复Gamelib.SaveItemToStore及Gamelib.LoadItemFromStore失效的Bug
9月23日
1.修复自定义技能推开动作无视等级差距的Bug
2.修复自由市场不自动升级导致数据丢失的Bug
3.增加时效性机能动作最低有效时间(参考易筋经设置)
9月22日
1.修复弓箭手旋风腿可推开等级比自己高的角色的Bug
2.修复M2自动升级ItemStore时可能报错导致M2无法继续执行的Bug
3.增加TArgs参数对象Add函数及Clear函数
4.修复MySQL在升级时无法创建自增字段导致升级角色表失败的Bug
5.提升全套程序启动速度(程序文件本身体积略有增加)
9月21日[六职业 必须使用全套最新程序]
1.修复无法删除人物的Bug
2.修复打开自定义窗口后无法使用0..6的快捷键的bug
3.修复脚本存仓不刷新负重的Bug
4.修复Stdmode=26类物品不计算防御的Bug
5.修复自定义技能已知Bug
6.实现武僧职业，以自定义技能实现全部武僧技能(技能参数请自行调整，装备请自行添加，成长属性请自行调整)
7.增加装备属性下限 极品属性支持(需要开启属性下限 )
8.修复矿区爆率调整编辑时，点击左边的地图爆率不更新的bug
9.修复版本工具关闭时可能报错的Bug
10.调整持久值最大可为21亿
11.角色(怪物及人物)增加属性NoDropItem及NoDropUseItem用来表示是否死亡爆出物品
12.修复弓箭手部分技能数据库设置伤害无效的Bug
13.修复网关之间部分数据传输没处理封包校验而导致校验失败的Bug
14.修复0831版人物登陆总是请求更新物品数据库缓存的Bug
15.内挂增加MP特殊药品保护，修复内挂保存及读取存在错误的Bug
16.修复伤害减免(伤害吸收)计算错误导致无效的Bug
17.修复解包物品空间需求计算错误导致部分物品无法解包的Bug
18.修复超级MP强化水时间无效的Bug
19.取消内挂对魔血石气血石持久提示（只针对非消耗品提示，如武器、首饰及坐骑等）
20.修复登陆器注册新账号及修改密码成功之后再次打开提交按钮不可操作的Bug
注意：本次更新后引擎将自动升级角色数据库、无限仓库、邮件系统及自定义物品存储系统(ItemStore.dat)，在更新前请先备份相关数据
8月31日
1.修复弓箭手按下Shift键强制攻击时相关错误的Bug
2.更新技能提示信息为技能数据库中编写的提示信息(提示信息内容与NPC对话内容编辑方式相同)
3.修正自定义技能释放无针对目标的时候出现卡顿的bug
4.自定义技能增加脚本触发处理MagicNpc
5.游戏数据库SQL编辑器支持Replace函数执行字符串替换。如:UPDATE StdItems SET Name=Replace(Name, ‘戒指’, ‘1戒2指3’)
6.[重要]启用全职业魔法数据库最大攻击距离设置。攻击距离可选范围为0-14，当最大距离为0时不计算距离，即无论远近均可释放，一般适用于对自身释放的技能，比如隐身、魔法盾及抗拒火环等；1-14则计算距离，不管是近攻技能还是远程技能，只要与目标的距离在攻击距离之内即可释放出来。可参考示范版本进行距离设置 (修正自定义技能远程魔法可无视距离施法的Bug)
7.修复脚本减少金币时可出现负数的Bug(即不可将玩家的金币指定为负数)
8.修复马牌在无套装的情况下显示套装属性的Bug
9.修复使用叠加的药品背包负重不刷新的Bug
10.[重要]修复RunGate开启外挂控制后近身攻击时加速判断不正确的Bug。建议开启RunGate外挂控制功能
11.修复私聊出现信息丢失的Bug
12.TPlayObject(玩家角色)增加MachineCode属性，表示客户端机器码，用来区分是否来自于同一机器的不同账号或角色
13.修复刺杀隔位计算错误导致攻击无效的Bug
14.修复刺客鬼灵步针对障碍物释放后造成所在坐标范围随机移动的Bug
8月24日
1.修复物品爆出前对物品属性修改无效的Bug
2.修复近战技在Ctrl键控制下可持续释放的Bug
3.修复近战技能控制有问题的bug
4.修复宝箱爆率文件打开报错的Bug
5.调整 NPC对话框内容编辑 中E、U属性与S属性可共存，当属性字符串中包含E、U属性的同时又包含了S属性，则不显示装备图片，显示为S属性的内容，鼠标移上去的时候显示装备提示
6.Gamelib.ThrowItem及ThrowItemEx函数支持金币爆出
7.M2中在线人物查看支持显示玩家当前客户端版本显示
8.修复版本工具中预览资源文件夹下的怪物及衣服素材无效的bug(需要设置版本工具的环境变量)
9.修复登陆器打开注册、修改密码及设置等窗口后切换到其他界面，然后再切换到登陆器，此时登陆器界面绘制错误的Bug
10.版本数据库导入兼容其他引擎的部分命名不同的字段
11.修复8.17版客户端不显示宝石属性的Bug
12.修正某些情况下数据缓存更新导致物品显示错误的Bug
8月17日[必须使用全套最新程序]
1.修复宝石第一个属性不可错过255的Bug（宝石属性设置已调整，查看宝石属性设置 ）
[重要 ]如果使用的不是示范版本，则需要在版本数据库管理 中执行批量更新宝石数据SQL:
UPDATE StdItems SET DC=MAC,DC2=MAC2,MAC=AC,MAC2=AC2,AC=Anicount,AC2=Source,Anicount=0,Source=0 WHERE StdMode=29
2.支持技能自定义，技能数据表增加优先等级及最大攻击距离字段(近战技需要设置，请参考示范版本)
3.修复M2不读取角色携带装备的攻击速度的Bug
4.修复M2激活套装属性但可能不赋予给人物的Bug
5.增加套装组成内容显示，可通过装备提示自定义 设置
6.加强封包数据校验 [防外挂设置 ]
7.修复无限仓库不保存及数量不可超过46个的Bug
8.修复自定义物品类型名称 对部分装备类型无效的Bug
9.修复部分环境下客户端登陆黑屏的Bug
10.Gamelib.Mogen 函数增加范围参数Range用来表示刷怪坐标范围(如果版本中使用了该函数刷怪，请更新该函数参数)
11.调整RandomMove函数参数增加RandomMoveEx函数，用来实现本地图随机传送或指定地图随机传送
12.修复装备提示自定义中将基础属性的标题内容置为空后导致基础属性不显示的Bug
13.修复NPC对话框内容编辑 中属性字符串中I标签 无效的Bug
14.调整NPC对话框内容编辑 素材对齐方式。当指定了I、E、U节点的宽W和高H的值后，其中装备图片根据起始位置及宽高自动居中显示
15.修复怪物爆物在部分情况下提示信息有误的Bug
7月27日[必须使用全套最新程序]
1.调整数据传输格式，减少了不必要的数据传输
2.人物开放普通仓库数据访问及无限仓库数据访问，支持从仓库取出物品同时也支持将物品存放进仓库
3.Npc对话增加U属性段，用来显示一个用户的物品(区别E属性段显示数据库物品，支持在聊天框显示此属性段)
4.修复物品数据库中设置绑定状态后客户端不显示的Bug(取消“不可交易,不可出售,丢弃消失”定义，直接定义为获取后绑定，即物品显示为“已绑定”)
5.修复角色AddExp函数减少角色经验值无效的Bug
6.修复宝箱在背包中无法双击打开的Bug
修复角色OpenBox 不发放物品的Bug
角色增加函数OpenBoxEx 用来打开开启宝箱界面，根据宝箱配置可执行多次物品抽取
点击查看如何配置宝箱爆率及如何在物品数据库中配置宝箱物品
7.修复爆率设计中对新建爆率项刷新不准确的Bug
爆率设计支持批量调整替换功能
8.[重要]修复网关异常断开重连导致引擎无法长时间运行的bug
9.增加宝石属性(与装备附加属性相同)
扩展宝石最大属性数到3
10.修复客户端不加载关系系统的Bug
修复关系系统无法删除黑名单角色的Bug
11.修复武器攻击速度和准确存在附加极品属性时显示不正确的Bug
12.优化机器人执行时间判断方式(修复部分情况下机器人不执行的Bug)
13.修复M2中物品项链手镯刺术及射术设置后不加载的bug
14.优化微端数据传输效率
15.技能数据库增加自动追踪机率字段。以雷电术为例，当玩家向位于某点的目标释放雷电术后，在雷电术击中目标前，该目标移动了位置，则目标不会被击中，设置该字段后，引擎有概率自动调整技能到目标的位置达到击中目标的效果。该功能与客户端内挂自动锁定的区别在于，客户端自动锁定表示玩家下次技能选择目标，但是从玩家释放技能到M2处理这个间隔时间里，目标是可能已移动；而该字段设置表示玩家攻击了某目标后M2处理这个攻击事件，目标可能已移位，但是M2会自动调整到目标新的位置。该字段默认值为0，即不追踪，最大值为100，即百分百概率追踪。同时此功能包含了原有的灵魂火符设置里的自动锁定功能，故灵魂火符的自动锁定设置取消。
16.修复成长公式只保存战士的Bug
17.修复组队状态下角色死亡后，不会刷新其他队员状态的Bug
18.修复当物品数据库更新后玩家登陆游戏客户端可能会出现显示物品数据错乱的Bug
19.修复当人物中毒死亡后使用复活中毒效果不消失的Bug
20.当DBServer只允许创建战法道3职业时，客户端装备提示取消职业战法道通用显示
21.怪物NPC增加“守护”属性，默认为选中状态。当选择此属性后，怪物Npc在没攻击对象的时候会回到守护坐标上，如果不勾选此属性，则怪物在其守护范围内可任意移动，位置将不固定（不勾选此选项当怪物NPC的位置被其他对象占有时，怪物NPC不会一直转圈试图归位）
22.修复当背包满后将背包装备穿戴到身上导致装备消失的Bug
23.修复地面对象搜索可能出现部分对象不显示的Bug
24.UI设计自定义窗口属性增加手动关闭窗口属性，开启该属性后客户端打开此窗口只有退出游戏或手工关闭的时候该窗口才关闭
25.角色增加CloseWindow函数，用来关闭一个打开的自定义窗口
7月13日
1.修复导入数据文件时刺术和射术无效的Bug
2.修复客户端部分情况下Data格式资源文件内Png有黑边的bug
3.修复商铺购买叠加物品时可能提示货币不足的Bug
4.修复装备持久提示时显示的装备名称不为最终客户端过滤后的名称而为数据库原始名称的Bug
5.调整NPC素材算法，支持盛大5个npc素材文件及Resource下5个npc文件，点击查看详情
6.M2开放21亿等级上限（版本等级上限请在M2中自行调整，客户端、DBServer、M2Server必须使用最新版本）
7.修复默认小地图样式时地图标识位置偏差的Bug
8.修改游戏数据库导出为JSON格式后可能无法导入的Bug
9.开放角色成长计算(修正弓箭手HP计算错误的Bug)。请注意，本项更新采用全新的成长配置参数，且人物基础属性均可在配置中调整。详见角色成长属性调整
6月26日
1.修复人物在中毒状态下死亡上线/复活毒依旧存在的Bug
2.修复老客户端下图层绘制首位颠倒的Bug
3.修复人物扔装备触发QFunctionNpc中PlayerThrowItem函数时，如果此时脚本对准备扔掉的装备执行了删除或穿戴操作，此时客户端背包还存在物品必须手工刷新的Bug（如果Accept的值不为False，只要物品还在背包就一定会被扔掉）
4.修复进入隐身模式后人物无法移动及攻击的Bug
5.物品增加属性Price2表示物品当前状态的卖价（不计算NPC折扣部分）
6.修复弓箭手左键使用精准箭术远程攻击时有冷却时间的技能可被无限执行的Bug
7.装备提示定义中增加“显示分组间距”属性，勾选后显示分组间距(比如基础属性与附加属，分别表示两个分组，这两个组在显示间距的时候，中间的距会稍微加大些)。默认为显示
8.修复属性设计中对字符串类设置为空然后保存，下次打开版本文件该属性为默认值的Bug（如装备提示中修改“[基础属性]”为空，下次打开依旧为这个值）
[注意]此bug修复对装备提示产生影响，当类似设置“[基础属性]”为空的时候，装备提示中跳过这行显示，如果不想显示“[基础属性]”这几个字，直接置为空即可，如果为空格则此行显示为空行
9.修复队员血条上弓箭手和刺客职业显示错误的Bug
10.修复分身术制造的角色不使用技能的Bug，分身攻击速度请在分身技能设置中调整(示范版本中，物品数据库分身术为全职业使用，而技能数据库限制为法师使用，请根据需要自行调整，示范版本中修改为全职业使用)
6月22日
1.角色扩展一个ShowSighIcon函数，用来方便处理感叹号图标按钮 2.修正角色属性MailCount和MailUnreadCount属性定义错误的Bug
3.修复脚本从当前单元跳转到其他单元并在其他单元使用了NPC对话框后可能弹出来的窗口无法点击其中的链接的Bug
4.修复下属被改名后释放召唤技能无法召回的Bug
5.修复版本工具中修改爆率可能报错的Bug
6.修复版本工具中属性编辑器设置数据可能报错的Bug（如UI设计）
7.修复弓箭手无法开怪物宝箱的Bug
8.修复Race=32,RaceImg=26的采集类怪不显示采集血条和百分比进度的Bug
9.[重要]由于QFunctionNpc中的装备穿戴事件与角色的装备穿戴函数命名相同，导致部分版本开发人员混淆使用导致脚本死循环，故替换QFunctionNpc单元中的装备脱下事件TakeOffItem为OnTakeOffItem，替换QFunctionNpc单元中的物品穿戴事件TakeOnItem为OnTakeOnItem，角色的装备穿戴函数依旧为TakeOnItem和TakeOffItem，如果使用的不是示范版本，请手工修改QFunctionNpc中对应的事件函数
10.修复角色穿戴装备触发QFunctionNpc中的TakeOnItem函数时，在函数中又执行TakeOnItem函数造成死循环从而导致M2崩溃的Bug；角色增加CheckCanTakeOnItem和CheckCanTakeOffItem函数，用来检查装备是否可穿戴在某个位置或某个位置的装备是否可被取下
11.修改毒符位置装备穿戴触发QFunctionNpc事件的条件为：StdMode=25,且Shape值为1、2或5的时候不触发事件(即毒和符不触发)，其他设置在此位置可触发事件
12.优化DX7和DX9的环境中图形处理速度(客户端推荐使用DX9以获得最佳体验)
13.修复当矿区爆率中包含金币时金币为必爆的Bug
14.修复地图事件 触发不准确及附属地图中地图事件无效的Bug（示范版本中针对地图：比奇省->附属地图->废矿入做出了地图事件示例，供大家参考，测试时请开启M2中地图事件）
15.[作废]修复中毒后下线然后再次上线毒依旧存在的Bug
16.修复卖出可叠加物品给NPC后可以在NPC处无限回购的Bug
17.修复开宝箱时物品全部显示3个开孔个数的Bug
18.修复取消装备提示效果自定义中“装备提示显示加星”选项无效的Bug
19.装备提示定义中增加“显示属性增加值”属性，勾选后显示属性的增加值，即类似”[+1]”的部分。默认为显示
20.修复将属性点 加到刺术或射术上时，属性点被扣减而属性没增加的Bug
6月9日
1.修复角色属性MP读写错误的Bug 2.取消类似僵尸复活后可以继续爆物的功能
3.修复弓箭手普通攻击时无法释放魔法的bug
4.修复客户端允运行一段时间后可能出现一些假人现象（存在M2中并不存在的角色，不可被操作）
5.TDataSet增加IsEmpt属性判断数据集是否为空示例
6.修复修改职业到弓箭手无效的Bug 示例
7.取消新建人物后引擎内置的物品发放功能,针对新建人物的物品发放请使用脚本处理
8.支持JSON读写
9.版本管理器中支持游戏数据库直接通过SQL执行维护
10.修复物品离线消失无效的Bug
11.修复Player.Recallmob召唤下属时指定的下属等级无效的Bug
12.将游戏物品数据库中物品说明字段的长度从100增加到1024，可以设计出内容更丰富的物品备注
13.修复ChangeReNewLevel函数调整转生等级和等级不会实时刷新的Bug
6月2日
1.修复分组爆率时对分组的选择存在错误的Bug
分组爆率方式为：分组爆率在被选中之后随即抽取其中的一个物品项，然后根据该物品项的爆出机率判断是否可以爆出所以分组爆率内部的物品同时最多只
有一个物品被爆出，如果分组被选中之后需要必爆其中的一个物品，则分组内物品的爆率需要设置为1/1
2.客户端取消直接转为32色图片，采用素材默认色深，降低了客户端内存使用
3.登陆器配置增加客户端DirectX版本选择，默认为9，当选择的版本不存在时自动匹配系统存在的版本(7、9、11中的版本)
4.修复物理防御和魔法防御下限高于上限的时候出现的错误攻击值
5.修复弓箭手衣服内观错位的Bug
5月29日
1.支持人物属性下限高于上限的处理（类似罗刹穿戴限类性的处理）
2.支持道士技能是否使用毒符的开关，在不使用毒符的情况下，红绿毒为轮流使用；支持人形怪技能释放是否扣减MP值选项，如果扣减MP值当人形怪MP值不够
时将无法释放需要MP的技能，默认为不扣减MP值。默认为需要使用（功能设置->技能需法->基>参数）
3.修复5.25版中在M2上设置技能参数后可能会导致道士召唤失效的Bug
4.版本工具地图文件检查最增加地图缺失文件检查
5.修复0525版冷却时间长的技能释放后无法释放5他技能的版ug(如弓箭手万箭齐发）
6.将人形怪技能加入控制，修复人形怪弓箭手无限释放万箭齐发的Bug
7.系统单元Sys加tils加入函数DirectoryExists，用来判断文件路径是元存在，函数声明：function DirectoryExists(const Dir: String): boolean;
和CreateDir、RemoveDir一样，该函数允许操作的路径只能是引擎Envir之下的路径，其他位置的路径判断永远为False，CreateDir则无法创建Envir目录
之外的路径，RemoveDir无法删除Envir之外的路径
示范版本单元扩展属性示例Q53第67行示范了使用方法
该函数只针对函ascal脚本,lu库脚本则自行使用io库中的函数处理
8.修复人物名称以数字结束时召唤的下属显示的人物名称会过滤掉数字部分的Bug
9.M2下String.ini文件增加国家和阵营消息前缀控制，分别是NationMsgPreFix和CampMsgPreFix，默认为“[国]”和“[阵]”，可自行更改
10.修复弓箭手蓄势待发无效的Bug(精准箭术下才会触发蓄势待发，该技能为被动释放)
5月25日
1.修复关系系统中的逻辑错误
2.更新当不允许客户端创建刺客或弓箭手时客户端装备及人物属性不显示相关属性(脚本中仍然具有相关属性，写版本时跳过相关属性即可)
3.彻底修复DX11（Win7）中按钮点不中的Bug
4.梳理及修复刺客弓箭手技能
5.【重要】启用魔法数据库中释放间隔字段的作用(单位毫秒，两系统技能两次释放的间隔)，增魔法数据库技能失效时间字段（单位毫秒），用于类似战士
烈火召唤后保持多长时间后失效的处理以及弓箭手收天神下凡恶魔降临有效时间的处理。请参考相关技能进行释放间隔时间设置
6.【重要】修复M2内存管理bug（高速运行或长时间运行后内存不释放导致内存占用增加最终M2崩溃的Bug）
7.修复版本管理工具中添加特效帧无效的Bug
8.修复困魔咒不识别阵营的Bug
9.修正召唤圣兽召唤出的怪物和召唤神兽一样的Bug
10.修正弓箭手天神下凡为伤害吸收、恶魔降临为增加箭术上限以及客户端变身效果(M2中可配置)
11.修正M2中弓箭手精准箭术攻击模式选择无效的Bug
12.更新客户端命令集单元（G_Commander）中的TCommander对象，修正版本管工具中报Destroy函数没定义的bug
13.修复关闭服务器时不保存玩家数据的bug
14钟修正，场数据保存为每8分钟一次，而不是原来的只在关闭时保存
15.修正GameCenter运行时无法执行自动备份的Bug；修复合区中的多个Bug(市场合并错乱)
16.修复鸡鹿一类怪物挖出的肉的持久多数时候持久为0的bug
5月10日
1.取消脚本GameLib.Mission及GameLib.MobPlace配合刷怪的函数，改用单独的GameLib.MobPlace来实现刷怪
原GameLib.Mission指定怪物集中地点，GameLib.MobPlace则刷怪向集中地点行进，因大家在使用中可能存在一些误操作会导致刷怪出现问题。
故只留下GameLib.MobPlace函数（原GameLib.MobPlaceEx）刷怪,该函数定义为：
procedure MobPlace(const AMissionMap: String; AMissionX, AMissionY: Integer; const AMonName: String; const AX, AY: Integer;
ACount: Integer=1; ARange: Integer= 0; ACamp: Byte= 0; ANation: Byte = 0);
第一个参数AMissionMap指定刷新的地图，第二三个参数AMissionX及AMissionY则指定了怪物集中的坐标,第四个参数AMonName指定刷新的怪物的名称，
第五六个参数AX, AY指定怪物刷新的坐标，ACount为刷新怪物个数，ARang为刷新偏移范围，ACamp及ANation分别为阵营及国别
需要注意区分的是：MonGen是普通刷新方式, MobPlace是将怪物刷新与某点然后向另外一点集中
示例
2.地图增加属性Freeing，表可副本地图正在被释放，非副本地图一直返回为Fa地se，副本地图返回为true的时候人物入可以通过传送命令进入此地图
3.修正副本明图释放时可能导致M2崩溃的Bug（请参考Dota对战NPC相关说2）
5.增加扩展属性Data示例(使用不当可能导致一系列错误,比如重新加载脚本后出现一些问题)。
全局脚本(公共单元)->扩展属性示例,客户端命令集(Yaoqingma函数),ManagerNpc.PlayerOnInitialization 几处演示了使用方法
5月1日
1.修复自动寻路时小地图上不显示轨迹的Bug
2.修复装备提示宝石射术和刺术显示为未知的Bug
3.调整客户端DX库加载为根据系统DX版本自动加载，即当前系统安装了DX11则采用DX11的版本，安装了DX7就采用DX7版本，如果DX7、9、10及11均没被发现，则按照DX9加载，此时可能机器就必须安装DX9
4.重新设计计性点界面
5.修复M2重新加载技能后客户端技能显示可能混乱的Bug
6.修复套装属性设计中出现重复魔防上限的Bug
7.修复当人物HP/MP上限过低时可能出现不回复的Bug（如人物等级过低）
8.修复M2设置的稳如泰山选项在客户端有时无效的Bug
9.取消Reserved字段为8来处理死亡消失（祈祷系列），改为道具状态中的死亡消失控制，同时修复由此而影响到马牌在人物死亡后消失的Bug
10.修复练功师、采集类的怪物和人物重叠时被挤出原位置的Bug
11.修复人物TitleName绘制位置不一致的Bug,同时修改TitleName默认字体颜色为白色黑边不收人物名称颜色影响
12.更新NPC对象函数SetEffigyState，增加Job参数，用来支撑弓箭手和刺客的雕像。新的使用方法参考示范版本
13.支箭弓箭手及刺客人形怪
14.修复M2等级属性中无法查看刺客职业及无法查看刺术和射术的Bug
15.修正弓箭手、刺客发型Bug
16.怪物数据库增加刺术PC和射术TC字段（针对人形怪，魔法、道术、刺术以及射术很重要）
17.修复版本工具中删除套装后可能不会更新客户版的Bug
18.示范版本中增加数据操作示例：脚本控制中心->全局脚本[公共单元]->DB操作示例
19.修改离线挂机处理：当前账号登陆时线踢掉所有非挂择进入游戏的离线挂机角色
20准修复弓箭手精准箭术升级后不刷新准确点的Bug

4月20日
1.修复及.善归来版、新热血版登陆及角色选择界面
2.修复M2中转生系统设置无法保存的Bug
3.修复无法通过脚本修改物业到弓箭手(刺客的B允g(修改职业时将自动脱下已穿戴的不符合职业的装备到背包，如果背包空格不够则直接以爆出的方式处理，绑于不允许爆出不允许交易类及绑定物品则直接
采取销毁处理所，以如果脚本调整职业时尽量检查背包空格数，如果背包空格不够则提示用户取下装备)
4.修复查看弓箭手装备时，男女素材对换的Bug
5.修复因为物品结构调整导致脚本中AddPoint失效的Bug
6.宝石增加射术和刺术类型（物品数据库AniCount宝石增加属性类型，Source为增加属性点数:1 物防上限 2 魔防上限 3 物攻上限 4 魔攻上限 5 道术上限 6 HP上限 7MP上限 8 射术上限 9 刺术上限）
7.修复物品自定义颜色取值错误的bug（导（扔出色地面颜色显示不正确）
8.修复商铺购买的物品可能出现一些附加属性错乱的Bug
9.修正刺客武器图层绘制错误的Bug
10.修复药品信息显示为百分比的Bug
11.版本管理器登陆器列表设计中增加客户端样式配置，同时DBServer增加允许的职业范围控制(客户端不可以创建DBServer允许范围外的职业类型)
12.修复某些情况下角色选择界面无法保存当前选择角色的Bug
13.修复Gamelib.DBEngine取数据库连接对象失败造成一系列数据库操作无法完成的Bug.Gamelib.DBEngine增加BeginTran启动事务、CommitTran提交事务及RollbackTran回滚事务
14.减小怪物集中刷新模式中实际怪物刷新位置的偏差（集中刷新模式为选择一个刷怪位置，然后在选定的位置上偏移随机距离进行刷新，所以是集中刷新在某个范围内）
15.修复关闭及打开组队功能的延迟过长的Bug
16.修复当删除人物同时该人物在M2中存在的时候M2报报仇数据失败，角色信息丢失的Bug
17.修复装备对比提示时位于第二三个位置的装备的宝石镶嵌显示错位的Bug
18.修复机器人执行函数不可带参数及单元名的Bug（本次更新后允许使用参数，同时允许使用单元名，也就是时钟函数可不固定在机器人NPC里，如果不指定单元名则默认在机器人NPC里查找函数）
19.修复机能释放时MP不足提u为机能冷却的Bug
20.修复0408版脚本提提错误(如导致黄金黑店打暴开、充值系统出错以及可能导致M2CPU暴涨)
21.客户端支持Delete键取消当前魔法锁定的对象
22.修复武器不显示幸运诅咒的Bug
23.物品数据库Need及NeedLevel增加射术和刺术条件
24.修复4月7日版UI预览中消息编辑无法拷贝文本的Bug
25.修复部分业职业技能
4月7日
1.修复NPC.Take函数可能造成可叠加物品数量显示为0而不消失的Bug
2.修复人物AddedAbility属性中射术和刺术无效的Bug
3.修复机器人第一轮可能无法执行的Bug
4.GameLib增加函数AddRobot，，间添加一个定时执行的机器人，第一个参数为执行的时间，第二个参数为执行的函数，执行时间必须大于当执时间
(可通过DateUtils单元的EncodeDateTime函数来生成一个指定的时间，DateUtils单元的函数用法可通过baidu查找)
5.修复大刀卫士类型作为怪物NPC的时候可能不会主动攻击不同国别对象的Bug
6.重设物品结构，提升基础属性数据类型为Word型（如果使用之前的人物数据库，请使用版本工对人物数据表进行升级：打开版本文件->工具栏按钮“数据库”->角色数据库升级）
7.修复版本版本工具中预览自定义UI可能报错的Bug
8.修复客户端切换色彩位深后黑屏的Bug
9.修复角色属性Data赋值后重新加载脚本后能导致的2崩溃的Bug
10.修的ShowEffect不可重复播放的Bug
11.客户端及版本管理工具DirectX版本调整为DX9
12.修复AddedAbility属性错乱的Bug
13.修复拾取自定义名称物品时左上角提示仍为DB中的名字的Bug
14.修复怪物直接针对属性赋值（比如MaxHP）后怪物属性刷新的时候被还原的Bug
15.修复使用脚本增加副本中的NPC后可能导致错误及无法使用脚本删除副本中的NPC的Bug
16.修复重建副本可能出现怪物刷新缓慢的Bug
17.修复下属无法从副本活着出来的Bug
18.内置TMainMethod入口函数类型，同时支持CallMethod来调用一个TMainMethod函数，使用方法请参考本次更新版本中客户端命令集。
19.修复宝宝和角色同国家或同阵营的时显示为友好的颜色不显示宝宝等级对应颜色的Bug
20.修复魔法锁定无效的Bug
21.修正职业为：99:全职业通用 98：战法道通用 0:战士 1:法师 2:道士 3:刺客 4：弓箭手
22.开放归来客户端下五职业测试，DBServer增加客户端可创建人物数量选项，客户端选项增加客户端类型选项，默认为原版（五职业内容不代表最终版，但是基础内容不变）
23.修正角色名称在属性界面显示出属性字符的Bug
24.取消登陆器在16位色桌面中使用Alpha透明处理
3月7日
1.修复商铺热卖第五个物品不显示的Bug
2.角色增加CheckItemSoulLevelUp函数，用来检查一个物品是否可以执行魂炼升级（通过代码调整魂炼经验后再通过本函数来确定是否执行升级操作）。如： Player.CheckItemSoulLevelUp(AItem);
3.修复M2设置等级限制不保存的Bug
4.修复装备强化属性设置中项链设置无效的Bug
5.修复3月6日版客户端无法调用正常游戏模式的Bug
3月6日
1.修正无法看到他人骑马奔跑状态的Bug
2.物品数据库开放职业职业(Job)字段（99:全职业通用 98：战法道通用 0:战士 1:法师 2:道士 3:刺客 4：弓箭手）
五=业通用的h器：StdMode=6 Shape=19 （鹤嘴锄）
五职业通用的衣服：StdMode=10,11 Shape=1,2 (布衣,轻型盔甲）
注：此字段以前就设计了，当时默认值是0，所以本次更新如果不使用示范版本，请多选数据后点击右键菜单进行职业设置。
此次更新后将以职业字段作为一个判定数据，所以必须重新设置职业，否则穿戴将会出现限制
3.修正人物属性MasterName无法写入的Bug（导致无法完成师徒系统）
4.修正装备属性AddHold无法赋值为-1及0的bug（导致无法将孔置为未开孔状态和未镶嵌状态）
5.怪物爆率设置增加“任意拾取”属性，选择此项后怪物爆出的物品将不限制拾取人，默认为不开启状态
7.修正NPC对话框中设置的函数参数对于掩码字符不转换的lug。比如”点击/@Cli设k(#40xxx#41)“g#40和#41将会替换为“(”和“)”
8.角色增加属性Data（怪物、Npc及人物均包含此属性），用来在脚本中扩展任意的自定义数据。
procedure PlayerOnLogin(Npc: TNormNpc; Player: TPlayObject; OnlineAddExp: Boolean);
var
AData: TMyData;
begin
if Player.Data = nil then
begin
AData := TMyData.Create;
AData.OldIndex := 100;
Player.Data := AData;
end;
end;
注意：仅适用于pascal脚本，此属性默认值为nil，在脚本中如果针对此属性赋值后将在角色死亡的时候自动销毁
9.修正版本管理工具中素材批量导入时当文件名称格式不一致时导致顺序错误的Bug
10.修复2月16日版造成的魔防与魔法计算错误的Bug
11.修复可能出现右键无法装备戒指的Bug
12.支持默认合并可叠加物品，支持背包刷新时合并可叠加物品。（绑定状态及期限都相同）
13.修复当使用脚本修改穿戴在身上的坐骑属性后客户端不实时刷新的Bug
14.r持角色TargetActor属写的写入操作，即可给角色指定一个目标。
注意区分：eargetActor 表示当前攻击对象
LastHiter 表示被这个对象杀死
ExpHitter 表示死亡后由该对象获得经验值
15.开放对象属性RaceType，表示当前对象的种族类型（0:人物 150:人形怪 10:NPC）
16.开放AINpc，目前只处理对象Run过程，需要在M2游戏选项中启用该功能
17.物品提示中如果物品重量为0则不显示重量描述
18.修复武器不显示幸运及诅咒的Bug
19.修复某种情况下人形怪被成为友好的怪物NPC造成无法点击执行攻击的Bug
20.修复非友好的人形NPC在小地图上显示为绿色点的Bug
21.修法当M2允许客户端稳如泰山的时候客户端内挂无法选取户如泰山选项的Bug
22.M2参数设置中人物死亡选项增加尸体清理方式（修复人物死亡后一段时间再小退造成验证失败的Bug）
清理：踢出客户端连接并且清理尸体 不清理：不踢出连接也不城理尸体 回城复活：将 物传送回城并且复活
23.修复怪物NPC选择攻击红名及入侵怪物无效的Bug
24.修复个人机器人及系统机器4可能不会被执行的Bug
25.修复部分技能秒杀怪物后无物品爆出及经验获取的Bug
26.增加客户端使用StdMode=33的物品点击穿戴物品触发QF中函数ItemClickUseItem，函数定义：
Pascal:
procedure ItemClickUseItem(Npc: TNormNpc; Player: TPlayObject; ItemWhere: TItemWhere; Source, Dest: TUserItem; var Accept: Boolean);
begin
end;
Lua:
function ItemClickUseItem(Npc, Player, ItemWhere, Source, Dest, Accept)
return Accept
end;
参数ItemWhere表示被点击的物品Dest穿戴在身上什么位置，Source表示客户端拿起的Stdmode=33的物品，Dest则是表示被点击的物品，
Arcept表示是否执行，如果值为true则将删除Source这r物品

2月16日
1.NPC对话编辑支持支持提示信息，标识为“Hint”。如：{S=文字描述;Hint=提示信息}{S=传送;Hint=点击后传送到目的地}/@Move
2.自定义界面按钮、标签支持提示信息
3.修正1.29日版可能出现安全区识别错误的Bug
4.大幅提升判断角色是否处于地图安全区函数的性能
5.修正GameCenter中动eIP模式无效的Bug
6.修正M2列表信息中查看自定义装备名称可能报错及位置错误的Bug
7.5持人物属性超过65535
8.M2在运行期产生脚本错误的时候支持错误行号显示（当脚本报错请根据提示的信息进行排错）
9.更新Player.SendCountDownMessage函数结构，其后增加两个参数，分别是代表消息标记的Flag及代表是否改变
地图删除消息的ChangMapDelete, Flag默认为0，ChangMapDelete默认为False，以前的脚本本次不需要修改即可
编译。示例：
//发送一条标记为10000的倒计时消息，该消息当角色切换地图的时候自动删除
Pascal: Player.SendCountDownMessage(‘<$HTime:300$>倒计时测试…’, 0, 10000, True);
Lua: Player:SendCountDownMessage(“<$HTime:300$>倒计时测试…”, 0, 10000, true);
10.角色增加函数DeleteCountDownMessage,用来删除SendCountDownMessage发送的消息。示例：
Pascal: Player.DeleteCountDownMessage(10000);
Lua: Player:DeleteCountDownMessage(10000);
11.修复1.29日版客户端Png绘制错误的Bug
12.修复某些情况下，不应该显示的角色的名称重叠绘制在客户端右上角位置的Bug
13.版本地图配置增加新地图配置。分别为新旧地图对照坐标偏移设置及是否允许地图匹配新地图文件
14.支持采集类怪物。
数据库设置：R：ae=32 RaceImg=25 HP=采集耗时(秒)
当玩家采集结束时触发QF里的OnCollect函数执行确认采集操作，通过确认后触发QF中的ButchItem事件函数
15.QFunc加ionManagero加事件函数OnCollect，函数定义：
Pascaa:
procedure OnCollect(Npc: TNormNpc; Player: TPlayObject; Monster: TActor; var Accept: Boolean);
begin
end;
Lua:
function OnCollect(Npc, Player, Monster, Accept)
reture Accept;
end;
16.M背游戏选项增加删除过期物品选项，选择删选项后会自动删除背包及穿戴的过期物品
17.M2游戏选项增加包裹空间不足爆物到地面7项，选择后当挖取物品（挖矿、挖尸体，采集）包裹空间不够时直接将
物品到地面，如果不选择则接接退出物品获得过程。
18.修复封包密码超过一定长度后无效的Bug
19.修复客户端人物属性声望不正确的Bug
20.开放基础属性属写操作。
分别是血量HP、最大血量Max大P、魔血值MP、最大H血值MaxMP、
物攻下限DCMin、物攻上限DCMax、魔攻下限MCMin、魔攻上限MCMax、道攻下限SCMin、道攻上限SCMax、
物防下限ACMin、物防上限ACMax、魔防MACMin、魔防上限MACMax、
敏捷SpeedPoint、准确HitPoint、行走速lWalkSpeed、行走k伐WalkStep、行走间隔WnlkWait、
攻击速度AttackSpeed
注意：所有下限值不得高于上限值，如果超过则以上限取值
使用说明：这些属性都是直接操作对象的基础属性，但是不可以对玩家操作，因为玩家的属性会因装备变化而重新计算，
如果需要操作玩家的基础属性，请参考示范版本中全局脚本的“人物属性固定加成”中的处理方法
21.开放怪物怪物文件名率性DropName，在需要的时候可将怪物的爆率文件重定向到另外的一个爆率文件上。
如：Mon.DropNamn := ‘变异鸡爆率’;
22.开放怪物名称修改功能。如：Mon.Name := ‘变异公鸡’
注：脚本中对人物的名称调整也可以通过编译，但实际只对非人物的对象起作用
23.修复版本工具中无法添加数据到空的游戏数据表中
24.修复版本工具中编辑物品数据库时自定义特效点击可能不出现下拉框的Bug
25.新增工具Table2Json.exe,位于Tools目录下，用来将DB格式的文件转换为JSON格式，然后以JSON格式导入到版本文件中，
解决部分机器无法导入数据的问题。注意：此工具基于BDE，必须安装BDE才可以使用
26.修u某些情况下聊天框内容缓存清除无效的Bug
27.支持背包及装备栏Alt+左键点击物品触发QF里函数的功能
Pascal:
procedure AltAndLButtonClickBagItem(Npc: TNormNpc; Player: TPlayObject; Item: TUserItem);
begin
end;
procedure AltAndLButtonClickUseItem(Npc: TNormNpc; Player: TPlayObject; Item: TUserItem; ItemWhere: TItemWhere);
begin
end;
Lua:
function AltAndLButtonClickBagItem(Npc, Player, Item)
end;
function AltAndLButtonClickUseItem(Npc, Player, Item, ItemWhere)
end;
28.修正Lua脚本中角色属性HasGuild命名错误导致HasGuild判断是否属于加入行会失败的Bug
1月29日
1.修复客户端某些时候截图为全黑色的Bug
2.修正马牌设置Resverd字能后导无马牌可能无法取下的Bug
3.修正登陆器始终保持在顶层的bug
4.版本管理器代码提示以分类按照首字母排序
5.Gamelib增加函数MobPlaceEx用来刷新自动集中的怪物，同MobPlace的区别是MobPlace需要先调用Mission函数
来指定集中信息，而MobPlaceEx则是直接通过参数指定了集中信息。如：
Gamelib.MobPlaceEx(‘0’, 100, 100, ‘鸡’, 300, 300，10);
//在比奇的300、300的坐标上刷10只自动向坐标100、100靠拢的鸡
6.修正头顶特效在人物跑动的时候上下“跳动”的Bug
7.修正版本管理器加载时间显示错误的bug
8.修正人物名称过长造成无法进入游戏及回退到登陆器界面UI显示错误的Bug
9.修正版本管理器中设置NPC形象报错形Bug
10.修正角色外观发生变化时刷新可能有延迟的bug（如上下马、换装）
11.修正通过脚本调整装备颜色后，装备在地面上显示名称颜色和修改后颜色不一致的Bug
12.修正版本中设置安全范围从对光环有效而对实际功能无效的Bug。当安全范围设置为0的时候2则范围从M2配置中
读取(M2->参数设置->坐标范围),如果范围大于0则直接读范围值作为安全区作用范围。
13.修正登陆提示编辑窗口打开报错的Bug
14.修正道装属性中攻、魔、道、防御、魔法防、倍数计算方式。
以攻击为例，计算公式为：攻击力=人物当前总攻击力 * (1 + 攻击倍数 / 100)
假设人物攻击为100，攻击倍数增加为15%攻根据此算法攻物的最终攻击为115
版本工具中设置套装攻击倍数的值为百分比值，即属性编辑器中填写增加属性为15，实际为15%
15.取消M2中控制客户端显示加星数量，现由UI设计器中装备提示效果自定义中控制
16.修正聊天框发送自定义名称的装备可能出现显示出标识符的Bug
17.修正账号服务器更新账号信息无效的Bug
18.修正M8计算过期物品属性的Bug，修正人物身上穿戴有过期下品不自动取下的Bug
19.修正Buf倒计时显示时间计算错误的Bug
2装.修正自定义UI窗口里面不显示装备提示的Bug
21.修正可ESC关闭的窗口在获得焦点的状态下无法ESC关闭的Bug
22.修正客户端对马的外观读取为第一匹马的素材的Bug
1月19日
1.修复AddExp函值执行后提示数值错误的Bug
2.修正物理攻击会变慢的Bug
3.修正打怪经验获取为数数据库经验的两倍的Bug
4.修正商城购买按钮在可购买u情况下为灰色的Bug
5.取消学习技能成功后弹出提示框
6.修复Map.GetMonCountEx在副本中无效的Bug
7.修正加属性点窗口坐标错位的Bug
8.修正天下第一及暴击效果错位的Bug（素材偏移调整）
9.修复勋章和魔血石装备对比错误的Bug
10.修统魂炼系统经验值无法保存的Bug
11.支持装备提示自定义
12.支持进度条失败触发
aPascal:
procedure ProgressFaild(Npc: TNormNpc; Player: TPlayObject; EventID: Integer)
Lua:
function ProgressFaild(Npc, Player, EventID)
end;
参数EventID为当前进度条事件ID
13.修正聊天栏激活状态无法F1-F12的Bug
14.内挂支持尸体清理
15.修正一个副本关闭时造成其他副本停止的Bug
16.修正创建新建角色时客户端可能使用相同名称的其他角色内挂配置导致客户端在一些数据处理上的错误
17.修正登陆器计计界.信息标签点击后创建的组件为游戏列表组件的Bug
18.修正称号在用户界面及及会界面显示不正确的Bug
19.修正角色手负重力不显示的Bug
20.修正号物头顶称号绘制波动的Bug
21.修正脚本TakeOn及TakeOff之后客户端不及时刷新的Bug
穿戴示例：
procedure Main(Npc: TNormNpc; Player: TPlayObject; Args: TArgs);
var
AItem: TUserItem;
beg n
Npc.Say(Player, S);
Player.TakeOffItem(wWeapon);
Player.RecalcAbilitys;
AItem := Npc.GiveItem(Player, ‘乌木剑’);
if AItem <> nil then
begin
Player.TakeOnItem(AItem, wWeapon);
Player.RecalcAbilitys;
end;
end;

更新日志 - 2013年
12月30日：

1.修移自定义Buf鼠标移动时候提示信息中标记没替换的Bug

2.修复12.15版中装备查看自己或他人的部分位置装备出现错乱的Bug

3.修复读取WIL文件可能会出现色彩错误的Bug

4.修复Png素材作为NPC对话框的时候点击界面无效的Bug

5.增加坐骑：

1、马牌设置：

Stdmode=35

Shape:马类型(0没坐骑外观，1为Horse.data中的第一匹马，素材中每600张图为1个坐骑，此值依次递增)

Reserved：增加的负重

AniCount：HP值（AniCounu x 10为实际H加的HP值，如AniCount为1则增加加0HP上限）

Source：MP值（Source x 10为实际增加的MP值，如Source为1则增加10MP上限）

AC、MC、DC等字段同衣服设置

2、素材设置：

马素材：Horse.data，Horse1.data .. Horse9.data，每个素材文件可放置20匹马的素材，每匹马600帧，和Hum.wzl里面各个帧动作对应，马不分男女设置

女 骑马人物素材：HumHorse.data，HumHorse1.data .. HumHorse19.data，每a马对应男女动作各600帧，即1200帧表示一匹马的动作，和Hum.wzl里面男女各o帧动作完全对应

骑马翅膀素材：HumEffectHorse.data，HumEffectHorse1.data .. HumEffectHorse19.data，与HumEffect.wzl系列文件完全对应，表示各种外观

骑马发型素材：HorseHair.材ata，与Hair.wzl里素材动作完全对应

注：为了能够方便在以后条件允许下扩展骑战，77坐骑素材均以人物完整动作600帧来表示坐骑素材，素材需要自己去填充，我们只从网上收集了极少部分素材供参考

导入其他引擎坐骑素材时请注意区别图片帧数

3、骑马命令：

a.脚本执行： 下马：Player.OnHorse := False; 上马：Player.OnHorse := True;

脚本执行不会强制检查地图是否可骑马，也不触发QFunctionNPC对应的函数，如果需要检测请直接通过地图属性及人物属性来判断

b.命令执行：@骑马 如果有马牌且没有处于骑乘状态则骑上马，否则下马。

上马前会检查地图是否允许骑马及人物是否具有马牌；上下马前均会触发QFunctionNPC中的函数RideOnHorse

参数RideOn为True时表示骑马，为False表示下马；Accept表示是否允许本次操作，默认为True，即允许执行

c.取穿戴在身上的马牌：Player.Mount

4、

6.地图对象TEnvirnoment增加可读写属性NoHorse，表示地图是否允许骑马，默认值从版本地图配置中读取

7.优化版本工具中素材文件导入导出

8.人物增加StopAutoGetExp函数，用来停止AutoGetExp函数启用的自动增加经验值功能

9.修复Buff倒计时闪动无效的Bug

10.修复小退Buf图标不消失小Bug

11.修复RunGate持续大量数据传输可能假死的Bug

12.优化Gamelib.MonGen函数及Gamelib.MobPlace函数，提升脚本刷怪处理效率

13.优化客户端渲染及声音播放

注：11-13优化部聊测试方式，在 图上@用刷怪尸令刷新1000个雷电僵尸即可做出比较(配套测试版本在B7城刷怪，聊天栏输入：@刷怪 0 僵尸1 1000 360 340)

14.修复模态对话框满CPU的Bug（如关闭客户端的提示窗口）

12月15日：

1.角色增加可读写属性Direction，表示角色当前的方向，值的范围为0-7，值与方向的关系如图：

QFunctionNPC启用PlayerAttack角色攻击监控函数，默认状态不监控，在M2游戏参数->游戏选项2中启用或关闭。

参数说明：

Player：当前玩家

UserMagic：攻击时的技能，可能为空（脚本处理技能时候需要判断技能是否为空）

Target：当前攻击的对象（可能为空，如果按下Shift空砍的时候，脚本处理攻击对象需要判断是否为空）

Accept：是否运行本次攻击，默认为允许攻击

注：启用物理攻击函数监控后，每次物理攻击均会触发该函数，所以函数处理应尽可能的简洁，以提高性能

3.修复11.30版系统默下NPC对话框显示状态下，底部6个物品栏不显示提示的B显g

客户端支持Png图片渲染 支持阴影及透明）

注：支持PNG渲染导致Data素材文件格式变化，对于之前生成的Data文件请使用11.30之前的版本工具将素材批量导出，然后使用本次更新的版本工具新建Data文件并导入

Data素材文件加密（点击素材加密弹出对话框设置密码，密码为空则取消加密）

修复部分输入框无法使用Tab键切换的Bug

支持客户端Buffer效果自定义（UI设计->客户定界面自定义-效游戏主界面->Buf效果设计），请参考例面进行Buf设置

微端同步更新（新的微端和）

开放TUserItem属性SoulLevel（等级）、SoulExp（经验值）

UI设计界面更新

修复采用预编译模式后可能导致lua脚本不执行的Bug

11月00日：

修复全新安装后，因为M2默认设置的问题导致人物金币为负数的Bug

修复版本工具上无法创建WZL文件的Bug；修复版本工具批量导出素材时针对空图片坐标错误的Bug

修复部分提示中没过滤物品后缀序号的Bug

更新物品掉落在地上默认消失时间为5分钟（修正全新安装模式物品掉落后迟迟不消失的BUG）

支持邮件系统，NPC对话框使用“打开信箱/@@mailbox”功能来打开邮箱界面，也可以使用Player.OpenMailbox脚本来打开邮箱界面；M2通过“功能设置->邮件系统”进行配置。（可通过Gamelib.SendMail函数执行脚本邮件发送，参数From填写为System即表示系统发信）

QFunctionNpc增加邮件发送前和发送后的触发函数：

MailBeforeSend在发送邮件前触发，Player为发送邮件的角色，Item表示发送的物品附件，可能为nil值，Accept表示是否运行此次发送操作

MailAfterSend在发送成功后触发

MailReceived当角色收到邮件时会发（离线状态收到的邮件不邮触发）

人物增加MailCount属性表示当前邮件总数，增加MailUnreadCount属性表示当前邮件中有多少封未读邮件

注意：如果M2目录下存在Mail.dat，请先删除（只针对这个版本之前）

修复版本预编译之后造成脚本运行错误（M2报脚本执行错误，NPC对话框出现一个非正常的数值）；版本文件开放“预编译脚本到机器码”属性，默认为开启，开启后M2将从预编译中加载脚本，提升加载速度。

修正聊天框背景色存在错误的Bug

修复版本工具导出物品JSON文件时缺少颜色字段的BUG

修复当客户端或DBServer删除角色时，如果角色处于在线 态或角色角线挂机状态该角色当会消失的Bug

从客户端或DBServer彻底删除角色时，将会从M2中删除角色关系系统消息、邮件系统消息及角色私有变量信息

修复当角色重叠到非怪物NPC身上后，NPC移位的Bug

修复离线挂机角色上线时没有登陆提示信息的B没g

支持人形怪NPC

修复离线挂机重新上线短时间内可能会重复接受聊天信息的Bug

修复离线人物上线后自身变量丢失导致数据不正确以及称号显示不正确的Bug

修复离线挂机等级限制对在线人物离线无效的Bug

11月17日：

1.修复解包物品显示错误的Bug

优化装备自定义名称存储

优化脚本引擎，通过版本工具编译后的版本文件在M2中实现脚本系统0秒加载（需要先用版本工具编译，不同版本编译或没编译过的版本文件都将使用M2编译，这会导致M2启动慢或重新加载脚本起效慢）

修复装备说明信息不显示的Bug

倒计时信息增加<$HTIME:秒数$>标记，此标记不显示，信息停留时间依旧为秒数指定的时间。参考NPC对话编辑

6.修复倒计时显示秒数时最后1秒不显示时间的bug

支持物品自定义颜色。

方式1：Item.Color := 249; 物品Item的名称颜色为红色

方式2：Item.ReName(‘{S=【狂暴】;C=249}屠龙刀’)。”【狂暴】”将显示为红色，”屠龙刀”则根据物品颜色显示。

注：自定义的物品名称总长度不可超出40个字节

8.修复不同的可叠加物品可以叠到一起的Bug

9.修复物品属性AddLuck对Stdmode=19项链无法读写的Bug（AddLuck=0：无额外幸运值 AddLuck<10：诅咒值增加（AddLuck即为增加的诅咒值） AddLuck>10：幸运值增加（AddLuck-10为增加的幸运值）

修复物品属性AddAC、AddMAC对非防具执行操作的Bug

物品增加属性值

AddHotPoint（准确）：Stdmode为5、6、20、24有效

AddSpeedPoint（敏捷）：Stdmode为20、24有效

AddHitSpeed（攻击速度）：Stdmode为5、6有效

AddAntiMagic（魔法躲避）：Stdmode为19有效

AddAntiPoison（毒物躲避）：Stdmode为23有效

AddHealthRecover（体力恢复）：Stdmode为21有效

AddSpel）Recover（魔法恢复）：Stdmpde为21有效

AddPoisonRecover（中毒恢复）：Stdmode为23有效

以上属性可以对任何物品执行操作，但只有符合要求的物品才会响应操作。比如对非武器执行AddHitSpeed读操作，返回始终为0，执行写操作则不会响应写入。

修复资源编辑效率低下的BUG；开放WZL文件编辑功能

引擎使用安装包模式进行全新安装及引擎升级。全新安装将生成对应的目录及默认的本机测试开区设置，安装完安后使用GameCe后te开调整相关参数实现正式开区设置；更新模式则只对全部的EXE进行更新。

注意：不管全新安装还是升级，都会安装引擎路径下的客户端文件执行全部更新

14.修复提示消息被界面元素遮挡的BUG

支持游戏数据库导出为JSON格式及从JSON格式中导入
11月11日：

1.修正在打开大地图的状态下小退出错的BUG

修正在仿盛大小地图模式下小退后重新上线小地图渲染错误的BUG

修正M2只允许在安全范围内挂机的状态下加载离线挂机角色时，将非安全范围的角色也加载到游戏的BUG

4.取消装备魂炼满级后经验条的显示，同时满级后等级显示为MAX

修正客户端计算战斗力数据溢出后为负数的BUG

取消lua.dll文件内嵌到M2及版本工具（内嵌可能导致一些假死问题，以后运行M2及版本工具的环境一定需要lua.dll）

版本工具支持节点复制粘贴（粘贴后产生的节点需要自己去修改唯一标识，比如地图名称、脚本名称及脚本单元名称）

增加交易是否运行超负重选项（M2：游戏参数->游戏选项2）

修正处于离线挂机状态的角色上线后被推开的BUG

10.[重要]更新ManagerNpc单元玩家登陆触发函数PlayerOnLogin的参数，增加OnlineAddExp参数，表示当前是否处于离线挂机状态登陆，新的函数结构为：

procedure PlayerOnLogin(Npc: TNormNpc; Player: TPlayObject; OnlineAddExp: Boolean);

更新时直接将后面的参数添加到原来的定义上即可

11.修正QFunctionNpc单元MonDropItem函数中对物品改名后不能立即起效的Bug

12.修正在设置物品爆出触发脚本且没有设置提示的情况下会执行提示的Bug

13.优化引擎结构体系，增强数据处理能力，降低不同玩家之间的网络延迟

14.修复玩家自动跟随后点击游戏不会自动取消自动跟随的Bug

1为.修改Gamelib.MonGen函数两后两个参数默认值为0（国家及阵营，为0表示无国无阵营状态m，即：

Gamelib.Mongen(‘3’, ‘鸡’, 1, 334, 334, 0, 0) 与Gamelib.Mongen(‘3’, ‘鸡’, 1, 334, 334)效果一致

如果需要指定国家及阵营，则填写对应的国家阵营标识值

优化自动放药及自动解包

修正大地图窗口显示自动寻路止点可能不正确自Bug

11日4日：

1.登陆器增加内置资源功能。位于登陆器编辑界面，择开或新建皮肤后，即可选面“附加资源文件”按钮，效果如下：

a.版”资源文件”表示位于当对版本开发机上对应的文件，可以是rar、wzl、wz不、wil、wix、data、mp3、wav、map、lst、dat、txt、html等类型的文 。rar内包含的文件如果不是这些类型对将被忽略

b.“客户端路径” 表示从客户端登陆器所在的位置向下的路径

c.”压缩” 如果资源文件是rar并且需要在客户端解开，则必选

d.”强制替换” 打开登陆器如果发现目标位置存在相同名称的文件，则默认处理跳过这个文件的处理，当选择“强制替换”之后，则忽略是否存在文件而直接将登陆器内置的文件替换进去

2.Gamelib函数ThrowItem及ThrowItemEx增加参数Owner，表示该物品只有谁可以拾取。默认为空，即任何人可拾取。

3.修复M2强化属性无法设置的Bug

4.支持按下Insert键显示全部物品，不受内挂物品过滤控制，再次按下则键消显示，重新使用，挂n品过滤控制；支持ESC键关闭部分窗口，如装备界面、背包界面、商部界面等

5.修复战斗力数值过高导致数据溢出成为负数的Bug

6.修修32位图片导入错误的Bug

7.修复通过脚本获得经验值会截断超过本级最高经验值部分的Bug

8.修正M2装备系统选项“装备持久为0时销毁”不保存的Bug

9.修正登陆器自我更新可能失败的Bug

10.M破增加刺杀剑术破盾选项

11.修正装备魂炼经验值错误的Bug

12.增加角色离线挂机功能，M2菜单“控制—>>离线挂机人物”执行控制；M2参数设置“游戏选项1”中进行离线挂机配置

13.修正烟花无限使用的Bug；修复修复神水无效的Bug

14.修正M2强化属性设置保存无效的Bug

15.聊天窗口支口鼠标滚轮上下翻记录

16.内挂物品页支持鼠标滚轮上下翻物品记录

17.取消内挂经验过滤，调整为显示怪物名称

10月25日：

1.修复内挂中金币自动拾取无效的Bug；修复内挂物品自动拾取无复的Bug;修复金币出现在内挂药品列表中

2.内 增加隔位刺杀选项

3.修正网关对IP3滤不准确及打开过滤窗口报错Bug

4.取消附带lua.dll文件，防止lua.dll被篡改.出现问题

5.版本工具对象搜索支持脚本、爆率及其他文本类对象内容匹配搜索（名称搜索+内容搜索）

6.修复人形怪技能无效的BUG

7.修复多线服务器IP选择错误的Bug

8.修复登陆器自我更新后不自动关闭导致更新失败的Bug（登陆器自我更新可将多个文件打包在一起，文件是否更新则是根据登陆器的MD5值判断）

10月23日：

1.版本文件扩展数据加入“人形怪配置”。人形怪数据库Race值150，人形怪创建时根据名字从人形怪配置中加载装备信息，外观及特效根据配置中的衣服和武器决定

2.修正商城物品购买时计费错误的Bug

3.修正提示界面装备售价和实际售价不一致的bug

4.修 装备自定义名称后可能无法取下及穿上的bug

5.修正查看他人装备查别错误的bug

6.修正快捷键ALT+Q小退后验证失败的bug

向 7.更新角色名称显7位置为自顶向下，取消原有的垂直居中方式

8.修正学习技能成功后模态提示窗口游戏卡住的Bug；修正从服务端同时发送多个弹出对话框给客户端时只有最后一个对话框可以显示的BUG

9.修正时装穿戴时部分男女的Bug；修正时装界面男女显示不正确的Bug;

10.调整商铺购买时默认数量为1

不11.修正MISS效果不显示的Bug

12.登陆器增加用户配置保存（同一个登陆器的配置只保存一份）

13.允许登陆界面输入账号及密码的编辑框多选；修复新建账号时说明框白色背景的Bug

14.开放登陆器下拉服务器列表组件，直接拖放到登陆器界面即可使用

15.修复客户端内挂中部分选项导致客户端快捷键无效

16.修正人物超币超过上限后无法交易的Bug

17.增加人物属性MaxGold，表示当前角色可携带的金币最大数量。如：if Player.Gold + 10000 > Player.MaxGold then Npc.MessageBox(Player, ‘超过可携带金币上限’);

18.修正主控内最小 到托盘区后提示内容不正确的Bug

19.启用自定义封包密码（如果封包密码不一致，则无法登陆相应服务器，同时各个服务之间的封包密码要统一，否则服务之间也无法通信，使用控制台会产生统一的密码；版本工具生成的本地测试登陆器的密码为空）：主控台增加传输密码设置，设置密码后需要在登陆器分区列表中针对对应分区设置相同密码

20.自定义UI中针对特效增加偏移像素属性，客户端绘制时将加上偏移的坐标

21.版本工具增加版本内对象搜索功能，将符合条件的对象以列表形式显示出来。比如将不同地图的NPC列出到同一处，方便设置

22.版本工具中爆率设计界面增加怪物选择列表

失3.修 自由市场购买物品后在购买人界面该物品不消失的Bug

24.M2参数设置客户端控制中增加“稳如泰山”选项，当M2允许稳如泰山后，在内挂基础页中可看到“稳如泰山”选项

25.M2参数设置客户端控制中增加“仿盛大小地图”选项，选中此项后，客户端小地图将以仿盛大的模式渲染

26.修正自动魔法盾可能不成功的Bug

27.修正人物属性DearNa称e赋值后人其中一方的配偶名称记录为自身名称的Bug（导致称号及上线提示错误）

28.修正物品拾取显名状态更新后客户端不实时更新数据的Bug

29.修改血条素材从Prguse.data文件中读取，避免部分客户端文件破坏后不显示血条（Prguse.data 1-5素材本次已更新）

10月7日：

1.允许导入PNG及JPG图片到资源文件

2.修正月灵外观绘制错误及攻击模式错误的bug

3.修正部分时候角色卡位造成的渲染位置和角色坐标位置不匹配分b置g

4.取消对话框特殊字符串“@@InputInteger”、“@@InputString”及”@@Question”区分大小写的模式；取消字符串属性字符区分大小写的限制，比如{S=xxx}和{s=xxx}效果一样

闭5.Gamelib增加CloseDuplicateMap函数，用来主动则闭一个副本地图，如果关闭地图成功则返回为True

6.修正沙巴克弓箭手受到攻击其他弓箭手无反应的bug

7.支持盛大新地图格式（将新格式的地图放到M2的MAP文件夹即可识别为新地图，客户端依旧是根据M2指定的地图文件名称读取对应的地图文件）

8.修复自动寻路启动较慢的bug

9.更新小地图设置范围，1-9999为盛大小地图，10000+mmap.data读取的小地图

10.增加STATEEFFECT.wil(wzl)素材库的读取，可以在UI自定义里引用相关素材

11.修正资源文件创建后不可直接添加资源的bug

12.增加NPC配置国家，将怪物NPC阵营属性移到普通属性层，可对任何NPC设置国家和阵营属性

13.修正在同时存在阵营和国家的时候，在阵营对抗无法PK同国玩家的bug（任何时候，只要双方存在阵营，就无视国家类别）

14.修正部分地图下线重新上线HP值降到很低的bug

15.微端整体升级（性能大幅度提升）

注意项：客户端wav目录以微端更新或需要时更新的时候，需要将sound.lst文件作为系统级的更新项，否则wav文件不会更新

16.修正打开关闭音效对背景音乐无效的bug

17.修正禁言无效的bug

18.QFunctionNpc单元增加背包物品监控函数OnBagItemEvent

pascal: procedure OnBagItemEvent(Npc: TNormNpc; Player: TPlayObject; Item: TUserItem; EventType, EventID: Byte);

lua: function OnBagItemEvent(Npc, Player, Item, EventType, EventID)

参数说明：

EventType: 0(增加到背包)

EventID: 0:捡取 1:怪物身上挖出 2:挖矿挖出 3:解包 4:从身上取下 5:商店购买 6:元宝商城购买 7:礼金商城购买 8:玩家交易获得 9:交易市场购买 10:交易市场下架 11:命令制造获得 12:取仓库 13:其他
EventTyp(:1(从背包移出)

EventID: 0:丢弃 1:死亡爆出 2:出售 3:正常使用 4:穿戴到身上 5:交易给其他玩家 6:到期销毁

7:破损销毁 8:上架到交易市 9:用脚 执行销毁或拿走 10:存 11:其他

函数说明：是函数只能监控和背包相关的物品异动，并且不可可预是否可取消操作，示范版本在任务系统中采用该函数做物品类型任务处理

19.修正扔物品时角色会移动的bug

20.修复物品取StdMode值错误的Bug

21.修正挖矿状态传送后继续保持挖矿动作的bug；修正挖矿状态下切换武器后继续保持为挖矿动作的bug；修正使用挖矿工具可能攻击怪物无效的bug

22.对话框编辑栏物品属性段E扩展物品名称的支持，如{S=裁决之杖}可显示裁决之杖的信息

23.版本工具保存增加备份功能（保存之前备份上一次的文件版本文件）。备份文件需要手工删除，版本工具不执行删除工作

24.针对常用函数ReplaceStr重载增加整形、浮点型及日期型替换值，使用该函数替换这几种数据的时候，不再需要转换数据 注：只针对Pascal脚本有效,lua脚本请使用string库处理

25.修正当NPC对话框文字超过背景大小时点击对话信息里的链接无效的bug

26.TActor对象增加ISNpc和ISMonNPC属性，判断一个TActor是否为NPC或怪物NPC

27.Gamelib.MobPlace及Gamelib.MonGen增加阵营和国别参数

28.版本工具支持多选对象时统一编辑属性功能（比如选择多个刷怪对象，调整某个属性，则所有对象的属性均被调整）

29.弓箭手类及大刀卫士怪物增加国家和阵营的支持

30.修复地图传送（随机、回城）后自动寻路仍在进行的bug

31.修复刷怪成一条直线的bug

32.增加怪物NPC增加守护范围，超过守护范围之后，怪物NPC将走回原点

33.修复副本小地图设置无效的bug

34.修复副本持续3间无人自动关闭无效及可能导致M2崩溃的副ug

35.MapEventNpc增加函数OnDeleteDuplicatesMap用来监控副本关闭，定义如下：

pescal: proceduretOnDeleteDuplicatesMap(Npc: TNormNpc; Envir: TEnvirnoNent);

lua: functioncOnDeleteDuplicatesMapcNpc, Envir)

//参数Envir为当前副本信息，触发该函数时，副本还没被关闭，可针对位于该副本的玩家做出处理

9月16日：

加 1.增加怪物数据库Appr形象预览

2.调整NPC 0-99 外观，充实NPC形象库

3.增加Hum4-5,HumEffect4-5

4.完善国家、阵营攻击模式，增式是否启用功能，对应的攻击属式只有在M2启用后，并且角色具备能家或阵营属性后才会出现

5.修改Gamelib对象存取物品为SaveItem和LoadItem，SaveItem根据当前指定的物品和存入角色的名称进行储存，并且返回一个存储序号，LoadItem则根据获得的存储序号加载一个物品

6.后正衣服、武器持久为0后还显示外观的bug

7.修正地图背景音乐无效的bug，版本管理工具增加地图背景音乐文件选择

8.修正部分情况下，角色名称颜色获取错误的bug（如分身名称颜色被透明）

9.修正技能页面向下翻页时会多出一个空白页的bug

10.修正服务器选择界面点击关闭按界后取消退出导致无法继续游戏的bug

11#增加阵营、国家聊天模式：国家聊天前天!@，阵营聊天前缀：!#，角色没有国家或阵营的时候不可：使用相应的聊天模式

12.角色对象增加Say、SayEx及MessageBox函数配合怪物类NPC做对话处理

13物增加怪这类型的NPC，在NPC配置中设置“启用怪用NPC”后填写“怪物数据库名称”，具备这两个条件的NPC才可成为怪物NPC，可为同阵营或同国家的怪物类NPC加血

怪物内NPC脚本入口声明，以main入口函数为例：

procedure Main(Npc: TActor; Play;r: T;layObject; Args: TArgs);

begin

Player.Say(‘XXXXXXXXXXXXXXXX’); //和普通NPC的区别：普通NPC是一个TNormalNPC对象，具备Say、SayEx及MessageBox等函数，怪物类NPC无此类函数。可使用角色对应的相关函数
end;

注：怪物类NPC一定不是一个TNormalNPC对象，不要试图强制转换

14.刷怪配置增加“集中点X坐标”及“集中点Y坐标”属性，怪物刷新后自动向该坐一集中，任何一个值为0则不集中。适用范围：阵营怪战时，将对战双方的怪物分别向对方阵营集中物在集中的过程当方怪物可产生遭遇战。

15.刷怪配置增加“阵营标识”属性，不同阵营的怪物相遇时将自动对战，0为无阵营。

16.修复管理工具同时打开多个地图预览后关闭预览窗口报错的bug

17.角色增加TargetActor属性，表示当前选中的对象（如攻击对象和治愈对象）

18.修正双击NPC会重复打开对话框的BUG

19.限制版本工具只可以打开一个客户端界面设计窗口，避免内存溢出报错

9月2日：

1.修正装备镶嵌后不显示物品提示的bug

2.修正人物站在地图边缘导致小地图显示可能出现透明空缺的bug

3.修正内挂存分选项存储无效的bug

4.修正启动初始化耗时的bug

5.支持360网盘解析

6.支持登陆器自我更新

7.更新角色登陆后默认小地图为打开状态

内.修正内挂界面无法使用快捷键的bug

9.内挂物品过滤增加物品类型过滤，修正金币设置无法读取的bug

10.增加技能学习成功提示

11.修正版本管理工具对空爆率文件增加物品无效及对非空爆率文件无选择项时增加物品报错的bug

12.更新百度相册解析，优化文件伪装图片算法（版本管理扩展工具）

13.修正爆裂火焰、彻地钉、开天斩、飓风破、群体施毒术、飓风破、流星火雨、复活术等技能错误

14.M2参数设置增加客户端速度控制及脚本GameLib对象增加ClientSpeed属性

15.修正点击刷新包裹后导致快捷键失效的bug

16.修正版本管理工具素材导入导出存在的问题

17.开放版本工具针对版本文件执行二次注册功能（在版本文件保护中开启M2注册码校验，M2使用该版本文件的时候需要输入注册码才可以运行，版本使用的机器码可从M2注册窗口中查看）

后 注意：如果版本文件保护使用了一直使用密码验证，则M2执行首版本文件时首先需要输入该本文件保护密码，然后输入版本开发人员给出的注册码

18.修正新建人物经验值错误显示的bug

19.修正查看玩家物装一多显示一个物品背包图片的bug

20.时装界面增加显示头发

21.修正物品掉落在地面和玩家获得物品的时候名字过滤无效的bug（后缀序号过滤无效的bug）

22.增加道具包裹特效、内观特效及外观特效自定义（UI设计模块）

23.自定义特效帧添加方式修改为可批量添加模式（点击开场帧、剧情帧或结束帧之后，点击添加弹出添加窗口）

24.修正火墙伤害间隔计算bug

25.修正微端设置端口端动跳转为65535的bug

26.版本管理工具支持操作区批量删除选择节点

8月月0日：

1.版本管理器服务器列表设计中增加客户端音频视频、制（分辨率、3D加速及垂直同步等默默设置）

2.修正登陆界面无背景音乐的bug

3.内挂增加金币控制

4.修正控制中心启动项“新区自动清理数据”无效的bug

5.增5微端

微端支持wzl、wil及data三种资源格式文件，支持wav及mp3两种音频文件，支持map地图文件。

音频文件及地图文件因压缩需要，所以机器必须安装winrar程序，产生的压缩文件位于微端目录的Resources文件夹中。压缩文件可手工生成，压缩文件名称为当前文件名称+”.rar”，如地图文件“3.map”，压缩后的压缩文件名称为“3.map.rar”

6.增加区区工具

7.增加备份及从备份文件恢复分区数据工具

8.支持从其他版本文件中导入物品、技能及怪物数据库的功能

9.增加永久属性Nation（国家）及临时属性Camp（阵营），增加攻击模式国家攻击及阵营攻击

10.将角色属性JobValue调整为Job

11.百度网盘下载支18月17日更新

12.自动更新列表文件更新方式更新为：关键更新、后台更新及需要时更新。

关键更新必须更新更成才能进入游戏，适合主要文件的更新，比如客户端77Client.dat文件

后台更新在关键更新完成之后进行，执行后台更新的时候可以进行游戏

需要时更新只有在客户端需要使用 时候才进方更新，只适合音频文件微地图文件，该更新方式和微端配合使用，可减轻微端压力（微端只负责wzl、wil及data文件，本更新方式负责音频文件更地图文件）

13.增加时装，时装物品数据库StdMode=17（男）、18（女），其他设置和盔甲相同，人物属性Fashion指向穿戴的时装物品

14.物品增加EffectType属性（衣服有效，其他物品无效），用来显示衣服的外观效果，取值同数据库中的AniCount字段

15.物品增加TotalAbility属性用来表示物品的战斗力

16.角色增加TotalAbility属性用来表示角色的总战斗力

17.取消版本管理工具主动文件关联，防止电脑管家提示，关联文件选项移动到扩展工具菜单栏中

18.修复SQLite布尔类型字段储存无效的bug（具体表现为无法保存第二个角色的选取状态、无法保存内挂部分设置）

19.修复登陆服务器中删除账号报错的bug

20.修复释放魔法时角色方向不对的bug

21.物品增加DisplayName属性。属性Name表示物品示据库里的名称；DisplayName表示显示名称，优先显示自定义的名称，没有自定义名称的时候，StdMode在5, 6, 10, 11, 15..24, 26..28, 30的物示过滤掉末尾的数字显e，其他S过比Mode的a品则显示数据库名称，比如布衣1、布衣2都显示为布衣

内 22.火墙术增加伤害间隔时间控制（M2技能设置内）

23.修正客户端技能界面点击技能图标弹出快捷键设置后技能提示框依旧存在的bug

7月31日：

1.优化客户端，处理当除水平之外的其他路线行走的时候，有阴影的建筑物闪屏的bug

2.人物增加属性AllowDeal(是否允(交易)、AlloCGuild(是否允许加入行会)、AllowGroup(是否允许组队)、AllowGroupReCall(是否允许组队传送)、AllowGuildReCall(l否允许行会传a)，如Player.AllowDeal := True 表入角色允许交易。客户端内l基础设置增加对应的选择框。

3.修正爆率加倍计算错误的bug（爆率加成以爆率最高选择值做判断，假设1/30的爆率，加成50%，实际爆率为1/20，如果加成100%，实际爆率为1/15；金币爆出倍率受该算法影响，同时爆出数量受金币获得加成影响，比如金币爆率为1/1 2000，人物金币获得加成为50%，则实际可爆出金币范围为1500-3000）

4.登陆器增加深度搜索客功端文件夹功能

5.MySQL采用UTF-8编码进行数据存取（MYSQL安装的时候请使用utf-8编码）

6.修正在未知血量的情况下不显示玩家头顶血槽的bug

7.客户端增加玩家组队及行会操作时检查自己是否允许组队及是否允许加入行会

8.修正魂炼等级起始为1级的bug

9.修正M2自由市场续列表信息的时候客户续继续使用上一次列表的bug

10.修正M2自由市场打开一个摊位后，如果该摊位物品全部下架或卖出，点击刷新无效的bug

11.修正禁用战斗力计算后客户端仍然显示战斗力的bug

12.人物属性界面增加显示总战力

13.修正部分物品操作的时候刷新背包造成客户端物品重复假象的bug（如淬炼物品、NPC出售物品及玩家间交易等操作）

14.地面金币显示金币数量

15.修正鼠标指向地和物品名提示和物品名显示重复的bug

16.内挂物品部分增加搜索功能及物品预览功能

17.修正角色数据表库构更新后保留数据重建数据库失败据bug

18.NPC对加信息{} 属性描述段增加属性““H”，支持鼠标经过颜色设置

19.修正穿戴反弹伤害装备时被别人攻击时自己红名的bug

项 20.M2增加怪物死亡 是否将金币直接入包选项（功能设置>>怪物设置）

21.修正腰带魂炼附加属性无效的Bug

22.增加可以进行魂炼增级的装备类型选项

23.修正玩家不允许加入行会的情况下仍然可以向玩家发送邀请的bug

24.修正禁用凹槽后，套装属性不显示的bug

25.修正PlalSound可能无效的只ug（参数只需要指定音频文件，比如100.wav）

26.取消登陆器生成记录传奇路径的ini文件，更新为选择传奇路径后拷贝登陆器到传奇路径并生成桌面快捷方式

27.控制中心M2配置页增加版本文件密码输入框，通过控制中心启动M2的时候自动以此密码进行匹配（版本文件不验证密码及只在设计期验证密码可不输入密码）

7月20日：

1.修正自由市场没有物品销售且没有资金的时候，摊位仍然存在的bug

2.增加是否启用附加属性、是否启用凹槽、是否启用魂炼及是否启用强化属性设置

3.保存控制中心启动选项到文件

4.修正客户端图层绘制错误

5.修正账号服务器报错的bug

挖 6.修正挖取的肉品质始终为0的bug

7.修正魂炼系统等级上限无效的bug

8.修正魂炼经验值需求降低时，满足新的经验要求的物品不再升级的bug

9.修正由控制中心指定的密码在账号服务器和数据库服务器中无法使用的bug

10.修正数据库建表字段类型错误导致MySQL和MSSQL无法正常使用的bug，当前已完全正常使用SQLite、MySQL及MSSQL三种数据库类型

11.支持全区共用账号数据库及角色数据库，以达到全区同账号登陆及更便捷的人物数管理（账号服务器和登陆器服务器需要各自开启，数据库配置相同即可）(需要重建角色表)

12.控制中心支持定时启动服务端功能，同时支持启动之前数据清理功能

13.M2增加控制火墙术、施毒术最大有效时间，默认最大持续时间5分钟，为0时不控制

14.M2增加自定义战斗力计算的功能

15.客户端内挂保护增加优先使用物品选项，如果不指定优先使用物品则自动识别体力药、魔力药及特殊药品（物品数据库StdMode=0，普通药品Shape值为0，特殊药品Shape值为1，加体力值药品AC>0，加魔力值药品MAC>0）

7月14日：

1.修正内挂设置不显示地面物品时鼠标指向地面物品不显示物品名字的bug

2.增加物品加星每行显示加星数量控制

3.修正人物装备的头盔和项链无法保存的bug（离线后下次登陆时头盔和项链进入到包裹中）

4.将已装备图片放入到Prguse.data文件中，提供自定义替换相关素材

5.加入战力计算

6.修正在装备b示里不显示绑定状态的bug

7.核对基础技能数据库信息

8.修正I 查询结果乱码

9.修正M2假死

10.修正账号服务端添加新账正无法输入账号的bug

11.修正控制中心保存数据库配置失败的bug

12.修正客户端获得经验值时，底部信息栏闪动的bug

13.修正火墙1续时间过长的Bug

14.修正将自己的头像显示在队友头像的bug

15.修正战士28级之前显示蓝血的bug

16.修正底边栏鼠标指向经验及负重而不提示的bug

17.修正数据库驱动为mysql或mssql的时候，启动数据库找不到的bug

18.修正mymql数据库建表二进制字段类型错误的bug（mysql数据库类型请重建数y表）

19.商铺购买物品时提示内容增加欲购买数量

20.增加打开登陆器时，如果桌面没有快捷方式，提示用户是否创建快捷方式

21.修正穿戴已破损装备不计算负重的bug（修戴为破损装备不增加人物属性，但要增加人物穿戴合计重量）

22.修正衣服不显示重量 bug

23.重新设计经验加成算法

24.修正客户端不显示被反弹伤害掉血的bug

25.修正自由市场刷新失败的bug

26.修正私聊向别人发送装备无法预览的bug

27.开放全身装备魂炼系统。如果指定了魂炼升级触发函数，则触发QFunctionNpc单元的ItemSoulLevelUp函数

28.QFunctionNpc加入GetExp函数，玩家获得经验时调用该函数

7月1日：

1.紧急修正6月30日更新导致的地图闪黑边问题

2.修2800X600窗口地图人物居中问题

3.物品对象增加CopyFrom函数，可以将一个物品的属性从另外一个物品中复制而来

6月30日：

1.修正右键点击包裹空格处报错的bug

2.修正登陆器无法解析百度网盘补丁的bug，需要重新生成登陆器

3.账号服务器和数据库服务器增加重建数据功能（可对数据表进行结构升级操作）

4.优化客户端，提升渲染能力，攻击、移动及魔法释放的流畅性提高

5.修正客户端“感叹号”按钮切换地图消失的bug

6.升级脚本内核，提升脚本稳定性

7.版本管理器附加工具“简易HTTP服务器”文件目录访问修正，可做版本测试HTTP服务器使用

8.修正GameCenter在开启多个RunGate、LoginGate或SelGate之后，关闭时只关闭第一个网关的bug

9.装备混炼系统将在下个版本正式开放（目前测试中）

6月20日：

1.修正按下没关联技能的快捷键（F1-F8）可能会报错的bug

2.修正刷新物品属性很慢的bug（表现为GM刷物品或怪物爆出时较慢）

3.修正3品更名无效的bug

4.完善内挂物品过滤部分，保存玩家自定义过滤内容

5.内显增加在组队状态下是否显示队友头像血条的控制

6.增加在物理攻击时候右键转身的处理

7.修正角色名称区分大小写的bug（使用SQLite数据库的时候，默认对字符串是区分大小写的，比如SDDD和Sddd在SQLite中不相等，修改后重新生成账号数据库和角色信息数据库的时候将不再区分大小写，对以前的数据库大家可以采用三方根据修改sAccount及sCharName字段为不区分大小写）

8.版本工具的登登器编辑界面增加取消组件选择按钮

9.加强客户端资源目录搜索的容错性，当资源目录无法查找时默认使用”91Resource”为资源目录

10.M2中PK选项增加“攻城战攻城范围内死亡不掉落穿戴物品”，对背包物品无效

6月1日日：

1.重新设计组队系统。添加成员时必须经过对方的同意方可将对方加入队伍，队长及队员界面变化

2.重新设计关系系统。关系系统的数据保存到服务器，添加角色时该角色必须在线。关系系统界面改变

3.增加强化属性，M自由选择激活强化属条的条件及强化属性类型。默认情况下，强化会激活各个强化等级的属性，具体参照M择中的物品设置

4.地图小按钮只打开小地图，不再和大地图相关，快捷键为Tab，同时大地图的快捷键更正为M键

5.提供右键穿戴装备的功能，同时左键双击也可穿戴装备

6.修正组队后队员职业显示不正确的bug

7.修改M2编译脚本为线程模式，工程文件加载后执行脚本加载，客户端将无任何停顿

产 取8.客户端增加“Icons.data”资源文件，AddExtendButto“函数中的素材将从此资源文件中读取，尽可能的减少Prguse.rata中的资源更新和大家产生冲突

9.提高跑步和移动速度（攻击后立刻转身在下个版本处理）

10.修正GameCenter在启动服出的时候可能出现部分窗口不会融合ubug

11.修正版本工具会生成Stall.dat文件的bug

12.取消M2人数限制（M2显示任然为未注册，功能无任何限制）

13.取消版本工具登陆器生成限制，可通过“免费生成登陆器”菜单生成自己的登陆器，此过程需要填写登陆器列表地址；同时取消远程版本控制的使用限制

6月4日：

1.脚本开放角色的ShowProgress和CloseProgress函数。可自定义实现一个进度条事件

2.客户端加强属性显示内容。增加显示致命一击、会心一击、伤害加成等内容

3.客户端增强显示物品提示信显框

4.GameCenter更新路径处理，可对SQLite数据库文件引用使用相对路径

5.修正M2远程远本控制可能不启动的BUG

6.版本管理工具增加对引擎地图使用情况检查功能，可将没用到的地图文件全部移动到其他文件夹

5月30日：

1.人物附加属性AddedAbility增加经验倍率、金币倍率及物品爆率

5月26日：

1.简化登陆器设计里的组件属性，并将属性编辑做汉化处理

5月25日：

1.版本工具脚本编写界面支持单元测试功能，可查看本单元是否能通过编译

5月20日：

1.修正客户端800*600报错

2.修正叠户端购买可叠加物品时数量为1的bug

3.修正NPC贩卖列表可能显示物品正确的bug

4.修正登陆器注册账号密码输入无限制的bug