# 需求文档

## 简介

本文档定义了无限恐怖项目中怪物属性与装备属性系统的需求规范。该系统旨在建立怪物属性与装备掉落之间的关联机制，通过属性翻倍、变异系统和技能魔次等元素，为玩家提供惊喜感和挑战性的游戏体验。

## 术语表

- **怪物系统**: 怪物属性管理系统，负责怪物的生命、防御、攻击等属性计算
- **装备系统**: 装备属性管理系统，负责18件装备（不含生肖）的属性生成和掉落
- **技能魔次**: 技能魔次系统，定义各技能的伤害倍率标识
- **伤害计算器**: 使用公式 (主属性 - 怪物防御) * (技能魔次 - 怪物魔次抵抗) * BUFF加成
- **属性翻倍**: 属性翻倍系统，包含基础翻倍、极品翻倍、神品翻倍三种
- **怪物变异**: 怪物变异系统，提供多样化的变异效果
- **磨怪**: 指需要长时间才能击杀的高血量怪物

## 需求列表

### 需求1: 怪物基础属性系统

**用户故事:** 作为游戏系统，我需要管理怪物的基础属性，以便根据怪物类型和等级提供合适的战斗挑战。

#### 验收标准

1. 怪物系统 应当 为所有怪物定义三个基础属性：生命(HP)、防御(Defense)、攻击(Attack)
2. 当 怪物生成时，怪物系统 应当 根据怪物TAG（后缀1-5）分配属性
3. 若 TAG后缀为1-2，怪物系统 应当 将怪物分类为小怪
4. 若 TAG后缀为3，怪物系统 应当 将怪物分类为精英怪
5. 若 TAG后缀为4，怪物系统 应当 将怪物分类为BOSS
6. 怪物系统 应当 支持超出标准TAG分类的特殊怪物类型和特殊BOSS类型

### 需求2: 怪物变异系统

**用户故事:** 作为玩家，我希望遇到变异怪物时获得惊喜，以便增加游戏的趣味性和挑战性。

#### 验收标准

1. 当 怪物生成时，怪物变异系统 应当 有一定概率触发变异
2. 怪物变异系统 应当 支持多种变异类型，具有不同的视觉效果和属性加成
3. 当 变异发生时，怪物系统 应当 根据变异类型增加怪物的生命值和攻击力
4. 当 变异发生时，怪物系统 应当 改变怪物外观（颜色/名称后缀）
5. 怪物变异系统 应当 确保变异怪物有更高的稀有装备掉落率
6. 怪物变异系统 应当 创建"磨怪"（显著增加生命值的怪物）以延长战斗时间

### 需求3: 装备基础属性系统

**用户故事:** 作为游戏系统，我需要管理18件装备的属性，以便为玩家提供多样化的装备选择。

#### 验收标准

1. 装备系统 应当 管理18个装备槽位（不含生肖物品）
2. 装备系统 应当 支持以下基础属性：
   - 自定属性[167]: 血量(HP)
   - 自定属性[168]: 防御(Defense)
   - 自定属性[161]: 攻击(Attack)
   - 自定属性[162]: 魔法(Magic)
   - 自定属性[163]: 道士(Taoist)
   - 自定属性[165]: 箭术(Archery)
   - 自定属性[164]: 刺术(Assassination)
   - 自定属性[166]: 武术(Martial Arts)
3. 装备系统 应当 支持技能魔次枚举中定义的所有技能的技能魔次属性
4. 当 装备生成时，装备系统 应当 根据掉落该装备的怪物类型分配属性

### 需求4: 装备掉落关联系统

**用户故事:** 作为玩家，我希望从不同属性的怪物获得对应属性的装备，以便有针对性地刷取所需装备。

#### 验收标准

1. 当 怪物死亡时，装备系统 应当 根据怪物的主要属性确定掉落属性
2. 装备系统 应当 将怪物攻击类型映射到装备攻击属性
3. 装备系统 应当 将怪物防御类型映射到装备防御属性
4. 若 怪物是BOSS，装备系统 应当 增加掉落带有技能魔次加成装备的概率
5. 若 怪物已变异，装备系统 应当 增加掉落更高品质装备的概率

### 需求5: 属性翻倍系统

**用户故事:** 作为玩家，我希望装备属性有翻倍机会，以便获得更强力的装备。

#### 验收标准

1. 属性翻倍系统 应当 支持三种翻倍类型：基础翻倍、极品翻倍、神品翻倍
2. 当 装备生成时，属性翻倍系统 应当 以100%概率应用基础翻倍，倍率范围1-100
3. 当 装备生成时，属性翻倍系统 应当 根据玩家的极品率应用极品翻倍，倍率 = 10 + 极品率/100
4. 当 装备生成时，属性翻倍系统 应当 以1/2000概率应用神品翻倍，倍率范围1-20
5. 属性翻倍系统 应当 允许基于概率的多种翻倍类型叠加

### 需求6: 伤害计算系统

**用户故事:** 作为游戏系统，我需要准确计算玩家对怪物的伤害，以便提供平衡的战斗体验。

#### 验收标准

1. 伤害计算器 应当 使用公式：(主属性 - 怪物防御) * (技能魔次 - 怪物魔次抵抗) * BUFF加成 = 最终伤害
2. 当 计算伤害时，伤害计算器 应当 根据技能类型获取玩家的主属性
3. 当 计算伤害时，伤害计算器 应当 获取怪物的防御和魔次抵抗值
4. 当 计算伤害时，伤害计算器 应当 应用所有激活的BUFF加成
5. 若 计算出的伤害为负数，则 伤害计算器 应当 将最小伤害设为1

### 需求7: 技能魔次系统

**用户故事:** 作为游戏系统，我需要管理技能魔次值，以便不同技能产生不同的伤害效果。

#### 验收标准

1. 技能魔次系统 应当 为基础技能定义基础技能魔次（10001-10013）
2. 技能魔次系统 应当 为职业特定技能定义职业技能魔次（10014-10019）
3. 技能魔次系统 应当 为全体目标技能定义全局技能魔次（10020）
4. 技能魔次系统 应当 为高级技能定义新技能魔次（10021-10050）
5. 当 装备具有技能魔次加成时，装备系统 应当 将加成添加到玩家的技能魔次中

### 需求8: 磨怪惊喜系统

**用户故事:** 作为玩家，我希望击杀磨怪时获得更高的惊喜几率，以便长时间战斗获得相应回报。可以是属性提高 也可以是爆率提高,即掉落稀有道具

#### 验收标准

1. 怪物系统 应当 将磨怪识别为需要延长战斗时间的怪物（高生命值）
2. 当 磨怪被击杀时，装备系统 应当 增加稀有掉落概率
3. 怪物系统 应当 确保磨怪提供视觉反馈以表明其特殊状态
4. 装备系统 应当 跟踪战斗持续时间并相应调整掉落品质
5. 若 战斗持续时间超过阈值，装备系统 应当 保证最低装备品质

### 需求9: 玩家体验优化

**用户故事:** 作为玩家，我希望获得良好的游戏体验，包括惊喜感和成就感。

#### 验收标准

1. 怪物系统 应当 在遇到特殊怪物时提供特殊BOSS称号 
2. 装备系统 应当 在掉落的装备上显示清晰的属性信息
3. 当 稀有装备掉落时，装备系统 应当 提供特殊视觉效果
4. 属性翻倍系统 应当 在获得装备时显示翻倍类型
5. 怪物变异系统 应当 确保变异频率提供惊喜感而不会造成挫败感
