# 实现计划: 怪物属性与装备属性系统

## 概述

本实现计划将怪物属性与装备属性系统分解为可执行的编码任务。所有数值计算使用大数值计算方法（`智能计算`），装备属性通过OutWay1/OutWay2/OutWay3三层结构存储。

## 任务列表

- [ ] 1. 怪物基础属性系统
  - [ ] 1.1 实现怪物TAG分类器
    - 根据TAG后缀(1-5)分类怪物类型
    - TAG后缀1-2为小怪，3为精英，4为BOSS
    - 支持特殊怪物和特殊BOSS类型
    - _需求: 1.2, 1.3, 1.4, 1.5, 1.6_

  - [ ] 1.2 实现怪物属性计算器
    - 定义怪物属性接口（生命值、防御力、攻击力、魔次抵抗）
    - 使用大数值字符串存储属性
    - 根据怪物类型分配基础属性
    - _需求: 1.1, 1.2_

  - [ ] 1.3 编写TAG分类属性测试
    - **属性1: TAG分类正确性**
    - **验证需求: 1.2, 1.3, 1.4, 1.5**

- [ ] 2. 怪物变异系统
  - [ ] 2.1 实现变异类型枚举和配置
    - 定义变异类型（普通、稀有、传说、磨怪）
    - 配置各变异类型的倍率和掉落加成
    - _需求: 2.2_

  - [ ] 2.2 实现变异触发逻辑
    - 怪物生成时概率触发变异
    - 使用大数值计算应用属性倍率
    - 改变怪物外观（颜色/名称后缀）
    - _需求: 2.1, 2.3, 2.4_

  - [ ] 2.3 实现磨怪系统
    - 识别磨怪（高生命值怪物）
    - 磨怪生命值至少为普通怪物5倍
    - 提供视觉反馈表明特殊状态
    - _需求: 2.6, 8.1, 8.3_

  - [ ] 2.4 编写变异属性增强测试
    - **属性2: 变异属性增强**
    - **验证需求: 2.3**

  - [ ] 2.5 编写磨怪生命值测试
    - **属性7: 磨怪生命值显著增加**
    - **验证需求: 2.6, 8.1**

- [ ] 3. 检查点 - 确保怪物系统测试通过
  - 确保所有测试通过，如有问题请询问用户

- [ ] 4. 装备基础属性系统
  - [ ] 4.1 定义装备属性ID枚举
    - 基础属性ID（161-168）
    - 技能魔次属性ID（10001-10050）
    - 其他特殊属性ID
    - _需求: 3.2, 3.3_

  - [ ] 4.2 实现装备属性设置函数
    - 统一的设置装备属性函数
    - OutWay1存储属性ID
    - OutWay2存储前端数字值
    - OutWay3存储后端单位值
    - _需求: 3.2, 3.3, 3.4_

  - [ ] 4.3 实现装备属性读取函数
    - 读取并解析OutWay1/2/3
    - 转换为大数值字符串
    - _需求: 3.2_

- [ ] 5. 装备掉落关联系统
  - [ ] 5.1 实现怪物-装备属性映射
    - 怪物攻击类型映射到装备攻击属性
    - 怪物防御类型映射到装备防御属性
    - _需求: 4.2, 4.3_

  - [ ] 5.2 实现掉落属性计算
    - 根据怪物主要属性确定掉落属性
    - BOSS增加技能魔次装备概率
    - 变异怪物增加高品质装备概率
    - _需求: 4.1, 4.4, 4.5_

  - [ ] 5.3 编写装备属性映射测试
    - **属性3: 装备属性映射一致性**
    - **验证需求: 4.1, 4.2, 4.3**

- [ ] 6. 属性翻倍系统
  - [ ] 6.1 实现翻倍类型枚举
    - 基础翻倍（100%触发，1-100）
    - 极品翻倍（根据极品率触发）
    - 神品翻倍（1/2000触发，1-20）
    - _需求: 5.1_

  - [ ] 6.2 实现翻倍计算函数
    - 使用大数值计算翻倍
    - 支持多种翻倍类型叠加
    - 返回翻倍结果对象
    - _需求: 5.2, 5.3, 5.4, 5.5_

  - [ ] 6.3 编写翻倍范围约束测试
    - **属性4: 翻倍系统范围约束**
    - **验证需求: 5.2, 5.3, 5.4**

  - [ ] 6.4 编写翻倍叠加测试
    - **属性8: 翻倍叠加正确性**
    - **验证需求: 5.5**

- [ ] 7. 检查点 - 确保装备系统测试通过
  - 确保所有测试通过，如有问题请询问用户

- [ ] 8. 伤害计算系统
  - [ ] 8.1 实现伤害计算函数
    - 公式: (主属性-怪物防御)*(技能魔次-怪物魔次抵抗)*BUFF加成/100
    - 使用大数值计算所有步骤
    - 最小伤害保证为1
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

  - [ ] 8.2 编写伤害最小值测试
    - **属性5: 伤害计算最小值保证**
    - **验证需求: 6.5**

  - [ ] 8.3 编写伤害公式正确性测试
    - **属性6: 伤害公式正确性**
    - **验证需求: 6.1**

- [ ] 9. 技能魔次系统
  - [ ] 9.1 实现技能魔次枚举
    - 基础技能魔次（10001-10013）
    - 职业技能魔次（10014-10019）
    - 全体技能魔次（10020）
    - 新技能魔次（10021-10050）
    - _需求: 7.1, 7.2, 7.3, 7.4_

  - [ ] 9.2 实现装备技能魔次加成
    - 读取装备的技能魔次属性
    - 将加成添加到玩家技能魔次
    - _需求: 7.5_

- [ ] 10. 磨怪惊喜系统
  - [ ] 10.1 实现战斗时间跟踪
    - 跟踪战斗持续时间
    - 根据时间调整掉落品质
    - _需求: 8.4_

  - [ ] 10.2 实现磨怪掉落加成
    - 磨怪被击杀时增加稀有掉落概率
    - 战斗时间超过阈值保证最低品质
    - _需求: 8.2, 8.5_

- [ ] 11. 玩家体验优化
  - [ ] 11.1 实现特殊怪物反馈
    - 特殊怪物显示BOSS称号
    - _需求: 9.1_

  - [ ] 11.2 实现装备掉落反馈
    - 显示清晰的属性信息
    - 稀有装备提供特殊视觉效果
    - 显示翻倍类型
    - _需求: 9.2, 9.3, 9.4_

  - [ ] 11.3 调整变异频率
    - 确保变异频率提供惊喜感
    - 避免造成挫败感
    - _需求: 9.5_

- [ ] 12. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

## 备注

- 所有任务都必须完成，包括测试任务
- 所有数值计算使用 `智能计算` 函数（来自 `大数值/核心计算方法.ts`）
- 装备属性通过 OutWay1/OutWay2/OutWay3 三层结构存储
- 技能魔次枚举值作为属性ID存储在OutWay1中
