# Implementation Plan: 血统系统

## Overview

本实现计划将血统系统分解为离散的编码步骤，每个步骤都建立在前一步的基础上。所有任务都涉及编写、修改或测试代码。

## Tasks

- [x] 1. 创建血统系统基础结构
  - 创建 `_核心部分/_服务/血统选择.ts` 文件
  - 定义血统配置接口和数据
  - 定义四种血统的配置（血族、狼人、修真、恶魔）
  - 添加图标ID和属性加成配置
  - _Requirements: 1.5, 2.1, 2.2, 2.3, 2.4_

- [x] 2. 实现血统选择功能
  - [x] 2.1 实现初始化函数
    - 初始化 Player.V.血统 和 Player.V.血统等级
    - _Requirements: 6.3_
  
  - [x] 2.2 实现主界面函数
    - 显示当前血统信息
    - 显示血统列表（带图标）
    - 显示选择按钮
    - 显示升级和重置按钮
    - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.7_
  
  - [x] 2.3 实现血统选择逻辑
    - 检查是否已有血统
    - 设置血统类型和初始等级
    - 触发属性重新计算
    - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 3. 实现血统升级功能
  - [x] 3.1 实现材料计算函数
    - 使用等差数列求和公式
    - 计算当前等级升级所需材料
    - _Requirements: 3.4_
  
  - [x] 3.2 实现升级界面
    - 显示当前和升级后的属性对比
    - 显示所需材料数量
    - _Requirements: 3.6, 5.6_
  
  - [x] 3.3 实现升级执行逻辑
    - 检查材料是否足够
    - 扣除材料
    - 提升血统等级
    - 触发属性重新计算
    - _Requirements: 3.1, 3.2, 3.3, 3.5_

- [x] 4. 实现血统重置功能
  - [x] 4.1 实现重置确认对话框
    - 使用 Player.Question 显示确认对话框
    - 提示将失去所有等级和加成
    - _Requirements: 4.1, 4.5_
  
  - [x] 4.2 实现重置执行逻辑
    - 清空血统类型和等级
    - 触发属性重新计算
    - _Requirements: 4.2, 4.3, 4.4_

- [x] 5. 实现属性加成计算
  - [x] 5.1 实现获取血统加成函数
    - 根据血统类型和等级计算加成
    - 返回血量、主属性、防御加成
    - _Requirements: 2.6_
  
  - [x] 5.2 创建应用血统加成函数
    - 使用大数值计算方法
    - 应用血量加成
    - 应用主属性加成
    - 应用防御加成
    - _Requirements: 2.5, 7.3_

- [x] 6. 集成到属性统计系统
  - [x] 6.1 导入血统加成函数
    - 在属性统计文件中导入获取血统加成
    - _Requirements: 7.1_
  
  - [x] 6.2 在属性统计流程中调用血统加成
    - 在应用基因加成后调用
    - 在最终属性计算前调用
    - _Requirements: 7.2, 7.5_
  
  - [x] 6.3 在属性显示页面添加血统信息
    - 添加血统类型显示项
    - 添加血统等级显示项
    - _Requirements: 7.4_

- [x] 7. Checkpoint - 确保所有功能正常工作
  - 测试血统选择流程
  - 测试血统升级流程
  - 测试血统重置流程
  - 测试属性加成计算
  - 验证界面显示正确

## Notes

- 所有任务已完成 ✓
- 血统系统已成功集成到游戏中
- 界面参考基因系统设计，保持一致性
- 使用大数值计算方法确保数值正确性
- 属性加成在装备属性统计流程中正确应用
