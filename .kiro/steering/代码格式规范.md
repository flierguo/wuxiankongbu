---
inclusion: always
---


# 全局开发规则 (Global Rules)

以下规则必须**始终遵守 (Always Call)**：

1. **中文交互**: 所有交互、解释、注释及文档说明必须使用中文，确保用户理解。
2. **查阅说明书**: 编写脚本或涉及API调用时，必须优先查阅 `h:\10职业\无限恐怖\91M2说明书` 文件夹内的文档和示例。遇到不确定的API用法，先查阅说明书。
3. **低CPU消耗**: 所有代码编写必须以**降低单核CPU消耗**为前提。
    - 优先使用高效算法。
    - 避免不必要的循环和高频计算。
    - 使用大数值优化方案时，严格遵循性能最佳实践。

# 代码格式规范

## 自动格式化规则

每次保存代码文件时，请自动应用以下格式规范：

## 1. 缩进和空格

```typescript
// ✅ 正确：使用4个空格缩进
export function Main(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    if (condition) {
        // 代码
    }
}

// ❌ 错误：使用Tab或2个空格
export function Main(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
  if (condition) {
    // 代码
  }
}
```

## 2. 运算符空格

```typescript
// ✅ 正确：运算符两边加空格
const 结果 = 数值1 + 数值2
if (a === b) { }
Player.V.计数器 = 0

// ❌ 错误：运算符没有空格
const 结果=数值1+数值2
if (a===b) { }
Player.V.计数器=0
```

## 3. 逗号和分号

```typescript
// ✅ 正确：逗号后加空格，分号结尾
const arr = [1, 2, 3];
function test(a: number, b: string): void { }

// ❌ 错误：逗号后无空格
const arr = [1,2,3];
function test(a:number,b:string):void { }
```

## 4. 函数声明

```typescript
// ✅ 正确：函数名和参数之间无空格
export function 货币兑换(Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    // 代码
}

// ❌ 错误：函数名和参数之间有空格
export function 货币兑换 (Npc: TNormNpc, Player: TPlayObject, Args: TArgs): void {
    // 代码
}
```

## 5. 对象和数组

```typescript
// ✅ 正确：花括号内侧加空格
const obj = { name: '测试', value: 100 };
const arr = [1, 2, 3];

// ❌ 错误：花括号内侧无空格
const obj = {name: '测试', value: 100};
const arr = [1,2,3];
```

## 6. 条件语句

```typescript
// ✅ 正确：关键字后加空格，花括号换行
if (condition) {
    // 代码
} else {
    // 代码
}

// ❌ 错误：格式混乱
if(condition){
    // 代码
}else{
    // 代码
}
```

## 7. 注释规范

```typescript
// ✅ 正确：注释符号后加空格
// 这是单行注释
/* 这是多行注释 */

// ❌ 错误：注释符号后无空格
//这是单行注释
/*这是多行注释*/
```

## 8. 空行规范

```typescript
// ✅ 正确：函数之间空一行
export function 函数1(): void {
    // 代码
}

export function 函数2(): void {
    // 代码
}

// ❌ 错误：函数之间无空行或多个空行
export function 函数1(): void {
    // 代码
}
export function 函数2(): void {
    // 代码
}
```

## 9. 字符串引号

```typescript
// ✅ 推荐：优先使用单引号
const str = '这是字符串';
const template = `这是模板字符串 ${变量}`;

// ✅ 可接受：双引号（保持一致性）
const str = "这是字符串";
```

## 10. 变量声明

```typescript
// ✅ 正确：使用 const 或 let，不使用 var
const 常量 = 100;
let 变量 = 200;

// ❌ 错误：使用 var
var 旧变量 = 300;
```

## 11. 类型注解

```typescript
// ✅ 正确：冒号后加空格
function test(name: string, age: number): void { }
const value: number = 100;

// ❌ 错误：冒号后无空格
function test(name:string, age:number):void { }
const value:number = 100;
```

## 12. 箭头函数

```typescript
// ✅ 正确：箭头两边加空格
const func = (x: number) => x * 2;
arr.map(item => item.value);

// ❌ 错误：箭头两边无空格
const func = (x: number)=>x * 2;
arr.map(item=>item.value);
```

## 自动格式化触发时机

1. **保存文件时**：自动应用所有格式规范
2. **粘贴代码时**：自动调整缩进和空格
3. **编写代码时**：实时提示格式问题

## 格式化优先级

1. 保持代码可读性
2. 遵循 TypeScript 标准规范
3. 保持项目内格式一致性
4. 优化性能相关的代码结构

## 特殊情况

### 长字符串不强制换行

```typescript
// ✅ 允许：UI字符串可以很长
const S = `\\\\
    {S=货币兑换中心;C=254;X=200;Y=38}\\\\
    <{S=金币兑换元宝;HINT=比例: 1200金币 = 1元宝;X=100;Y=120}/@InputInteger(请输入要兑换的元宝数量,金币兑换)>
`;
```

### 性能优化代码保持紧凑

```typescript
// ✅ 允许：性能关键代码可以紧凑
if (Player.R.性能计数器 % 5 === 0) { 自动回收(Npc, Player, Args); }
```

## 注意事项

1. **保存前自动格式化**：每次保存时自动应用规范
2. **不破坏逻辑**：格式化不应改变代码逻辑
3. **保持一致性**：整个项目使用相同的格式规范
4. **性能优先**：格式化不应影响代码性能
