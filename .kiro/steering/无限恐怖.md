---
inclusion: always
---
<!------------------------------------------------------------------------------------
   Add rules to this file or a short description and have Kiro refine them for you.
   
   Learn about inclusion modes: https://kiro.dev/docs/steering/#inclusion-modes
-------------------------------------------------------------------------------------> 

# 无限恐怖项目规则

## 项目特性

- 项目是大数值游戏项目，会频繁调用大数值运算
- 引擎自身支持最大999京的数值，超过的数值都需要字符运算
- 引用 `大数值/核心计算方法` 中的智能计算函数来进行运算

## 性能要求

- 代码需要以降低CPU单核占用为基础
- 高频调用的部分一定要优化性能
- 使用计数器而非时间函数来计算时间间隔

## API参考

- 每次添加及更改代码需读取及参考 `91M2说明书` 文件夹内的代码说明和示例及API，防止出错
- 所有API调用都可以在 91M2说明书 文件夹内查看

## 相关规则

- 定时器使用规则：参考 `定时器规则.md`
- 代码格式规范：参考 `代码格式规范.md`

## 代码删除安全规则

- **禁止使用 editCode 的 delete_node 操作删除函数**，该操作在中文函数名场景下会误删大量无关代码，导致整个文件被清空
- 删除函数/代码块时，必须使用 `strReplace` 工具，将目标代码精确替换为空字符串
- 删除前必须先用 `grepSearch` 确认该函数/导出没有被其他文件引用
- 每次删除操作后，立即用 `getDiagnostics` 检查被修改文件及所有引用方文件
- 批量删除时，每删一个函数就验证一次，不要一次性删除多个后再验证
- 如果一个文件需要删除多个函数，优先使用 `readFile` 读取完整内容，手动剔除目标函数后用 `fsWrite` 重写整个文件，这比逐个 delete_node 更安全

## 变量初始化规则

- 所有 `Player.R.xxx ??= 默认值` 的初始化代码必须统一放在 `_核心部分/_玩家/登录触发.ts` 的 `登录初始化变量(Player)` 函数中
- 登录时初始化一次即可，其他文件（如装备掉落、攻击计算等）直接使用，不要重复写 `??=` 初始化
- 新增 `Player.R` 变量时，按功能分类放到对应的注释区块下（基础属性、技能、神器、爆率回收等）
- `Player.V` 的临时变量同理，统一在登录初始化中赋默认值

## UI窗口尺寸规范

制作NPC对话界面时，必须遵循以下窗口尺寸和布局规范：

### 窗口类型和尺寸

- **NPC小窗口**: 400×276 像素
  - 适用于简单对话、提示信息
  - 建议内容不超过8-10行
  
- **NPC扁窗口**: 450×209 像素
  - 适用于横向布局、简短列表
  - 建议内容不超过6-8行
  
- **NPC大窗口**: 498×414 像素
  - 适用于复杂界面、长列表、详细信息
  - 建议内容不超过15-18行

### 布局规范

- **标题位置**: Y=5-10，居中显示（X=180左右）
- **分隔线**: Y间隔20-35，使用 `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`
- **文字行间距**: 20-25像素
- **按钮间距**: 垂直间距25-30像素
- **左边距**: 主内容X=20，次级内容X=40
- **底部按钮**: 距离底部20-30像素

### 分页显示规范

- **小窗口**: 每页最多显示5-6项
- **大窗口**: 每页最多显示10-12项
- 超过限制时必须实现翻页功能
- 翻页按钮格式: `<上一页>` `<下一页>` 或 `<第X页>`

