/**
 * 属性统计模块 - 优化版
 * 
 * 优化点：
 * 1. 使用查表替代switch-case，减少分支判断
 * 2. 合并重复的映射定义，减少内存占用
 * 3. 减少函数调用次数，降低CPU消耗
 * 4. 简化逻辑，去除冗余代码
 */

import { 大于, 智能计算, 比较 } from "../../_大数值/核心计算方法"
import { 大数值整数简写, 血量显示 } from "../字符计算"
import { 基础词条, 技能魔次 } from "../基础常量"
import { 神器属性统计 } from "./神器统计"
import { 计算捐献爆率加成 } from "../_服务/捐献排名"
import { 获取血统加成 } from "../_服务/血统选择"
import { 获取津贴爆率加成 } from "../_服务/主神津贴"
import { 应用套装加成 } from "./随机套装"
import { 获取魂血血量加成, 获取魂血吸血加成 } from "../_服务/魂血精魄"

// ==================== 常量定义（预计算，避免运行时创建） ====================

// 主属性百分比映射（Job -> 百分比变量名）
const 主属性百分比表 = ['攻击百分比', '魔法百分比', '道术百分比', '刺术百分比', '箭术百分比', '武术百分比']

// 基础词条 -> 自定属性索引映射（使用数组查表，O(1)）
const 基础词条索引表: { [id: number]: number } = {
    [基础词条.攻击]: 161, [基础词条.攻击2]: 161,
    [基础词条.魔法]: 162, [基础词条.魔法2]: 162,
    [基础词条.道术]: 163, [基础词条.道术2]: 163,
    [基础词条.刺术]: 164, [基础词条.刺术2]: 164,
    [基础词条.箭术]: 165, [基础词条.箭术2]: 165,
    [基础词条.武术]: 166, [基础词条.武术2]: 166,
    [基础词条.血量]: 167, [基础词条.血量2]: 167,
    [基础词条.防御]: 168, [基础词条.防御2]: 168,
}

// 百分比词条 -> 变量名映射
const 百分比词条表: { [id: number]: string } = {
    [基础词条.攻击百分比]: '攻击百分比',
    [基础词条.魔法百分比]: '魔法百分比',
    [基础词条.道术百分比]: '道术百分比',
    [基础词条.刺术百分比]: '刺术百分比',
    [基础词条.箭术百分比]: '箭术百分比',
    [基础词条.武术百分比]: '武术百分比',
    [基础词条.血量百分比]: '生命百分比',
    [基础词条.防御百分比]: '防御百分比',
    [基础词条.天枢职业百分比]: '天枢职业百分比',
    [基础词条.血神职业百分比]: '血神职业百分比',
    [基础词条.暗影职业百分比]: '暗影职业百分比',
    [基础词条.烈焰职业百分比]: '烈焰职业百分比',
    [基础词条.正义职业百分比]: '正义职业百分比',
    [基础词条.不动职业百分比]: '不动职业百分比',
    [基础词条.全体职业百分比]: '全体职业百分比',
    [基础词条.经验百分比]: '经验百分比',
    [基础词条.极品百分比]: '极品率加成',
}

// 技能魔次 -> 变量名映射
const 魔次变量表: { [id: number]: string } = {
    [技能魔次.攻杀剑术]: '攻杀剑术魔次', [技能魔次.半月弯刀]: '半月弯刀魔次',
    [技能魔次.雷电术]: '雷电术魔次', [技能魔次.暴风雪]: '暴风雪魔次',
    [技能魔次.灵魂火符]: '灵魂火符魔次', [技能魔次.飓风破]: '飓风破魔次',
    [技能魔次.暴击术]: '暴击术魔次', [技能魔次.霜月]: '霜月魔次',
    [技能魔次.精准箭术]: '精准箭术魔次', [技能魔次.万箭齐发]: '万箭齐发魔次',
    [技能魔次.罗汉棍法]: '罗汉棍法魔次', [技能魔次.天雷阵]: '天雷阵魔次',
    [技能魔次.怒斩]: '怒斩魔次', [技能魔次.人之怒]: '人之怒魔次',
    [技能魔次.地之怒]: '地之怒魔次', [技能魔次.天之怒]: '天之怒魔次',
    [技能魔次.神之怒]: '神之怒魔次',
    [技能魔次.血气献祭]: '血气献祭魔次', [技能魔次.血气燃烧]: '血气燃烧魔次',
    [技能魔次.暗影袭杀]: '暗影袭杀魔次', [技能魔次.暗影剔骨]: '暗影剔骨魔次',
    [技能魔次.暗影风暴]: '暗影风暴魔次', [技能魔次.暗影附体]: '暗影附体魔次',
    [技能魔次.火焰追踪]: '火焰追踪魔次', [技能魔次.烈焰护甲]: '烈焰护甲魔次',
    [技能魔次.爆裂火冢]: '爆裂火冢魔次', [技能魔次.烈焰突袭]: '烈焰突袭魔次',
    [技能魔次.圣光]: '圣光魔次', [技能魔次.行刑]: '行刑魔次', [技能魔次.洗礼]: '洗礼魔次',
    [技能魔次.如山]: '如山魔次', [技能魔次.金刚掌]: '金刚掌魔次',
}

// 职业魔次 -> 影响的技能列表
const 职业魔次影响表: { [id: number]: string[] } = {
    [技能魔次.天枢]: ['怒斩魔次', '人之怒魔次', '地之怒魔次', '天之怒魔次', '神之怒魔次'],
    [技能魔次.血神]: ['血气献祭魔次', '血气燃烧魔次'],
    [技能魔次.暗影]: ['暗影袭杀魔次', '暗影剔骨魔次', '暗影风暴魔次', '暗影附体魔次'],
    [技能魔次.烈焰]: ['火焰追踪魔次', '烈焰护甲魔次', '爆裂火冢魔次', '烈焰突袭魔次'],
    [技能魔次.正义]: ['圣光魔次', '行刑魔次', '洗礼魔次'],
    [技能魔次.不动]: ['如山魔次', '金刚掌魔次'],
}

// 全部魔次列表（用于全体魔次加成）
const 全部魔次列表 = [
    '攻杀剑术魔次', '半月弯刀魔次', '雷电术魔次', '暴风雪魔次',
    '灵魂火符魔次', '飓风破魔次', '暴击术魔次', '霜月魔次',
    '精准箭术魔次', '万箭齐发魔次', '罗汉棍法魔次', '天雷阵魔次',
    '怒斩魔次', '人之怒魔次', '地之怒魔次', '天之怒魔次', '神之怒魔次',
    '血气献祭魔次', '血气燃烧魔次',
    '暗影袭杀魔次', '暗影剔骨魔次', '暗影风暴魔次', '暗影附体魔次',
    '火焰追踪魔次', '烈焰护甲魔次', '爆裂火冢魔次', '烈焰突袭魔次',
    '圣光魔次', '行刑魔次', '洗礼魔次', '如山魔次', '金刚掌魔次'
]

// 职业魔次百分比映射
const 职业魔次百分比表: { [key: string]: string[] } = {
    '天枢职业百分比': ['怒斩魔次', '人之怒魔次', '地之怒魔次', '天之怒魔次', '神之怒魔次'],
    '血神职业百分比': ['血气献祭魔次', '血气燃烧魔次'],
    '暗影职业百分比': ['暗影袭杀魔次', '暗影剔骨魔次', '暗影风暴魔次', '暗影附体魔次'],
    '烈焰职业百分比': ['火焰追踪魔次', '烈焰护甲魔次', '爆裂火冢魔次', '烈焰突袭魔次'],
    '正义职业百分比': ['圣光魔次', '行刑魔次', '洗礼魔次'],
    '不动职业百分比': ['如山魔次', '金刚掌魔次'],
}

// ==================== JSON缓存系统 ====================
const JSON缓存 = new Map<string, any>()
const JSON缓存上限 = 200

function 获取JSON缓存(customDesc: string): any {
    if (!customDesc) return null
    const cached = JSON缓存.get(customDesc)
    if (cached) return cached
    try {
        const data = JSON.parse(customDesc)
        if (JSON缓存.size >= JSON缓存上限) {
            const firstKey = JSON缓存.keys().next().value
            JSON缓存.delete(firstKey)
        }
        JSON缓存.set(customDesc, data)
        return data
    } catch { return null }
}

// ==================== 装备获取（使用数组索引优化） ====================
export function 获取身上装备(Player: TPlayObject, 位置: number): TUserItem | null {
    // 0-16: 直接属性访问
    if (位置 <= 16) {
        const 装备属性 = [
            Player.Dress, Player.Wepon, Player.NeckLace, Player.Helmet,
            Player.RightHand, Player.ArmringLeft, Player.ArmringRight,
            Player.RingLeft, Player.RingRight, Player.Belt, Player.Boots,
            Player.Shield, Player.Charm, Player.Bujuk, Player.Fashion,
            Player.Mount, Player.Mask
        ]
        return 装备属性[位置] || null
    }
    // 17-22: 宝石
    if (位置 <= 22) return Player.GetJewelrys(位置 - 17)
    // 23-34: 生肖
    if (位置 <= 34) return Player.GetZodiacs(位置 - 23)
    return null
}

// ==================== 变量初始化 ====================
export function 清空变量(Player: TPlayObject): void {
    const R = Player.R
    
    // 自定属性初始化（使用对象字面量一次性赋值）
    R.自定属性 = {
        161: '500', 162: '500', 163: '500', 164: '500',
        165: '500', 166: '500', 167: '100000', 168: '500', 169: '0'
    }

    // 百分比属性批量初始化
    R.生命百分比 = R.防御百分比 = R.攻击百分比 = R.魔法百分比 = 0
    R.道术百分比 = R.刺术百分比 = R.箭术百分比 = R.武术百分比 = 0
    R.天枢职业百分比 = R.血神职业百分比 = R.暗影职业百分比 = 0
    R.烈焰职业百分比 = R.正义职业百分比 = R.不动职业百分比 = R.全体职业百分比 = 0
    R.经验百分比 = 0
    R.吸血千分比 = 0

    // 魔次属性批量初始化
    for (const 魔次名 of 全部魔次列表) { R[魔次名] = '0' }

    // 其他属性
    R.经验加成 = R.爆率加成 = R.极品率加成 = R.伤害吸收 = 0
    R.回收倍率 = 100
    R.鞭尸几率 = R.鞭尸次数 = 0
    R.全体魔次 = '0'
    R.狂化阶数 = R.融合阶数 = R.迅疾阶数 = R.念力阶数 = R.甲壳阶数 = R.协作阶数 = 0
    R.神器爆率加成 = R.神器回收加成 = R.神器增伤加成 = 0
    R.基因锁等级 = R.暴击几率 = R.暴击伤害 = R.无视防御 = R.基因增加伤害 = 0
    R.最终爆率加成 = R.最终回收倍率 = R.最终极品倍率 = R.最终鞭尸次数 = R.最终伤害加成 = 0

    Player.RecalcAbilitys()
}

// ==================== 属性处理（查表优化） ====================
function 处理词条(Player: TPlayObject, 词条ID: number, 属性值: string): void {
    const R = Player.R
    
    // 基础属性词条（100-115）
    const 索引 = 基础词条索引表[词条ID]
    if (索引) {
        R.自定属性[索引] = 智能计算(R.自定属性[索引], 属性值, 1)
        return
    }

    // 百分比词条（116-130）
    const 百分比名 = 百分比词条表[词条ID]
    if (百分比名) {
        R[百分比名] += Number(属性值)
        return
    }

    // 单个技能魔次
    const 魔次名 = 魔次变量表[词条ID]
    if (魔次名) {
        R[魔次名] = 智能计算(R[魔次名], 属性值, 1)
        return
    }

    // 职业魔次（影响多个技能）
    const 影响列表 = 职业魔次影响表[词条ID]
    if (影响列表) {
        for (const 名称 of 影响列表) {
            R[名称] = 智能计算(R[名称], 属性值, 1)
        }
        return
    }

    // 全体魔次
    if (词条ID === 技能魔次.全体) {
        for (const 名称 of 全部魔次列表) {
            R[名称] = 智能计算(R[名称], 属性值, 1)
        }
    }
}

// ==================== JSON属性处理 ====================
function 处理JSON属性(Player: TPlayObject, 数据: any): void {
    if (!数据) return
    const 职业数组 = 数据.职业属性_职业
    const 属性数组 = 数据.职业属性_属性
    if (!职业数组 || !属性数组 || 职业数组.length !== 属性数组.length) return

    for (let i = 0, len = 职业数组.length; i < len; i++) {
        const id = 职业数组[i]
        const val = String(属性数组[i])
        if (id != null && val && val !== '0') {
            处理词条(Player, id, val)
        }
    }
}

// ==================== 加成应用（合并优化） ====================
function 应用所有加成(Player: TPlayObject): void {
    const R = Player.R
    const V = Player.V
    const job = Player.Job
    const 主属性百分比 = 主属性百分比表[job]

    // 基因加成
    const 基因 = V.基因
    if (基因 === '狂化') { R.暴击几率 += 20; R.暴击伤害 += 500 }
    else if (基因 === '迅疾') { R.无视防御 += 20; R.基因增加伤害 += 200 }
    else if (基因 === '甲壳') { R.防御百分比 += 30; R.生命百分比 += 50 }
    else if (基因 === '融合') { R.神器回收加成 += 50; R.生命百分比 += 50 }
    else if (基因 === '念力') { R.神器爆率加成 += 20; R[主属性百分比] += 10 }
    else if (基因 === '协作') { R.极品率加成 += 10; R[主属性百分比] += 10 }

    // 职业特殊加成
    if (V.职业 === '暗影') { R[主属性百分比] += (R.暗影值 || 0) }
    if (V.泰山等级 > 0 && V.职业 === '不动') {
        R[主属性百分比] += Math.floor(V.泰山等级 * 3 + 27)
    }

    // 血统加成
    const 血统 = 获取血统加成(Player)
    if (血统) {
        if (血统.血量 > 0) R.生命百分比 += 血统.血量
        if (血统.主属性 > 0) R[主属性百分比] += 血统.主属性
        if (血统.防御 > 0) R.防御百分比 += 血统.防御
    }

    // 魂血精魄加成
    R.生命百分比 += 获取魂血血量加成(Player)
    R.吸血千分比 = (R.吸血千分比 || 0) + 获取魂血吸血加成(Player)
    R.吸血千分比 = Math.min(R.吸血千分比 + V.血气迸发等级, 2000)
}

// ==================== 属性倍数应用 ====================
function 应用属性倍数(Player: TPlayObject): void {
    const R = Player.R
    const 自定 = R.自定属性

    // 全属性加成
    const 全属性 = 自定[169]
    if (全属性 !== '0') {
        for (let i = 161; i <= 168; i++) {
            自定[i] = 智能计算(自定[i], 全属性, 1)
        }
    }

    // 百分比加成（索引 -> 百分比变量名）
    const 百分比映射 = [
        [161, '攻击百分比'], [162, '魔法百分比'], [163, '道术百分比'],
        [164, '刺术百分比'], [165, '箭术百分比'], [166, '武术百分比'],
        [167, '生命百分比'], [168, '防御百分比']
    ] as const

    for (const [idx, 名称] of 百分比映射) {
        const 百分比 = R[名称] || 0
        if (百分比 > 0) {
            const 原值 = 自定[idx]
            const 增量 = 智能计算(原值, String(百分比 * 0.01), 3)
            自定[idx] = 智能计算(原值, 增量, 1)
        }
    }

    // 职业魔次百分比
    for (const [百分比名, 魔次列表] of Object.entries(职业魔次百分比表)) {
        const 百分比 = R[百分比名] || 0
        if (百分比 > 0) {
            const 倍率 = String(百分比 * 0.01)
            for (const 魔次名 of 魔次列表) {
                const 原值 = R[魔次名]
                if (大于(原值, '0')) {
                    R[魔次名] = 智能计算(原值, 智能计算(原值, 倍率, 3), 1)
                }
            }
        }
    }

    // 全体职业百分比
    const 全体百分比 = R.全体职业百分比 || 0
    if (全体百分比 > 0) {
        const 倍率 = String(全体百分比 * 0.01)
        for (const 魔次名 of 全部魔次列表) {
            const 原值 = R[魔次名]
            if (大于(原值, '0')) {
                R[魔次名] = 智能计算(原值, 智能计算(原值, 倍率, 3), 1)
            }
        }
    }
}

// ==================== 人物额外属性计算 ====================
export function 人物额外属性计算(Player: TPlayObject): void {
    const A = Player.AddedAbility
    // 批量初始化为0
    A.AC = A.ACMax = A.MAC = A.MACMax = A.DC = A.DCMax = A.MC = A.MCMax = 0
    A.SC = A.SCMax = A.HP = A.HitPoint = A.SpeedPoint = 0
    A.AntiPoison = A.PoisonRecover = A.HealthRecover = A.SpellRecover = A.AntiMagic = 0
    A.GoldRate = A.DamageAdd = A.AppendDamage = A.Rebound = A.AppendDamageDef = 0
    A.CriticalHit = A.CriticalHitDef = A.DamageAbsorb = 0
    A.PunchHit = A.PunchHitDef = A.PunchHitAppendDamage = A.CriticalHitAppendDamage = 0
    A.HPRate = A.MPRate = A.WearWeight = 0
    
    A.MP = 5000
    A.ExpRate = Player.R.经验加成
    A.ItemRate = Player.R.最终爆率加成
    A.MaxWeight = 65535

    显示属性页面(Player, Player.R.属性页码 || 0)
    显示技能页面(Player)
    Player.RecalcAbilitys()
}

// ==================== 核心统计函数 ====================
export function 装备属性统计(Player: TPlayObject): void {
    清空变量(Player)
    const R = Player.R
    const V = Player.V

    // 遍历装备
    for (let i = 0; i <= 34; i++) {
        const 装备 = 获取身上装备(Player, i)
        if (!装备) continue
        const desc = 装备.GetCustomDesc()
        if (desc) {
            const data = 获取JSON缓存(desc)
            if (data) 处理JSON属性(Player, data)
        }
    }

    // 应用各种加成
    应用属性倍数(Player)
    神器属性统计(Player)
    应用所有加成(Player)
    应用套装加成(Player)


    // 计算最终属性
    const 捐献爆率 = 计算捐献爆率加成(Player)
    const 津贴爆率 = 获取津贴爆率加成(Player)
    const 转生 = Player.GetReNewLevel()
    
    R.伤害吸收 = 转生 <= 40 ? 转生 * 2 : 40 + 转生

    if (GameLib.V.是新区) {
        R.爆率加成 += 50
        R.回收倍率 += 100
        R.极品率加成 += 20
        R.经验百分比 += 200
    }
    // 经验百分比转经验加成
    R.经验加成 += R.经验百分比 || 0

    if (R.鞭尸几率 >= 100) { R.鞭尸次数++; R.鞭尸几率 = 100 }
    if (V.赞助鞭尸 >= 1) R.鞭尸几率 = 100

    R.最终爆率加成 = Math.max((R.神器爆率加成 || 0) + (R.爆率加成 || 0) + (V.宣传爆率 || 0) + (V.赞助爆率 || 0) + 捐献爆率 + 津贴爆率, 0)
    R.最终回收倍率 = Math.max((R.神器回收加成 || 0) + (R.回收倍率 || 0) + (V.宣传回收 || 0) + (V.赞助回收 || 0), 100)
    R.最终极品倍率 = Math.max((R.极品率加成 || 0) + (V.宣传极品 || 0) + (V.赞助极品 || 0), 0)
    R.最终鞭尸次数 = Math.max(R.鞭尸次数 + (V.赞助鞭尸 || 0), 0)
    if (R.圣耀副本爆率加成) R.最终爆率加成 += R.圣耀副本倍率

    // 血量同步
    Player.SetSVar(92, R.自定属性[167])
    if (比较(Player.GetSVar(91), Player.GetSVar(92)) > 0) {
        Player.SetSVar(91, Player.GetSVar(92))
        V.自定属性 = V.自定属性 || {}
        V.自定属性[1051] = Player.GetSVar(91)
    }

    Player.RecalcAbilitys()
    Player.UpdateName()
    人物额外属性计算(Player)
    血量显示(Player)
}


// ==================== 属性页面显示 ====================
const 属性配置: Array<[string, number, (p: TPlayObject) => string]> = [
    ['等级', 149, p => String(p.GetLevel())],
    ['幸运', 149, p => String(p.V.幸运值 || 0)],
    ['生命', 149, p => p.GetSVar(92) || '0'],
    ['防御', 149, p => p.R.自定属性[168] || '0'],
    ['攻击', 149, p => p.R.自定属性[161] || '0'],
    ['魔法', 149, p => p.R.自定属性[162] || '0'],
    ['道术', 149, p => p.R.自定属性[163] || '0'],
    ['刺术', 149, p => p.R.自定属性[164] || '0'],
    ['箭术', 149, p => p.R.自定属性[165] || '0'],
    ['武术', 149, p => p.R.自定属性[166] || '0'],
    ['爆率百分比', 19, p => String(p.R.最终爆率加成) || '100'],
    ['极品百分比', 19, p => String(p.R.最终极品倍率) || '0'],
    ['回收百分比', 19, p => String(p.R.最终回收倍率) || '100'],
    ['鞭尸几率', 19, p => String(p.R.鞭尸几率) || '0'],
    ['鞭尸次数', 19, p => String(p.R.最终鞭尸次数) || '0'],
    ['经验百分比', 21, p => String(p.R.经验加成) || '0'], 
    ['生命百分比', 21, p => String(p.R.生命百分比) || '0'],
    ['防御百分比', 21, p => String(p.R.防御百分比) || '0'],
    ['攻击百分比', 21, p => String(p.R.攻击百分比) || '0'],
    ['魔法百分比', 21, p => String(p.R.魔法百分比) || '0'],
    ['道术百分比', 21, p => String(p.R.道术百分比) || '0'],
    ['刺术百分比', 21, p => String(p.R.刺术百分比) || '0'],
    ['箭术百分比', 21, p => String(p.R.箭术百分比) || '0'],
    ['武术百分比', 21, p => String(p.R.武术百分比) || '0'],
    ['天枢魔次百分比', 21, p => String(p.R.天枢职业百分比) || '0'],
    ['血神魔次百分比', 21, p => String(p.R.血神职业百分比) || '0'],
    ['暗影魔次百分比', 21, p => String(p.R.暗影职业百分比) || '0'],     
    ['烈焰魔次百分比', 21, p => String(p.R.烈焰职业百分比) || '0'],
    ['正义魔次百分比', 21, p => String(p.R.正义职业百分比) || '0'],
    ['不动魔次百分比', 21, p => String(p.R.不动职业百分比) || '0'],
    ['全体魔次百分比', 21, p => String(p.R.全体职业百分比) || '0'],
    ['基因类型', 9, p => String(p.V.基因) || '未选择'],
    ['狂化阶数', 9, p => String(p.R.狂化阶数) || '0'],
    ['迅疾阶数', 9, p => String(p.R.迅疾阶数) || '0'],
    ['甲壳阶数', 9, p => String(p.R.甲壳阶数) || '0'],
    ['融合阶数', 9, p => String(p.R.融合阶数) || '0'],
    ['念力阶数', 9, p => String(p.R.念力阶数) || '0'],
    ['协作阶数', 9, p => String(p.R.协作阶数) || '0'],
    ['血统类型', 116, p => String(p.V.血统) || '未选择'],
    ['血统等级', 116, p => String(p.V.血统等级) || '0'],
    ['伤害吸收百分比', 116, p => String(p.R.伤害吸收) || '0'],
    ['吸血千分比', 116, p => String(p.R.吸血千分比) || '0'],
    ['基因锁等级', 116, p => String(p.R.基因锁等级) || '0'],
]

const 每页条数 = 10
const 计算位数 = (v: string) => String(v).replace(/\.\d+/, '').length

export function 显示属性页面(Player: TPlayObject, 页码: number): void {
    Player.R.属性页码 = 页码
    const 起始 = 页码 * 每页条数
    const 当页数据 = 属性配置.slice(起始, 起始 + 每页条数)

    let 内容 = ''
    for (let i = 0; i < 当页数据.length; i++) {
        const [名称, 色值, 取值] = 当页数据[i]
        const 值 = 取值(Player)
        const y = i * 25
        内容 += `#123S#61${名称}#59C#61${色值}#59X#6110#59Y#61${y}#59H#6125#125`
        内容 += `#123S#61${大数值整数简写(值)}#59X#61115#59Y#61${y}#59H#6125#59HINT#61${值}#125`
        内容 += `#123S#61${计算位数(值)}位#59X#61220#59Y#61${y}#59H#6125#125`
    }
    Player.SetClientUIProperty('新属性显示', `SayText=${内容}`)
}

export function 属性下一页(Player: TPlayObject): void {
    const 总页数 = Math.ceil(属性配置.length / 每页条数)
    const 新页码 = ((Player.R.属性页码 || 0) + 1) % 总页数
    显示属性页面(Player, 新页码)
}

// ==================== 技能显示页面 ====================
const 本职业技能配置: { [job: number]: string[] } = {
    0: ['攻杀剑术', '半月弯刀'],
    1: ['雷电术', '暴风雪'],
    2: ['灵魂火符', '飓风破'],
    3: ['暴击术', '霜月'],
    4: ['精准箭术', '万箭齐发'],
    5: ['罗汉棍法', '天雷阵'],
}

const 新职业技能配置: { [职业: string]: string[] } = {
    '天枢': ['怒斩', '人之怒', '地之怒', '天之怒', '神之怒'],
    '血神': ['血气献祭', '血气燃烧', '血气吸纳', '血气迸发', '血魔临身'],
    '暗影': ['暗影猎取', '暗影袭杀', '暗影剔骨', '暗影风暴', '暗影附体'],
    '烈焰': ['火焰追踪', '火镰狂舞', '烈焰护甲', '爆裂火冢', '烈焰突袭'],
    '正义': ['圣光', '行刑', '洗礼', '审判', '神罚'],
    '不动': ['如山', '泰山', '人王盾', '铁布衫', '金刚掌'],
}

export function 显示技能页面(Player: TPlayObject): void {
    const 本职技能 = 本职业技能配置[Player.Job] || []
    const 新职技能 = Player.V.职业 ? (新职业技能配置[Player.V.职业] || []) : []

    let 内容 = ''
    let 行号 = 0

    // 本职业技能等级
    for (const 技能名 of 本职技能) {
        const 等级 = String((Player.V as any)[`${技能名}等级`] || 0)
        const y = 行号 * 25
        内容 += `#123S#61${技能名}#59X#610#59Y#61${y}#59H#6125#125`
        内容 += `#123S#61${大数值整数简写(等级)}级#59C#61146#59X#61100#59Y#61${y}#59H#6125#59HINT#61等级:${等级}#125`
        内容 += `#123S#61${计算位数(等级)}位#59X#61200#59Y#61${y}#59H#6125#125`
        行号++
    }

    // 新职业技能等级
    for (const 技能名 of 新职技能) {
        const 等级 = String((Player.V as any)[`${技能名}等级`] || 0)
        const y = 行号 * 25
        内容 += `#123S#61${技能名}#59X#610#59Y#61${y}#59H#6125#125`
        内容 += `#123S#61${大数值整数简写(等级)}级#59C#61146#59X#61100#59Y#61${y}#59H#6125#59HINT#61等级:${等级}#125`
        内容 += `#123S#61${计算位数(等级)}位#59X#61200#59Y#61${y}#59H#6125#125`
        行号++
    }

    // 本职业技能魔次
    for (const 技能名 of 本职技能) {
        const 魔次 = (Player.R as any)[`${技能名}魔次`] || '0'
        const y = 行号 * 25
        内容 += `#123S#61${技能名}#59X#610#59Y#61${y}#59H#6125#125`
        内容 += `#123S#61${大数值整数简写(魔次)}魔次#59C#61149#59X#61100#59Y#61${y}#59H#6125#59HINT#61魔次:${魔次}#125`
        内容 += `#123S#61${计算位数(魔次)}位#59X#61200#59Y#61${y}#59H#6125#125`
        行号++
    }

    // 新职业技能魔次
    for (const 技能名 of 新职技能) {
        const 魔次 = (Player.R as any)[`${技能名}魔次`] || '0'
        const y = 行号 * 25
        内容 += `#123S#61${技能名}#59X#610#59Y#61${y}#59H#6125#125`
        内容 += `#123S#61${大数值整数简写(魔次)}魔次#59C#61149#59X#61100#59Y#61${y}#59H#6125#59HINT#61魔次:${魔次}#125`
        内容 += `#123S#61${计算位数(魔次)}位#59X#61200#59Y#61${y}#59H#6125#125`
        行号++
    }

    Player.SetClientUIProperty('技能详细信息', `SayText=${内容}`)
}
