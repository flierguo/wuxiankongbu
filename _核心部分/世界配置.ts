// ==================== 锚点计算函数（大数值版） ====================
import { 智能计算 } from '../_大数值/核心计算方法'

/**
 * ============================================================================
 * 世界配置 - 统一管理大陆、地图、生物、装备配置
 * ============================================================================
 * 
 * 【核心设计理念】
 * 地图星级 → 生物属性 → 装备属性 三者紧密关联
 * 只需调整核心配置，所有数值自动联动更新
 * 
 * 【核心公式】
 * 1. 星级倍数 = 根据星级区间自动计算（支持5倍/10倍递增配置）
 * 2. 生物属性 = 生物基础值 × 星级倍数 × TAG倍数 × 难度系数
 * 3. 装备属性 = 装备品质基础 × 星级倍数 × 随机倍数 × 极品倍率 × 神器倍数 × 怪物装备倍数
 * 
 * 【设计原则】
 * 1. 星级驱动：地图固定星级是核心常量，所有数值基于星级计算
 * 2. 分段递增：不同星级区间可配置不同递增倍数（5倍/10倍）
 * 3. 品质关联：装备品质决定基础数值，与星级倍数相乘得到最终属性
 * 4. 性能优先：减少大数值乘法次数，降低CPU消耗
 * 
 * 【快速调整指南】
 * - 调整难度递增速度：修改 星级递增配置
 * - 调整怪物类型差异：修改 TAG倍数配置
 * - 调整副本难度差异：修改 难度系数配置
 * - 调整装备品质差异：修改 装备品质配置
 * - 调整基础数值：修改 生物基础值配置 / 装备基础值配置
 * 
 * ============================================================================
 */

// ==================== 星级递增配置（核心配置） ====================
/**
 * 星级递增配置 - 控制不同星级区间的属性递增倍数
 * 
 * 【配置说明】
 * - 起始星级: 该区间的起始星级（包含）
 * - 递增倍数: 每升1星，属性乘以该倍数
 * 
 * 【示例】
 * - 星级1-100: 每升1星，属性×5
 * - 星级101-105: 每升1星，属性×5
 * - 星级106-110: 每升1星，属性×10
 * - 星级111+: 每升1星，属性×10
 * 
 * 【计算示例】
 * - 星级100的倍数 = 5^99 = 极大数值
 * - 星级105的倍数 = 5^99 × 5^5
 * - 星级110的倍数 = 5^99 × 5^5 × 10^5
 */
export const 星级递增配置 = [
    { 起始星级: 1, 递增倍数: 5 },      // 1-100星: 5倍递增（新手到中期）
    { 起始星级: 101, 递增倍数: 5 },    // 101-105星: 5倍递增（过渡期）
    { 起始星级: 106, 递增倍数: 10 },   // 106-110星: 10倍递增（中后期）
    { 起始星级: 111, 递增倍数: 10 },   // 111+星: 10倍递增（后期）
] as const

/**
 * 根据星级计算总倍数（大数值版）
 * 
 * @param 星级 地图固定星级
 * @returns 星级倍数（字符串，支持大数值）
 * 
 * 【计算逻辑】
 * 遍历每个星级区间，使用大数值幂运算累乘对应的递增倍数
 * 
 * 【性能优化】
 * 使用智能计算 mode 7（幂运算）代替 Math.pow，支持超大数值
 * 例如：星级2000时，10^1890 远超 Number.MAX_VALUE，必须用大数值
 */
export function 计算星级倍数(星级: number): string {
    if (星级 <= 0) return '1'
    if (星级 === 1) return '1'
    
    let 总倍数 = '1'
    let 当前星级 = 1
    
    for (let i = 0; i < 星级递增配置.length; i++) {
        const 当前区间 = 星级递增配置[i]
        const 下一区间起始 = 星级递增配置[i + 1]?.起始星级 || Infinity
        
        // 计算在当前区间需要递增的星级数
        const 区间结束星级 = Math.min(星级, 下一区间起始 - 1)
        const 递增次数 = 区间结束星级 - 当前星级
        
        if (递增次数 > 0) {
            // 使用大数值幂运算：倍数^递增次数（mode 7）
            // 避免 Math.pow 在高星级时溢出（如 10^1890）
            const 区间倍数 = 智能计算(String(当前区间.递增倍数), String(递增次数), 7)
            总倍数 = 智能计算(总倍数, 区间倍数, 3)
            当前星级 = 区间结束星级
        }
        
        if (当前星级 >= 星级) break
    }
    
    return 总倍数
}

// ==================== 难度系数配置 ====================
/**
 * 难度系数配置表 - 副本难度额外倍数
 * 
 * 【设计原则】
 * - 难度系数是在星级倍数基础上的额外加成
 * - 同一地图不同难度，星级相同但难度系数不同
 */
export const 难度系数配置 = {
    简单: 1,      // 基准难度
    普通: 5,      // 3倍
    困难: 25,     // 10倍
    精英: 100,     // 30倍
    炼狱: 300,    // 100倍
    圣耀: 500,    // 300倍
} as const

// ==================== TAG倍数配置（生物多样性） ====================
/**
 * TAG倍数配置表 - 控制不同类型怪物的强度差异
 * 
 * 【设计原则】
 * - TAG1-5: 约2倍递增，形成清晰的难度阶梯
 * - TAG6(特殊BOSS): 杀怪2000后刷新的强力BOSS
 * - TAG7(大陆BOSS): 全大陆刷新的最强BOSS
 * 
 * 【计算公式】
 * 生物属性 = 生物基础值 × 星级倍数 × TAG倍数 × 难度系数
 */
export const TAG倍数配置: Record<number, number> = {
    1: 1,       // 基础小怪 - 基准
    2: 2,       // 挑战小怪 - 2倍
    3: 4,       // 稀有怪物 - 4倍
    4: 8,       // 精英怪物 - 8倍
    5: 16,      // 首领怪物 - 16倍
    6: 50,      // 特殊BOSS - 50倍（杀怪2000后刷新）
    7: 160,     // 大陆BOSS - 160倍（最强，全大陆刷新）
} as const

// ==================== 生物基础值配置 ====================
/**
 * 生物基础值配置 - 所有生物属性计算的基础
 * 
 * 【计算公式】
 * 实际属性 = 基础值 × 星级倍数 × TAG倍数 × 难度系数
 * 
 * 【注意】
 * 这里的基础值是小数值，大数值由星级倍数提供
 * 最终属性 = 基础值 × 星级倍数（大数值）
 */
export const 生物基础值配置 = {
    血量: 20000,   // 血量基础值（小数值，大数值由星级倍数提供）
    攻击: 100,    // 攻击基础值
    防御: 50,     // 防御基础值
} as const

// ==================== 装备品质配置（核心配置） ====================
/**
 * 装备品质配置 - 根据品质设置基础数值
 * 
 * 【设计原则】
 * - 品质决定装备的基础强度
 * - 基础数值 × 星级倍数 × 其他倍率 = 最终属性
 * 
 * 【品质等级】
 * - 普通(白): 基础×1
 * - 优秀(绿): 基础×2
 * - 稀有(蓝): 基础×4
 * - 史诗(紫): 基础×8
 * - 传说(橙): 基础×16
 * - 神话(金): 基础×32
 * - 神器(红): 基础×64 + 神器倍数
 */
export const 装备品质配置 = {
    普通: { 颜色: 255, 基础倍数: 1, 词条数: { min: 1, max: 3 } },
    优秀: { 颜色: 250, 基础倍数: 2, 词条数: { min: 2, max: 4 } },
    稀有: { 颜色: 154, 基础倍数: 4, 词条数: { min: 3, max: 5 } },
    史诗: { 颜色: 254, 基础倍数: 8, 词条数: { min: 4, max: 6 } },
    传说: { 颜色: 251, 基础倍数: 16, 词条数: { min: 5, max: 7 } },
    神话: { 颜色: 244, 基础倍数: 32, 词条数: { min: 6, max: 8 } },
    神器: { 颜色: 249, 基础倍数: 64, 词条数: { min: 7, max: 8 } },
} as const

/**
 * 根据词条数获取装备品质
 */
export function 获取装备品质(总词条数: number, 是否神器: boolean): keyof typeof 装备品质配置 {
    if (是否神器) return '神器'
    if (总词条数 >= 13) return '神话'
    if (总词条数 >= 10) return '传说'
    if (总词条数 >= 8) return '史诗'
    if (总词条数 >= 6) return '稀有'
    if (总词条数 >= 4) return '优秀'
    return '普通'
}

// ==================== 装备基础值配置 ====================
/**
 * 装备基础值配置 - 装备属性计算的基础
 * 
 * 【计算公式】
 * 最终属性 = 属性基础 × 品质倍数 × 星级倍数 × 随机倍数 × 极品倍率 × 神器倍数 × 怪物装备倍数
 * 
 * 【各倍率说明】
 * - 品质倍数: 由装备品质决定（1-64）
 * - 星级倍数: 由地图固定星级决定（大数值）
 * - 随机倍数: 0.3-1.7范围随机（增加多样性）
 * - 极品倍率: 玩家极品率触发时的额外倍数
 * - 神器倍数: 神器装备的额外倍数（1-10）
 * - 怪物装备倍数: 装备倍数怪掉落的额外倍数（3-20）
 */
export const 装备基础值配置 = {
    属性基础: 1000,    // 装备属性基础值
    魔次基础: 1,      // 魔次属性基础值
    随机倍数最小: 0.8,  // 随机倍数下限
    随机倍数最大: 2.5,  // 随机倍数上限
} as const

/**
 * 计算装备最终属性
 * 
 * @param 星级 地图固定星级
 * @param 品质 装备品质名称
 * @param 极品倍率 极品倍率（默认1）
 * @param 神器倍数 神器倍数（默认0，非神器）
 * @param 怪物装备倍数 怪物装备倍数（默认0，普通怪）
 * @returns 最终属性值（字符串，支持大数值）
 */
export function 计算装备属性(
    星级: number,
    品质: keyof typeof 装备品质配置,
    极品倍率: number = 1,
    神器倍数: number = 0,
    怪物装备倍数: number = 0
): string {
    // 1. 获取品质倍数
    const 品质配置 = 装备品质配置[品质]
    const 品质倍数 = 品质配置.基础倍数
    
    // 2. 获取星级倍数
    const 星级倍数 = 计算星级倍数(星级)
    
    // 3. 生成随机倍数
    const 随机倍数 = 装备基础值配置.随机倍数最小 + 
        Math.random() * (装备基础值配置.随机倍数最大 - 装备基础值配置.随机倍数最小)
    
    // 4. 计算总倍数（先合并小数值倍数，减少大数值乘法次数）
    let 小数值总倍数 = 装备基础值配置.属性基础 * 品质倍数 * 随机倍数
    if (极品倍率 > 1) 小数值总倍数 *= 极品倍率
    if (神器倍数 > 0) 小数值总倍数 *= 神器倍数
    if (怪物装备倍数 > 0) 小数值总倍数 *= 怪物装备倍数
    
    // 5. 最后一次大数值乘法
    return 智能计算(星级倍数, String(小数值总倍数), 3)
}

// 难度列表（从难度系数配置自动生成）
export const 难度列表 = Object.keys(难度系数配置) as (keyof typeof 难度系数配置)[]

// ==================== 装备倍数怪配置 ====================
/**
 * 装备倍数怪配置
 * 
 * 【触发几率】1/100（1%）
 * 
 * 【倍数权重池】
 * - 10个3倍, 9个4倍, 8个5倍, 7个6倍, 6个7倍
 * - 5个8倍, 3个9-11倍, 2个12-15倍, 1个16-20倍
 * 
 * 【效果】
 * - 怪物变为金色
 * - 名称显示"装备属性翻倍*X倍"
 * - 掉落装备的基础属性翻X倍（魔次不翻倍）
 */
export const 装备倍数怪配置 = {
    触发几率: 100,  // 1/100 = 1%
    倍数池: [
        // 10个3倍
        3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
        // 9个4倍
        4, 4, 4, 4, 4, 4, 4, 4, 4,
        // 8个5倍
        5, 5, 5, 5, 5, 5, 5, 5,
        // 7个6倍
        6, 6, 6, 6, 6, 6, 6,
        // 6个7倍
        7, 7, 7, 7, 7, 7,
        // 5个8倍
        8, 8, 8, 8, 8,
        // 3个9-11倍
        9, 9, 9, 10, 10, 10, 11, 11, 11,
        // 2个12-15倍
        12, 12, 13, 13, 14, 14, 15, 15,
        // 1个16-20倍
        16, 17, 18, 19, 20,
    ] as const,
} as const

/**
 * 获取随机装备倍数
 * @returns 随机倍数值（3-20）
 */
export function 获取随机装备倍数(): number {
    const 池 = 装备倍数怪配置.倍数池
    return 池[Math.floor(Math.random() * 池.length)]
}

// ==================== 生物属性计算函数 ====================
/**
 * 计算生物最终属性
 * 
 * @param 星级 地图固定星级
 * @param TAG TAG类型（1-7）
 * @param 属性类型 属性类型（血量/攻击/防御）
 * @param 难度名 难度名称（默认简单）
 * @returns 最终属性值（字符串，支持大数值）
 * 
 * 【计算公式】
 * 生物属性 = 生物基础值 × 星级倍数 × TAG倍数 × 难度系数
 */
export function 计算生物属性(
    星级: number,
    TAG: number,
    属性类型: keyof typeof 生物基础值配置,
    难度名: keyof typeof 难度系数配置 = '简单'
): string {
    // 1. 获取基础值
    const 基础值 = 生物基础值配置[属性类型]
    
    // 2. 获取星级倍数
    const 星级倍数 = 计算星级倍数(星级)
    
    // 3. 获取TAG倍数
    const TAG系数 = TAG倍数配置[TAG] || 1
    
    // 4. 获取难度系数
    const 难度系数 = 难度系数配置[难度名]
    
    // 5. 合并小数值倍数，减少大数值乘法次数
    const 小数值总倍数 = 基础值 * TAG系数 * 难度系数
    
    // 6. 一次大数值乘法
    return 智能计算(星级倍数, String(小数值总倍数), 3)
}

// ==================== 圣耀副本难度配置 ====================
export const 圣耀难度配置 = {
    基础倍数: 30,
    每层递增: 5,
    最大倍数: 1000,
} as const

export const 固定副本数量 = 6  // 6个难度等级：简单、普通、困难、精英、炼狱、圣耀
export const 最大副本数 = 10

// ==================== TAG 刷怪比例常量 ====================
export const TAG刷怪比例 = {
    1: 0.50,   // 基础小怪 50%
    2: 0.25,   // 挑战小怪 25%
    3: 0.15,   // 稀有怪物 15%
    4: 0.08,   // 精英怪物 8%
    5: 0.02,   // 首领怪物 2%
    6: 0.005,  // 大陆BOSS 0.5%
} as const

// ==================== 刷怪密度配置 ====================
export const 刷怪密度 = {
    基础密度: 0.6,
    最小数量: 200,
    最大数量: 2000,
} as const

// ==================== 锚点系统配置 ====================
export interface 锚点配置 {
    锚点等级: number
    生物强度倍数: string
    装备等级基础: number
    星级倍数: string  // 新增：星级倍数
}

// ==================== 完整地图配置接口 ====================
/**
 * 完整地图配置 - 统一管理地图、生物、装备、大陆配置
 * 
 * 【核心字段】
 * - 固定星级: 地图的核心常量，所有数值基于此计算
 * - 地图强度: 用于显示和分类（可选，默认等于固定星级）
 */
export interface 完整地图配置项 {
    // === 基础信息 ===
    地图名: string
    下标: number
    需求等级: number

    // === 核心配置（星级驱动） ===
    固定星级: number        // 核心常量！所有数值基于此计算
    地图强度: number        // 显示用，默认等于固定星级

    // === 生物配置 ===
    生物强度倍数: string    // 可选的自定义倍数（覆盖星级计算）
    生物名字: string[]      // [TAG1小怪, TAG2挑战, TAG3稀有, TAG4精英, TAG5首领]

    // === 装备配置 ===
    装备属性倍数: number    // 可选的额外装备倍数

    // === 大陆配置 ===
    大陆名: string
    大陆编号: number
    大陆BOSS名字: string    // TAG6
    特殊BOSS名字: string    // TAG7

    // === 可选配置 ===
    地图宽度?: number
    地图高度?: number
}

// ==================== 核心配置表（只需修改这里） ====================
/**
 * 完整地图配置表 - 统一管理所有地图
 * 
 * 【核心设计】
 * - 固定星级是核心常量，所有数值基于星级自动计算
 * - 生物名字数组顺序: [TAG1小怪, TAG2挑战, TAG3稀有, TAG4精英, TAG5首领]
 * 
 * 【星级递增规则】（参考星级递增配置）
 * - 1-100星: 每升1星，属性×5
 * - 101-105星: 每升1星，属性×5
 * - 106-110星: 每升1星，属性×10
 * - 111+星: 每升1星，属性×10
 */
export const 完整地图配置: 完整地图配置项[] = [
    {
        地图名: '新手地图',
        下标: 1,
        需求等级: 1,
        固定星级: 1,        // 核心常量
        地图强度: 1,        // 显示用
        生物强度倍数: '',   // 空则使用星级自动计算
        生物名字: ['鸡', '稻草人', '洞蛆', '山洞蝙蝠', '蝎子'],
        装备属性倍数: 1,
        大陆名: '生化篇章',
        大陆编号: 1,
        大陆BOSS名字: '威斯克',
        特殊BOSS名字: '红后'
    },
    {
        地图名: '浣熊市',
        下标: 101,
        需求等级: 1,
        固定星级: 10,       // 星级10 = 5^9 倍数
        地图强度: 10,
        生物强度倍数: '',
        生物名字: ['丧尸', '变异丧尸', '舔食者', '猎杀者', '暴君'],
        装备属性倍数: 1,
        大陆名: '生化篇章',
        大陆编号: 1,
        大陆BOSS名字: '威斯克',
        特殊BOSS名字: '红后'
    },
    {
        地图名: '蜂巢入口',
        下标: 111,
        需求等级: 50,
        固定星级: 20,       // 星级20 = 5^19 倍数
        地图强度: 20,
        生物强度倍数: '',
        生物名字: ['蜂巢丧尸', '蜂巢变异体', '蜂巢舔食者', '蜂巢猎杀者', '蜂巢暴君'],
        装备属性倍数: 1,
        大陆名: '生化篇章',
        大陆编号: 1,
        大陆BOSS名字: '威斯克',
        特殊BOSS名字: '红后'
    },
    {
        地图名: '病毒研究室',
        下标: 121,
        需求等级: 100,
        固定星级: 30,       // 星级30 = 5^29 倍数
        地图强度: 30,
        生物强度倍数: '',
        生物名字: ['实验体A', '实验体B', '实验体C', '实验体D', '实验体X'],
        装备属性倍数: 1,
        大陆名: '生化篇章',
        大陆编号: 1,
        大陆BOSS名字: '威斯克',
        特殊BOSS名字: '红后'
    },
    {
        地图名: '生化实验室',
        下标: 131,
        需求等级: 150,
        固定星级: 40,       // 星级40 = 5^39 倍数
        地图强度: 40,
        生物强度倍数: '',
        生物名字: ['生化兵', '生化战士', '生化精英', '生化队长', '生化指挥官'],
        装备属性倍数: 1,
        大陆名: '生化篇章',
        大陆编号: 1,
        大陆BOSS名字: '威斯克',
        特殊BOSS名字: '红后'
    },
    {
        地图名: '激光走廊',
        下标: 141,
        需求等级: 200,
        固定星级: 50,       // 星级50 = 5^49 倍数
        地图强度: 50,
        生物强度倍数: '',
        生物名字: ['激光守卫', '激光战士', '激光精英', '激光队长', '激光指挥官'],
        装备属性倍数: 1,
        大陆名: '生化篇章',
        大陆编号: 1,
        大陆BOSS名字: '威斯克',
        特殊BOSS名字: '红后'
    },
    {
        地图名: '红后控制室',
        下标: 151,
        需求等级: 250,
        固定星级: 60,       // 星级60 = 5^59 倍数
        地图强度: 60,
        生物强度倍数: '',
        生物名字: ['红后守卫', '红后战士', '红后精英', '红后队长', '红后指挥官'],
        装备属性倍数: 1,
        大陆名: '生化篇章',
        大陆编号: 1,
        大陆BOSS名字: '威斯克',
        特殊BOSS名字: '红后'
    },
]

/**
 * 根据地图强度计算锚点（兼容旧版）
 * @param 地图强度 地图基础强度（现在等于固定星级）
 * @param 难度倍数 难度系数
 * @param 自定义强度倍数 可选的自定义生物强度倍数
 */
export function 计算锚点(地图强度: number, 难度倍数: number = 1, 自定义强度倍数?: string): 锚点配置 {
    // 使用星级计算倍数
    const 星级倍数 = 计算星级倍数(地图强度)
    
    // 如果有自定义强度倍数，使用自定义值
    let 生物强度倍数 = 星级倍数
    if (自定义强度倍数 && 自定义强度倍数 !== '') {
        生物强度倍数 = 自定义强度倍数
    }
    
    // 应用难度系数
    if (难度倍数 > 1) {
        生物强度倍数 = 智能计算(生物强度倍数, String(难度倍数), 3)
    }

    return {
        锚点等级: 地图强度 * 难度倍数,
        生物强度倍数,
        装备等级基础: 地图强度,
        星级倍数,  // 新增：返回原始星级倍数
    }
}

/**
 * 计算圣耀副本的生物强度倍数
 */
export function 计算圣耀强度倍数(基础强度倍数: string, 圣耀倍率: number): string {
    const 圣耀难度 = 圣耀难度配置.基础倍数 + (圣耀倍率 - 1) * 圣耀难度配置.每层递增
    const 实际倍数 = Math.min(圣耀难度, 圣耀难度配置.最大倍数)
    return 智能计算(基础强度倍数, String(实际倍数), 3)
}

// ==================== 辅助函数 ====================

/** 根据地图名获取完整配置（支持包含难度后缀的地图名） */
export function 取完整地图配置(地图名: string): 完整地图配置项 | null {
    // 先尝试精确匹配
    let 配置 = 完整地图配置.find(c => c.地图名 === 地图名)
    if (配置) return 配置
    
    // 再尝试包含匹配（处理带难度后缀的地图名，如 "浣熊市«普通»"）
    配置 = 完整地图配置.find(c => 地图名.includes(c.地图名))
    return 配置 || null
}

/** 根据大陆名获取该大陆的所有地图 */
export function 取大陆地图列表(大陆名: string): 完整地图配置项[] {
    return 完整地图配置.filter(c => c.大陆名 === 大陆名)
}

/** 获取所有地图名 */
export function 取所有地图名(): string[] {
    return 完整地图配置.map(c => c.地图名)
}

/** 获取所有大陆名（去重） */
export function 取所有大陆名(): string[] {
    return [...new Set(完整地图配置.map(c => c.大陆名))]
}

/** 获取地图的生物名字 */
export function 取生物名字(地图名: string, TAG尾数: number): string {
    const 配置 = 取完整地图配置(地图名)
    if (!配置) {
        return `${地图名}怪物`
    }

    // TAG6 = 特殊BOSS（杀怪2000后刷新）
    if (TAG尾数 === 6) {
        return 配置.特殊BOSS名字
    }

    // TAG7 = 大陆BOSS（全大陆刷新）
    if (TAG尾数 === 7) {
        return 配置.大陆BOSS名字
    }

    // TAG1-5 从生物名字数组获取
    const 索引 = TAG尾数 - 1
    if (索引 >= 0 && 索引 < 配置.生物名字.length) {
        return 配置.生物名字[索引]
    }

    // 默认名字
    const 类型名 = ['', '小怪', '精英', '稀有', '精英首领', '首领']
    return `${地图名}${类型名[TAG尾数] || '怪物'}`
}

/** 获取难度配置（返回难度系数） */
export function 取难度配置(难度名: string): number {
    return 难度系数配置[难度名 as keyof typeof 难度系数配置] || 1
}

/** 智能计算刷怪数量 */
export function 智能计算刷怪数量(AMap: TEnvirnoment | null): number {
    if (!AMap) return 刷怪密度.最小数量

    const 宽度 = AMap.GetMapWidth() || 100
    const 高度 = AMap.GetMapHeight() || 100
    const 面积 = 宽度 * 高度

    let 数量 = Math.floor(面积 * 刷怪密度.基础密度 / 50)
    数量 = Math.max(刷怪密度.最小数量, Math.min(刷怪密度.最大数量, 数量))

    return 数量
}

/** 智能计算刷怪坐标 */
export function 智能计算刷怪坐标(AMap: TEnvirnoment): { x: number, y: number, 范围: number } {
    const 宽度 = AMap?.GetMapWidth() || 100
    const 高度 = AMap?.GetMapHeight() || 100

    const x = Math.floor(宽度 / 2)
    const y = Math.floor(高度 / 2)
    const 范围 = Math.floor(Math.max(宽度, 高度) / 2)

    return { x, y, 范围 }
}
